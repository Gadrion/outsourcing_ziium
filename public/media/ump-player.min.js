/*******************************************************************************
 * Copyright (c) 2018 Hanwha Techwin Co., Ltd.
 * Licensed to the Hanwha Techwin Software Foundation under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Total Plugin-Free Web Browser Viewer Framework 
 * http://www.hanwhatechwin.com
 *
 * Security Solution Development Division / Web Software Development Team
 *
 * Summary: ump-player
 * Description: UMP Framework 3.1.2.0021
 * @file ump-player_16-04-2019.js
 * @version 3.1.2.0021
 * @since 16-04-2019
 * @author by Youngho Kim (young.ho.kim@hanwha.com), 
 *              by Yongsoo Ko (yongsoo.ko@hanwha.com), 
 *              by Miju Park (miju462.park@hanwha.com), 
 *              by Sweungwon Cheung (sw.cheung@hanwha.com), 
 *              by Jongchan Park (jden.park@hanwha.com), 
 *              by Changehee Song (changh.song@hanwha.com), 
 */

var CryptoJS=CryptoJS||function(e,t){var n={},i=n.lib={},r=function(){},a=i.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),s=n.enc={},l=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(n,t)}},u=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,r=e.min(4*t,r),t){for(var l=0;l<t;l+=a)this._doProcessBlock(i,l);l=i.splice(0,t),n.sigBytes-=r}return new o.init(l,r)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=d.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new p.HMAC.init(e,n).finalize(t)}}});var p=n.algo={};return n}(Math);!function(e){function t(e,t,n,i,r,a,o){return((e=e+(t&n|~t&i)+r+o)<<a|e>>>32-a)+t}function n(e,t,n,i,r,a,o){return((e=e+(t&i|n&~i)+r+o)<<a|e>>>32-a)+t}function i(e,t,n,i,r,a,o){return((e=e+(t^n^i)+r+o)<<a|e>>>32-a)+t}function r(e,t,n,i,r,a,o){return((e=e+(n^(t|~i))+r+o)<<a|e>>>32-a)+t}for(var a=CryptoJS,o=(l=a.lib).WordArray,s=l.Hasher,l=a.algo,c=[],u=0;64>u;u++)c[u]=4294967296*e.abs(e.sin(u+1))|0;l=l.MD5=s.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,a){for(var o=0;16>o;o++){var s=e[d=a+o];e[d]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}o=this._hash.words;var l,u,d=e[a+0],p=(s=e[a+1],e[a+2]),h=e[a+3],m=e[a+4],f=e[a+5],g=e[a+6],v=e[a+7],y=e[a+8],b=e[a+9],w=e[a+10],C=e[a+11],S=e[a+12],_=e[a+13],T=e[a+14],x=e[a+15],E=o[0],I=r(I=r(I=r(I=r(I=i(I=i(I=i(I=i(I=n(I=n(I=n(I=n(I=t(I=t(I=t(I=t(I=o[1],u=t(u=o[2],l=t(l=o[3],E=t(E,I,u,l,d,7,c[0]),I,u,s,12,c[1]),E,I,p,17,c[2]),l,E,h,22,c[3]),u=t(u,l=t(l,E=t(E,I,u,l,m,7,c[4]),I,u,f,12,c[5]),E,I,g,17,c[6]),l,E,v,22,c[7]),u=t(u,l=t(l,E=t(E,I,u,l,y,7,c[8]),I,u,b,12,c[9]),E,I,w,17,c[10]),l,E,C,22,c[11]),u=t(u,l=t(l,E=t(E,I,u,l,S,7,c[12]),I,u,_,12,c[13]),E,I,T,17,c[14]),l,E,x,22,c[15]),u=n(u,l=n(l,E=n(E,I,u,l,s,5,c[16]),I,u,g,9,c[17]),E,I,C,14,c[18]),l,E,d,20,c[19]),u=n(u,l=n(l,E=n(E,I,u,l,f,5,c[20]),I,u,w,9,c[21]),E,I,x,14,c[22]),l,E,m,20,c[23]),u=n(u,l=n(l,E=n(E,I,u,l,b,5,c[24]),I,u,T,9,c[25]),E,I,h,14,c[26]),l,E,y,20,c[27]),u=n(u,l=n(l,E=n(E,I,u,l,_,5,c[28]),I,u,p,9,c[29]),E,I,v,14,c[30]),l,E,S,20,c[31]),u=i(u,l=i(l,E=i(E,I,u,l,f,4,c[32]),I,u,y,11,c[33]),E,I,C,16,c[34]),l,E,T,23,c[35]),u=i(u,l=i(l,E=i(E,I,u,l,s,4,c[36]),I,u,m,11,c[37]),E,I,v,16,c[38]),l,E,w,23,c[39]),u=i(u,l=i(l,E=i(E,I,u,l,_,4,c[40]),I,u,d,11,c[41]),E,I,h,16,c[42]),l,E,g,23,c[43]),u=i(u,l=i(l,E=i(E,I,u,l,b,4,c[44]),I,u,S,11,c[45]),E,I,x,16,c[46]),l,E,p,23,c[47]),u=r(u,l=r(l,E=r(E,I,u,l,d,6,c[48]),I,u,v,10,c[49]),E,I,T,15,c[50]),l,E,f,21,c[51]),u=r(u,l=r(l,E=r(E,I,u,l,S,6,c[52]),I,u,h,10,c[53]),E,I,w,15,c[54]),l,E,s,21,c[55]),u=r(u,l=r(l,E=r(E,I,u,l,y,6,c[56]),I,u,x,10,c[57]),E,I,g,15,c[58]),l,E,_,21,c[59]),u=r(u,l=r(l,E=r(E,I,u,l,m,6,c[60]),I,u,C,10,c[61]),E,I,p,15,c[62]),l,E,b,21,c[63]);o[0]=o[0]+E|0,o[1]=o[1]+I|0,o[2]=o[2]+u|0,o[3]=o[3]+l|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var a=e.floor(i/4294967296);for(n[15+(r+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n[14+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,i=0;4>i;i++)r=n[i],n[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return t},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=s._createHelper(l),a.HmacMD5=s._createHmacHelper(l)}(Math),eval(function(e,t,n,i,r,a){if(r=function(e){return(e<62?"":r(parseInt(e/62)))+((e%=62)>35?String.fromCharCode(e+29):e.toString(36))},!"".replace(/^/,String)){for(;n--;)a[r(n)]=i[n]||r(n);i=[function(e){return a[e]}],r=function(){return"\\w+"},n=1}for(;n--;)i[n]&&(e=e.replace(new RegExp("\\b"+r(n)+"\\b","g"),i[n]));return e}("9 17={3i:'0.1.3',16:1e-6};l v(){}v.23={e:l(i){8(i<1||i>7.4.q)?w:7.4[i-1]},2R:l(){8 7.4.q},1u:l(){8 F.1x(7.2u(7))},24:l(a){9 n=7.4.q;9 V=a.4||a;o(n!=V.q){8 1L}J{o(F.13(7.4[n-1]-V[n-1])>17.16){8 1L}}H(--n);8 2x},1q:l(){8 v.u(7.4)},1b:l(a){9 b=[];7.28(l(x,i){b.19(a(x,i))});8 v.u(b)},28:l(a){9 n=7.4.q,k=n,i;J{i=k-n;a(7.4[i],i+1)}H(--n)},2q:l(){9 r=7.1u();o(r===0){8 7.1q()}8 7.1b(l(x){8 x/r})},1C:l(a){9 V=a.4||a;9 n=7.4.q,k=n,i;o(n!=V.q){8 w}9 b=0,1D=0,1F=0;7.28(l(x,i){b+=x*V[i-1];1D+=x*x;1F+=V[i-1]*V[i-1]});1D=F.1x(1D);1F=F.1x(1F);o(1D*1F===0){8 w}9 c=b/(1D*1F);o(c<-1){c=-1}o(c>1){c=1}8 F.37(c)},1m:l(a){9 b=7.1C(a);8(b===w)?w:(b<=17.16)},34:l(a){9 b=7.1C(a);8(b===w)?w:(F.13(b-F.1A)<=17.16)},2k:l(a){9 b=7.2u(a);8(b===w)?w:(F.13(b)<=17.16)},2j:l(a){9 V=a.4||a;o(7.4.q!=V.q){8 w}8 7.1b(l(x,i){8 x+V[i-1]})},2C:l(a){9 V=a.4||a;o(7.4.q!=V.q){8 w}8 7.1b(l(x,i){8 x-V[i-1]})},22:l(k){8 7.1b(l(x){8 x*k})},x:l(k){8 7.22(k)},2u:l(a){9 V=a.4||a;9 i,2g=0,n=7.4.q;o(n!=V.q){8 w}J{2g+=7.4[n-1]*V[n-1]}H(--n);8 2g},2f:l(a){9 B=a.4||a;o(7.4.q!=3||B.q!=3){8 w}9 A=7.4;8 v.u([(A[1]*B[2])-(A[2]*B[1]),(A[2]*B[0])-(A[0]*B[2]),(A[0]*B[1])-(A[1]*B[0])])},2A:l(){9 m=0,n=7.4.q,k=n,i;J{i=k-n;o(F.13(7.4[i])>F.13(m)){m=7.4[i]}}H(--n);8 m},2Z:l(x){9 a=w,n=7.4.q,k=n,i;J{i=k-n;o(a===w&&7.4[i]==x){a=i+1}}H(--n);8 a},3g:l(){8 S.2X(7.4)},2d:l(){8 7.1b(l(x){8 F.2d(x)})},2V:l(x){8 7.1b(l(y){8(F.13(y-x)<=17.16)?x:y})},1o:l(a){o(a.K){8 a.1o(7)}9 V=a.4||a;o(V.q!=7.4.q){8 w}9 b=0,2b;7.28(l(x,i){2b=x-V[i-1];b+=2b*2b});8 F.1x(b)},3a:l(a){8 a.1h(7)},2T:l(a){8 a.1h(7)},1V:l(t,a){9 V,R,x,y,z;2S(7.4.q){27 2:V=a.4||a;o(V.q!=2){8 w}R=S.1R(t).4;x=7.4[0]-V[0];y=7.4[1]-V[1];8 v.u([V[0]+R[0][0]*x+R[0][1]*y,V[1]+R[1][0]*x+R[1][1]*y]);1I;27 3:o(!a.U){8 w}9 C=a.1r(7).4;R=S.1R(t,a.U).4;x=7.4[0]-C[0];y=7.4[1]-C[1];z=7.4[2]-C[2];8 v.u([C[0]+R[0][0]*x+R[0][1]*y+R[0][2]*z,C[1]+R[1][0]*x+R[1][1]*y+R[1][2]*z,C[2]+R[2][0]*x+R[2][1]*y+R[2][2]*z]);1I;2P:8 w}},1t:l(a){o(a.K){9 P=7.4.2O();9 C=a.1r(P).4;8 v.u([C[0]+(C[0]-P[0]),C[1]+(C[1]-P[1]),C[2]+(C[2]-(P[2]||0))])}1d{9 Q=a.4||a;o(7.4.q!=Q.q){8 w}8 7.1b(l(x,i){8 Q[i-1]+(Q[i-1]-x)})}},1N:l(){9 V=7.1q();2S(V.4.q){27 3:1I;27 2:V.4.19(0);1I;2P:8 w}8 V},2n:l(){8'['+7.4.2K(', ')+']'},26:l(a){7.4=(a.4||a).2O();8 7}};v.u=l(a){9 V=25 v();8 V.26(a)};v.i=v.u([1,0,0]);v.j=v.u([0,1,0]);v.k=v.u([0,0,1]);v.2J=l(n){9 a=[];J{a.19(F.2F())}H(--n);8 v.u(a)};v.1j=l(n){9 a=[];J{a.19(0)}H(--n);8 v.u(a)};l S(){}S.23={e:l(i,j){o(i<1||i>7.4.q||j<1||j>7.4[0].q){8 w}8 7.4[i-1][j-1]},33:l(i){o(i>7.4.q){8 w}8 v.u(7.4[i-1])},2E:l(j){o(j>7.4[0].q){8 w}9 a=[],n=7.4.q,k=n,i;J{i=k-n;a.19(7.4[i][j-1])}H(--n);8 v.u(a)},2R:l(){8{2D:7.4.q,1p:7.4[0].q}},2D:l(){8 7.4.q},1p:l(){8 7.4[0].q},24:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}o(7.4.q!=M.q||7.4[0].q!=M[0].q){8 1L}9 b=7.4.q,15=b,i,G,10=7.4[0].q,j;J{i=15-b;G=10;J{j=10-G;o(F.13(7.4[i][j]-M[i][j])>17.16){8 1L}}H(--G)}H(--b);8 2x},1q:l(){8 S.u(7.4)},1b:l(a){9 b=[],12=7.4.q,15=12,i,G,10=7.4[0].q,j;J{i=15-12;G=10;b[i]=[];J{j=10-G;b[i][j]=a(7.4[i][j],i+1,j+1)}H(--G)}H(--12);8 S.u(b)},2i:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}8(7.4.q==M.q&&7.4[0].q==M[0].q)},2j:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}o(!7.2i(M)){8 w}8 7.1b(l(x,i,j){8 x+M[i-1][j-1]})},2C:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}o(!7.2i(M)){8 w}8 7.1b(l(x,i,j){8 x-M[i-1][j-1]})},2B:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}8(7.4[0].q==M.q)},22:l(a){o(!a.4){8 7.1b(l(x){8 x*a})}9 b=a.1u?2x:1L;9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}o(!7.2B(M)){8 w}9 d=7.4.q,15=d,i,G,10=M[0].q,j;9 e=7.4[0].q,4=[],21,20,c;J{i=15-d;4[i]=[];G=10;J{j=10-G;21=0;20=e;J{c=e-20;21+=7.4[i][c]*M[c][j]}H(--20);4[i][j]=21}H(--G)}H(--d);9 M=S.u(4);8 b?M.2E(1):M},x:l(a){8 7.22(a)},32:l(a,b,c,d){9 e=[],12=c,i,G,j;9 f=7.4.q,1p=7.4[0].q;J{i=c-12;e[i]=[];G=d;J{j=d-G;e[i][j]=7.4[(a+i-1)%f][(b+j-1)%1p]}H(--G)}H(--12);8 S.u(e)},31:l(){9 a=7.4.q,1p=7.4[0].q;9 b=[],12=1p,i,G,j;J{i=1p-12;b[i]=[];G=a;J{j=a-G;b[i][j]=7.4[j][i]}H(--G)}H(--12);8 S.u(b)},1y:l(){8(7.4.q==7.4[0].q)},2A:l(){9 m=0,12=7.4.q,15=12,i,G,10=7.4[0].q,j;J{i=15-12;G=10;J{j=10-G;o(F.13(7.4[i][j])>F.13(m)){m=7.4[i][j]}}H(--G)}H(--12);8 m},2Z:l(x){9 a=w,12=7.4.q,15=12,i,G,10=7.4[0].q,j;J{i=15-12;G=10;J{j=10-G;o(7.4[i][j]==x){8{i:i+1,j:j+1}}}H(--G)}H(--12);8 w},30:l(){o(!7.1y){8 w}9 a=[],n=7.4.q,k=n,i;J{i=k-n;a.19(7.4[i][i])}H(--n);8 v.u(a)},1K:l(){9 M=7.1q(),1c;9 n=7.4.q,k=n,i,1s,1n=7.4[0].q,p;J{i=k-n;o(M.4[i][i]==0){2e(j=i+1;j<k;j++){o(M.4[j][i]!=0){1c=[];1s=1n;J{p=1n-1s;1c.19(M.4[i][p]+M.4[j][p])}H(--1s);M.4[i]=1c;1I}}}o(M.4[i][i]!=0){2e(j=i+1;j<k;j++){9 a=M.4[j][i]/M.4[i][i];1c=[];1s=1n;J{p=1n-1s;1c.19(p<=i?0:M.4[j][p]-M.4[i][p]*a)}H(--1s);M.4[j]=1c}}}H(--n);8 M},3h:l(){8 7.1K()},2z:l(){o(!7.1y()){8 w}9 M=7.1K();9 a=M.4[0][0],n=M.4.q-1,k=n,i;J{i=k-n+1;a=a*M.4[i][i]}H(--n);8 a},3f:l(){8 7.2z()},2y:l(){8(7.1y()&&7.2z()===0)},2Y:l(){o(!7.1y()){8 w}9 a=7.4[0][0],n=7.4.q-1,k=n,i;J{i=k-n+1;a+=7.4[i][i]}H(--n);8 a},3e:l(){8 7.2Y()},1Y:l(){9 M=7.1K(),1Y=0;9 a=7.4.q,15=a,i,G,10=7.4[0].q,j;J{i=15-a;G=10;J{j=10-G;o(F.13(M.4[i][j])>17.16){1Y++;1I}}H(--G)}H(--a);8 1Y},3d:l(){8 7.1Y()},2W:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}9 T=7.1q(),1p=T.4[0].q;9 b=T.4.q,15=b,i,G,10=M[0].q,j;o(b!=M.q){8 w}J{i=15-b;G=10;J{j=10-G;T.4[i][1p+j]=M[i][j]}H(--G)}H(--b);8 T},2w:l(){o(!7.1y()||7.2y()){8 w}9 a=7.4.q,15=a,i,j;9 M=7.2W(S.I(a)).1K();9 b,1n=M.4[0].q,p,1c,2v;9 c=[],2c;J{i=a-1;1c=[];b=1n;c[i]=[];2v=M.4[i][i];J{p=1n-b;2c=M.4[i][p]/2v;1c.19(2c);o(p>=15){c[i].19(2c)}}H(--b);M.4[i]=1c;2e(j=0;j<i;j++){1c=[];b=1n;J{p=1n-b;1c.19(M.4[j][p]-M.4[i][p]*M.4[j][i])}H(--b);M.4[j]=1c}}H(--a);8 S.u(c)},3c:l(){8 7.2w()},2d:l(){8 7.1b(l(x){8 F.2d(x)})},2V:l(x){8 7.1b(l(p){8(F.13(p-x)<=17.16)?x:p})},2n:l(){9 a=[];9 n=7.4.q,k=n,i;J{i=k-n;a.19(v.u(7.4[i]).2n())}H(--n);8 a.2K('\\n')},26:l(a){9 i,4=a.4||a;o(1g(4[0][0])!='1f'){9 b=4.q,15=b,G,10,j;7.4=[];J{i=15-b;G=4[i].q;10=G;7.4[i]=[];J{j=10-G;7.4[i][j]=4[i][j]}H(--G)}H(--b);8 7}9 n=4.q,k=n;7.4=[];J{i=k-n;7.4.19([4[i]])}H(--n);8 7}};S.u=l(a){9 M=25 S();8 M.26(a)};S.I=l(n){9 a=[],k=n,i,G,j;J{i=k-n;a[i]=[];G=k;J{j=k-G;a[i][j]=(i==j)?1:0}H(--G)}H(--n);8 S.u(a)};S.2X=l(a){9 n=a.q,k=n,i;9 M=S.I(n);J{i=k-n;M.4[i][i]=a[i]}H(--n);8 M};S.1R=l(b,a){o(!a){8 S.u([[F.1H(b),-F.1G(b)],[F.1G(b),F.1H(b)]])}9 d=a.1q();o(d.4.q!=3){8 w}9 e=d.1u();9 x=d.4[0]/e,y=d.4[1]/e,z=d.4[2]/e;9 s=F.1G(b),c=F.1H(b),t=1-c;8 S.u([[t*x*x+c,t*x*y-s*z,t*x*z+s*y],[t*x*y+s*z,t*y*y+c,t*y*z-s*x],[t*x*z-s*y,t*y*z+s*x,t*z*z+c]])};S.3b=l(t){9 c=F.1H(t),s=F.1G(t);8 S.u([[1,0,0],[0,c,-s],[0,s,c]])};S.39=l(t){9 c=F.1H(t),s=F.1G(t);8 S.u([[c,0,s],[0,1,0],[-s,0,c]])};S.38=l(t){9 c=F.1H(t),s=F.1G(t);8 S.u([[c,-s,0],[s,c,0],[0,0,1]])};S.2J=l(n,m){8 S.1j(n,m).1b(l(){8 F.2F()})};S.1j=l(n,m){9 a=[],12=n,i,G,j;J{i=n-12;a[i]=[];G=m;J{j=m-G;a[i][j]=0}H(--G)}H(--12);8 S.u(a)};l 14(){}14.23={24:l(a){8(7.1m(a)&&7.1h(a.K))},1q:l(){8 14.u(7.K,7.U)},2U:l(a){9 V=a.4||a;8 14.u([7.K.4[0]+V[0],7.K.4[1]+V[1],7.K.4[2]+(V[2]||0)],7.U)},1m:l(a){o(a.W){8 a.1m(7)}9 b=7.U.1C(a.U);8(F.13(b)<=17.16||F.13(b-F.1A)<=17.16)},1o:l(a){o(a.W){8 a.1o(7)}o(a.U){o(7.1m(a)){8 7.1o(a.K)}9 N=7.U.2f(a.U).2q().4;9 A=7.K.4,B=a.K.4;8 F.13((A[0]-B[0])*N[0]+(A[1]-B[1])*N[1]+(A[2]-B[2])*N[2])}1d{9 P=a.4||a;9 A=7.K.4,D=7.U.4;9 b=P[0]-A[0],2a=P[1]-A[1],29=(P[2]||0)-A[2];9 c=F.1x(b*b+2a*2a+29*29);o(c===0)8 0;9 d=(b*D[0]+2a*D[1]+29*D[2])/c;9 e=1-d*d;8 F.13(c*F.1x(e<0?0:e))}},1h:l(a){9 b=7.1o(a);8(b!==w&&b<=17.16)},2T:l(a){8 a.1h(7)},1v:l(a){o(a.W){8 a.1v(7)}8(!7.1m(a)&&7.1o(a)<=17.16)},1U:l(a){o(a.W){8 a.1U(7)}o(!7.1v(a)){8 w}9 P=7.K.4,X=7.U.4,Q=a.K.4,Y=a.U.4;9 b=X[0],1z=X[1],1B=X[2],1T=Y[0],1S=Y[1],1M=Y[2];9 c=P[0]-Q[0],2s=P[1]-Q[1],2r=P[2]-Q[2];9 d=-b*c-1z*2s-1B*2r;9 e=1T*c+1S*2s+1M*2r;9 f=b*b+1z*1z+1B*1B;9 g=1T*1T+1S*1S+1M*1M;9 h=b*1T+1z*1S+1B*1M;9 k=(d*g/f+h*e)/(g-h*h);8 v.u([P[0]+k*b,P[1]+k*1z,P[2]+k*1B])},1r:l(a){o(a.U){o(7.1v(a)){8 7.1U(a)}o(7.1m(a)){8 w}9 D=7.U.4,E=a.U.4;9 b=D[0],1l=D[1],1k=D[2],1P=E[0],1O=E[1],1Q=E[2];9 x=(1k*1P-b*1Q),y=(b*1O-1l*1P),z=(1l*1Q-1k*1O);9 N=v.u([x*1Q-y*1O,y*1P-z*1Q,z*1O-x*1P]);9 P=11.u(a.K,N);8 P.1U(7)}1d{9 P=a.4||a;o(7.1h(P)){8 v.u(P)}9 A=7.K.4,D=7.U.4;9 b=D[0],1l=D[1],1k=D[2],1w=A[0],18=A[1],1a=A[2];9 x=b*(P[1]-18)-1l*(P[0]-1w),y=1l*((P[2]||0)-1a)-1k*(P[1]-18),z=1k*(P[0]-1w)-b*((P[2]||0)-1a);9 V=v.u([1l*x-1k*z,1k*y-b*x,b*z-1l*y]);9 k=7.1o(P)/V.1u();8 v.u([P[0]+V.4[0]*k,P[1]+V.4[1]*k,(P[2]||0)+V.4[2]*k])}},1V:l(t,a){o(1g(a.U)=='1f'){a=14.u(a.1N(),v.k)}9 R=S.1R(t,a.U).4;9 C=a.1r(7.K).4;9 A=7.K.4,D=7.U.4;9 b=C[0],1E=C[1],1J=C[2],1w=A[0],18=A[1],1a=A[2];9 x=1w-b,y=18-1E,z=1a-1J;8 14.u([b+R[0][0]*x+R[0][1]*y+R[0][2]*z,1E+R[1][0]*x+R[1][1]*y+R[1][2]*z,1J+R[2][0]*x+R[2][1]*y+R[2][2]*z],[R[0][0]*D[0]+R[0][1]*D[1]+R[0][2]*D[2],R[1][0]*D[0]+R[1][1]*D[1]+R[1][2]*D[2],R[2][0]*D[0]+R[2][1]*D[1]+R[2][2]*D[2]])},1t:l(a){o(a.W){9 A=7.K.4,D=7.U.4;9 b=A[0],18=A[1],1a=A[2],2N=D[0],1l=D[1],1k=D[2];9 c=7.K.1t(a).4;9 d=b+2N,2h=18+1l,2o=1a+1k;9 Q=a.1r([d,2h,2o]).4;9 e=[Q[0]+(Q[0]-d)-c[0],Q[1]+(Q[1]-2h)-c[1],Q[2]+(Q[2]-2o)-c[2]];8 14.u(c,e)}1d o(a.U){8 7.1V(F.1A,a)}1d{9 P=a.4||a;8 14.u(7.K.1t([P[0],P[1],(P[2]||0)]),7.U)}},1Z:l(a,b){a=v.u(a);b=v.u(b);o(a.4.q==2){a.4.19(0)}o(b.4.q==2){b.4.19(0)}o(a.4.q>3||b.4.q>3){8 w}9 c=b.1u();o(c===0){8 w}7.K=a;7.U=v.u([b.4[0]/c,b.4[1]/c,b.4[2]/c]);8 7}};14.u=l(a,b){9 L=25 14();8 L.1Z(a,b)};14.X=14.u(v.1j(3),v.i);14.Y=14.u(v.1j(3),v.j);14.Z=14.u(v.1j(3),v.k);l 11(){}11.23={24:l(a){8(7.1h(a.K)&&7.1m(a))},1q:l(){8 11.u(7.K,7.W)},2U:l(a){9 V=a.4||a;8 11.u([7.K.4[0]+V[0],7.K.4[1]+V[1],7.K.4[2]+(V[2]||0)],7.W)},1m:l(a){9 b;o(a.W){b=7.W.1C(a.W);8(F.13(b)<=17.16||F.13(F.1A-b)<=17.16)}1d o(a.U){8 7.W.2k(a.U)}8 w},2k:l(a){9 b=7.W.1C(a.W);8(F.13(F.1A/2-b)<=17.16)},1o:l(a){o(7.1v(a)||7.1h(a)){8 0}o(a.K){9 A=7.K.4,B=a.K.4,N=7.W.4;8 F.13((A[0]-B[0])*N[0]+(A[1]-B[1])*N[1]+(A[2]-B[2])*N[2])}1d{9 P=a.4||a;9 A=7.K.4,N=7.W.4;8 F.13((A[0]-P[0])*N[0]+(A[1]-P[1])*N[1]+(A[2]-(P[2]||0))*N[2])}},1h:l(a){o(a.W){8 w}o(a.U){8(7.1h(a.K)&&7.1h(a.K.2j(a.U)))}1d{9 P=a.4||a;9 A=7.K.4,N=7.W.4;9 b=F.13(N[0]*(A[0]-P[0])+N[1]*(A[1]-P[1])+N[2]*(A[2]-(P[2]||0)));8(b<=17.16)}},1v:l(a){o(1g(a.U)=='1f'&&1g(a.W)=='1f'){8 w}8!7.1m(a)},1U:l(a){o(!7.1v(a)){8 w}o(a.U){9 A=a.K.4,D=a.U.4,P=7.K.4,N=7.W.4;9 b=(N[0]*(P[0]-A[0])+N[1]*(P[1]-A[1])+N[2]*(P[2]-A[2]))/(N[0]*D[0]+N[1]*D[1]+N[2]*D[2]);8 v.u([A[0]+D[0]*b,A[1]+D[1]*b,A[2]+D[2]*b])}1d o(a.W){9 c=7.W.2f(a.W).2q();9 N=7.W.4,A=7.K.4,O=a.W.4,B=a.K.4;9 d=S.1j(2,2),i=0;H(d.2y()){i++;d=S.u([[N[i%3],N[(i+1)%3]],[O[i%3],O[(i+1)%3]]])}9 e=d.2w().4;9 x=N[0]*A[0]+N[1]*A[1]+N[2]*A[2];9 y=O[0]*B[0]+O[1]*B[1]+O[2]*B[2];9 f=[e[0][0]*x+e[0][1]*y,e[1][0]*x+e[1][1]*y];9 g=[];2e(9 j=1;j<=3;j++){g.19((i==j)?0:f[(j+(5-i)%3)%3])}8 14.u(g,c)}},1r:l(a){9 P=a.4||a;9 A=7.K.4,N=7.W.4;9 b=(A[0]-P[0])*N[0]+(A[1]-P[1])*N[1]+(A[2]-(P[2]||0))*N[2];8 v.u([P[0]+N[0]*b,P[1]+N[1]*b,(P[2]||0)+N[2]*b])},1V:l(t,a){9 R=S.1R(t,a.U).4;9 C=a.1r(7.K).4;9 A=7.K.4,N=7.W.4;9 b=C[0],1E=C[1],1J=C[2],1w=A[0],18=A[1],1a=A[2];9 x=1w-b,y=18-1E,z=1a-1J;8 11.u([b+R[0][0]*x+R[0][1]*y+R[0][2]*z,1E+R[1][0]*x+R[1][1]*y+R[1][2]*z,1J+R[2][0]*x+R[2][1]*y+R[2][2]*z],[R[0][0]*N[0]+R[0][1]*N[1]+R[0][2]*N[2],R[1][0]*N[0]+R[1][1]*N[1]+R[1][2]*N[2],R[2][0]*N[0]+R[2][1]*N[1]+R[2][2]*N[2]])},1t:l(a){o(a.W){9 A=7.K.4,N=7.W.4;9 b=A[0],18=A[1],1a=A[2],2M=N[0],2L=N[1],2Q=N[2];9 c=7.K.1t(a).4;9 d=b+2M,2p=18+2L,2m=1a+2Q;9 Q=a.1r([d,2p,2m]).4;9 e=[Q[0]+(Q[0]-d)-c[0],Q[1]+(Q[1]-2p)-c[1],Q[2]+(Q[2]-2m)-c[2]];8 11.u(c,e)}1d o(a.U){8 7.1V(F.1A,a)}1d{9 P=a.4||a;8 11.u(7.K.1t([P[0],P[1],(P[2]||0)]),7.W)}},1Z:l(a,b,c){a=v.u(a);a=a.1N();o(a===w){8 w}b=v.u(b);b=b.1N();o(b===w){8 w}o(1g(c)=='1f'){c=w}1d{c=v.u(c);c=c.1N();o(c===w){8 w}}9 d=a.4[0],18=a.4[1],1a=a.4[2];9 e=b.4[0],1W=b.4[1],1X=b.4[2];9 f,1i;o(c!==w){9 g=c.4[0],2l=c.4[1],2t=c.4[2];f=v.u([(1W-18)*(2t-1a)-(1X-1a)*(2l-18),(1X-1a)*(g-d)-(e-d)*(2t-1a),(e-d)*(2l-18)-(1W-18)*(g-d)]);1i=f.1u();o(1i===0){8 w}f=v.u([f.4[0]/1i,f.4[1]/1i,f.4[2]/1i])}1d{1i=F.1x(e*e+1W*1W+1X*1X);o(1i===0){8 w}f=v.u([b.4[0]/1i,b.4[1]/1i,b.4[2]/1i])}7.K=a;7.W=f;8 7}};11.u=l(a,b,c){9 P=25 11();8 P.1Z(a,b,c)};11.2I=11.u(v.1j(3),v.k);11.2H=11.u(v.1j(3),v.i);11.2G=11.u(v.1j(3),v.j);11.36=11.2I;11.35=11.2H;11.3j=11.2G;9 $V=v.u;9 $M=S.u;9 $L=14.u;9 $P=11.u;",0,206,"||||elements|||this|return|var||||||||||||function|||if||length||||create|Vector|null|||||||||Math|nj|while||do|anchor||||||||Matrix||direction||normal||||kj|Plane|ni|abs|Line|ki|precision|Sylvester|A2|push|A3|map|els|else||undefined|typeof|contains|mod|Zero|D3|D2|isParallelTo|kp|distanceFrom|cols|dup|pointClosestTo|np|reflectionIn|modulus|intersects|A1|sqrt|isSquare|X2|PI|X3|angleFrom|mod1|C2|mod2|sin|cos|break|C3|toRightTriangular|false|Y3|to3D|E2|E1|E3|Rotation|Y2|Y1|intersectionWith|rotate|v12|v13|rank|setVectors|nc|sum|multiply|prototype|eql|new|setElements|case|each|PA3|PA2|part|new_element|round|for|cross|product|AD2|isSameSizeAs|add|isPerpendicularTo|v22|AN3|inspect|AD3|AN2|toUnitVector|PsubQ3|PsubQ2|v23|dot|divisor|inverse|true|isSingular|determinant|max|canMultiplyFromLeft|subtract|rows|col|random|ZX|YZ|XY|Random|join|N2|N1|D1|slice|default|N3|dimensions|switch|liesIn|translate|snapTo|augment|Diagonal|trace|indexOf|diagonal|transpose|minor|row|isAntiparallelTo|ZY|YX|acos|RotationZ|RotationY|liesOn|RotationX|inv|rk|tr|det|toDiagonalMatrix|toUpperTriangular|version|XZ".split("|"),0,{}));"use strict";function mht(e){var t,n="";if(16===e.length)for(t=0;t<4;t++)n+="<span style='font-family: monospace'>["+e[4*t+0].toFixed(4)+","+e[4*t+1].toFixed(4)+","+e[4*t+2].toFixed(4)+","+e[4*t+3].toFixed(4)+"]</span><br>";else{if(9!==e.length)return e.toString();for(t=0;t<3;t++)n+="<span style='font-family: monospace'>["+e[3*t+0].toFixed(4)+","+e[3*t+1].toFixed(4)+","+e[3*t+2].toFixed(4)+"]</font><br>"}return n}function makeLookAt(e,t,n,i,r,a,o,s,l){var c=$V([e,t,n]),u=$V([i,r,a]),d=$V([o,s,l]),p=c.subtract(u).toUnitVector(),h=d.cross(p).toUnitVector(),m=p.cross(h).toUnitVector(),f=$M([[h.e(1),h.e(2),h.e(3),0],[m.e(1),m.e(2),m.e(3),0],[p.e(1),p.e(2),p.e(3),0],[0,0,0,1]]),g=$M([[1,0,0,-e],[0,1,0,-t],[0,0,1,-n],[0,0,0,1]]);return f.x(g)}function makeOrtho(e,t,n,i,r,a){return $M([[2/(t-e),0,0,-(t+e)/(t-e)],[0,2/(i-n),0,-(i+n)/(i-n)],[0,0,-2/(a-r),-(a+r)/(a-r)],[0,0,0,1]])}function makeFrustum(e,t,n,i,r,a){return $M([[2*r/(t-e),0,(t+e)/(t-e),0],[0,2*r/(i-n),(i+n)/(i-n),0],[0,0,-(a+r)/(a-r),-2*a*r/(a-r)],[0,0,-1,0]])}function makePerspective(e,t,n,i){var r=n*Math.tan(e*Math.PI/360),a=-r;return makeFrustum(a*t,r*t,a,r,n,i)}Matrix.Translation=function(e){var t;if(2===e.elements.length)return(t=Matrix.I(3)).elements[2][0]=e.elements[0],t.elements[2][1]=e.elements[1],t;if(3===e.elements.length)return(t=Matrix.I(4)).elements[0][3]=e.elements[0],t.elements[1][3]=e.elements[1],t.elements[2][3]=e.elements[2],t;throw"Invalid length for Translation"},Matrix.prototype.flatten=function(){var e=[];if(0===this.elements.length)return[];for(var t=0;t<this.elements[0].length;t++)for(var n=0;n<this.elements.length;n++)e.push(this.elements[n][t]);return e},Matrix.prototype.ensure4x4=function(){var e;if(4===this.elements.length&&4===this.elements[0].length)return this;if(this.elements.length>4||this.elements[0].length>4)return null;for(e=0;e<this.elements.length;e++)for(var t=this.elements[e].length;t<4;t++)e===t?this.elements[e].push(1):this.elements[e].push(0);for(e=this.elements.length;e<4;e++)0===e?this.elements.push([1,0,0,0]):1===e?this.elements.push([0,1,0,0]):2===e?this.elements.push([0,0,1,0]):3===e&&this.elements.push([0,0,0,1]);return this},Matrix.prototype.make3x3=function(){return 4!==this.elements.length||4!==this.elements[0].length?null:Matrix.create([[this.elements[0][0],this.elements[0][1],this.elements[0][2]],[this.elements[1][0],this.elements[1][1],this.elements[1][2]],[this.elements[2][0],this.elements[2][1],this.elements[2][2]]])},Vector.prototype.flatten=function(){return this.elements};var saveAs=saveAs||function(e){if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return e.URL||e.webkitURL||e},n=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in n,r=/constructor/i.test(e.HTMLElement),a=/CriOS\/[\d]+/.test(navigator.userAgent),o=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},s=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},l=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},c=function(c,u,d){d||(c=l(c));var p,h=this,m="application/octet-stream"===c.type,f=function(){!function(e,t,n){for(var i=(t=[].concat(t)).length;i--;){var r=e["on"+t[i]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){o(e)}}}(h,"writestart progress write writeend".split(" "))};if(h.readyState=h.INIT,i)return p=t().createObjectURL(c),void setTimeout(function(){var e,t;n.href=p,n.download=u,e=n,t=new MouseEvent("click"),e.dispatchEvent(t),f(),s(p),h.readyState=h.DONE});!function(){if((a||m&&r)&&e.FileReader){var n=new FileReader;return n.onloadend=function(){var t=a?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,h.readyState=h.DONE,f()},n.readAsDataURL(c),void(h.readyState=h.INIT)}p||(p=t().createObjectURL(c)),m?e.location.href=p:e.open(p,"_blank")||(e.location.href=p);h.readyState=h.DONE,f(),s(p)}()},u=c.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=l(e)),navigator.msSaveOrOpenBlob(e,t)}:(u.abort=function(){},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,function(e,t,n){return new c(e,t||e.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);function CommonAudioUtil(){var e=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384],t=function(e,t,n){var i,r=0;for(i=0;i<n&&!(e<t[r]);i++)r++;return i},n=function(n,i){var r,a,o,s,l;return o=(a=t(r=n>0?n:8191&-n,e,15)-6)+(i>>6&15)-13,s=(0===r?32:a>=0?r>>a:r<<-a)*(i&parseInt("077",8))+48>>4,l=o>=0?s<<o&32767:s>>-o,(n^i)<0?-l:l};this.g726_init_state=function(){var e,t={};for(t.a=new Array(2),t.b=new Array(6),t.pk=new Array(2),t.dq=new Array(6),t.sr=new Array(2),t.yl=34816,t.yu=544,t.dms=0,t.dml=0,t.ap=0,e=0;e<2;e++)t.a[e]=0,t.pk[e]=0,t.sr[e]=32;for(e=0;e<6;e++)t.b[e]=0,t.dq[e]=32;return t.td=0,t},this.predictor_zero=function(e){var t,i;for(i=n(e.b[0]>>2,e.dq[0]),t=1;t<6;t++)i+=n(e.b[t]>>2,e.dq[t]);return i},this.predictor_pole=function(e){return n(e.a[1]>>2,e.sr[1])+n(e.a[0]>>2,e.sr[0])},this.step_size=function(e){var t,n,i;return e.ap>=256?e.yu:(t=e.yl>>6,n=e.yu-t,i=e.ap>>2,n>0?t+=n*i>>6:n<0&&(t+=n*i+63>>6),t)},this.quantize=function(n,i,r,a){var o,s,l;return o=Math.abs(n),s=t(o>>1,e,15),l=t((s<<7)+(o<<7>>s&127)-(i>>2),r,a),n<0?1+(a<<1)-l:0===l?1+(a<<1):l},this.reconstruct=function(e,t,n){var i,r;return(i=t+(n>>2))<0?e?-32768:0:(r=128+(127&i)<<7>>14-(i>>7&15),e?r-32768:r)},this.update=function(n,i,r,a,o,s,l,c){var u,d,p,h,m,f,g,v,y,b,w,C,S;if(S=l<0?1:0,d=32767&o,y=c.yl>>15,C=c.yl>>10&31,w=(b=y>9?31744:32+C<<y)+(b>>1)>>1,v=0===c.td?0:d<=w?0:1,c.yu=i+(r-i>>5),c.yu<544?c.yu=544:c.yu>5120&&(c.yu=5120),c.yl+=c.yu+(-c.yl>>6),1===v)c.a[0]=0,c.a[1]=0,c.b[0]=0,c.b[1]=0,c.b[2]=0,c.b[3]=0,c.b[4]=0,c.b[5]=0,h=0;else for(f=S^c.pk[0],h=c.a[1]-(c.a[1]>>7),0!==l&&((g=f?c.a[0]:-c.a[0])<-8191?h-=256:h+=g>8191?255:g>>5,S^c.pk[1]?h<=-12160?h=-12288:h>=12416?h=12288:h-=128:h<=-12416?h=-12288:h>=12160?h=12288:h+=128),c.a[1]=h,c.a[0]-=c.a[0]>>8,0!==l&&(0===f?c.a[0]+=192:c.a[0]-=192),m=15360-h,c.a[0]<-m?c.a[0]=-m:c.a[0]>m&&(c.a[0]=m),u=0;u<6;u++)c.b[u]-=5===n?c.b[u]>>9:c.b[u]>>8,32767&o&&((o^c.dq[u])>=0?c.b[u]+=128:c.b[u]-=128);for(u=5;u>0;u--)c.dq[u]=c.dq[u-1];return 0===d?c.dq[0]=o>=0?32:64544:(p=t(d,e,15),c.dq[0]=o>=0?(p<<6)+(d<<6>>p):(p<<6)+(d<<6>>p)-1024),c.sr[1]=c.sr[0],0===s?c.sr[0]=32:s>0?(p=t(s,e,15),c.sr[0]=(p<<6)+(s<<6>>p)):s>-32768?(p=t(d=-s,e,15),c.sr[0]=(p<<6)+(d<<6>>p)-1024):c.sr[0]=64544,c.pk[1]=c.pk[0],c.pk[0]=S,c.td=1===v?0:h<-11776?1:0,c.dms+=a-c.dms>>5,c.dml+=(a<<2)-c.dml>>7,1===v?c.ap=256:i<1536?c.ap+=512-c.ap>>4:1===c.td?c.ap+=512-c.ap>>4:Math.abs((c.dms<<2)-c.dml)>=c.dml>>3?c.ap+=512-c.ap>>4:c.ap+=-c.ap>>4,c}}"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs}),function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.log4javascript=e()}(function(){function isUndefined(e){return void 0===e}function EventSupport(){}Array.prototype.push||(Array.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(this.length>0){for(var e=this[0],t=0,n=this.length-1;t<n;t++)this[t]=this[t+1];return this.length=this.length-1,e}}),Array.prototype.splice||(Array.prototype.splice=function(e,t){var n=this.slice(e+t),i=this.slice(e,e+t);this.length=e;for(var r=[],a=0,o=arguments.length;a<o;a++)r[a]=arguments[a];var s=r.length>2?n=r.slice(2).concat(n):n;for(a=0,o=s.length;a<o;a++)this.push(s[a]);return i}),EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(e){if(e instanceof Array){this.eventTypes=e,this.eventListeners={};for(var t=0,n=this.eventTypes.length;t<n;t++)this.eventListeners[this.eventTypes[t]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+e+"'"),this.eventListeners[e].push(t)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+e+"'"),array_remove(this.eventListeners[e],t)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(e,t){if(array_contains(this.eventTypes,e))for(var n=this.eventListeners[e],i=0,r=n.length;i<r;i++)n[i](this,e,t);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+e+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(1e8*Math.random()),emptyFunction=function(){},newLine="\r\n",pageLoaded=!1;function Log4JavaScript(){}Log4JavaScript.prototype=new EventSupport;var log4javascript=new Log4JavaScript;function toStr(e){return e&&e.toString?e.toString():String(e)}function getExceptionMessage(e){return e.message?e.message:e.description?e.description:toStr(e)}function getUrlFileName(e){var t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return e.substr(t+1)}function getExceptionStringRep(e){if(e){var t="Exception: "+getExceptionMessage(e);try{e.lineNumber&&(t+=" on line number "+e.lineNumber),e.fileName&&(t+=" in file "+getUrlFileName(e.fileName))}catch(e){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&e.stack&&(t+=newLine+"Stack trace:"+newLine+e.stack),t}return null}function bool(e){return Boolean(e)}function trim(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n")}log4javascript.version="1.4.13",log4javascript.edition="log4javascript";var urlEncode=void 0!==window.encodeURIComponent?function(e){return encodeURIComponent(e)}:function(e){return escape(e).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};function array_remove(e,t){for(var n=-1,i=0,r=e.length;i<r;i++)if(e[i]===t){n=i;break}return n>=0&&(e.splice(n,1),!0)}function array_contains(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]==t)return!0;return!1}function extractBooleanFromParam(e,t){return isUndefined(e)?t:bool(e)}function extractStringFromParam(e,t){return isUndefined(e)?t:String(e)}function extractIntFromParam(e,t){if(isUndefined(e))return t;try{var n=parseInt(e,10);return isNaN(n)?t:n}catch(n){return logLog.warn("Invalid int param "+e,n),t}}function extractFunctionFromParam(e,t){return"function"==typeof e?e:t}function isError(e){return e instanceof Error}Function.prototype.apply||(Function.prototype.apply=function(obj,args){var methodName="__apply__";void 0!==obj[methodName]&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this;for(var argsStrings=[],i=0,len=args.length;i<len;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(e){for(var t=[],n=1,i=arguments.length;n<i;n++)t[n-1]=arguments[n];return this.apply(e,t)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(e){this.quietMode=bool(e)},numberOfErrors:0,alertAllErrors:!1,setAlertAllErrors:function(e){this.alertAllErrors=e},debug:function(e){this.debugMessages.push(e)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(e,t){},error:function(e,t){if((1==++this.numberOfErrors||this.alertAllErrors)&&!this.quietMode){var n="log4javascript error: "+e;t&&(n+=newLine+newLine+"Original error: "+getExceptionStringRep(t)),alert(n)}}};function handleError(e,t){logLog.error(e,t),log4javascript.dispatchEvent("error",{message:e,exception:t})}log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]),log4javascript.handleError=handleError;var enabled=!("undefined"!=typeof log4javascript_disabled&&log4javascript_disabled);log4javascript.setEnabled=function(e){enabled=bool(e)},log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=!0;log4javascript.setTimeStampsInMilliseconds=function(e){useTimeStampsInMilliseconds=bool(e)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=!1;log4javascript.setShowStackTraces=function(e){showStackTraces=bool(e)};var Level=function(e,t){this.level=e,this.name=t};function Timer(e,t){this.name=e,this.level=isUndefined(t)?Level.INFO:t,this.start=new Date}Level.prototype={toString:function(){return this.name},equals:function(e){return this.level==e.level},isGreaterOrEqual:function(e){return this.level>=e.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level,Timer.prototype.getElapsedTime=function(){return(new Date).getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";function Logger(e){this.name=e,this.parent=null,this.children=[];var t=[],n=null,i=this.name===rootLoggerName,r=this.name===nullLoggerName,a=null,o=!1;this.addChild=function(e){this.children.push(e),e.parent=this,e.invalidateAppenderCache()};var s=!0;this.getAdditivity=function(){return s},this.setAdditivity=function(e){var t=s!=e;s=e,t&&this.invalidateAppenderCache()},this.addAppender=function(e){r?handleError("Logger.addAppender: you may not add an appender to the null logger"):e instanceof log4javascript.Appender?array_contains(t,e)||(t.push(e),e.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(e)+"') is not a subclass of Appender")},this.removeAppender=function(e){array_remove(t,e),e.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var e=t.length;if(e>0){for(var n=0;n<e;n++)t[n].setRemovedFromLogger(this);t.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){if(null===a||o){var e=i||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders();a=e.concat(t),o=!1}return a},this.invalidateAppenderCache=function(){o=!0;for(var e=0,t=this.children.length;e<t;e++)this.children[e].invalidateAppenderCache()},this.log=function(e,t){if(enabled&&e.isGreaterOrEqual(this.getEffectiveLevel())){var n,i=t.length-1,r=t[i];t.length>1&&isError(r)&&(n=r,i--);for(var a=[],o=0;o<=i;o++)a[o]=t[o];var s=new LoggingEvent(this,new Date,e,a,n);this.callAppenders(s)}},this.callAppenders=function(e){for(var t=this.getEffectiveAppenders(),n=0,i=t.length;n<i;n++)t[n].doAppend(e)},this.setLevel=function(e){i&&null===e?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):e instanceof Level?n=e:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return n},this.getEffectiveLevel=function(){for(var e=this;null!==e;e=e.parent){var t=e.getLevel();if(null!==t)return t}},this.group=function(e,t){if(enabled)for(var n=this.getEffectiveAppenders(),i=0,r=n.length;i<r;i++)n[i].group(e,t)},this.groupEnd=function(){if(enabled)for(var e=this.getEffectiveAppenders(),t=0,n=e.length;t<n;t++)e[t].groupEnd()};var l={};this.time=function(e,t){enabled&&(isUndefined(e)?handleError("Logger.time: a name for the timer must be supplied"):!t||t instanceof Level?l[e]=new Timer(e,t):handleError("Logger.time: level supplied to timer "+e+" is not an instance of log4javascript.Level"))},this.timeEnd=function(e){if(enabled)if(isUndefined(e))handleError("Logger.timeEnd: a name for the timer must be supplied");else if(l[e]){var t=l[e],n=t.getElapsedTime();this.log(t.level,["Timer "+toStr(e)+" completed in "+n+"ms"]),delete l[e]}else logLog.warn("Logger.timeEnd: no timer found with name "+e)},this.assert=function(e){if(enabled&&!e){for(var t=[],n=1,i=arguments.length;n<i;n++)t.push(arguments[n]);(t=t.length>0?t:["Assertion Failure"]).push(newLine),t.push(e),this.log(Level.ERROR,t)}},this.toString=function(){return"Logger["+this.name+"]"}}Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(e){return e.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(e){if("string"!=typeof e&&(e=anonymousLoggerName,logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(e)+" supplied, returning anonymous logger")),e==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),!loggers[e]){var t=new Logger(e);loggers[e]=t,loggerNames.push(e);var n,i=e.lastIndexOf(".");if(i>-1){var r=e.substring(0,i);n=log4javascript.getLogger(r)}else n=rootLogger;n.addChild(t)}return loggers[e]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){return defaultLogger||(defaultLogger=createDefaultLogger()),defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName)).setLevel(Level.OFF),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}};var LoggingEvent=function(e,t,n,i,r){this.logger=e,this.timeStamp=t,this.timeStampInMilliseconds=t.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=n,this.messages=i,this.exception=r};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return 1==this.messages.length?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(e){this.overrideTimeStampsSetting=!0,this.useTimeStampsInMilliseconds=bool(e)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(e){return this.isTimeStampsInMilliseconds()?e.timeStampInMilliseconds:e.timeStampInSeconds},getDataValues:function(e,t){var n=[[this.loggerKey,e.logger.name],[this.timeStampKey,this.getTimeStampValue(e)],[this.levelKey,e.level.name],[this.urlKey,window.location.href],[this.messageKey,t?e.getCombinedMessages():e.messages]];if(this.isTimeStampsInMilliseconds()||n.push([this.millisecondsKey,e.milliseconds]),e.exception&&n.push([this.exceptionKey,getExceptionStringRep(e.exception)]),this.hasCustomFields())for(var i=0,r=this.customFields.length;i<r;i++){var a=this.customFields[i].value;"function"==typeof a&&(a=a(this,e)),n.push([this.customFields[i].name,a])}return n},setKeys:function(e,t,n,i,r,a,o){this.loggerKey=extractStringFromParam(e,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(t,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(n,this.defaults.levelKey),this.messageKey=extractStringFromParam(i,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(r,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(a,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(o,this.defaults.millisecondsKey)},setCustomField:function(e,t){for(var n=!1,i=0,r=this.customFields.length;i<r;i++)this.customFields[i].name===e&&(this.customFields[i].value=t,n=!0);n||this.customFields.push({name:e,value:t})},hasCustomFields:function(){return this.customFields.length>0},formatWithException:function(e){var t=this.format(e);return e.exception&&this.ignoresThrowable()&&(t+=e.getThrowableStrRep()),t},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout;var Appender=function(){},SimpleDateFormat;function SimpleLayout(){this.customFields=[]}function NullLayout(){this.customFields=[]}function XmlLayout(e){this.combineMessages=extractBooleanFromParam(e,!0),this.customFields=[]}function escapeNewLines(e){return e.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(e,t){this.readable=extractBooleanFromParam(e,!1),this.combineMessages=extractBooleanFromParam(t,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"\t":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}function formatObjectExpansion(e,t,n){var i=[];return function e(t,n,r){var a,o,s,l,c,u,d;function p(e){for(var t=splitIntoLines(e),n=1,i=t.length;n<i;n++)t[n]=r+t[n];return t.join(newLine)}if(r||(r=""),null===t)return"null";if(void 0===t)return"undefined";if("string"==typeof t)return p(t);if("object"==typeof t&&array_contains(i,t)){try{u=toStr(t)}catch(e){u="Error formatting property. Details: "+getExceptionStringRep(e)}return u+" [already expanded]"}if(t instanceof Array&&n>0){for(i.push(t),u="["+newLine,s=n-1,l=r+"  ",c=[],a=0,o=t.length;a<o;a++)try{d=e(t[a],s,l),c.push(l+d)}catch(e){c.push(l+"Error formatting array member. Details: "+getExceptionStringRep(e))}return u+=c.join(","+newLine)+newLine+r+"]"}if("[object Date]"==Object.prototype.toString.call(t))return t.toString();if("object"==typeof t&&n>0){for(a in i.push(t),u="{"+newLine,s=n-1,l=r+"  ",c=[],t)try{d=e(t[a],s,l),c.push(l+a+": "+d)}catch(e){c.push(l+a+": Error formatting property. Details: "+getExceptionStringRep(e))}return u+=c.join(","+newLine)+newLine+r+"}"}return p(toStr(t))}(e,t,n)}function PatternLayout(e){this.pattern=e||PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}function AlertAppender(){}function BrowserConsoleAppender(){}Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(e){enabled&&e.level.level>=this.threshold.level&&this.append(e)},Appender.prototype.append=function(e){},Appender.prototype.setLayout=function(e){e instanceof Layout?this.layout=e:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(e){e instanceof Level?this.threshold=e:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(e){this.loggers.push(e)},Appender.prototype.setRemovedFromLogger=function(e){array_remove(this.loggers,e)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender,SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(e){return e.level.name+" - "+e.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout,NullLayout.prototype=new Layout,NullLayout.prototype.format=function(e){return e.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(e){var t=e.messages,n=e.exception;return n?t.concat([n]):t},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout,XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(e){return e.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(e){var t,n,i=this;function r(e){return e="string"==typeof e?e:toStr(e),"<log4javascript:message><![CDATA["+i.escapeCdata(e)+"]]></log4javascript:message>"}var a='<log4javascript:event logger="'+e.logger.name+'" timestamp="'+this.getTimeStampValue(e)+'"';if(this.isTimeStampsInMilliseconds()||(a+=' milliseconds="'+e.milliseconds+'"'),a+=' level="'+e.level.name+'">'+newLine,this.combineMessages)a+=r(e.getCombinedMessages());else{for(a+="<log4javascript:messages>"+newLine,t=0,n=e.messages.length;t<n;t++)a+=r(e.messages[t])+newLine;a+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(t=0,n=this.customFields.length;t<n;t++)a+='<log4javascript:customfield name="'+this.customFields[t].name+'"><![CDATA['+this.customFields[t].value.toString()+"]]></log4javascript:customfield>"+newLine;return e.exception&&(a+="<log4javascript:exception><![CDATA["+getExceptionStringRep(e.exception)+"]]></log4javascript:exception>"+newLine),a+="</log4javascript:event>"+newLine+newLine},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout,JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(e){var t,n,i=this,r=this.getDataValues(e,this.combineMessages),a="{"+this.lineBreak;function o(e,t,n){var r,a=typeof e;if(e instanceof Date)r=String(e.getTime());else if(n&&e instanceof Array){r="["+i.lineBreak;for(var s=0,l=e.length;s<l;s++){var c=t+i.tab;r+=c+o(e[s],c,!1),s<e.length-1&&(r+=","),r+=i.lineBreak}r+=t+"]"}else r="number"!==a&&"boolean"!==a?'"'+escapeNewLines(toStr(e).replace(/\"/g,'\\"'))+'"':e;return r}for(t=0,n=r.length-1;t<=n;t++)a+=this.tab+'"'+r[t][0]+'"'+this.colon+o(r[t][1],this.tab,!0),t<n&&(a+=","),a+=this.lineBreak;return a+="}"+this.lineBreak},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout,HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(e){for(var t=this.getDataValues(e),n=[],i=0,r=t.length;i<r;i++){var a=t[i][1]instanceof Date?String(t[i][1].getTime()):t[i][1];n.push(urlEncode(t[i][0])+"="+urlEncode(a))}return n.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(e){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout,function(){var e=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,t=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i={G:0,y:3,M:4,w:2,W:2,D:2,d:2,F:2,E:1,a:0,H:2,k:2,K:2,h:2,m:2,s:2,S:2,Z:5},r=function(e,t,n){var i=new Date(e,t,n,0,0,0);return i.setMilliseconds(0),i};Date.prototype.getDifference=function(e){return this.getTime()-e.getTime()},Date.prototype.isBefore=function(e){return this.getTime()<e.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(e){return this.getUTCTime()-e.getUTCTime()},Date.prototype.getPreviousSunday=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),t=new Date(e.getTime()-864e5*this.getDay());return r(t.getFullYear(),t.getMonth(),t.getDate())},Date.prototype.getWeekInYear=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),n=r(this.getFullYear(),0,1),i=t.isBefore(n)?0:1+Math.floor(t.getTimeSince(n)/6048e5);return 7-n.getDay()<e&&i--,i},Date.prototype.getWeekInMonth=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),n=r(this.getFullYear(),this.getMonth(),1),i=t.isBefore(n)?0:1+Math.floor(t.getTimeSince(n)/6048e5);return 7-n.getDay()>=e&&i++,i},Date.prototype.getDayInYear=function(){var e=r(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(e)/864e5)},(SimpleDateFormat=function(e){this.formatString=e}).prototype.setMinimalDaysInFirstWeek=function(e){this.minimalDaysInFirstWeek=e},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?1:this.minimalDaysInFirstWeek};var a=function(e,t){for(;e.length<t;)e="0"+e;return e},o=function(e,t,n){return t>=4?e:e.substr(0,Math.max(n,t))},s=function(e,t){return a(""+e,t)};SimpleDateFormat.prototype.format=function(r){for(var l,c="",u=this.formatString;l=e.exec(u);){var d=l[1],p=l[2],h=l[3],m=l[4];if(d)c+="''"==d?"'":d.substring(1,d.length-1);else if(h);else if(m)c+=m;else if(p){var f=p.charAt(0),g=p.length,v="";switch(f){case"G":v="AD";break;case"y":v=r.getFullYear();break;case"M":v=r.getMonth();break;case"w":v=r.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":v=r.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":v=r.getDayInYear();break;case"d":v=r.getDate();break;case"F":v=1+Math.floor((r.getDate()-1)/7);break;case"E":v=n[r.getDay()];break;case"a":v=r.getHours()>=12?"PM":"AM";break;case"H":v=r.getHours();break;case"k":v=r.getHours()||24;break;case"K":v=r.getHours()%12;break;case"h":v=r.getHours()%12||12;break;case"m":v=r.getMinutes();break;case"s":v=r.getSeconds();break;case"S":v=r.getMilliseconds();break;case"Z":v=r.getTimezoneOffset()}switch(i[f]){case 0:c+=o(v,g,2);break;case 1:c+=o(v,g,3);break;case 2:c+=s(v,g);break;case 3:if(g<=3)c+=(""+v).substr(2,2);else c+=s(v,g);break;case 4:c+=g>=3?o(t[v],g,g):s(v+1,g);break;case 5:var y=v>0?"-":"+",b=Math.abs(v),w=""+Math.floor(b/60),C=""+b%60;c+=y+(w=a(w,2))+(C=a(C,2))}}u=u.substr(l.index+l[0].length)}return c}}(),log4javascript.SimpleDateFormat=SimpleDateFormat,PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(e){for(var t,n=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,i="",r=this.pattern;t=n.exec(r);){var a=t[0],o=t[1],s=t[2],l=t[3],c=t[5],u=t[6];if(u)i+=""+u;else{var d,p="";switch(l){case"a":case"m":var h=0;c&&(h=parseInt(c,10),isNaN(h)&&(handleError("PatternLayout.format: invalid specifier '"+c+"' for conversion character '"+l+"' - should be a number"),h=0));for(var m="a"===l?e.messages[0]:e.messages,f=0,g=m.length;f<g;f++)f>0&&" "!==p.charAt(p.length-1)&&(p+=" "),p+=0===h?m[f]:formatObjectExpansion(m[f],h);break;case"c":var v=e.logger.name;if(c){var y=parseInt(c,10),b=e.logger.name.split(".");p=y>=b.length?v:b.slice(b.length-y).join(".")}else p=v;break;case"d":var w=PatternLayout.ISO8601_DATEFORMAT;c&&("ISO8601"==(w=c)?w=PatternLayout.ISO8601_DATEFORMAT:"ABSOLUTE"==w?w=PatternLayout.ABSOLUTETIME_DATEFORMAT:"DATE"==w&&(w=PatternLayout.DATETIME_DATEFORMAT)),p=new SimpleDateFormat(w).format(e.timeStamp);break;case"f":if(this.hasCustomFields()){var C=0;c&&(C=parseInt(c,10),isNaN(C)?handleError("PatternLayout.format: invalid specifier '"+c+"' for conversion character 'f' - should be a number"):0===C?handleError("PatternLayout.format: invalid specifier '"+c+"' for conversion character 'f' - must be greater than zero"):C>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+c+"' for conversion character 'f' - there aren't that many custom fields"):C-=1);var S=this.customFields[C].value;"function"==typeof S&&(S=S(this,e)),p=S}break;case"n":p=newLine;break;case"p":p=e.level.name;break;case"r":p=""+e.timeStamp.getDifference(applicationStartDate);break;case"%":p="%";break;default:p=a}if(s){d=parseInt(s.substr(1),10);var _=p.length;d<_&&(p=p.substring(_-d,_))}if(o)if("-"==o.charAt(0))for(d=parseInt(o.substr(1),10);p.length<d;)p+=" ";else for(d=parseInt(o,10);p.length<d;)p=" "+p;i+=p}r=r.substr(t.index+t[0].length)}return i},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout,AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(e){alert(this.getLayout().formatWithException(e))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender,BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(e){var t,n=this,i=function(t){var i=n.getLayout().formatWithException(e);return"string"==typeof i?t?i:[i]:t?i.join(" "):i},r=window.console;r&&r.log?"function"==typeof r[t=r.debug&&Level.DEBUG.isGreaterOrEqual(e.level)?"debug":r.info&&Level.INFO.equals(e.level)?"info":r.warn&&Level.WARN.equals(e.level)?"warn":r.error&&e.level.isGreaterOrEqual(Level.ERROR)?"error":"log"].apply?r[t].apply(r,i(!1)):r[t](i(!0)):"undefined"!=typeof opera&&opera.postError&&opera.postError(i(!0))},BrowserConsoleAppender.prototype.group=function(e){window.console&&window.console.group&&window.console.group(e)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(e){for(var t,n=null,i=0,r=xmlHttpFactories.length;i<r;i++){t=xmlHttpFactories[i];try{return n=t(),withCredentialsSupported=t==xhrFactory&&"withCredentials"in n,getXmlHttp=t,n}catch(e){}}e?e():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")},ConsoleAppender;function isHttpRequestSuccessful(e){return isUndefined(e.status)||0===e.status||e.status>=200&&e.status<300||1223==e.status}function AjaxAppender(e,t){var n=this,i=!0;e||(handleError("AjaxAppender: URL must be specified in constructor"),i=!1);var r=this.defaults.timed,a=this.defaults.waitForResponse,o=this.defaults.batchSize,s=this.defaults.timerInterval,l=this.defaults.requestSuccessCallback,c=this.defaults.failCallback,u=this.defaults.postVarName,d=this.defaults.sendAllOnUnload,p=this.defaults.contentType,h=null,m=[],f=[],g=[],v=!1,y=!1;function b(e){return!y||(handleError("AjaxAppender: configuration option '"+e+"' may not be set after the appender has been initialized"),!1)}function w(){var e;if(i&&enabled)if(v=!0,a)f.length>0?x(S(e=f.shift()),w):(v=!1,r&&_());else{for(;e=f.shift();)x(S(e));v=!1,r&&_()}}function C(){var e=!1;if(i&&enabled){for(var t,s=n.getLayout().allowBatching()?o:1,l=[];t=m.shift();)l.push(t),m.length>=s&&(f.push(l),l=[]);l.length>0&&f.push(l),e=f.length>0,a=!1,r=!1,w()}return e}function S(e){for(var t,i=[],r="";t=e.shift();)i.push(n.getLayout().formatWithException(t));return r=1==e.length?i.join(""):n.getLayout().batchHeader+i.join(n.getLayout().batchSeparator)+n.getLayout().batchFooter,p==n.defaults.contentType&&((r=n.getLayout().returnsPostData?r:urlEncode(u)+"="+urlEncode(r)).length>0&&(r+="&"),r+="layout="+urlEncode(n.getLayout().toString())),r}function _(){window.setTimeout(w,s)}function T(){var e="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(e),i=!1,c&&c(e)}function x(n,r){try{var a=getXmlHttp(T);if(i){a.onreadystatechange=function(){if(4==a.readyState){if(isHttpRequestSuccessful(a))l&&l(a),r&&r(a);else{var t="AjaxAppender.append: XMLHttpRequest request to URL "+e+" returned status code "+a.status;handleError(t),c&&c(t)}a.onreadystatechange=emptyFunction,a=null}},a.open("POST",e,!0),t&&withCredentialsSupported&&(a.withCredentials=!0);try{for(var o,s=0;o=g[s++];)a.setRequestHeader(o.name,o.value);a.setRequestHeader("Content-Type",p)}catch(e){var u="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";return handleError(u),i=!1,void(c&&c(u))}a.send(n)}}catch(t){var d="AjaxAppender.append: error sending log message to "+e;handleError(d,t),i=!1,c&&c(d+". Details: "+getExceptionStringRep(t))}}this.getSessionId=function(){return h},this.setSessionId=function(e){h=extractStringFromParam(e,null),this.layout.setCustomField("sessionid",h)},this.setLayout=function(e){b("layout")&&(this.layout=e,null!==h&&this.setSessionId(h))},this.isTimed=function(){return r},this.setTimed=function(e){b("timed")&&(r=bool(e))},this.getTimerInterval=function(){return s},this.setTimerInterval=function(e){b("timerInterval")&&(s=extractIntFromParam(e,s))},this.isWaitForResponse=function(){return a},this.setWaitForResponse=function(e){b("waitForResponse")&&(a=bool(e))},this.getBatchSize=function(){return o},this.setBatchSize=function(e){b("batchSize")&&(o=extractIntFromParam(e,o))},this.isSendAllOnUnload=function(){return d},this.setSendAllOnUnload=function(e){b("sendAllOnUnload")&&(d=extractBooleanFromParam(e,d))},this.setRequestSuccessCallback=function(e){l=extractFunctionFromParam(e,l)},this.setFailCallback=function(e){c=extractFunctionFromParam(e,c)},this.getPostVarName=function(){return u},this.setPostVarName=function(e){b("postVarName")&&(u=extractStringFromParam(e,u))},this.getHeaders=function(){return g},this.addHeader=function(e,t){"content-type"==e.toLowerCase()?p=t:g.push({name:e,value:t})},this.sendAll=w,this.sendAllRemaining=C,this.append=function(e){if(i){y||function(){if(y=!0,d){var e=window.onbeforeunload;window.onbeforeunload=function(){e&&e(),C()}}r&&_()}(),m.push(e);var t=this.getLayout().allowBatching()?o:1;if(m.length>=t){for(var n,s=[];n=m.shift();)s.push(n);f.push(s),r||a&&(!a||v)||w()}}}}function setCookie(e,t,n,i){var r;if(i=i?"; path="+i:"",n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),r="; expires="+a.toGMTString()}else r="";document.cookie=escape(e)+"="+escape(t)+r+i}function getCookie(e){for(var t=escape(e)+"=",n=document.cookie.split(";"),i=0,r=n.length;i<r;i++){for(var a=n[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return unescape(a.substring(t.length,a.length))}return null}function getBaseUrl(){for(var e=document.getElementsByTagName("script"),t=0,n=e.length;t<n;++t)if(-1!=e[t].src.indexOf("log4javascript")){var i=e[t].src.lastIndexOf("/");return-1==i?"":e[t].src.substr(0,i+1)}return null}function isLoaded(e){try{return bool(e.loaded)}catch(e){return!1}}function padWithSpaces(e,t){if(e.length<t){for(var n=[],i=Math.max(0,t-e.length),r=0;r<i;r++)n[r]=" ";e+=n.join("")}return e}function createDefaultLogger(){var e=log4javascript.getLogger(defaultLoggerName),t=new log4javascript.PopUpAppender;return e.addAppender(t),e}if(AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender,function(){var e=[],t=1;function n(e,t,n,i,r){this.create(!1,null,e,t,n,i,r,this.defaults.focusPopUp)}function i(e,t,n,i,r,a){this.create(!0,e,t,n,i,r,a,!1)}(ConsoleAppender=function(){}).prototype=new Appender,ConsoleAppender.prototype.create=function(n,i,r,a,o,s,l,c){var u=this,d=!1,p=!1,h=!1,m=!1,f=[],g=!0,v=t++;a=extractBooleanFromParam(a,this.defaults.initiallyMinimized),r=extractBooleanFromParam(r,this.defaults.lazyInit),o=extractBooleanFromParam(o,this.defaults.useDocumentWrite);var y=this.defaults.newestMessageAtTop,b=this.defaults.scrollToLatestMessage;s=s||this.defaults.width,l=l||this.defaults.height;var w,C,S,_,T,x=this.defaults.maxMessages,E=this.defaults.showCommandLine,I=this.defaults.commandLineObjectExpansionDepth,k=this.defaults.showHideButton,A=this.defaults.showCloseButton;this.setLayout(this.defaults.layout);var R=n?"InPageAppender":"PopUpAppender",L=function(e){return!p||(handleError(R+": configuration option '"+e+"' may not be set after the appender has been initialized"),!1)},P=function(){return h&&g&&!m};this.isNewestMessageAtTop=function(){return y},this.setNewestMessageAtTop=function(e){y=bool(e),P()&&_().setNewestAtTop(y)},this.isScrollToLatestMessage=function(){return b},this.setScrollToLatestMessage=function(e){b=bool(e),P()&&_().setScrollToLatest(b)},this.getWidth=function(){return s},this.setWidth=function(e){L("width")&&(s=extractStringFromParam(e,s))},this.getHeight=function(){return l},this.setHeight=function(e){L("height")&&(l=extractStringFromParam(e,l))},this.getMaxMessages=function(){return x},this.setMaxMessages=function(e){x=extractIntFromParam(e,x),P()&&_().setMaxMessages(x)},this.isShowCommandLine=function(){return E},this.setShowCommandLine=function(e){E=bool(e),P()&&_().setShowCommandLine(E)},this.isShowHideButton=function(){return k},this.setShowHideButton=function(e){k=bool(e),P()&&_().setShowHideButton(k)},this.isShowCloseButton=function(){return A},this.setShowCloseButton=function(e){A=bool(e),P()&&_().setShowCloseButton(A)},this.getCommandLineObjectExpansionDepth=function(){return I},this.setCommandLineObjectExpansionDepth=function(e){I=extractIntFromParam(e,I)};var M=a;function D(e,t){this.loggingEvent=e,this.levelName=e.level.name,this.formattedMessage=t}function N(e,t){this.name=e,this.initiallyExpanded=t}function H(){}this.isInitiallyMinimized=function(){return a},this.setInitiallyMinimized=function(e){L("initiallyMinimized")&&(a=bool(e),M=a)},this.isUseDocumentWrite=function(){return o},this.setUseDocumentWrite=function(e){L("useDocumentWrite")&&(o=bool(e))},D.prototype.append=function(){_().log(this.levelName,this.formattedMessage)},N.prototype.append=function(){_().group(this.name,this.initiallyExpanded)},H.prototype.append=function(){_().groupEnd()};var U=function(){S(),d?m&&ee&&C():w(),S()&&F()};this.append=function(e){if(g){var t=u.getLayout().formatWithException(e);f.push(new D(e,t)),U()}},this.group=function(e,t){g&&(f.push(new N(e,t)),U())},this.groupEnd=function(){g&&(f.push(new H),U())};var F=function(){for(;f.length>0;)f.shift().append();c&&_().focus()};this.setAddedToLogger=function(e){this.loggers.push(e),enabled&&!r&&w()},this.clear=function(){P()&&_().clearLog(),f.length=0},this.focus=function(){P()&&_().focus()},this.focusCommandLine=function(){P()&&_().focusCommandLine()},this.focusSearch=function(){P()&&_().focusSearch()};var O=window;this.getCommandWindow=function(){return O},this.setCommandWindow=function(e){O=e},this.executeLastCommand=function(){P()&&_().evalLastCommand()};var B=new PatternLayout("%m");this.getCommandLayout=function(){return B},this.setCommandLayout=function(e){B=e},this.evalCommandAndAppend=function(e){var t={appendResult:!0,isError:!1},n="";try{var i,r;!O.eval&&O.execScript&&O.execScript("null");var a={};for(r=0,len=j.length;r<len;r++)a[j[r][0]]=j[r][1];var o=[],s=function(e){o.push([e,O[e]])};s("appender"),O.appender=u,s("commandReturnValue"),O.commandReturnValue=t,s("commandLineFunctionsHash"),O.commandLineFunctionsHash=a;var l=function(e){s(e),O[e]=function(){return this.commandLineFunctionsHash[e](u,arguments,t)}};for(r=0,len=j.length;r<len;r++)l(j[r][0]);for(O===window&&O.execScript?(s("evalExpr"),s("result"),window.evalExpr=e,O.execScript("window.result=eval(window.evalExpr);"),i=window.result):i=O.eval(e),n=isUndefined(i)?i:formatObjectExpansion(i,I),r=0,len=o.length;r<len;r++)O[o[r][0]]=o[r][1]}catch(e){n="Error evaluating command: "+getExceptionStringRep(e),t.isError=!0}if(t.appendResult){var c=">>> "+e;isUndefined(n)||(c+=newLine+n);var d=t.isError?Level.ERROR:Level.INFO,p=new LoggingEvent(null,new Date,d,[c],null),h=this.getLayout();this.setLayout(B),this.append(p),this.setLayout(h)}};var j=e.concat([]);this.addCommandLineFunction=function(e,t){j.push([e,t])};this.storeCommandHistory=function(e){setCookie("log4javascriptCommandHistory",e.join(","))};var V=function(e){var t=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"<head>","<title>log4javascript</title>",'<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"\x3c!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work --\x3e",'<meta http-equiv="X-UA-Compatible" content="IE=7" />','<script type="text/javascript">var isIe = false, isIePre7 = false;<\/script>','\x3c!--[if IE]><script type="text/javascript">isIe = true<\/script><![endif]--\x3e','\x3c!--[if lt IE 7]><script type="text/javascript">isIePre7 = true<\/script><![endif]--\x3e','<script type="text/javascript">',"//<![CDATA[","var loggingEnabled=true;var logQueuedEventsTimer=null;var logEntries=[];var logEntriesAndSeparators=[];var logItems=[];var renderDelay=100;var unrenderedLogItemsExist=false;var rootGroup,currentGroup=null;var loaded=false;var currentLogItem=null;var logMainContainer;function copyProperties(obj,props){for(var i in props){obj[i]=props[i];}}","function LogItem(){}","LogItem.prototype={mainContainer:null,wrappedContainer:null,unwrappedContainer:null,group:null,appendToLog:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].appendToLog();}","this.group.update();},doRemove:function(doUpdate,removeFromGroup){if(this.rendered){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].remove();}","this.unwrappedElementContainer=null;this.wrappedElementContainer=null;this.mainElementContainer=null;}","if(this.group&&removeFromGroup){this.group.removeChild(this,doUpdate);}","if(this===currentLogItem){currentLogItem=null;}},remove:function(doUpdate,removeFromGroup){this.doRemove(doUpdate,removeFromGroup);},render:function(){},accept:function(visitor){visitor.visit(this);},getUnwrappedDomContainer:function(){return this.group.unwrappedElementContainer.contentDiv;},getWrappedDomContainer:function(){return this.group.wrappedElementContainer.contentDiv;},getMainDomContainer:function(){return this.group.mainElementContainer.contentDiv;}};LogItem.serializedItemKeys={LOG_ENTRY:0,GROUP_START:1,GROUP_END:2};function LogItemContainerElement(){}",'LogItemContainerElement.prototype={appendToLog:function(){var insertBeforeFirst=(newestAtTop&&this.containerDomNode.hasChildNodes());if(insertBeforeFirst){this.containerDomNode.insertBefore(this.mainDiv,this.containerDomNode.firstChild);}else{this.containerDomNode.appendChild(this.mainDiv);}}};function SeparatorElementContainer(containerDomNode){this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="separator";this.mainDiv.innerHTML="&nbsp;";}',"SeparatorElementContainer.prototype=new LogItemContainerElement();SeparatorElementContainer.prototype.remove=function(){this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;};function Separator(){this.rendered=false;}","Separator.prototype=new LogItem();copyProperties(Separator.prototype,{render:function(){var containerDomNode=this.group.contentDiv;if(isIe){this.unwrappedElementContainer=new SeparatorElementContainer(this.getUnwrappedDomContainer());this.wrappedElementContainer=new SeparatorElementContainer(this.getWrappedDomContainer());this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{this.mainElementContainer=new SeparatorElementContainer(this.getMainDomContainer());this.elementContainers=[this.mainElementContainer];}",'this.content=this.formattedMessage;this.rendered=true;}});function GroupElementContainer(group,containerDomNode,isRoot,isWrapped){this.group=group;this.containerDomNode=containerDomNode;this.isRoot=isRoot;this.isWrapped=isWrapped;this.expandable=false;if(this.isRoot){if(isIe){this.contentDiv=logMainContainer.appendChild(document.createElement("div"));this.contentDiv.id=this.isWrapped?"log_wrapped":"log_unwrapped";}else{this.contentDiv=logMainContainer;}}else{var groupElementContainer=this;this.mainDiv=document.createElement("div");this.mainDiv.className="group";this.headingDiv=this.mainDiv.appendChild(document.createElement("div"));this.headingDiv.className="groupheading";this.expander=this.headingDiv.appendChild(document.createElement("span"));this.expander.className="expander unselectable greyedout";this.expander.unselectable=true;var expanderText=this.group.expanded?"-":"+";this.expanderTextNode=this.expander.appendChild(document.createTextNode(expanderText));this.headingDiv.appendChild(document.createTextNode(" "+this.group.name));this.contentDiv=this.mainDiv.appendChild(document.createElement("div"));var contentCssClass=this.group.expanded?"expanded":"collapsed";this.contentDiv.className="groupcontent "+contentCssClass;this.expander.onclick=function(){if(groupElementContainer.group.expandable){groupElementContainer.group.toggleExpanded();}};}}','GroupElementContainer.prototype=new LogItemContainerElement();copyProperties(GroupElementContainer.prototype,{toggleExpanded:function(){if(!this.isRoot){var oldCssClass,newCssClass,expanderText;if(this.group.expanded){newCssClass="expanded";oldCssClass="collapsed";expanderText="-";}else{newCssClass="collapsed";oldCssClass="expanded";expanderText="+";}',"replaceClass(this.contentDiv,newCssClass,oldCssClass);this.expanderTextNode.nodeValue=expanderText;}},remove:function(){if(!this.isRoot){this.headingDiv=null;this.expander.onclick=null;this.expander=null;this.expanderTextNode=null;this.contentDiv=null;this.containerDomNode=null;this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;}},reverseChildren:function(){var node=null;var childDomNodes=[];while((node=this.contentDiv.firstChild)){this.contentDiv.removeChild(node);childDomNodes.push(node);}",'while((node=childDomNodes.pop())){this.contentDiv.appendChild(node);}},update:function(){if(!this.isRoot){if(this.group.expandable){removeClass(this.expander,"greyedout");}else{addClass(this.expander,"greyedout");}}},clear:function(){if(this.isRoot){this.contentDiv.innerHTML="";}}});function Group(name,isRoot,initiallyExpanded){this.name=name;this.group=null;this.isRoot=isRoot;this.initiallyExpanded=initiallyExpanded;this.elementContainers=[];this.children=[];this.expanded=initiallyExpanded;this.rendered=false;this.expandable=false;}',"Group.prototype=new LogItem();copyProperties(Group.prototype,{addChild:function(logItem){this.children.push(logItem);logItem.group=this;},render:function(){if(isIe){var unwrappedDomContainer,wrappedDomContainer;if(this.isRoot){unwrappedDomContainer=logMainContainer;wrappedDomContainer=logMainContainer;}else{unwrappedDomContainer=this.getUnwrappedDomContainer();wrappedDomContainer=this.getWrappedDomContainer();}","this.unwrappedElementContainer=new GroupElementContainer(this,unwrappedDomContainer,this.isRoot,false);this.wrappedElementContainer=new GroupElementContainer(this,wrappedDomContainer,this.isRoot,true);this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{var mainDomContainer=this.isRoot?logMainContainer:this.getMainDomContainer();this.mainElementContainer=new GroupElementContainer(this,mainDomContainer,this.isRoot,false);this.elementContainers=[this.mainElementContainer];}","this.rendered=true;},toggleExpanded:function(){this.expanded=!this.expanded;for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].toggleExpanded();}},expand:function(){if(!this.expanded){this.toggleExpanded();}},accept:function(visitor){visitor.visitGroup(this);},reverseChildren:function(){if(this.rendered){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].reverseChildren();}}},update:function(){var previouslyExpandable=this.expandable;this.expandable=(this.children.length!==0);if(this.expandable!==previouslyExpandable){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].update();}}},flatten:function(){var visitor=new GroupFlattener();this.accept(visitor);return visitor.logEntriesAndSeparators;},removeChild:function(child,doUpdate){array_remove(this.children,child);child.group=null;if(doUpdate){this.update();}},remove:function(doUpdate,removeFromGroup){for(var i=0,len=this.children.length;i<len;i++){this.children[i].remove(false,false);}","this.children=[];this.update();if(this===currentGroup){currentGroup=this.group;}","this.doRemove(doUpdate,removeFromGroup);},serialize:function(items){items.push([LogItem.serializedItemKeys.GROUP_START,this.name]);for(var i=0,len=this.children.length;i<len;i++){this.children[i].serialize(items);}","if(this!==currentGroup){items.push([LogItem.serializedItemKeys.GROUP_END]);}},clear:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].clear();}}});function LogEntryElementContainer(){}",'LogEntryElementContainer.prototype=new LogItemContainerElement();copyProperties(LogEntryElementContainer.prototype,{remove:function(){this.doRemove();},doRemove:function(){this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;this.contentElement=null;this.containerDomNode=null;},setContent:function(content,wrappedContent){if(content===this.formattedMessage){this.contentElement.innerHTML="";this.contentElement.appendChild(document.createTextNode(this.formattedMessage));}else{this.contentElement.innerHTML=content;}},setSearchMatch:function(isMatch){var oldCssClass=isMatch?"searchnonmatch":"searchmatch";var newCssClass=isMatch?"searchmatch":"searchnonmatch";replaceClass(this.mainDiv,newCssClass,oldCssClass);},clearSearch:function(){removeClass(this.mainDiv,"searchmatch");removeClass(this.mainDiv,"searchnonmatch");}});function LogEntryWrappedElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));this.mainDiv.className="logentry wrapped "+this.logEntry.level;this.contentElement=this.mainDiv;}','LogEntryWrappedElementContainer.prototype=new LogEntryElementContainer();LogEntryWrappedElementContainer.prototype.setContent=function(content,wrappedContent){if(content===this.formattedMessage){this.contentElement.innerHTML="";this.contentElement.appendChild(document.createTextNode(this.formattedMessage));}else{this.contentElement.innerHTML=wrappedContent;}};function LogEntryUnwrappedElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="logentry unwrapped "+this.logEntry.level;this.pre=this.mainDiv.appendChild(document.createElement("pre"));this.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));this.pre.className="unwrapped";this.contentElement=this.pre;}','LogEntryUnwrappedElementContainer.prototype=new LogEntryElementContainer();LogEntryUnwrappedElementContainer.prototype.remove=function(){this.doRemove();this.pre=null;};function LogEntryMainElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="logentry nonielogentry "+this.logEntry.level;this.contentElement=this.mainDiv.appendChild(document.createElement("span"));this.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));}',"LogEntryMainElementContainer.prototype=new LogEntryElementContainer();function LogEntry(level,formattedMessage){this.level=level;this.formattedMessage=formattedMessage;this.rendered=false;}",'LogEntry.prototype=new LogItem();copyProperties(LogEntry.prototype,{render:function(){var logEntry=this;var containerDomNode=this.group.contentDiv;if(isIe){this.formattedMessage=this.formattedMessage.replace(/\\r\\n/g,"\\r");this.unwrappedElementContainer=new LogEntryUnwrappedElementContainer(this,this.getUnwrappedDomContainer());this.wrappedElementContainer=new LogEntryWrappedElementContainer(this,this.getWrappedDomContainer());this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{this.mainElementContainer=new LogEntryMainElementContainer(this,this.getMainDomContainer());this.elementContainers=[this.mainElementContainer];}','this.content=this.formattedMessage;this.rendered=true;},setContent:function(content,wrappedContent){if(content!=this.content){if(isIe&&(content!==this.formattedMessage)){content=content.replace(/\\r\\n/g,"\\r");}',"for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].setContent(content,wrappedContent);}",'this.content=content;}},getSearchMatches:function(){var matches=[];var i,len;if(isIe){var unwrappedEls=getElementsByClass(this.unwrappedElementContainer.mainDiv,"searchterm","span");var wrappedEls=getElementsByClass(this.wrappedElementContainer.mainDiv,"searchterm","span");for(i=0,len=unwrappedEls.length;i<len;i++){matches[i]=new Match(this.level,null,unwrappedEls[i],wrappedEls[i]);}}else{var els=getElementsByClass(this.mainElementContainer.mainDiv,"searchterm","span");for(i=0,len=els.length;i<len;i++){matches[i]=new Match(this.level,els[i]);}}',"return matches;},setSearchMatch:function(isMatch){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].setSearchMatch(isMatch);}},clearSearch:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].clearSearch();}},accept:function(visitor){visitor.visitLogEntry(this);},serialize:function(items){items.push([LogItem.serializedItemKeys.LOG_ENTRY,this.level,this.formattedMessage]);}});function LogItemVisitor(){}","LogItemVisitor.prototype={visit:function(logItem){},visitParent:function(logItem){if(logItem.group){logItem.group.accept(this);}},visitChildren:function(logItem){for(var i=0,len=logItem.children.length;i<len;i++){logItem.children[i].accept(this);}},visitLogEntry:function(logEntry){this.visit(logEntry);},visitSeparator:function(separator){this.visit(separator);},visitGroup:function(group){this.visit(group);}};function GroupFlattener(){this.logEntriesAndSeparators=[];}",'GroupFlattener.prototype=new LogItemVisitor();GroupFlattener.prototype.visitGroup=function(group){this.visitChildren(group);};GroupFlattener.prototype.visitLogEntry=function(logEntry){this.logEntriesAndSeparators.push(logEntry);};GroupFlattener.prototype.visitSeparator=function(separator){this.logEntriesAndSeparators.push(separator);};window.onload=function(){if(location.search){var queryBits=unescape(location.search).substr(1).split("&"),nameValueBits;for(var i=0,len=queryBits.length;i<len;i++){nameValueBits=queryBits[i].split("=");if(nameValueBits[0]=="log4javascript_domain"){document.domain=nameValueBits[1];break;}}}','logMainContainer=$("log");if(isIePre7){addClass(logMainContainer,"oldIe");}','rootGroup=new Group("root",true);rootGroup.render();currentGroup=rootGroup;setCommandInputWidth();setLogContainerHeight();toggleLoggingEnabled();toggleSearchEnabled();toggleSearchFilter();toggleSearchHighlight();applyFilters();checkAllLevels();toggleWrap();toggleNewestAtTop();toggleScrollToLatest();renderQueuedLogItems();loaded=true;$("command").value="";$("command").autocomplete="off";$("command").onkeydown=function(evt){evt=getEvent(evt);if(evt.keyCode==10||evt.keyCode==13){evalCommandLine();stopPropagation(evt);}else if(evt.keyCode==27){this.value="";this.focus();}else if(evt.keyCode==38&&commandHistory.length>0){currentCommandIndex=Math.max(0,currentCommandIndex-1);this.value=commandHistory[currentCommandIndex];moveCaretToEnd(this);}else if(evt.keyCode==40&&commandHistory.length>0){currentCommandIndex=Math.min(commandHistory.length-1,currentCommandIndex+1);this.value=commandHistory[currentCommandIndex];moveCaretToEnd(this);}};$("command").onkeypress=function(evt){evt=getEvent(evt);if(evt.keyCode==38&&commandHistory.length>0&&evt.preventDefault){evt.preventDefault();}};$("command").onkeyup=function(evt){evt=getEvent(evt);if(evt.keyCode==27&&evt.preventDefault){evt.preventDefault();this.focus();}};document.onkeydown=function keyEventHandler(evt){evt=getEvent(evt);switch(evt.keyCode){case 69:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){evalLastCommand();cancelKeyEvent(evt);return false;}',"break;case 75:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){focusSearch();cancelKeyEvent(evt);return false;}","break;case 40:case 76:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){focusCommandLine();cancelKeyEvent(evt);return false;}","break;}};setTimeout(setLogContainerHeight,20);setShowCommandLine(showCommandLine);doSearch();};window.onunload=function(){if(mainWindowExists()){appender.unload();}",'appender=null;};function toggleLoggingEnabled(){setLoggingEnabled($("enableLogging").checked);}',"function setLoggingEnabled(enable){loggingEnabled=enable;}","var appender=null;function setAppender(appenderParam){appender=appenderParam;}",'function setShowCloseButton(showCloseButton){$("closeButton").style.display=showCloseButton?"inline":"none";}','function setShowHideButton(showHideButton){$("hideButton").style.display=showHideButton?"inline":"none";}',"var newestAtTop=false;function LogItemContentReverser(){}","LogItemContentReverser.prototype=new LogItemVisitor();LogItemContentReverser.prototype.visitGroup=function(group){group.reverseChildren();this.visitChildren(group);};function setNewestAtTop(isNewestAtTop){var oldNewestAtTop=newestAtTop;var i,iLen,j,jLen;newestAtTop=Boolean(isNewestAtTop);if(oldNewestAtTop!=newestAtTop){var visitor=new LogItemContentReverser();rootGroup.accept(visitor);if(currentSearch){var currentMatch=currentSearch.matches[currentMatchIndex];var matchIndex=0;var matches=[];var actOnLogEntry=function(logEntry){var logEntryMatches=logEntry.getSearchMatches();for(j=0,jLen=logEntryMatches.length;j<jLen;j++){matches[matchIndex]=logEntryMatches[j];if(currentMatch&&logEntryMatches[j].equals(currentMatch)){currentMatchIndex=matchIndex;}","matchIndex++;}};if(newestAtTop){for(i=logEntries.length-1;i>=0;i--){actOnLogEntry(logEntries[i]);}}else{for(i=0,iLen=logEntries.length;i<iLen;i++){actOnLogEntry(logEntries[i]);}}","currentSearch.matches=matches;if(currentMatch){currentMatch.setCurrent();}}else if(scrollToLatest){doScrollToLatest();}}",'$("newestAtTop").checked=isNewestAtTop;}','function toggleNewestAtTop(){var isNewestAtTop=$("newestAtTop").checked;setNewestAtTop(isNewestAtTop);}',"var scrollToLatest=true;function setScrollToLatest(isScrollToLatest){scrollToLatest=isScrollToLatest;if(scrollToLatest){doScrollToLatest();}",'$("scrollToLatest").checked=isScrollToLatest;}','function toggleScrollToLatest(){var isScrollToLatest=$("scrollToLatest").checked;setScrollToLatest(isScrollToLatest);}','function doScrollToLatest(){var l=logMainContainer;if(typeof l.scrollTop!="undefined"){if(newestAtTop){l.scrollTop=0;}else{var latestLogEntry=l.lastChild;if(latestLogEntry){l.scrollTop=l.scrollHeight;}}}}',"var closeIfOpenerCloses=true;function setCloseIfOpenerCloses(isCloseIfOpenerCloses){closeIfOpenerCloses=isCloseIfOpenerCloses;}","var maxMessages=null;function setMaxMessages(max){maxMessages=max;pruneLogEntries();}",'var showCommandLine=false;function setShowCommandLine(isShowCommandLine){showCommandLine=isShowCommandLine;if(loaded){$("commandLine").style.display=showCommandLine?"block":"none";setCommandInputWidth();setLogContainerHeight();}}','function focusCommandLine(){if(loaded){$("command").focus();}}','function focusSearch(){if(loaded){$("searchBox").focus();}}',"function getLogItems(){var items=[];for(var i=0,len=logItems.length;i<len;i++){logItems[i].serialize(items);}","return items;}","function setLogItems(items){var loggingReallyEnabled=loggingEnabled;loggingEnabled=true;for(var i=0,len=items.length;i<len;i++){switch(items[i][0]){case LogItem.serializedItemKeys.LOG_ENTRY:log(items[i][1],items[i][2]);break;case LogItem.serializedItemKeys.GROUP_START:group(items[i][1]);break;case LogItem.serializedItemKeys.GROUP_END:groupEnd();break;}}","loggingEnabled=loggingReallyEnabled;}","function log(logLevel,formattedMessage){if(loggingEnabled){var logEntry=new LogEntry(logLevel,formattedMessage);logEntries.push(logEntry);logEntriesAndSeparators.push(logEntry);logItems.push(logEntry);currentGroup.addChild(logEntry);if(loaded){if(logQueuedEventsTimer!==null){clearTimeout(logQueuedEventsTimer);}","logQueuedEventsTimer=setTimeout(renderQueuedLogItems,renderDelay);unrenderedLogItemsExist=true;}}}","function renderQueuedLogItems(){logQueuedEventsTimer=null;var pruned=pruneLogEntries();var initiallyHasMatches=currentSearch?currentSearch.hasMatches():false;for(var i=0,len=logItems.length;i<len;i++){if(!logItems[i].rendered){logItems[i].render();logItems[i].appendToLog();if(currentSearch&&(logItems[i]instanceof LogEntry)){currentSearch.applyTo(logItems[i]);}}}","if(currentSearch){if(pruned){if(currentSearch.hasVisibleMatches()){if(currentMatchIndex===null){setCurrentMatchIndex(0);}","displayMatches();}else{displayNoMatches();}}else if(!initiallyHasMatches&&currentSearch.hasVisibleMatches()){setCurrentMatchIndex(0);displayMatches();}}","if(scrollToLatest){doScrollToLatest();}","unrenderedLogItemsExist=false;}","function pruneLogEntries(){if((maxMessages!==null)&&(logEntriesAndSeparators.length>maxMessages)){var numberToDelete=logEntriesAndSeparators.length-maxMessages;var prunedLogEntries=logEntriesAndSeparators.slice(0,numberToDelete);if(currentSearch){currentSearch.removeMatches(prunedLogEntries);}","var group;for(var i=0;i<numberToDelete;i++){group=logEntriesAndSeparators[i].group;array_remove(logItems,logEntriesAndSeparators[i]);array_remove(logEntries,logEntriesAndSeparators[i]);logEntriesAndSeparators[i].remove(true,true);if(group.children.length===0&&group!==currentGroup&&group!==rootGroup){array_remove(logItems,group);group.remove(true,true);}}","logEntriesAndSeparators=array_removeFromStart(logEntriesAndSeparators,numberToDelete);return true;}","return false;}",'function group(name,startExpanded){if(loggingEnabled){initiallyExpanded=(typeof startExpanded==="undefined")?true:Boolean(startExpanded);var newGroup=new Group(name,false,initiallyExpanded);currentGroup.addChild(newGroup);currentGroup=newGroup;logItems.push(newGroup);if(loaded){if(logQueuedEventsTimer!==null){clearTimeout(logQueuedEventsTimer);}',"logQueuedEventsTimer=setTimeout(renderQueuedLogItems,renderDelay);unrenderedLogItemsExist=true;}}}","function groupEnd(){currentGroup=(currentGroup===rootGroup)?rootGroup:currentGroup.group;}","function mainPageReloaded(){currentGroup=rootGroup;var separator=new Separator();logEntriesAndSeparators.push(separator);logItems.push(separator);currentGroup.addChild(separator);}","function closeWindow(){if(appender&&mainWindowExists()){appender.close(true);}else{window.close();}}","function hide(){if(appender&&mainWindowExists()){appender.hide();}}",'var mainWindow=window;var windowId="log4javascriptConsoleWindow_"+new Date().getTime()+"_"+(""+Math.random()).substr(2);function setMainWindow(win){mainWindow=win;mainWindow[windowId]=window;if(opener&&closeIfOpenerCloses){pollOpener();}}',"function pollOpener(){if(closeIfOpenerCloses){if(mainWindowExists()){setTimeout(pollOpener,500);}else{closeWindow();}}}","function mainWindowExists(){try{return(mainWindow&&!mainWindow.closed&&mainWindow[windowId]==window);}catch(ex){}","return false;}",'var logLevels=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"];function getCheckBox(logLevel){return $("switch_"+logLevel);}','function getIeWrappedLogContainer(){return $("log_wrapped");}','function getIeUnwrappedLogContainer(){return $("log_unwrapped");}',"function applyFilters(){for(var i=0;i<logLevels.length;i++){if(getCheckBox(logLevels[i]).checked){addClass(logMainContainer,logLevels[i]);}else{removeClass(logMainContainer,logLevels[i]);}}","updateSearchFromFilters();}",'function toggleAllLevels(){var turnOn=$("switch_ALL").checked;for(var i=0;i<logLevels.length;i++){getCheckBox(logLevels[i]).checked=turnOn;if(turnOn){addClass(logMainContainer,logLevels[i]);}else{removeClass(logMainContainer,logLevels[i]);}}}','function checkAllLevels(){for(var i=0;i<logLevels.length;i++){if(!getCheckBox(logLevels[i]).checked){getCheckBox("ALL").checked=false;return;}}','getCheckBox("ALL").checked=true;}',"function clearLog(){rootGroup.clear();currentGroup=rootGroup;logEntries=[];logItems=[];logEntriesAndSeparators=[];doSearch();}",'function toggleWrap(){var enable=$("wrap").checked;if(enable){addClass(logMainContainer,"wrap");}else{removeClass(logMainContainer,"wrap");}',"refreshCurrentMatch();}","var searchTimer=null;function scheduleSearch(){try{clearTimeout(searchTimer);}catch(ex){}","searchTimer=setTimeout(doSearch,500);}","function Search(searchTerm,isRegex,searchRegex,isCaseSensitive){this.searchTerm=searchTerm;this.isRegex=isRegex;this.searchRegex=searchRegex;this.isCaseSensitive=isCaseSensitive;this.matches=[];}","Search.prototype={hasMatches:function(){return this.matches.length>0;},hasVisibleMatches:function(){if(this.hasMatches()){for(var i=0;i<this.matches.length;i++){if(this.matches[i].isVisible()){return true;}}}","return false;},match:function(logEntry){var entryText=String(logEntry.formattedMessage);var matchesSearch=false;if(this.isRegex){matchesSearch=this.searchRegex.test(entryText);}else if(this.isCaseSensitive){matchesSearch=(entryText.indexOf(this.searchTerm)>-1);}else{matchesSearch=(entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase())>-1);}","return matchesSearch;},getNextVisibleMatchIndex:function(){for(var i=currentMatchIndex+1;i<this.matches.length;i++){if(this.matches[i].isVisible()){return i;}}","for(i=0;i<=currentMatchIndex;i++){if(this.matches[i].isVisible()){return i;}}","return-1;},getPreviousVisibleMatchIndex:function(){for(var i=currentMatchIndex-1;i>=0;i--){if(this.matches[i].isVisible()){return i;}}","for(var i=this.matches.length-1;i>=currentMatchIndex;i--){if(this.matches[i].isVisible()){return i;}}",'return-1;},applyTo:function(logEntry){var doesMatch=this.match(logEntry);if(doesMatch){logEntry.group.expand();logEntry.setSearchMatch(true);var logEntryContent;var wrappedLogEntryContent;var searchTermReplacementStartTag="<span class=\\"searchterm\\">";var searchTermReplacementEndTag="<"+"/span>";var preTagName=isIe?"pre":"span";var preStartTag="<"+preTagName+" class=\\"pre\\">";var preEndTag="<"+"/"+preTagName+">";var startIndex=0;var searchIndex,matchedText,textBeforeMatch;if(this.isRegex){var flags=this.isCaseSensitive?"g":"gi";var capturingRegex=new RegExp("("+this.searchRegex.source+")",flags);var rnd=(""+Math.random()).substr(2);var startToken="%%s"+rnd+"%%";var endToken="%%e"+rnd+"%%";logEntryContent=logEntry.formattedMessage.replace(capturingRegex,startToken+"$1"+endToken);logEntryContent=escapeHtml(logEntryContent);var result;var searchString=logEntryContent;logEntryContent="";wrappedLogEntryContent="";while((searchIndex=searchString.indexOf(startToken,startIndex))>-1){var endTokenIndex=searchString.indexOf(endToken,searchIndex);matchedText=searchString.substring(searchIndex+startToken.length,endTokenIndex);textBeforeMatch=searchString.substring(startIndex,searchIndex);logEntryContent+=preStartTag+textBeforeMatch+preEndTag;logEntryContent+=searchTermReplacementStartTag+preStartTag+matchedText+',"preEndTag+searchTermReplacementEndTag;if(isIe){wrappedLogEntryContent+=textBeforeMatch+searchTermReplacementStartTag+","matchedText+searchTermReplacementEndTag;}","startIndex=endTokenIndex+endToken.length;}",'logEntryContent+=preStartTag+searchString.substr(startIndex)+preEndTag;if(isIe){wrappedLogEntryContent+=searchString.substr(startIndex);}}else{logEntryContent="";wrappedLogEntryContent="";var searchTermReplacementLength=searchTermReplacementStartTag.length+',"this.searchTerm.length+searchTermReplacementEndTag.length;var searchTermLength=this.searchTerm.length;var searchTermLowerCase=this.searchTerm.toLowerCase();var logTextLowerCase=logEntry.formattedMessage.toLowerCase();while((searchIndex=logTextLowerCase.indexOf(searchTermLowerCase,startIndex))>-1){matchedText=escapeHtml(logEntry.formattedMessage.substr(searchIndex,this.searchTerm.length));textBeforeMatch=escapeHtml(logEntry.formattedMessage.substring(startIndex,searchIndex));var searchTermReplacement=searchTermReplacementStartTag+","preStartTag+matchedText+preEndTag+searchTermReplacementEndTag;logEntryContent+=preStartTag+textBeforeMatch+preEndTag+searchTermReplacement;if(isIe){wrappedLogEntryContent+=textBeforeMatch+searchTermReplacementStartTag+","matchedText+searchTermReplacementEndTag;}","startIndex=searchIndex+searchTermLength;}","var textAfterLastMatch=escapeHtml(logEntry.formattedMessage.substr(startIndex));logEntryContent+=preStartTag+textAfterLastMatch+preEndTag;if(isIe){wrappedLogEntryContent+=textAfterLastMatch;}}","logEntry.setContent(logEntryContent,wrappedLogEntryContent);var logEntryMatches=logEntry.getSearchMatches();this.matches=this.matches.concat(logEntryMatches);}else{logEntry.setSearchMatch(false);logEntry.setContent(logEntry.formattedMessage,logEntry.formattedMessage);}","return doesMatch;},removeMatches:function(logEntries){var matchesToRemoveCount=0;var currentMatchRemoved=false;var matchesToRemove=[];var i,iLen,j,jLen;for(i=0,iLen=this.matches.length;i<iLen;i++){for(j=0,jLen=logEntries.length;j<jLen;j++){if(this.matches[i].belongsTo(logEntries[j])){matchesToRemove.push(this.matches[i]);if(i===currentMatchIndex){currentMatchRemoved=true;}}}}","var newMatch=currentMatchRemoved?null:this.matches[currentMatchIndex];if(currentMatchRemoved){for(i=currentMatchIndex,iLen=this.matches.length;i<iLen;i++){if(this.matches[i].isVisible()&&!array_contains(matchesToRemove,this.matches[i])){newMatch=this.matches[i];break;}}}","for(i=0,iLen=matchesToRemove.length;i<iLen;i++){array_remove(this.matches,matchesToRemove[i]);matchesToRemove[i].remove();}","if(this.hasVisibleMatches()){if(newMatch===null){setCurrentMatchIndex(0);}else{var newMatchIndex=0;for(i=0,iLen=this.matches.length;i<iLen;i++){if(newMatch===this.matches[i]){newMatchIndex=i;break;}}","setCurrentMatchIndex(newMatchIndex);}}else{currentMatchIndex=null;displayNoMatches();}}};function getPageOffsetTop(el,container){var currentEl=el;var y=0;while(currentEl&&currentEl!=container){y+=currentEl.offsetTop;currentEl=currentEl.offsetParent;}","return y;}",'function scrollIntoView(el){var logContainer=logMainContainer;if(!$("wrap").checked){var logContainerLeft=logContainer.scrollLeft;var logContainerRight=logContainerLeft+logContainer.offsetWidth;var elLeft=el.offsetLeft;var elRight=elLeft+el.offsetWidth;if(elLeft<logContainerLeft||elRight>logContainerRight){logContainer.scrollLeft=elLeft-(logContainer.offsetWidth-el.offsetWidth)/2;}}',"var logContainerTop=logContainer.scrollTop;var logContainerBottom=logContainerTop+logContainer.offsetHeight;var elTop=getPageOffsetTop(el)-getToolBarsHeight();var elBottom=elTop+el.offsetHeight;if(elTop<logContainerTop||elBottom>logContainerBottom){logContainer.scrollTop=elTop-(logContainer.offsetHeight-el.offsetHeight)/2;}}","function Match(logEntryLevel,spanInMainDiv,spanInUnwrappedPre,spanInWrappedDiv){this.logEntryLevel=logEntryLevel;this.spanInMainDiv=spanInMainDiv;if(isIe){this.spanInUnwrappedPre=spanInUnwrappedPre;this.spanInWrappedDiv=spanInWrappedDiv;}","this.mainSpan=isIe?spanInUnwrappedPre:spanInMainDiv;}",'Match.prototype={equals:function(match){return this.mainSpan===match.mainSpan;},setCurrent:function(){if(isIe){addClass(this.spanInUnwrappedPre,"currentmatch");addClass(this.spanInWrappedDiv,"currentmatch");var elementToScroll=$("wrap").checked?this.spanInWrappedDiv:this.spanInUnwrappedPre;scrollIntoView(elementToScroll);}else{addClass(this.spanInMainDiv,"currentmatch");scrollIntoView(this.spanInMainDiv);}},belongsTo:function(logEntry){if(isIe){return isDescendant(this.spanInUnwrappedPre,logEntry.unwrappedPre);}else{return isDescendant(this.spanInMainDiv,logEntry.mainDiv);}},setNotCurrent:function(){if(isIe){removeClass(this.spanInUnwrappedPre,"currentmatch");removeClass(this.spanInWrappedDiv,"currentmatch");}else{removeClass(this.spanInMainDiv,"currentmatch");}},isOrphan:function(){return isOrphan(this.mainSpan);},isVisible:function(){return getCheckBox(this.logEntryLevel).checked;},remove:function(){if(isIe){this.spanInUnwrappedPre=null;this.spanInWrappedDiv=null;}else{this.spanInMainDiv=null;}}};var currentSearch=null;var currentMatchIndex=null;function doSearch(){var searchBox=$("searchBox");var searchTerm=searchBox.value;var isRegex=$("searchRegex").checked;var isCaseSensitive=$("searchCaseSensitive").checked;var i;if(searchTerm===""){$("searchReset").disabled=true;$("searchNav").style.display="none";removeClass(document.body,"searching");removeClass(searchBox,"hasmatches");removeClass(searchBox,"nomatches");for(i=0;i<logEntries.length;i++){logEntries[i].clearSearch();logEntries[i].setContent(logEntries[i].formattedMessage,logEntries[i].formattedMessage);}','currentSearch=null;setLogContainerHeight();}else{$("searchReset").disabled=false;$("searchNav").style.display="block";var searchRegex;var regexValid;if(isRegex){try{searchRegex=isCaseSensitive?new RegExp(searchTerm,"g"):new RegExp(searchTerm,"gi");regexValid=true;replaceClass(searchBox,"validregex","invalidregex");searchBox.title="Valid regex";}catch(ex){regexValid=false;replaceClass(searchBox,"invalidregex","validregex");searchBox.title="Invalid regex: "+(ex.message?ex.message:(ex.description?ex.description:"unknown error"));return;}}else{searchBox.title="";removeClass(searchBox,"validregex");removeClass(searchBox,"invalidregex");}','addClass(document.body,"searching");currentSearch=new Search(searchTerm,isRegex,searchRegex,isCaseSensitive);for(i=0;i<logEntries.length;i++){currentSearch.applyTo(logEntries[i]);}',"setLogContainerHeight();if(currentSearch.hasVisibleMatches()){setCurrentMatchIndex(0);displayMatches();}else{displayNoMatches();}}}","function updateSearchFromFilters(){if(currentSearch){if(currentSearch.hasMatches()){if(currentMatchIndex===null){currentMatchIndex=0;}","var currentMatch=currentSearch.matches[currentMatchIndex];if(currentMatch.isVisible()){displayMatches();setCurrentMatchIndex(currentMatchIndex);}else{currentMatch.setNotCurrent();var nextVisibleMatchIndex=currentSearch.getNextVisibleMatchIndex();if(nextVisibleMatchIndex>-1){setCurrentMatchIndex(nextVisibleMatchIndex);displayMatches();}else{displayNoMatches();}}}else{displayNoMatches();}}}","function refreshCurrentMatch(){if(currentSearch&&currentSearch.hasVisibleMatches()){setCurrentMatchIndex(currentMatchIndex);}}",'function displayMatches(){replaceClass($("searchBox"),"hasmatches","nomatches");$("searchBox").title=""+currentSearch.matches.length+" matches found";$("searchNav").style.display="block";setLogContainerHeight();}','function displayNoMatches(){replaceClass($("searchBox"),"nomatches","hasmatches");$("searchBox").title="No matches found";$("searchNav").style.display="none";setLogContainerHeight();}','function toggleSearchEnabled(enable){enable=(typeof enable=="undefined")?!$("searchDisable").checked:enable;$("searchBox").disabled=!enable;$("searchReset").disabled=!enable;$("searchRegex").disabled=!enable;$("searchNext").disabled=!enable;$("searchPrevious").disabled=!enable;$("searchCaseSensitive").disabled=!enable;$("searchNav").style.display=(enable&&($("searchBox").value!=="")&&currentSearch&&currentSearch.hasVisibleMatches())?"block":"none";if(enable){removeClass($("search"),"greyedout");addClass(document.body,"searching");if($("searchHighlight").checked){addClass(logMainContainer,"searchhighlight");}else{removeClass(logMainContainer,"searchhighlight");}','if($("searchFilter").checked){addClass(logMainContainer,"searchfilter");}else{removeClass(logMainContainer,"searchfilter");}','$("searchDisable").checked=!enable;}else{addClass($("search"),"greyedout");removeClass(document.body,"searching");removeClass(logMainContainer,"searchhighlight");removeClass(logMainContainer,"searchfilter");}',"setLogContainerHeight();}",'function toggleSearchFilter(){var enable=$("searchFilter").checked;if(enable){addClass(logMainContainer,"searchfilter");}else{removeClass(logMainContainer,"searchfilter");}',"refreshCurrentMatch();}",'function toggleSearchHighlight(){var enable=$("searchHighlight").checked;if(enable){addClass(logMainContainer,"searchhighlight");}else{removeClass(logMainContainer,"searchhighlight");}}','function clearSearch(){$("searchBox").value="";doSearch();}','function searchNext(){if(currentSearch!==null&&currentMatchIndex!==null){currentSearch.matches[currentMatchIndex].setNotCurrent();var nextMatchIndex=currentSearch.getNextVisibleMatchIndex();if(nextMatchIndex>currentMatchIndex||confirm("Reached the end of the page. Start from the top?")){setCurrentMatchIndex(nextMatchIndex);}}}','function searchPrevious(){if(currentSearch!==null&&currentMatchIndex!==null){currentSearch.matches[currentMatchIndex].setNotCurrent();var previousMatchIndex=currentSearch.getPreviousVisibleMatchIndex();if(previousMatchIndex<currentMatchIndex||confirm("Reached the start of the page. Continue from the bottom?")){setCurrentMatchIndex(previousMatchIndex);}}}',"function setCurrentMatchIndex(index){currentMatchIndex=index;currentSearch.matches[currentMatchIndex].setCurrent();}",'function addClass(el,cssClass){if(!hasClass(el,cssClass)){if(el.className){el.className+=" "+cssClass;}else{el.className=cssClass;}}}','function hasClass(el,cssClass){if(el.className){var classNames=el.className.split(" ");return array_contains(classNames,cssClass);}',"return false;}",'function removeClass(el,cssClass){if(hasClass(el,cssClass)){var existingClasses=el.className.split(" ");var newClasses=[];for(var i=0,len=existingClasses.length;i<len;i++){if(existingClasses[i]!=cssClass){newClasses[newClasses.length]=existingClasses[i];}}','el.className=newClasses.join(" ");}}',"function replaceClass(el,newCssClass,oldCssClass){removeClass(el,oldCssClass);addClass(el,newCssClass);}","function getElementsByClass(el,cssClass,tagName){var elements=el.getElementsByTagName(tagName);var matches=[];for(var i=0,len=elements.length;i<len;i++){if(hasClass(elements[i],cssClass)){matches.push(elements[i]);}}","return matches;}","function $(id){return document.getElementById(id);}","function isDescendant(node,ancestorNode){while(node!=null){if(node===ancestorNode){return true;}","node=node.parentNode;}","return false;}","function isOrphan(node){var currentNode=node;while(currentNode){if(currentNode==document.body){return false;}","currentNode=currentNode.parentNode;}","return true;}",'function escapeHtml(str){return str.replace(/&/g,"&amp;").replace(/[<]/g,"&lt;").replace(/>/g,"&gt;");}',"function getWindowWidth(){if(window.innerWidth){return window.innerWidth;}else if(document.documentElement&&document.documentElement.clientWidth){return document.documentElement.clientWidth;}else if(document.body){return document.body.clientWidth;}","return 0;}","function getWindowHeight(){if(window.innerHeight){return window.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight;}else if(document.body){return document.body.clientHeight;}","return 0;}",'function getToolBarsHeight(){return $("switches").offsetHeight;}','function getChromeHeight(){var height=getToolBarsHeight();if(showCommandLine){height+=$("commandLine").offsetHeight;}',"return height;}",'function setLogContainerHeight(){if(logMainContainer){var windowHeight=getWindowHeight();$("body").style.height=getWindowHeight()+"px";logMainContainer.style.height=""+','Math.max(0,windowHeight-getChromeHeight())+"px";}}','function setCommandInputWidth(){if(showCommandLine){$("command").style.width=""+Math.max(0,$("commandLineContainer").offsetWidth-','($("evaluateButton").offsetWidth+13))+"px";}}',"window.onresize=function(){setCommandInputWidth();setLogContainerHeight();};if(!Array.prototype.push){Array.prototype.push=function(){for(var i=0,len=arguments.length;i<len;i++){this[this.length]=arguments[i];}","return this.length;};}","if(!Array.prototype.pop){Array.prototype.pop=function(){if(this.length>0){var val=this[this.length-1];this.length=this.length-1;return val;}};}","if(!Array.prototype.shift){Array.prototype.shift=function(){if(this.length>0){var firstItem=this[0];for(var i=0,len=this.length-1;i<len;i++){this[i]=this[i+1];}","this.length=this.length-1;return firstItem;}};}","if(!Array.prototype.splice){Array.prototype.splice=function(startIndex,deleteCount){var itemsAfterDeleted=this.slice(startIndex+deleteCount);var itemsDeleted=this.slice(startIndex,startIndex+deleteCount);this.length=startIndex;var argumentsArray=[];for(var i=0,len=arguments.length;i<len;i++){argumentsArray[i]=arguments[i];}","var itemsToAppend=(argumentsArray.length>2)?itemsAfterDeleted=argumentsArray.slice(2).concat(itemsAfterDeleted):itemsAfterDeleted;for(i=0,len=itemsToAppend.length;i<len;i++){this.push(itemsToAppend[i]);}","return itemsDeleted;};}","function array_remove(arr,val){var index=-1;for(var i=0,len=arr.length;i<len;i++){if(arr[i]===val){index=i;break;}}","if(index>=0){arr.splice(index,1);return index;}else{return false;}}","function array_removeFromStart(array,numberToRemove){if(Array.prototype.splice){array.splice(0,numberToRemove);}else{for(var i=numberToRemove,len=array.length;i<len;i++){array[i-numberToRemove]=array[i];}","array.length=array.length-numberToRemove;}","return array;}","function array_contains(arr,val){for(var i=0,len=arr.length;i<len;i++){if(arr[i]==val){return true;}}","return false;}","function getErrorMessage(ex){if(ex.message){return ex.message;}else if(ex.description){return ex.description;}",'return""+ex;}',"function moveCaretToEnd(input){if(input.setSelectionRange){input.focus();var length=input.value.length;input.setSelectionRange(length,length);}else if(input.createTextRange){var range=input.createTextRange();range.collapse(false);range.select();}","input.focus();}",'function stopPropagation(evt){if(evt.stopPropagation){evt.stopPropagation();}else if(typeof evt.cancelBubble!="undefined"){evt.cancelBubble=true;}}',"function getEvent(evt){return evt?evt:event;}","function getTarget(evt){return evt.target?evt.target:evt.srcElement;}",'function getRelatedTarget(evt){if(evt.relatedTarget){return evt.relatedTarget;}else if(evt.srcElement){switch(evt.type){case"mouseover":return evt.fromElement;case"mouseout":return evt.toElement;default:return evt.srcElement;}}}',"function cancelKeyEvent(evt){evt.returnValue=false;stopPropagation(evt);}",'function evalCommandLine(){var expr=$("command").value;evalCommand(expr);$("command").value="";}',"function evalLastCommand(){if(lastCommand!=null){evalCommand(lastCommand);}}",'var lastCommand=null;var commandHistory=[];var currentCommandIndex=0;function evalCommand(expr){if(appender){appender.evalCommandAndAppend(expr);}else{var prefix=">>> "+expr+"\\r\\n";try{log("INFO",prefix+eval(expr));}catch(ex){log("ERROR",prefix+"Error: "+getErrorMessage(ex));}}',"if(expr!=commandHistory[commandHistory.length-1]){commandHistory.push(expr);if(appender){appender.storeCommandHistory(commandHistory);}}","currentCommandIndex=(expr==commandHistory[currentCommandIndex])?currentCommandIndex+1:commandHistory.length;lastCommand=expr;}","//]]>","<\/script>",'<style type="text/css">',"body{background-color:white;color:black;padding:0;margin:0;font-family:tahoma,verdana,arial,helvetica,sans-serif;overflow:hidden}div#switchesContainer input{margin-bottom:0}div.toolbar{border-top:solid #ffffff 1px;border-bottom:solid #aca899 1px;background-color:#f1efe7;padding:3px 5px;font-size:68.75%}div.toolbar,div#search input{font-family:tahoma,verdana,arial,helvetica,sans-serif}div.toolbar input.button{padding:0 5px;font-size:100%}div.toolbar input.hidden{display:none}div#switches input#clearButton{margin-left:20px}div#levels label{font-weight:bold}div#levels label,div#options label{margin-right:5px}div#levels label#wrapLabel{font-weight:normal}div#search label{margin-right:10px}div#search label.searchboxlabel{margin-right:0}div#search input{font-size:100%}div#search input.validregex{color:green}div#search input.invalidregex{color:red}div#search input.nomatches{color:white;background-color:#ff6666}div#search input.nomatches{color:white;background-color:#ff6666}div#searchNav{display:none}div#commandLine{display:none}div#commandLine input#command{font-size:100%;font-family:Courier New,Courier}div#commandLine input#evaluateButton{}*.greyedout{color:gray !important;border-color:gray !important}*.greyedout *.alwaysenabled{color:black}*.unselectable{-khtml-user-select:none;-moz-user-select:none;user-select:none}div#log{font-family:Courier New,Courier;font-size:75%;width:100%;overflow:auto;clear:both;position:relative}div.group{border-color:#cccccc;border-style:solid;border-width:1px 0 1px 1px;overflow:visible}div.oldIe div.group,div.oldIe div.group *,div.oldIe *.logentry{height:1%}div.group div.groupheading span.expander{border:solid black 1px;font-family:Courier New,Courier;font-size:0.833em;background-color:#eeeeee;position:relative;top:-1px;color:black;padding:0 2px;cursor:pointer;cursor:hand;height:1%}div.group div.groupcontent{margin-left:10px;padding-bottom:2px;overflow:visible}div.group div.expanded{display:block}div.group div.collapsed{display:none}*.logentry{overflow:visible;display:none;white-space:pre}span.pre{white-space:pre}pre.unwrapped{display:inline !important}pre.unwrapped pre.pre,div.wrapped pre.pre{display:inline}div.wrapped pre.pre{white-space:normal}div.wrapped{display:none}body.searching *.logentry span.currentmatch{color:white !important;background-color:green !important}body.searching div.searchhighlight *.logentry span.searchterm{color:black;background-color:yellow}div.wrap *.logentry{white-space:normal !important;border-width:0 0 1px 0;border-color:#dddddd;border-style:dotted}div.wrap #log_wrapped,#log_unwrapped{display:block}div.wrap #log_unwrapped,#log_wrapped{display:none}div.wrap *.logentry span.pre{overflow:visible;white-space:normal}div.wrap *.logentry pre.unwrapped{display:none}div.wrap *.logentry span.wrapped{display:inline}div.searchfilter *.searchnonmatch{display:none !important}div#log *.TRACE,label#label_TRACE{color:#666666}div#log *.DEBUG,label#label_DEBUG{color:green}div#log *.INFO,label#label_INFO{color:#000099}div#log *.WARN,label#label_WARN{color:#999900}div#log *.ERROR,label#label_ERROR{color:red}div#log *.FATAL,label#label_FATAL{color:#660066}div.TRACE#log *.TRACE,div.DEBUG#log *.DEBUG,div.INFO#log *.INFO,div.WARN#log *.WARN,div.ERROR#log *.ERROR,div.FATAL#log *.FATAL{display:block}div#log div.separator{background-color:#cccccc;margin:5px 0;line-height:1px}","</style>","</head>",'<body id="body">','<div id="switchesContainer">','<div id="switches">','<div id="levels" class="toolbar">',"Filters:",'<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"</div>",'<div id="search" class="toolbar">','<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','<div id="searchNav">','<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"</div>","</div>",'<div id="options" class="toolbar">',"Options:",'<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"</div>","</div>","</div>",'<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','<div id="commandLine" class="toolbar">','<div id="commandLineContainer">','<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"</div>","</div>","</body>","</html>",""];e.open();for(var n=0,i=t.length;n<i;n++)e.writeln(t[n]);e.close()};this.setEventTypes(["load","unload"]);var q=function(){var e=_();e.setAppender(u),e.setNewestAtTop(y),e.setScrollToLatest(b),e.setMaxMessages(x),e.setShowCommandLine(E),e.setShowHideButton(k),e.setShowCloseButton(A),e.setMainWindow(window);var t=getCookie("log4javascriptCommandHistory");t&&(e.commandHistory=t.split(","),e.currentCommandIndex=e.commandHistory.length),u.dispatchEvent("load",{win:e})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),m||(logLog.debug("really doing unload "+this),m=!0,h=!1,p=!1,u.dispatchEvent("unload",{}))};var z=function(e,t,n,i){var r=setInterval(function(){try{m&&clearInterval(r),e(_())&&(clearInterval(r),n())}catch(e){clearInterval(r),g=!1,handleError(i,e)}},t)},G=function(){var e=document.domain!=location.hostname;return o?"":getBaseUrl()+"console.html"+(e?"?log4javascript_domain="+escape(document.domain):"")};if(n){var W=null,J=[];this.addCssProperty=function(e,t){L("cssProperties")&&J.push([e,t])};var Y,K=!1,X=uniqueId+"_InPageAppender_"+v;this.hide=function(){d&&p&&(P()&&_().$("command").blur(),Y.style.display="none",M=!0)},this.show=function(){d&&(p?(Y.style.display="block",this.setShowCommandLine(E),M=!1):K||C(!0))},this.isVisible=function(){return!M&&!m},this.close=function(e){m||e&&!confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?")||(Y.parentNode.removeChild(Y),this.unload())},T=function(){var e="InPageAppender.open: unable to create console iframe";function t(){try{a||u.show(),q(),h=!0,F()}catch(t){g=!1,handleError(e,t)}}function n(){try{var n=function(e){return isLoaded(e)};o&&V(_().document),n(_())?t():z(n,100,t,e)}catch(t){g=!1,handleError(e,t)}}M=!1,(Y=W.appendChild(document.createElement("div"))).style.width=s,Y.style.height=l,Y.style.border="solid gray 1px";for(var i=0,r=J.length;i<r;i++)Y.style[J[i][0]]=J[i][1];var c=o?"":" src='"+G()+"'";Y.innerHTML="<iframe id='"+X+"' name='"+X+"' width='100%' height='100%' frameborder='0'"+c+" scrolling='no'></iframe>",m=!1;var d=function(e){try{return bool(e)&&bool(e.document)}catch(e){return!1}};d(_())?n():z(d,100,n,e),p=!0},C=function(e){if(e||!a){var t=function(){if(i)try{var e=document.getElementById(i);1==e.nodeType&&(W=e),T()}catch(e){handleError("InPageAppender.init: invalid container element '"+i+"' supplied",e)}else(W=document.createElement("div")).style.position="fixed",W.style.left="0",W.style.right="0",W.style.bottom="0",document.body.appendChild(W),u.addCssProperty("borderWidth","1px 0 0 0"),u.addCssProperty("zIndex",1e6),T()};pageLoaded&&i&&i.appendChild?(W=i,T()):pageLoaded?t():log4javascript.addEventListener("load",t),K=!0}},w=function(){C(),d=!0},_=function(){var e=window.frames[X];if(e)return e},S=function(){return!(!g||m)&&(p&&!h&&_()&&isLoaded(_())&&(h=!0),h)}}else{var $,Z=u.defaults.useOldPopUp,Q=u.defaults.complainAboutPopUpBlocking,ee=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return Z},this.setUseOldPopUp=function(e){L("useOldPopUp")&&(Z=bool(e))},this.isComplainAboutPopUpBlocking=function(){return Q},this.setComplainAboutPopUpBlocking=function(e){L("complainAboutPopUpBlocking")&&(Q=bool(e))},this.isFocusPopUp=function(){return c},this.setFocusPopUp=function(e){c=bool(e)},this.isReopenWhenClosed=function(){return ee},this.setReopenWhenClosed=function(e){ee=bool(e)},this.close=function(){logLog.debug("close "+this);try{$.close(),this.unload()}catch(e){}},this.hide=function(){logLog.debug("hide "+this),P()&&this.close()},this.show=function(){logLog.debug("show "+this),p||T()},this.isVisible=function(){return S()},T=function(){var e="width="+s+",height="+l+",status,resizable",t="";try{var n=window.frameElement;n&&(t="_"+n.tagName+"_"+(n.name||n.id||""))}catch(e){t="_inaccessibleParentFrame"}var i="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+v+t;Z&&o||(i=i+"_"+uniqueId);var r=function(e){if(m)return!0;try{return bool(e)&&e.closed}catch(e){}return!1},a=function(){m||u.unload()};function c(){_().setCloseIfOpenerCloses(!Z||!o),q(),h=!0,F(),z(r,500,a,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}try{if($=window.open(G(),i,e),m=!1,p=!0,$&&$.document)if(o&&Z&&isLoaded($))$.mainPageReloaded(),c();else{o&&V($.document);isLoaded($)?c():z(function(e){return bool(e)&&isLoaded(e)},100,c,"PopUpAppender.init: unable to create console window")}else g=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),Q&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}catch(e){handleError("PopUpAppender.init: error creating pop-up",e)}},C=function(){a||T()},w=function(){C(),d=!0},_=function(){return $},S=function(){if(g&&!isUndefined($)&&!m){if($.closed||h&&isUndefined($.closed))return u.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!h&&isLoaded($)&&(h=!0)}return g&&h&&!m}}this.getConsoleWindow=_},ConsoleAppender.addGlobalCommandLineFunction=function(t,n){e.push([t,n])},n.prototype=new ConsoleAppender,n.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,useDocumentWrite:!0},n.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=n,i.prototype=new ConsoleAppender,i.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},i.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=i,log4javascript.InlineAppender=i}(),function(){function e(e){var t=0;for(var n in e)t=Math.max(toStr(n).length,t);var i=[];for(n in e){var r,a="  "+padWithSpaces(toStr(n),t+2);try{r=splitIntoLines(toStr(e[n])).join(padWithSpaces(newLine,t+6))}catch(e){r="[Error obtaining property. Details: "+getExceptionMessage(e)+"]"}i.push(a+r)}return i.join(newLine)}var t={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},n=["script","pre"],i=["br","img","hr","param","link","area","input","col","base","meta"],r="  ";function a(e,o,s,l,c){var u;function d(e){for(var t=e.style.cssText.split(";"),n="",i=0,r=t.length;i<r;i++){var a=t[i].split(":"),o=[];/^\s*$/.test(a[0])||o.push(trim(a[0]).toLowerCase()+":"+trim(a[1])),n=o.join(";")}return n}o=void 0===o||!!o,"string"!=typeof s&&(s=""),l=!!l,c=!!c;var p,h,m,f;if(!o||e.nodeType==t.DOCUMENT_FRAGMENT_NODE){for(u="",p=0,h=e.childNodes.length;p<h;p++)u+=a(e.childNodes[p],!0,s+r);return u}switch(e.nodeType){case t.ELEMENT_NODE:var g=e.tagName.toLowerCase();u=l?newLine+s:"",u+="<";var v=(f=e).prefix?f.prefix:f.outerHTML&&new RegExp("<([^:]+):"+f.tagName+"[^>]*>","i").test(f.outerHTML)?RegExp.$1.toLowerCase():"",y=!!v;for(y&&(u+=v+":"),u+=g,p=0,h=e.attributes.length;p<h;p++){var b=e.attributes[p];b.specified&&null!==b.nodeValue&&"style"!==b.nodeName.toLowerCase()&&"string"==typeof b.nodeValue&&0!==b.nodeName.indexOf("_moz")&&(u+=" "+b.nodeName.toLowerCase()+'="',u+=b.nodeValue.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;"),u+='"')}if(e.style.cssText)""!==d(e)&&(u+=' style="'+d(e)+'"');if(array_contains(i,g)||y&&!e.hasChildNodes())u+="/>";else{u+=">";var w=!(1===e.childNodes.length&&e.childNodes[0].nodeType===t.TEXT_NODE),C=array_contains(n,g);for(p=0,h=e.childNodes.length;p<h;p++)u+=a(e.childNodes[p],!0,s+r,w,C);var S="</"+g+">";u+=w?newLine+s+S:S}return u;case t.TEXT_NODE:if((m=e).nodeType==t.TEXT_NODE&&/^[ \t\r\n]*$/.test(m.nodeValue))u="";else{if(c)u=e.nodeValue;else{var _=splitIntoLines(trim(e.nodeValue)),T=[];for(p=0,h=_.length;p<h;p++)T[p]=trim(_[p]);u=T.join(newLine+s)}l&&(u=newLine+s+u)}return u;case t.CDATA_SECTION_NODE:return"<![CDATA["+e.nodeValue+"]]>"+newLine;case t.DOCUMENT_NODE:for(u="",p=0,h=e.childNodes.length;p<h;p++)u+=a(e.childNodes[p],!0,s);return u;default:return""}}ConsoleAppender.addGlobalCommandLineFunction("$",function(e,t,n){return document.getElementById(t[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(t,n,i){for(var r=[],a=0,o=n.length;a<o;a++)r[a]=e(n[a]);return r.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(e,t,n){for(var i=[],r=0,o=t.length;r<o;r++)i[r]=a(t[r]);return i.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(e,t,n){var i,r;return 0===t.length||""===t[0]?(i=window,r="Command line set to run in main window"):t[0].window==t[0]?(i=t[0],r="Command line set to run in frame '"+t[0].name+"'"):(i=window.frames[t[0]])?r="Command line set to run in frame '"+t[0]+"'":(n.isError=!0,r="Frame '"+t[0]+"' does not exist",i=e.getCommandWindow()),e.setCommandWindow(i),r}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(e,t,n){n.appendResult=!1,e.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(e,t,n){var i=[];for(var r in t[0])i.push(r);return i}),ConsoleAppender.addGlobalCommandLineFunction("values",function(e,t,n){var i=[];for(var r in t[0])try{i.push(t[0][r])}catch(e){logLog.warn("values(): Unable to obtain value for key "+r+". Details: "+getExceptionMessage(e))}return i}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(e,t,n){var i=parseInt(t[0],10);return isNaN(i)||i<0?(n.isError=!0,t[0]+" is not a valid expansion depth"):(e.setCommandLineObjectExpansionDepth(i),"Object expansion depth set to "+i)})}(),log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener)window.addEventListener("load",log4javascript.setDocumentReady,!1);else if(window.attachEvent)window.attachEvent("onload",log4javascript.setDocumentReady);else{var oldOnload=window.onload;"function"!=typeof window.onload?window.onload=log4javascript.setDocumentReady:window.onload=function(e){oldOnload&&oldOnload(e),log4javascript.setDocumentReady()}}return log4javascript},this),function(){var e=new Set("annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" "));function t(t){var n=e.has(t);return t=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(t),!n&&t}function n(e){var t=e.isConnected;if(void 0!==t)return t;for(;e&&!(e.__CE_isImportDocument||e instanceof Document);)e=e.parentNode||(window.ShadowRoot&&e instanceof ShadowRoot?e.host:void 0);return!(!e||!(e.__CE_isImportDocument||e instanceof Document))}function i(e,t){for(;t&&t!==e&&!t.nextSibling;)t=t.parentNode;return t&&t!==e?t.nextSibling:null}function r(e,t,n){n=void 0===n?new Set:n;for(var a=e;a;){if(a.nodeType===Node.ELEMENT_NODE){var o=a;t(o);var s=o.localName;if("link"===s&&"import"===o.getAttribute("rel")){if((a=o.import)instanceof Node&&!n.has(a))for(n.add(a),a=a.firstChild;a;a=a.nextSibling)r(a,t,n);a=i(e,o);continue}if("template"===s){a=i(e,o);continue}if(o=o.__CE_shadowRoot)for(o=o.firstChild;o;o=o.nextSibling)r(o,t,n)}a=a.firstChild?a.firstChild:i(e,a)}}function a(e,t,n){e[t]=n}function o(){this.a=new Map,this.f=new Map,this.c=[],this.b=!1}function s(e,t){e.b=!0,e.c.push(t)}function l(e,t){e.b&&r(t,function(t){return c(e,t)})}function c(e,t){if(e.b&&!t.__CE_patched){t.__CE_patched=!0;for(var n=0;n<e.c.length;n++)e.c[n](t)}}function u(e,t){var n=[];for(r(t,function(e){return n.push(e)}),t=0;t<n.length;t++){var i=n[t];1===i.__CE_state?e.connectedCallback(i):h(e,i)}}function d(e,t){var n=[];for(r(t,function(e){return n.push(e)}),t=0;t<n.length;t++){var i=n[t];1===i.__CE_state&&e.disconnectedCallback(i)}}function p(e,t,n){var i=(n=void 0===n?{}:n).u||new Set,a=n.h||function(t){return h(e,t)},o=[];if(r(t,function(t){if("link"===t.localName&&"import"===t.getAttribute("rel")){var n=t.import;n instanceof Node&&(n.__CE_isImportDocument=!0,n.__CE_hasRegistry=!0),n&&"complete"===n.readyState?n.__CE_documentLoadHandled=!0:t.addEventListener("load",function(){var n=t.import;if(!n.__CE_documentLoadHandled){n.__CE_documentLoadHandled=!0;var r=new Set(i);r.delete(n),p(e,n,{u:r,h:a})}})}else o.push(t)},i),e.b)for(t=0;t<o.length;t++)c(e,o[t]);for(t=0;t<o.length;t++)a(o[t])}function h(e,t){if(void 0===t.__CE_state){var i=t.ownerDocument;if((i.defaultView||i.__CE_isImportDocument&&i.__CE_hasRegistry)&&(i=e.a.get(t.localName))){i.constructionStack.push(t);var r=i.constructorFunction;try{try{if(new r!==t)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{i.constructionStack.pop()}}catch(e){throw t.__CE_state=2,e}if(t.__CE_state=1,t.__CE_definition=i,i.attributeChangedCallback)for(i=i.observedAttributes,r=0;r<i.length;r++){var a=i[r],o=t.getAttribute(a);null!==o&&e.attributeChangedCallback(t,a,null,o,null)}n(t)&&e.connectedCallback(t)}}}function m(e){var t=document;this.c=e,this.a=t,this.b=void 0,p(this.c,this.a),"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function f(e){e.b&&e.b.disconnect()}function g(e){if(e.a)throw Error("Already resolved.");e.a=void 0,e.b&&e.b(void 0)}function v(e){this.c=!1,this.a=e,this.j=new Map,this.f=function(e){return e()},this.b=!1,this.i=[],this.o=new m(e)}o.prototype.connectedCallback=function(e){var t=e.__CE_definition;t.connectedCallback&&t.connectedCallback.call(e)},o.prototype.disconnectedCallback=function(e){var t=e.__CE_definition;t.disconnectedCallback&&t.disconnectedCallback.call(e)},o.prototype.attributeChangedCallback=function(e,t,n,i,r){var a=e.__CE_definition;a.attributeChangedCallback&&-1<a.observedAttributes.indexOf(t)&&a.attributeChangedCallback.call(e,t,n,i,r)},m.prototype.f=function(e){var t=this.a.readyState;for("interactive"!==t&&"complete"!==t||f(this),t=0;t<e.length;t++)for(var n=e[t].addedNodes,i=0;i<n.length;i++)p(this.c,n[i])},v.prototype.l=function(e,n){var i=this;if(!(n instanceof Function))throw new TypeError("Custom element constructors must be functions.");if(!t(e))throw new SyntaxError("The element name '"+e+"' is not valid.");if(this.a.a.get(e))throw Error("A custom element with name '"+e+"' has already been defined.");if(this.c)throw Error("A custom element is already being defined.");this.c=!0;try{var r=function(e){var t=a[e];if(void 0!==t&&!(t instanceof Function))throw Error("The '"+e+"' callback must be a function.");return t},a=n.prototype;if(!(a instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var o=r("connectedCallback"),s=r("disconnectedCallback"),l=r("adoptedCallback"),c=r("attributeChangedCallback"),u=n.observedAttributes||[]}catch(e){return}finally{this.c=!1}n={localName:e,constructorFunction:n,connectedCallback:o,disconnectedCallback:s,adoptedCallback:l,attributeChangedCallback:c,observedAttributes:u,constructionStack:[]},function(e,t,n){e.a.set(t,n),e.f.set(n.constructorFunction,n)}(this.a,e,n),this.i.push(n),this.b||(this.b=!0,this.f(function(){return function(e){if(!1!==e.b){e.b=!1;for(var t=e.i,n=[],i=new Map,r=0;r<t.length;r++)i.set(t[r].localName,[]);for(p(e.a,document,{h:function(t){if(void 0===t.__CE_state){var r=t.localName,a=i.get(r);a?a.push(t):e.a.a.get(r)&&n.push(t)}}}),r=0;r<n.length;r++)h(e.a,n[r]);for(;0<t.length;){var a=t.shift();r=a.localName,a=i.get(a.localName);for(var o=0;o<a.length;o++)h(e.a,a[o]);(r=e.j.get(r))&&g(r)}}}(i)}))},v.prototype.h=function(e){p(this.a,e)},v.prototype.get=function(e){if(e=this.a.a.get(e))return e.constructorFunction},v.prototype.m=function(e){if(!t(e))return Promise.reject(new SyntaxError("'"+e+"' is not a valid custom element name."));var n=this.j.get(e);return n?n.c:(n=new function(){var e=this;this.b=this.a=void 0,this.c=new Promise(function(t){e.b=t,e.a&&t(e.a)})},this.j.set(e,n),this.a.a.get(e)&&!this.i.some(function(t){return t.localName===e})&&g(n),n.c)},v.prototype.s=function(e){f(this.o);var t=this.f;this.f=function(n){return e(function(){return t(n)})}},window.CustomElementRegistry=v,v.prototype.define=v.prototype.l,v.prototype.upgrade=v.prototype.h,v.prototype.get=v.prototype.get,v.prototype.whenDefined=v.prototype.m,v.prototype.polyfillWrapFlushCallback=v.prototype.s;var y=window.Document.prototype.createElement,b=window.Document.prototype.createElementNS,w=window.Document.prototype.importNode,C=window.Document.prototype.prepend,S=window.Document.prototype.append,_=window.DocumentFragment.prototype.prepend,T=window.DocumentFragment.prototype.append,x=window.Node.prototype.cloneNode,E=window.Node.prototype.appendChild,I=window.Node.prototype.insertBefore,k=window.Node.prototype.removeChild,A=window.Node.prototype.replaceChild,R=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),L=window.Element.prototype.attachShadow,P=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),M=window.Element.prototype.getAttribute,D=window.Element.prototype.setAttribute,N=window.Element.prototype.removeAttribute,H=window.Element.prototype.getAttributeNS,U=window.Element.prototype.setAttributeNS,F=window.Element.prototype.removeAttributeNS,O=window.Element.prototype.insertAdjacentElement,B=window.Element.prototype.insertAdjacentHTML,j=window.Element.prototype.prepend,V=window.Element.prototype.append,q=window.Element.prototype.before,z=window.Element.prototype.after,G=window.Element.prototype.replaceWith,W=window.Element.prototype.remove,J=window.HTMLElement,Y=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),K=window.HTMLElement.prototype.insertAdjacentElement,X=window.HTMLElement.prototype.insertAdjacentHTML,$=new function(){};function Z(e,t,i){function r(t){return function(i){for(var r=[],a=0;a<arguments.length;++a)r[a]=arguments[a];a=[];for(var o=[],s=0;s<r.length;s++){var l=r[s];if(l instanceof Element&&n(l)&&o.push(l),l instanceof DocumentFragment)for(l=l.firstChild;l;l=l.nextSibling)a.push(l);else a.push(l)}for(t.apply(this,r),r=0;r<o.length;r++)d(e,o[r]);if(n(this))for(r=0;r<a.length;r++)(o=a[r])instanceof Element&&u(e,o)}}void 0!==i.g&&(t.prepend=r(i.g)),void 0!==i.append&&(t.append=r(i.append))}var Q,ee=window.customElements;if(!ee||ee.forcePolyfill||"function"!=typeof ee.define||"function"!=typeof ee.get){var te=new o;Q=te,window.HTMLElement=function(){function e(){var e=this.constructor,t=Q.f.get(e);if(!t)throw Error("The custom element being constructed was not registered with `customElements`.");var n=t.constructionStack;if(0===n.length)return n=y.call(document,t.localName),Object.setPrototypeOf(n,e.prototype),n.__CE_state=1,n.__CE_definition=t,c(Q,n),n;var i=n[t=n.length-1];if(i===$)throw Error("The HTMLElement constructor was either called reentrantly for this constructor or called multiple times.");return n[t]=$,Object.setPrototypeOf(i,e.prototype),c(Q,i),i}return e.prototype=J.prototype,Object.defineProperty(e.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:e}),e}(),function(){var e=te;a(Document.prototype,"createElement",function(t){if(this.__CE_hasRegistry){var n=e.a.get(t);if(n)return new n.constructorFunction}return t=y.call(this,t),c(e,t),t}),a(Document.prototype,"importNode",function(t,n){return t=w.call(this,t,!!n),this.__CE_hasRegistry?p(e,t):l(e,t),t}),a(Document.prototype,"createElementNS",function(t,n){if(this.__CE_hasRegistry&&(null===t||"http://www.w3.org/1999/xhtml"===t)){var i=e.a.get(n);if(i)return new i.constructorFunction}return t=b.call(this,t,n),c(e,t),t}),Z(e,Document.prototype,{g:C,append:S})}(),Z(te,DocumentFragment.prototype,{g:_,append:T}),function(){function e(e,i){Object.defineProperty(e,"textContent",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(e){if(this.nodeType===Node.TEXT_NODE)i.set.call(this,e);else{var r=void 0;if(this.firstChild){var a=this.childNodes,o=a.length;if(0<o&&n(this)){r=Array(o);for(var s=0;s<o;s++)r[s]=a[s]}}if(i.set.call(this,e),r)for(e=0;e<r.length;e++)d(t,r[e])}}})}var t=te;a(Node.prototype,"insertBefore",function(e,i){if(e instanceof DocumentFragment){var r=Array.prototype.slice.apply(e.childNodes);if(e=I.call(this,e,i),n(this))for(i=0;i<r.length;i++)u(t,r[i]);return e}return r=n(e),i=I.call(this,e,i),r&&d(t,e),n(this)&&u(t,e),i}),a(Node.prototype,"appendChild",function(e){if(e instanceof DocumentFragment){var i=Array.prototype.slice.apply(e.childNodes);if(e=E.call(this,e),n(this))for(var r=0;r<i.length;r++)u(t,i[r]);return e}return i=n(e),r=E.call(this,e),i&&d(t,e),n(this)&&u(t,e),r}),a(Node.prototype,"cloneNode",function(e){return e=x.call(this,!!e),this.ownerDocument.__CE_hasRegistry?p(t,e):l(t,e),e}),a(Node.prototype,"removeChild",function(e){var i=n(e),r=k.call(this,e);return i&&d(t,e),r}),a(Node.prototype,"replaceChild",function(e,i){if(e instanceof DocumentFragment){var r=Array.prototype.slice.apply(e.childNodes);if(e=A.call(this,e,i),n(this))for(d(t,i),i=0;i<r.length;i++)u(t,r[i]);return e}r=n(e);var a=A.call(this,e,i),o=n(this);return o&&d(t,i),r&&d(t,e),o&&u(t,e),a}),R&&R.get?e(Node.prototype,R):s(t,function(t){e(t,{enumerable:!0,configurable:!0,get:function(){for(var e=[],t=0;t<this.childNodes.length;t++)e.push(this.childNodes[t].textContent);return e.join("")},set:function(e){for(;this.firstChild;)k.call(this,this.firstChild);E.call(this,document.createTextNode(e))}})})}(),function(){function e(e,t){Object.defineProperty(e,"innerHTML",{enumerable:t.enumerable,configurable:!0,get:t.get,set:function(e){var i=this,a=void 0;if(n(this)&&(a=[],r(this,function(e){e!==i&&a.push(e)})),t.set.call(this,e),a)for(var s=0;s<a.length;s++){var c=a[s];1===c.__CE_state&&o.disconnectedCallback(c)}return this.ownerDocument.__CE_hasRegistry?p(o,this):l(o,this),e}})}function t(e,t){a(e,"insertAdjacentElement",function(e,i){var r=n(i);return e=t.call(this,e,i),r&&d(o,i),n(e)&&u(o,i),e})}function i(e,t){function n(e,t){for(var n=[];e!==t;e=e.nextSibling)n.push(e);for(t=0;t<n.length;t++)p(o,n[t])}a(e,"insertAdjacentHTML",function(e,i){if("beforebegin"===(e=e.toLowerCase())){var r=this.previousSibling;t.call(this,e,i),n(r||this.parentNode.firstChild,this)}else if("afterbegin"===e)r=this.firstChild,t.call(this,e,i),n(this.firstChild,r);else if("beforeend"===e)r=this.lastChild,t.call(this,e,i),n(r||this.firstChild,null);else{if("afterend"!==e)throw new SyntaxError("The value provided ("+String(e)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");r=this.nextSibling,t.call(this,e,i),n(this.nextSibling,r)}})}var o=te;L&&a(Element.prototype,"attachShadow",function(e){return this.__CE_shadowRoot=L.call(this,e)}),P&&P.get?e(Element.prototype,P):Y&&Y.get?e(HTMLElement.prototype,Y):s(o,function(t){e(t,{enumerable:!0,configurable:!0,get:function(){return x.call(this,!0).innerHTML},set:function(e){var t="template"===this.localName,n=t?this.content:this,i=b.call(document,this.namespaceURI,this.localName);for(i.innerHTML=e;0<n.childNodes.length;)k.call(n,n.childNodes[0]);for(e=t?i.content:i;0<e.childNodes.length;)E.call(n,e.childNodes[0])}})}),a(Element.prototype,"setAttribute",function(e,t){if(1!==this.__CE_state)return D.call(this,e,t);var n=M.call(this,e);D.call(this,e,t),t=M.call(this,e),o.attributeChangedCallback(this,e,n,t,null)}),a(Element.prototype,"setAttributeNS",function(e,t,n){if(1!==this.__CE_state)return U.call(this,e,t,n);var i=H.call(this,e,t);U.call(this,e,t,n),n=H.call(this,e,t),o.attributeChangedCallback(this,t,i,n,e)}),a(Element.prototype,"removeAttribute",function(e){if(1!==this.__CE_state)return N.call(this,e);var t=M.call(this,e);N.call(this,e),null!==t&&o.attributeChangedCallback(this,e,t,null,null)}),a(Element.prototype,"removeAttributeNS",function(e,t){if(1!==this.__CE_state)return F.call(this,e,t);var n=H.call(this,e,t);F.call(this,e,t);var i=H.call(this,e,t);n!==i&&o.attributeChangedCallback(this,t,n,i,e)}),K?t(HTMLElement.prototype,K):O?t(Element.prototype,O):console.warn("Custom Elements: `Element#insertAdjacentElement` was not patched."),X?i(HTMLElement.prototype,X):B?i(Element.prototype,B):console.warn("Custom Elements: `Element#insertAdjacentHTML` was not patched."),Z(o,Element.prototype,{g:j,append:V}),function(e){function t(t){return function(i){for(var r=[],a=0;a<arguments.length;++a)r[a]=arguments[a];a=[];for(var o=[],s=0;s<r.length;s++){var l=r[s];if(l instanceof Element&&n(l)&&o.push(l),l instanceof DocumentFragment)for(l=l.firstChild;l;l=l.nextSibling)a.push(l);else a.push(l)}for(t.apply(this,r),r=0;r<o.length;r++)d(e,o[r]);if(n(this))for(r=0;r<a.length;r++)(o=a[r])instanceof Element&&u(e,o)}}var i=Element.prototype;void 0!==q&&(i.before=t(q)),void 0!==q&&(i.after=t(z)),void 0!==G&&a(i,"replaceWith",function(t){for(var i=[],r=0;r<arguments.length;++r)i[r]=arguments[r];r=[];for(var a=[],o=0;o<i.length;o++){var s=i[o];if(s instanceof Element&&n(s)&&a.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)r.push(s);else r.push(s)}for(o=n(this),G.apply(this,i),i=0;i<a.length;i++)d(e,a[i]);if(o)for(d(e,this),i=0;i<r.length;i++)(a=r[i])instanceof Element&&u(e,a)}),void 0!==W&&a(i,"remove",function(){var t=n(this);W.call(this),t&&d(e,this)})}(o)}(),document.__CE_hasRegistry=!0;var ne=new v(te);Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:ne})}}.call(self),function(){if("undefined"!=typeof window)try{var e=new window.CustomEvent("test",{cancelable:!0});if(e.preventDefault(),!0!==e.defaultPrevented)throw new Error("Could not prevent default")}catch(e){var t=function(e,t){var n,i;return t=t||{bubbles:!1,cancelable:!1,detail:void 0},(n=document.createEvent("CustomEvent")).initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i=n.preventDefault,n.preventDefault=function(){i.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch(e){this.defaultPrevented=!0}},n};t.prototype=window.Event.prototype,window.CustomEvent=t}}();var DigestGenerator=function(){var e={formulateResponse:function(e,t,n,i,r,a){var o=CryptoJS.MD5(e+":"+i+":"+t).toString(),s=CryptoJS.MD5(r+":"+n).toString();return CryptoJS.MD5(o+":"+a+":"+s).toString()},getDigestInfoInWwwAuthenticate:function(e){var t=e,n=null,i=null;if(null!==t){t=t.split(",");for(var r=0;r<t.length;r++){var a=t[r].split("="),o=a[0],s=a[1].replace(/\"/g,"").trim();null!==o.match(/realm/i)&&(n=s),null!==o.match(/nonce/i)&&(i=s)}}return{realm:n,nonce:i}}};return e},box,dinf,esds,ftyp,mdat,mfhd,minf,moof,moov,mvex,mvhd,trak,tkhd,mdia,mdhd,hdlr,sdtp,stbl,stsd,traf,trex,trun,types,MAJOR_BRAND,MINOR_VERSION,AVC1_BRAND,VIDEO_HDLR,ISO5_BRAND,DASH_BRAND,iods,mehd,trep,free,udta,meta,ilst,styp,sidx,AUDIO_HDLR,HDLR_TYPES,VMHD,SMHD,DREF,STCO,STSC,STSZ,STTS;function Fisheye3DMulti(){var e,t,n,i,r,a=!1,o=0,s=0,l=0,c=0,u=230,d=45,p=function(){return function e(t){var n=this;if(null!=t&&t instanceof e||null===t)this.u=0,this.v=0,this.x=0,this.y=0,this.z=0,n.x=t.x,n.y=t.y,n.z=t.z,n.u=t.u,n.v=t.v;else{if(void 0!==t)throw new Error("invalid overload");this.u=0,this.v=0,this.x=0,this.y=0,this.z=0,n.v=0,n.u=0,n.z=0,n.y=0,n.x=0}}}(),h=function(){function e(){this.m_InvertX=!1,this.m_InvertY=!1,this.m_FisheyeHeight=0,this.m_FisheyeWidth=0,this.m_NumTriangles=0,this.m_TextureHeight=0,this.m_TextureWidth=0}return e.prototype.ClipToCircle=function(e){var t,n=this.m_FisheyeConfig.GetCenterX(),i=this.m_FisheyeConfig.GetCenterY(),r=this.m_FisheyeConfig.GetMaxRadius(),a=Math.sqrt((e.u-n)*(e.u-n)+(e.v-i)*(e.v-i));return(t=a<r)||(r/=a,e.u=(e.u-n)*r+n,e.v=(e.v-i)*r+i),t},e.prototype.CreateTriangle=function(e,t,n){e=new p(e),t=new p(t),n=new p(n);var i=this.ClipToCircle(e),r=this.ClipToCircle(t),a=this.ClipToCircle(n),o=this.Normalize(e),s=this.Normalize(t),l=this.Normalize(n);(i||r||a)&&(o||s||l)&&(this.Find3DPos(e),this.Find3DPos(t),this.Find3DPos(n),this.m_Triangles[5*this.m_NumTriangles*3+0+0]=e.x,this.m_Triangles[5*this.m_NumTriangles*3+0+1]=e.y,this.m_Triangles[5*this.m_NumTriangles*3+0+2]=e.z,this.m_Triangles[5*this.m_NumTriangles*3+0+3]=e.u,this.m_Triangles[5*this.m_NumTriangles*3+0+4]=e.v,this.m_Triangles[5*this.m_NumTriangles*3+5+0]=t.x,this.m_Triangles[5*this.m_NumTriangles*3+5+1]=t.y,this.m_Triangles[5*this.m_NumTriangles*3+5+2]=t.z,this.m_Triangles[5*this.m_NumTriangles*3+5+3]=t.u,this.m_Triangles[5*this.m_NumTriangles*3+5+4]=t.v,this.m_Triangles[5*this.m_NumTriangles*3+10+0]=n.x,this.m_Triangles[5*this.m_NumTriangles*3+10+1]=n.y,this.m_Triangles[5*this.m_NumTriangles*3+10+2]=n.z,this.m_Triangles[5*this.m_NumTriangles*3+10+3]=n.u,this.m_Triangles[5*this.m_NumTriangles*3+10+4]=n.v,++this.m_NumTriangles)},e.prototype.Find3DPos=function(e){var t=e.u,n=this.m_TextureWidth,i=e.v,r=this.m_TextureHeight;t=t*n-this.m_FisheyeConfig.GetCenterX(),i=r=i*r-this.m_FisheyeConfig.GetCenterY(),this.m_InvertY&&(i=-r),r=t,this.m_InvertX&&(r=-t),n=this.m_FisheyeConfig.GetMaxRadius();var a=Math.sqrt(r*r+i*i);t=a,a>n&&(t=n),t=.017453293*this.m_FisheyeConfig.GetFOV(t)/2,i=Math.atan2(i,r),e.z=Math.cos(t),e.y=Math.sin(t)*Math.sin(i),e.x=Math.sin(t)*Math.cos(i)},e.prototype.GenerateMesh=function(e,t,n,i,r,a,o,s){this.m_InvertX=o,this.m_InvertY=s,this.m_FisheyeConfig=t,this.m_FisheyeWidth=n,this.m_FisheyeHeight=i,this.m_TextureWidth=r,this.m_TextureHeight=a;var l=3*e/4,c=this.m_FisheyeConfig.GetMaxRadius(),u=new p,d=new p,h=new p,m=new p;this.m_NumTriangles=0,r=2*(0|Math.ceil(c/e+.5));var f=this.m_FisheyeConfig.GetCenterX()-(r/2|0)*e;for(a=2*(0|Math.ceil(c/l)),c=this.m_FisheyeConfig.GetCenterY()-(a/2|0)*l,this.m_Triangles=new Array(30*r*a),n=0;n<a;++n)for(i=0;i<r;++i)u.v=n*l+c,d.v=n*l+c,h.v=(n+1)*l+c,m.v=(n+1)*l+c,n%2==0?(d.u=(i+1)*e+f,u.u=i*e+f,h.u=e/2+i*e+f,m.u=e/2+(i+1)*e+f,this.CreateTriangle(u,h,d),this.CreateTriangle(d,h,m)):(u.u=e/2+f+i*e,d.u=e/2+f+(i+1)*e,h.u=i*e+f,m.u=(i+1)*e+f,this.CreateTriangle(u,m,d),this.CreateTriangle(u,h,m))},e.prototype.GetTriangleCount=function(){return this.m_NumTriangles},e.prototype.GetTriangles=function(){return this.m_Triangles},e.prototype.Normalize=function(e){var t=!0;return e.u/=this.m_FisheyeWidth,e.v/=this.m_FisheyeHeight,e.u<0&&(e.u=0,t=!1),e.u>1&&(e.u=1,t=!1),e.v<0&&(e.v=0,t=!1),e.v>1&&(e.v=1,t=!1),e.u*=this.m_FisheyeWidth/this.m_TextureWidth,e.v*=this.m_FisheyeHeight/this.m_TextureHeight,t},e.DEGREETORAD=.017453293,e}(),m=function(){function e(e,t,n,i,r){this.m_CenterX=0,this.m_CenterY=0,this.m_CircleFOV=0,this.m_CircleRadius=0,this.m_FOVToRadius=0,this.m_MaxFOV=0,this.m_MaxRadius=0,this.m_RadiusToFOV=0,this.m_CircleFOV=i,this.m_CircleRadius=r,this.m_CenterX=e,this.m_CenterY=t,i=this.m_CircleFOV,this.m_MaxFOV=i>n?n:i,this.m_MaxRadius=this.m_CircleRadius,this.m_RadiusToFOV=this.m_MaxFOV/this.m_MaxRadius,this.m_FOVToRadius=this.m_MaxRadius/this.m_MaxFOV}return e.prototype.GetCenterX=function(){return this.m_CenterX},e.prototype.GetCenterY=function(){return this.m_CenterY},e.prototype.GetCircleFOV=function(){return this.m_CircleFOV},e.prototype.GetCircleRadius=function(){return this.m_CircleRadius},e.prototype.GetFOV=function(e){return e<=this.m_MaxRadius?this.m_RadiusToFOV*e:-1},e.prototype.GetHeight=function(){return 2*this.GetMaxRadius()},e.prototype.GetMaxFOV=function(){return this.m_MaxFOV},e.prototype.GetMaxRadius=function(){return this.m_MaxRadius},e.prototype.GetRadius=function(e){return e<=this.m_MaxFOV?this.m_FOVToRadius*e:-1},e.prototype.GetWidth=function(){return 2*this.GetMaxRadius()},e.DEFAULT_MAX_FOV=170,e.DEFAULT_MAX_RADIUS=823.12506,e}();!function(){function e(){this.mNumTriangles=0}e.prototype.generateVertices=function(){var e=new m(1496,1496,170,170,1496),t=new h;t.GenerateMesh(124,e,2992,2992,2992,2992,!1,!0),this.mNumTriangles=t.GetTriangleCount();var n=t.GetTriangles(),i=3*this.mNumTriangles;this.position=new Float32Array(3*i),this.textureCoords=new Float32Array(2*i);for(var r=0;r<this.mNumTriangles;++r)this.textureCoords[6*r+0]=n[15*r+3],this.textureCoords[6*r+1]=n[15*r+4],this.position[9*r+0]=n[15*r],this.position[9*r+1]=n[15*r+1],this.position[9*r+2]=n[15*r+2],this.textureCoords[6*r+2]=n[15*r+10+3],this.textureCoords[6*r+3]=n[15*r+10+4],this.position[9*r+3]=n[15*r+10],this.position[9*r+4]=n[15*r+10+1],this.position[9*r+5]=n[15*r+10+2],this.textureCoords[6*r+4]=n[15*r+5+3],this.textureCoords[6*r+5]=n[15*r+5+4],this.position[9*r+6]=n[15*r+5],this.position[9*r+7]=n[15*r+5+1],this.position[9*r+8]=n[15*r+5+2]}}();function f(){}return f.prototype={init:function(a){var o,s;o=document.getElementById("mi-full-camera"),(e=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,4400)).target=new THREE.Vector3(0,0,0),t=new THREE.Scene;var l=function(){this.mNumTriangles=8,this.position=[],this.textureCoords=[];this.mNumTriangles=64;for(var e=Math.PI/32,t=a.height/a.width*Math.PI/2,n=0;n<32;n++){var i=18*n,r=12*n,o=e*(32-n),s=e*(31-n),l=Math.cos(o),c=Math.cos(s),u=Math.sin(o),d=Math.sin(s);this.position[i++]=l,this.position[i++]=t,this.position[i++]=-u,this.position[i++]=l,this.position[i++]=-t,this.position[i++]=-u,this.position[i++]=c,this.position[i++]=t,this.position[i++]=-d,this.position[i++]=c,this.position[i++]=t,this.position[i++]=-d,this.position[i++]=l,this.position[i++]=-t,this.position[i++]=-u,this.position[i++]=c,this.position[i++]=-t,this.position[i++]=-d,this.textureCoords[r++]=1/32*n,this.textureCoords[r++]=1,this.textureCoords[r++]=1/32*n,this.textureCoords[r++]=0,this.textureCoords[r++]=1/32*n+1/32,this.textureCoords[r++]=1,this.textureCoords[r++]=1/32*n+1/32,this.textureCoords[r++]=1,this.textureCoords[r++]=1/32*n,this.textureCoords[r++]=0,this.textureCoords[r++]=1/32*n+1/32,this.textureCoords[r++]=0}},c=new THREE.Geometry;c.verticesNeedUpdate=!0,c.elementsNeedUpdate=!0,c.uvsNeedUpdate=!0;for(var u=0;u<l.mNumTriangles;u++)c.vertices.push(new THREE.Vector3(200*l.position[9*u+0],200*l.position[9*u+1],200*l.position[9*u+2]),new THREE.Vector3(200*l.position[9*u+3],200*l.position[9*u+4],200*l.position[9*u+5]),new THREE.Vector3(200*l.position[9*u+6],200*l.position[9*u+7],200*l.position[9*u+8])),c.faces.push(new THREE.Face3(3*u+0,3*u+1,3*u+2)),c.faceVertexUvs[0].push([new THREE.Vector2(l.textureCoords[6*u+0],l.textureCoords[6*u+1]),new THREE.Vector2(l.textureCoords[6*u+2],l.textureCoords[6*u+3]),new THREE.Vector2(l.textureCoords[6*u+4],l.textureCoords[6*u+5])]);var d,p=new THREE.BufferGeometry;p.fromGeometry(c),a instanceof HTMLVideoElement?(a.play(),a.setAttribute("webkit-playsinline","webkit-playsinline"),d=new THREE.VideoTexture(a),i=null):(d=new THREE.CanvasTexture(a),i=d),d.minFilter=THREE.LinearFilter,d.format=THREE.RGBFormat;var h=new THREE.MeshBasicMaterial({map:d});s=new THREE.Mesh(p,h),t.add(s);var m=new THREE.GridHelper(1e3,50,16711680,0);m.position.y=-199,m.material.opacity=.25,m.material.transparent=!0,t.add(m),(n=new THREE.WebGLRenderer).setClearColor(15790320),n.setPixelRatio(window.devicePixelRatio),n.setSize(window.innerWidth,window.innerHeight),(r=new THREE.PerspectiveCamera(20,1,1,1e4)).position.y=50,r.position.z=1800,t.add(r),n.autoClear=!1,o.appendChild(n.domElement),document.addEventListener("mousedown",this.onDocumentMouseDown,!1),document.addEventListener("mousemove",this.onDocumentMouseMove,!1),document.addEventListener("mouseup",this.onDocumentMouseUp,!1),document.addEventListener("dblclick",this.onDocumentMouseDbClick,!1),document.addEventListener("mousewheel",this.onDocumentMouseWheel,!1),document.addEventListener("MozMousePixelScroll",this.onDocumentMouseWheel,!1),window.addEventListener("resize",this.onWindowResize,!1)},onWindowResize:function(){e.aspect=container.clientWidth/container.clientHeight,e.updateProjectionMatrix(),n.setSize(container.clientWidth,container.clientHeight)},onDocumentMouseDown:function(e){e.preventDefault(),a=!0,onPointerDownPointerX=e.clientX,onPointerDownPointerY=e.clientY,onPointerDownLon=o,onPointerDownLat=s},onDocumentMouseMove:function(e){!0===a&&(o=.1*(onPointerDownPointerX-e.clientX)+onPointerDownLon,s=.1*(onPointerDownPointerY-e.clientY)+onPointerDownLat)},onDocumentMouseUp:function(e){a=!1},onDocumentMouseDbClick:function(e){u=u>1e-10?1e-10:500},onDocumentMouseWheel:function(e){e.wheelDeltaY?u-=.005*e.wheelDeltaY:e.wheelDelta?u-=.005*e.wheelDelta:e.detail&&(u+=.5*e.detail),u<1e-10?(u=1e-10,d>1&&(d-=1)):d<45&&(u=1e-10,d+=1)},animate:function(){window.requestAnimationFrame(this.animate.bind(this)),this.update()},update:function(){i&&(i.needsUpdate=!0),e.up.set(0,1,0);var r=0;u<500&&(r=180*Math.atan(Math.tan(d*Math.PI/180/2)*e.aspect)/Math.PI,u>1e-10&&(r*=1-1*u/500)),s=Math.max(-75,Math.min(75,s)),l=THREE.Math.degToRad(s-90),o=r>90?0:Math.max(r-90,Math.min(90-r,o)),c=THREE.Math.degToRad(o-90),e.position.x=u*Math.sin(l)*Math.cos(c),e.position.y=u*Math.cos(l),e.position.z=u*Math.sin(l)*Math.sin(c),e.fov!=d&&(e.fov=d,e.updateProjectionMatrix()),e.lookAt(e.target),n.clear(),n.render(t,e)}},new f}function Fisheye3D(e){var t,n,i,r,a,o=!1,s=0,l=0,c=0,u=0,d=500,p=75,h=e,m=function(){return function e(t){var n=this;if(null!=t&&t instanceof e||null===t)this.u=0,this.v=0,this.x=0,this.y=0,this.z=0,n.x=t.x,n.y=t.y,n.z=t.z,n.u=t.u,n.v=t.v;else{if(void 0!==t)throw new Error("invalid overload");this.u=0,this.v=0,this.x=0,this.y=0,this.z=0,n.v=0,n.u=0,n.z=0,n.y=0,n.x=0}}}(),f=function(){function e(){this.m_InvertX=!1,this.m_InvertY=!1,this.m_FisheyeHeight=0,this.m_FisheyeWidth=0,this.m_NumTriangles=0,this.m_TextureHeight=0,this.m_TextureWidth=0}return e.prototype.ClipToCircle=function(e){var t,n=this.m_FisheyeConfig.GetCenterX(),i=this.m_FisheyeConfig.GetCenterY(),r=this.m_FisheyeConfig.GetMaxRadius(),a=Math.sqrt((e.u-n)*(e.u-n)+(e.v-i)*(e.v-i));return(t=a<r)||(r/=a,e.u=(e.u-n)*r+n,e.v=(e.v-i)*r+i),t},e.prototype.CreateTriangle=function(e,t,n){e=new m(e),t=new m(t),n=new m(n);var i=this.ClipToCircle(e),r=this.ClipToCircle(t),a=this.ClipToCircle(n),o=this.Normalize(e),s=this.Normalize(t),l=this.Normalize(n);(i||r||a)&&(o||s||l)&&(this.Find3DPos(e),this.Find3DPos(t),this.Find3DPos(n),this.m_Triangles[5*this.m_NumTriangles*3+0+0]=e.x,this.m_Triangles[5*this.m_NumTriangles*3+0+1]=e.y,this.m_Triangles[5*this.m_NumTriangles*3+0+2]=e.z,this.m_Triangles[5*this.m_NumTriangles*3+0+3]=e.u,this.m_Triangles[5*this.m_NumTriangles*3+0+4]=e.v,this.m_Triangles[5*this.m_NumTriangles*3+5+0]=t.x,this.m_Triangles[5*this.m_NumTriangles*3+5+1]=t.y,this.m_Triangles[5*this.m_NumTriangles*3+5+2]=t.z,this.m_Triangles[5*this.m_NumTriangles*3+5+3]=t.u,this.m_Triangles[5*this.m_NumTriangles*3+5+4]=t.v,this.m_Triangles[5*this.m_NumTriangles*3+10+0]=n.x,this.m_Triangles[5*this.m_NumTriangles*3+10+1]=n.y,this.m_Triangles[5*this.m_NumTriangles*3+10+2]=n.z,this.m_Triangles[5*this.m_NumTriangles*3+10+3]=n.u,this.m_Triangles[5*this.m_NumTriangles*3+10+4]=n.v,++this.m_NumTriangles)},e.prototype.Find3DPos=function(e){var t=e.u,n=this.m_TextureWidth,i=e.v,r=this.m_TextureHeight;t=t*n-this.m_FisheyeConfig.GetCenterX(),i=r=i*r-this.m_FisheyeConfig.GetCenterY(),this.m_InvertY&&(i=-r),r=t,this.m_InvertX&&(r=-t),n=this.m_FisheyeConfig.GetMaxRadius();var a=Math.sqrt(r*r+i*i);t=a,a>n&&(t=n),t=.017453293*this.m_FisheyeConfig.GetFOV(t)/2,i=Math.atan2(i,r),e.z=Math.cos(t),e.y=Math.sin(t)*Math.sin(i),e.x=Math.sin(t)*Math.cos(i)},e.prototype.GenerateMesh=function(e,t,n,i,r,a,o,s){this.m_InvertX=o,this.m_InvertY=s,this.m_FisheyeConfig=t,this.m_FisheyeWidth=n,this.m_FisheyeHeight=i,this.m_TextureWidth=r,this.m_TextureHeight=a;var l=3*e/4,c=this.m_FisheyeConfig.GetMaxRadius(),u=new m,d=new m,p=new m,h=new m;this.m_NumTriangles=0,r=2*(0|Math.ceil(c/e+.5));var f=this.m_FisheyeConfig.GetCenterX()-(r/2|0)*e;for(a=2*(0|Math.ceil(c/l)),c=this.m_FisheyeConfig.GetCenterY()-(a/2|0)*l,this.m_Triangles=new Array(30*r*a),n=0;n<a;++n)for(i=0;i<r;++i)u.v=n*l+c,d.v=n*l+c,p.v=(n+1)*l+c,h.v=(n+1)*l+c,n%2==0?(d.u=(i+1)*e+f,u.u=i*e+f,p.u=e/2+i*e+f,h.u=e/2+(i+1)*e+f,this.CreateTriangle(u,p,d),this.CreateTriangle(d,p,h)):(u.u=e/2+f+i*e,d.u=e/2+f+(i+1)*e,p.u=i*e+f,h.u=(i+1)*e+f,this.CreateTriangle(u,h,d),this.CreateTriangle(u,p,h))},e.prototype.GetTriangleCount=function(){return this.m_NumTriangles},e.prototype.GetTriangles=function(){return this.m_Triangles},e.prototype.Normalize=function(e){var t=!0;return e.u/=this.m_FisheyeWidth,e.v/=this.m_FisheyeHeight,e.u<0&&(e.u=0,t=!1),e.u>1&&(e.u=1,t=!1),e.v<0&&(e.v=0,t=!1),e.v>1&&(e.v=1,t=!1),e.u*=this.m_FisheyeWidth/this.m_TextureWidth,e.v*=this.m_FisheyeHeight/this.m_TextureHeight,t},e.DEGREETORAD=.017453293,e}(),g=function(){function e(e,t,n,i,r){this.m_CenterX=0,this.m_CenterY=0,this.m_CircleFOV=0,this.m_CircleRadius=0,this.m_FOVToRadius=0,this.m_MaxFOV=0,this.m_MaxRadius=0,this.m_RadiusToFOV=0,this.m_CircleFOV=i,this.m_CircleRadius=r,this.m_CenterX=e,this.m_CenterY=t,i=this.m_CircleFOV,this.m_MaxFOV=i>n?n:i,this.m_MaxRadius=this.m_CircleRadius,this.m_RadiusToFOV=this.m_MaxFOV/this.m_MaxRadius,this.m_FOVToRadius=this.m_MaxRadius/this.m_MaxFOV}return e.prototype.GetCenterX=function(){return this.m_CenterX},e.prototype.GetCenterY=function(){return this.m_CenterY},e.prototype.GetCircleFOV=function(){return this.m_CircleFOV},e.prototype.GetCircleRadius=function(){return this.m_CircleRadius},e.prototype.GetFOV=function(e){return e<=this.m_MaxRadius?this.m_RadiusToFOV*e:-1},e.prototype.GetHeight=function(){return 2*this.GetMaxRadius()},e.prototype.GetMaxFOV=function(){return this.m_MaxFOV},e.prototype.GetMaxRadius=function(){return this.m_MaxRadius},e.prototype.GetRadius=function(e){return e<=this.m_MaxFOV?this.m_FOVToRadius*e:-1},e.prototype.GetWidth=function(){return 2*this.GetMaxRadius()},e.DEFAULT_MAX_FOV=170,e.DEFAULT_MAX_RADIUS=823.12506,e}(),v=function(){function e(){this.mNumTriangles=0}return e.prototype.generateVertices=function(){var e=new g(1496,1496,170,170,1496),t=new f;t.GenerateMesh(124,e,2992,2992,2992,2992,!1,!0),this.mNumTriangles=t.GetTriangleCount();var n=t.GetTriangles(),i=3*this.mNumTriangles;this.position=new Float32Array(3*i),this.textureCoords=new Float32Array(2*i);for(var r=0;r<this.mNumTriangles;++r)this.textureCoords[6*r+0]=n[15*r+3],this.textureCoords[6*r+1]=n[15*r+4],this.position[9*r+0]=n[15*r],this.position[9*r+1]=n[15*r+1],this.position[9*r+2]=n[15*r+2],this.textureCoords[6*r+2]=n[15*r+10+3],this.textureCoords[6*r+3]=n[15*r+10+4],this.position[9*r+3]=n[15*r+10],this.position[9*r+4]=n[15*r+10+1],this.position[9*r+5]=n[15*r+10+2],this.textureCoords[6*r+4]=n[15*r+5+3],this.textureCoords[6*r+5]=n[15*r+5+4],this.position[9*r+6]=n[15*r+5],this.position[9*r+7]=n[15*r+5+1],this.position[9*r+8]=n[15*r+5+2]},e}();function y(){}return y.prototype={init:function(e,o){var s;a=o,(t=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,4400)).target=new THREE.Vector3(0,0,0),n=new THREE.Scene;var l=new v;l.generateVertices();var c=new THREE.Geometry;c.verticesNeedUpdate=!0,c.elementsNeedUpdate=!0,c.uvsNeedUpdate=!0;for(var u=0;u<l.mNumTriangles;u++)c.vertices.push(new THREE.Vector3(200*l.position[9*u+0],200*l.position[9*u+1],200*l.position[9*u+2]),new THREE.Vector3(200*l.position[9*u+3],200*l.position[9*u+4],200*l.position[9*u+5]),new THREE.Vector3(200*l.position[9*u+6],200*l.position[9*u+7],200*l.position[9*u+8])),c.faces.push(new THREE.Face3(3*u+0,3*u+1,3*u+2)),c.faceVertexUvs[0].push([new THREE.Vector2(l.textureCoords[6*u+0],l.textureCoords[6*u+1]),new THREE.Vector2(l.textureCoords[6*u+2],l.textureCoords[6*u+3]),new THREE.Vector2(l.textureCoords[6*u+4],l.textureCoords[6*u+5])]);var d,p=new THREE.BufferGeometry;p.fromGeometry(c),e instanceof HTMLVideoElement?(e.play(),e.setAttribute("webkit-playsinline","webkit-playsinline"),d=new THREE.VideoTexture(e),r=null):(d=new THREE.CanvasTexture(e),r=d),d.minFilter=THREE.LinearFilter,d.format=THREE.RGBFormat;var h=new THREE.MeshBasicMaterial({map:d});s=new THREE.Mesh(p,h),n.add(s),(i=new THREE.WebGLRenderer).setClearColor(15790320),i.setPixelRatio(window.devicePixelRatio),i.setSize(window.innerWidth,window.innerHeight),i.autoClear=!1,i.domElement.style.width="100%",i.domElement.style.height="100%",o.appendChild(i.domElement),i.domElement.addEventListener("mousedown",this.onDocumentMouseDown,!1),i.domElement.addEventListener("mousemove",this.onDocumentMouseMove,!1),i.domElement.addEventListener("mouseup",this.onDocumentMouseUp,!1),i.domElement.addEventListener("dblclick",this.onDocumentMouseDbClick,!1),i.domElement.addEventListener("mousewheel",this.onDocumentMouseWheel,!1),i.domElement.addEventListener("MozMousePixelScroll",this.onDocumentMouseWheel,!1),window.addEventListener("resize",this.onWindowResize,!1)},onWindowResize:function(){t.aspect=a.clientWidth/a.clientHeight,t.updateProjectionMatrix(),i.setSize(a.clientWidth,a.clientHeight)},onDocumentMouseDown:function(e){e.preventDefault(),o=!0,onPointerDownPointerX=e.clientX,onPointerDownPointerY=e.clientY,onPointerDownLon=s,onPointerDownLat=l},onDocumentMouseMove:function(e){!0===o&&(s=.1*(onPointerDownPointerX-e.clientX)+onPointerDownLon,l=!0===h?.1*(onPointerDownPointerY-e.clientY)+onPointerDownLat:.1*(e.clientY-onPointerDownPointerY)+onPointerDownLat)},onDocumentMouseUp:function(e){o=!1},onDocumentMouseDbClick:function(e){d=d>1e-10?1e-10:500},onDocumentMouseWheel:function(e){e.wheelDeltaY?d-=.5*e.wheelDeltaY:e.wheelDelta?d-=.5*e.wheelDelta:e.detail&&(d+=.5*e.detail),d<1e-10?(d=1e-10,p>1&&(p-=1)):p<75&&(d=1e-10,p+=1)},animate:function(){this.animateId=window.requestAnimationFrame(this.animate.bind(this)),this.update()},start:function(){this.animateId||this.animate()},stop:function(){this.animateId&&(window.cancelAnimationFrame(this.animateId),this.animateId=void 0),a.removeChild(i.domElement),window.removeEventListener("resize",this.onWindowResize,!1)},update:function(){r&&!0===livecanvas.updatedCanvas&&(livecanvas.updatedCanvas=!1,r.needsUpdate=!0),!0===h?t.up.set(0,1,0):t.up.set(0,0,-1);var e=0;d<500&&(e=!0===h?180*Math.atan(Math.tan(p*Math.PI/180/2)*t.aspect)/Math.PI:p/2+5,d>1e-10&&(e*=1-1*d/500)),!0===h?(l=Math.max(-75,Math.min(75,l)),c=THREE.Math.degToRad(l-90),s=e>90?0:Math.max(e-90,Math.min(90-e,s)),u=THREE.Math.degToRad(s+90),t.position.x=d*Math.sin(c)*Math.cos(u),t.position.y=d*Math.cos(c),t.position.z=d*Math.sin(c)*Math.sin(u)):(l=Math.max(0,Math.min(90-e,l)),c=THREE.Math.degToRad(l-180),u=THREE.Math.degToRad(s-90),t.position.x=d*Math.sin(c)*Math.cos(u),t.position.z=d*Math.cos(c),t.position.y=d*Math.sin(c)*Math.sin(u)),t.fov!=p&&(t.fov=p,t.updateProjectionMatrix()),t.lookAt(t.target),i.clear(),i.render(n,t)}},new y}function H264SPSParser(){var e=0,t=null,n=null;function i(){e=0,t=new UmpMap}function r(t,n){var i=e+n>>3;return n=e+n&7,t[i]>>7-(7&n)&1}function a(t,n){var i=0;if(1==n)i=r(t,0);else for(var a=0;a<n;a++)i=(i<<1)+r(t,a);return e+=n,i}function o(t,n){var i=0,a=0,o=0,s=n;if(t.length!==s)do{if(0===(a=r(t,s++))&&i++,t.length===s)break}while(0===a);if(0===i)return e+=1,0;o=1<<i;for(var l=i-1;l>=0;l--,s++)o|=(a=r(t,s))<<l;return e+=2*i+1,o-1}function s(e,t){var n=o(e,t);return 1&n?(n+1)/2:-n/2}function l(e){t.put("cpb_cnt_minus1",o(e,0)),t.put("bit_rate_scale",a(e,4)),t.put("cpb_size_scale",a(e,4));for(var n=t.get("cpb_cnt_minus1"),i=new Array(n),r=new Array(n),s=new Array(n),l=0;l<=n;l++)i[l]=o(e,0),r[l]=o(e,0),s[l]=a(e,1);t.put("bit_rate_value_minus1",i),t.put("cpb_size_value_minus1",r),t.put("cbr_flag",s),t.put("initial_cpb_removal_delay_length_minus1",a(e,5)),t.put("cpb_removal_delay_length_minus1",a(e,5)),t.put("dpb_output_delay_length_minus1",a(e,5)),t.put("time_offset_length",a(e,5))}return i.prototype={parse:function(i){var r,c;n=function(e){for(var t=[],n=e.byteLength,i=0;i<2&&i<n;)t.push(e[i++]);for(;i+2<n;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(t.push(e[i++]),t.push(e[i++]),i++):t.push(e[i++]);for(;i<n;)t.push(e[i++]);return new Uint8Array(t)}(i),e=0,t.clear(),t.put("forbidden_zero_bit",a(n,1)),t.put("nal_ref_idc",a(n,2)),t.put("nal_unit_type",a(n,5)),t.put("profile_idc",a(n,8)),t.put("profile_compatibility",a(n,8)),t.put("level_idc",a(n,8)),t.put("seq_parameter_set_id",o(n,0));var u=t.get("profile_idc");if(t.put("chroma_format_idc",0),100===u||110===u||122===u||244===u||44===u||83===u||86===u||118===u||128===u||138===u||139===u||134===u||135===u){t.put("chroma_format_idc",o(n,0)),3===t.get("chroma_format_idc")&&t.put("separate_colour_plane_flag",a(n,1));var d=0,p=t.get("chroma_format_idc");if(0===t.get("separate_colour_plane_flag")?d=p:1===t.get("separate_colour_plane_flag")&&(d=0),t.put("ChromaArrayType",d),t.put("bit_depth_luma_minus8",o(n,0)),t.put("bit_depth_chroma_minus8",o(n,0)),t.put("qpprime_y_zero_transform_bypass_flag",a(n,1)),t.put("seq_scaling_matrix_present_flag",a(n,1)),t.get("seq_scaling_matrix_present_flag")){var h=3!==t.get("chroma_format_idc")?8:12,m=new Array(h);for(r=0;r<h;r++)if(m[r]=a(n,1),m[r]){var f=r<6?16:64,g=8,v=8,y=new Array(f);for(c=0;c<f;c++)v&&(v=(g+s(n,0)+256)%256,0==c&&0==v),y[c]=0==v?g:v,g=y[c]}t.put("seq_scaling_list_present_flag",m)}}if(t.put("log2_max_frame_num_minus4",o(n,0)),t.put("pic_order_cnt_type",o(n,0)),0==t.get("pic_order_cnt_type"))t.put("log2_max_pic_order_cnt_lsb_minus4",o(n,0));else if(1==t.get("pic_order_cnt_type")){t.put("delta_pic_order_always_zero_flag",a(n,1)),t.put("offset_for_non_ref_pic",s(n,0)),t.put("offset_for_top_to_bottom_field",s(n,0)),t.put("num_ref_frames_in_pic_order_cnt_cycle",o(n,0));var b=[];for(r=0;r<t.get("num_ref_frames_in_pic_order_cnt_cycle");r++)b[r]=s(n,0)}return t.put("num_ref_frames",o(n,0)),t.put("gaps_in_frame_num_value_allowed_flag",a(n,1)),t.put("pic_width_in_mbs_minus1",o(n,0)),t.put("pic_height_in_map_units_minus1",o(n,0)),t.put("frame_mbs_only_flag",a(n,1)),0==t.get("frame_mbs_only_flag")&&t.put("mb_adaptive_frame_field_flag",a(n,1)),t.put("direct_8x8_interence_flag",a(n,1)),t.put("frame_cropping_flag",a(n,1)),1==t.get("frame_cropping_flag")&&(t.put("frame_cropping_rect_left_offset",o(n,0)),t.put("frame_cropping_rect_right_offset",o(n,0)),t.put("frame_cropping_rect_top_offset",o(n,0)),t.put("frame_cropping_rect_bottom_offset",o(n,0))),t.put("vui_parameters_present_flag",a(n,1)),t.get("vui_parameters_present_flag")&&function(e){t.put("aspect_ratio_info_present_flag",a(e,1)),t.get("aspect_ratio_info_present_flag")&&(t.put("aspect_ratio_idc",a(e,8)),255==t.get("aspect_ratio_idc")&&(t.put("sar_width",a(e,16)),t.put("sar_height",a(e,16)))),t.put("overscan_info_present_flag",a(e,1)),t.get("overscan_info_present_flag")&&t.put("overscan_appropriate_flag",a(e,1)),t.put("video_signal_type_present_flag",a(e,1)),t.get("video_signal_type_present_flag")&&(t.put("video_format",a(e,3)),t.put("video_full_range_flag",a(e,1)),t.put("colour_description_present_flag",a(e,1)),t.get("colour_description_present_flag")&&(t.put("colour_primaries",a(e,8)),t.put("transfer_characteristics",a(e,8)),t.put("matrix_coefficients",a(e,8)))),t.put("chroma_loc_info_present_flag",a(e,1)),t.get("chroma_loc_info_present_flag")&&(t.put("chroma_sample_loc_type_top_field",o(e,0)),t.put("chroma_sample_loc_type_bottom_field",o(e,0))),t.put("timing_info_present_flag",a(e,1)),t.get("timing_info_present_flag")&&(t.put("num_units_in_tick",a(e,32)),t.put("time_scale",a(e,32)),t.put("fixed_frame_rate_flag",a(e,1))),t.put("nal_hrd_parameters_present_flag",a(e,1)),t.get("nal_hrd_parameters_present_flag")&&l(e),t.put("vcl_hrd_parameters_present_flag",a(e,1)),t.get("vcl_hrd_parameters_present_flag")&&l(e),(t.get("nal_hrd_parameters_present_flag")||t.get("vcl_hrd_parameters_present_flag"))&&t.put("low_delay_hrd_flag",a(e,1)),t.put("pic_struct_present_flag",a(e,1)),t.put("bitstream_restriction_flag",a(e,1)),t.get("bitstream_restriction_flag")&&(t.put("motion_vectors_over_pic_boundaries_flag",a(e,1)),t.put("max_bytes_per_pic_denom",o(e,0)),t.put("max_bits_per_mb_denom",o(e,0)),t.put("log2_max_mv_length_horizontal",o(e,0)),t.put("log2_max_mv_length_vertical",o(e,0)),t.put("max_num_reorder_frames",o(e,0)),t.put("max_dec_frame_buffering",o(e,0)))}(n),!0},getSizeInfo:function(){var e=2,n=2;0===t.get("chroma_format_idc")&&0===t.get("separate_colour_plane_flag")?e=n=0:1===t.get("chroma_format_idc")&&0===t.get("separate_colour_plane_flag")?e=n=2:2===t.get("chroma_format_idc")&&0===t.get("separate_colour_plane_flag")?(e=2,n=1):3===t.get("chroma_format_idc")&&(0===t.get("separate_colour_plane_flag")?e=n=1:1===t.get("separate_colour_plane_flag")&&(e=n=0));var i=0,r=0,a=0,o=0;1===t.get("frame_cropping_flag")&&(i=t.get("frame_cropping_rect_left_offset"),r=t.get("frame_cropping_rect_right_offset"),a=t.get("frame_cropping_rect_top_offset"),o=t.get("frame_cropping_rect_bottom_offset"));var s=t.get("pic_width_in_mbs_minus1")+1,l=t.get("pic_height_in_map_units_minus1")+1,c=(2-t.get("frame_mbs_only_flag"))*l;0===t.get("ChromaArrayType")&&(1,t.get("frame_mbs_only_flag"));var u=16*s,d=16*c,p=e*(i+r),h=n*(2-t.get("frame_mbs_only_flag"))*(a+o);return p&&(u-=p),h&&(d-=h),{width:u,height:d,decodeSize:u*d,cropWidth:p,cropHeight:h}},getSpsValue:function(e){return t.get(e)},getCodecInfo:function(){var e=t.get("profile_idc"),n=t.get("profile_compatibility"),i=t.get("level_idc");return void 0===e||void 0===n||void 0===i?null:"avc1."+(e=(e<=15?"0":"")+e.toString(16))+(n=(n<=15?"0":"")+n.toString(16))+(i=(i<=15?"0":"")+i.toString(16))}},new i}function H265SPSParser(){var e=0,t=null,n=null;function i(){e=0,t=new UmpMap}function r(t,n){var i=e+n>>3;return n=e+n&7,t[i]>>7-(7&n)&1}function a(t,n){var i=0;if(1==n)i=r(t,0);else for(var a=0;a<n;a++)i=(i<<1)+r(t,a);return e+=n,i}function o(t,n){var i=0,a=0,o=0,s=n;do{0===(a=r(t,s++))&&i++}while(0==a);if(0==i)return e+=1,0;o=1<<i;for(var l=i-1;l>=0;l--,s++)o|=(a=r(t,s))<<l;return e+=2*i+1,o-1}return i.prototype={parse:function(i){return n=function(e){for(var t=[],n=e.byteLength,i=0;i<2&&i<n;)t.push(e[i++]);for(;i+2<n;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(t.push(e[i++]),t.push(e[i++]),i++):t.push(e[i++]);for(;i<n;)t.push(e[i++]);return new Uint8Array(t)}(i),e=0,t.clear(),t.put("forbidden_zero_bit",a(n,1)),t.put("nal_unit_type",a(n,6)),t.put("nuh_layer_id",a(n,6)),t.put("nuh_temporal_id_plus1",a(n,3)),t.put("sps_video_parameter_set_id",a(n,4)),t.put("sps_max_sub_layers_minus1",a(n,3)),t.put("sps_temporal_id_nesting_flag",a(n,1)),t.put("general_profile_space",a(n,2)),t.put("general_tier_flag",a(n,1)),t.put("general_profile_idc",a(n,5)),t.put("general_profile_compatibility_flags",a(n,32)),t.put("general_constraint_indicator_flags",[a(n,16),a(n,16),a(n,16)]),t.put("general_level_idc",a(n,8)),t.put("sps_seq_parameter_set_id",o(n,0)),t.put("chroma_format_idc",o(n,0)),3===t.get("chroma_format_idc")&&t.put("separate_colour_plane_flag",a(n,1)),t.put("pic_width_in_luma_samples",o(n,0)),t.put("pic_height_in_luma_samples",o(n,0)),t.put("conformance_window_flag",a(n,1)),1===t.get("conformance_window_flag")&&(t.put("conf_win_left_offset",o(n,0)),t.put("conf_win_right_offset",o(n,0)),t.put("conf_win_top_offset",o(n,0)),t.put("conf_win_bottom_offset",o(n,0))),!0},getSizeInfo:function(){var e=t.get("pic_width_in_luma_samples"),n=t.get("pic_height_in_luma_samples"),i=2,r=2;0===t.get("chroma_format_idc")?i=r=1:1===t.get("chroma_format_idc")?(i=2,r=2):2===t.get("chroma_format_idc")?(i=2,r=1):3===t.get("chroma_format_idc")&&(0===t.get("separate_colour_plane_flag")?i=r=1:1===t.get("separate_colour_plane_flag")&&(i=r=1));var a=0,o=0;return 1===t.get("conformance_window_flag")&&(a=i*t.get("conf_win_right_offset")+i*t.get("conf_win_left_offset"),o=r*t.get("conf_win_bottom_offset")+r*t.get("conf_win_top_offset")),a&&(e-=a),o&&(n-=o),{width:e,height:n,decodeSize:e*n,cropWidth:a,cropHeight:o}},getSpsValue:function(e){return t.get(e)},getProfileName:function(){switch(t.get("general_profile_idc")){case 1:return"Main";case 2:return"Main 10";case 3:return"Main Still Picture";case 4:return"Rext";default:return"Unknown"}},getCodecInfo:function(){var e=t.get("general_profile_space");e=e>0&&e<=3?"A"+(e-1):"";for(var n=t.get("general_profile_idc"),i=t.get("general_constraint_indicator_flags")[0];i&&0==(255&i);)i>>=8;return"hvc1."+e+n+"."+function(e,t){for(var n=e.toString(2).split("").reverse().join("");n.length<t;)n+="0";return parseInt(n,2)}(t.get("general_profile_compatibility_flags"),32)+"."+(t.get("general_tier_flag")?"H":"L")+t.get("general_level_idc")+"."+i.toString(16)},getProfileTierLevel:function(){var e=t.get("general_profile_compatibility_flags"),n=t.get("general_constraint_indicator_flags");return[t.get("general_profile_space")<<6|t.get("general_tier_flag")<<5|t.get("general_profile_idc"),(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,(65280&n[0])>>8,255&n[0],(65280&n[1])>>8,255&n[1],(65280&n[2])>>8,255&n[2],t.get("general_level_idc")]}},new i}function UmpMap(){this.map=new Object}function MetaDataParser(e){var t,n=log4javascript.getLogger("meta:parser"),i=null,r=null,a=null,o=0;function s(){i=e,t=this}var l=function(e,n){var r=[],a=e.childNodes,o={PTZStatus:!0},s={MoveStatus:!0},l={PanTilt:!0,Zoom:!0};Array.prototype.forEach.call(a,function(e){!0===o[e.localName]&&Array.prototype.forEach.call(e.childNodes,function(e){var n=e.localName;!0===s[n]&&Array.prototype.forEach.call(e.childNodes,function(e){var i=e.localName;!0===l[i]&&r.push({type:n+":"+i,value:e.textContent,channelId:t.getChannel()})})})}),r.forEach(function(e){i(e)}),void 0!==n&&n.concat(r)},c=function(e,n){for(var i=e.childNodes,r={},a=null,o=null,s=null,l=null,c=null,d=null,p=0;p<i.length;p++){o=(a=i[p].childNodes)[0],s=a[1].childNodes[0].childNodes,l=u(o.childNodes[0].nodeValue);for(var h=0;h<s.length;h++){if("tt:Source"===s[h].nodeName)if(void 0!==s[h].childNodes[0])d=s[h].childNodes[0].getAttribute("Value").split("-")[1];else void 0!==s[h].childNodes[1]&&(d=s[h].childNodes[1].getAttribute("Value"));else if("tt:Data"===s[h].nodeName)if("SoundClassification"===l)d=s[h].childNodes[2].getAttribute("Value"),c=s[h].childNodes[0].getAttribute("Value");else if("BoxTemperatureReading"===l){var m=s[h].childNodes[0].childNodes[0].getAttribute("MaxTemperature"),f=s[h].childNodes[0].childNodes[0].getAttribute("MinTemperature"),g=s[h].childNodes[0].childNodes[0].getAttribute("AverageTemperature");d=s[h].childNodes[0].childNodes[0].getAttribute("ItemID"),c={maxTemperature:m,minTemperature:f,averageTemperature:g}}else c=s[h].childNodes[0].getAttribute("Value")}"BoxTemperatureReading"!==l&&null!==c&&void 0!==c&&(c="inactive"===c||"false"===c?"false":"true"),r={id:1,type:l,value:c,eventId:d,channelId:t.getChannel()},n.push(r)}},u=function(e){var t="";switch(e){case"tns1:Device/tns1:Trigger/tns1:DigitalInput":case"tns1:Device/tns1:Trigger/tnssamsung:DigitalInput":t="DigitalInput";break;case"tns1:VideoSource/tnssamsung:FaceDetection":t="FaceDetection";break;case"tns1:VideoSource/ImageTooBlurry/ImagingService":case"tns1:VideoSource/tnssamsung:DefocusDetection":t="DefocusDetection";break;case"tns1:VideoSource/ImageTooBright/ImagingService":case"tns1:VideoSource/tnssamsung:Fog":t="Fog";break;case"tns1:RuleEngine/MotionRegionDetector/Motion":case"tns1:VideoAnalytics/tnssamsung:MotionDetection":case"tns1:VideoAnalytics/tns1:MotionDetection":t="MotionDetection";break;case"tns1:VideoAnalytics/tnssamsung:VideoAnalytics":t="VideoAnalytics";break;case"tns1:VideoSource/GlobalSceneChange/ImagingService":case"tns1:VideoSource/tnssamsung:TamperingDetection":t="TamperingDetection";break;case"tns1:AudioSource/tnssamsung:AudioDetection":t="AudioDetection";break;case"tns1:Device/tns1:Trigger/tns1:Relay":t="Relay";break;case"tns1:VideoSource/tnssamsung:DigitalAutoTracking":t="DigitalAutoTracking";break;case"tns1:AudioAnalytics/Audio/DetectedSound":t="SoundClassification";break;case"tns1:VideoSource/tnssamsung:QueueManagement":t="Queue";break;case"tns1:VideoSource/tnssamsung:AutoTracking":t="AutoTracking";break;case"tns1:VideoSource/tnssamsung:ShockDetection":t="ShockDetection";break;case"tns1:VideoSource/tnssamsung:TrackingEnable":t="TrackingEnable";break;case"tns1:Device/tns1:AlarmOut":t="AlarmOut";break;case"tns1:RuleEngine/Radiometry/TemperatureAlarm":t="TemperatureChangeDetection";break;case"tns1:VideoAnalytics/Radiometry/BoxTemperatureReading":t="BoxTemperatureReading";break;case"tns1:VideoSource/RadiometryAlarm":t="RadiometryAlarm";break;default:t="Unknown Event"}return t},d=function(e,i){var r=e.childNodes,a=r[0].getAttribute("UtcTime"),s=r[0].childNodes,l=s[0],c=s.length;n.debug("metaParser utcTime "+a),"tt:Extension"===s[c-1].nodeName&&"tnssamsung:DigitalAutoTracking"===s[c-1].childNodes[0].nodeName&&(c-=2);for(var u=l.childNodes[0],d=[parseFloat(u.getAttribute("x")),parseFloat(u.getAttribute("y"))],h=l.childNodes[1],m=[parseFloat(h.getAttribute("x")),parseFloat(h.getAttribute("y"))],f=null,g=1;g<c;g++){var v=s[g],y=v.getAttribute("ObjectId");if(0!==v.attributes.length){var b=v.childNodes[0],w=b.childNodes[0],C=b.childNodes[1],S=b.childNodes[2],_=b.childNodes[3],T=w.childNodes[0],x=[parseFloat(T.getAttribute("left")),parseFloat(T.getAttribute("right")),parseFloat(T.getAttribute("top")),parseFloat(T.getAttribute("bottom"))],E=w.childNodes[1],I=[parseFloat(E.getAttribute("x")),parseFloat(E.getAttribute("y"))],k="",A="";if(void 0===C)k="VideoAnalytics";else{if(!C||"tt:Class"!==C.nodeName)return;k=C.childNodes[0].childNodes[0].textContent,A=parseFloat(C.childNodes[0].childNodes[1].textContent),k="Face"===k?"FaceDetection":k}if("VideoAnalytics"===k){var R=1;2===o&&(R=0),f={id:2,scale:m,translate:d,coordinates:x,type:k,color:R,channelId:t.getChannel()}}else f="FaceDetection"===k?{id:2,scale:m,translate:d,coordinates:x,type:k,color:0,channelId:t.getChannel()}:{id:y,scale:m,translate:d,coordinates:x,COGCoordinates:I,type:k,likelihood:A,color:1,utcTime:a,infodata:S?p(k,S):null,image:_?_.childNodes[0].textContent:null,channelId:t.getChannel()};i.push(f)}}},p=function(e,t){switch(e){case"Human":return{Gender:t.childNodes[0].textContent,Age:t.childNodes[1].textContent,Upper:{color:t.childNodes[2].getAttribute("color"),type:t.childNodes[2].getAttribute("type")},Lower:{color:t.childNodes[3].getAttribute("color"),type:t.childNodes[3].getAttribute("type")},Hat:t.childNodes[4].textContent,Bag:t.childNodes[5].textContent};case"Face":return{Gender:t.childNodes[0].textContent,Age:t.childNodes[1].textContent,Hat:t.childNodes[2].textContent,Glasses:t.childNodes[3].textContent};case"Vehicle":return{Type:t.childNodes[0].textContent,Color:t.childNodes[1].textContent}}};return s.prototype={setChannel:function(e){n.debug("metaParser::setChannel",e),s.prototype.channelId=null===e?0:e},getChannel:function(){return n.debug("metaParser::getChannel ",s.prototype.channelId),s.prototype.channelId},parse:function(e){var t=null,s=null;try{var u=String.fromCharCode.apply(null,e);if(-1!==u.indexOf("<?xml"))if(window.jQuery)n.debug("metaParser parsing with jquery on normal"),t=(s=$.parseXML(u)).documentElement.childNodes;else{if(!window.DOMParser)throw n.debug("error",error),new umpError({channelId:this.getChannel(),errorCode:fromHex("0x0907"),place:"metaDataParser.js:432",message:"Your web browser is not support DOM Parser, So you have to use the Jquery library"});n.debug("metaParser parsing without jquery on normal"),t=(s=(new DOMParser).parseFromString(u,"text/xml")).childNodes[0].childNodes,a=u,r=JSON.stringify(function e(t){var n={};if(1==t.nodeType){if(t.attributes.length>0){n["@attributes"]={};for(var i=0;i<t.attributes.length;i++){var r=t.attributes.item(i);n["@attributes"][r.nodeName]=r.nodeValue}}}else 3==t.nodeType&&(n=t.nodeValue);if(t.hasChildNodes()&&1===t.childNodes.length&&3===t.childNodes[0].nodeType)n=t.childNodes[0].nodeValue;else if(t.hasChildNodes())for(var a=0;a<t.childNodes.length;a++){var o=t.childNodes.item(a),s=o.nodeName;if(void 0===n[s])n[s]=e(o);else{if(void 0===n[s].push){var l=n[s];n[s]=[],n[s].push(l)}n[s].push(e(o))}}return n}(s))}s=null}catch(e){throw n.debug("error",e),new umpError({channelId:this.getChannel(),errorCode:fromHex("0x0907"),place:"metaDataParser.js:443",message:"Metadata Parsing Error  ["+e.message+"]"})}if(null!==t)try{!function(e){var t=[];o=e.length;for(var n=0;n<e.length;n++)"tt:Event"===e[n].nodeName?c(e[n],t):"tt:VideoAnalytics"===e[n].nodeName?d(e[n],t):"tt:PTZ"===e[n].nodeName&&l(e[n]);t.json=r,t.xml=a,i(t,!0)}(t)}catch(e){throw n.debug("error",e),new umpError({channelId:this.getChannel(),errorCode:fromHex("0x0907"),place:"metaDataParser.js:458",message:"Metadata Parsing Error  ["+e.message+"]"})}}},new s}function initSegment(e){var t,n=ftyp(),i=moov(e);return(t=new Uint8Array(n.byteLength+i.byteLength)).set(n),t.set(i,n.byteLength),t}function mediaSegment(e,t,n,i){var r,a=moof(e,t),o=mdat(n);return(r=new Uint8Array(a.byteLength+o.byteLength)).set(a),r.set(o,a.byteLength),r}function Queue(e){log4javascript.getLogger();var t=Math.pow(2,53)-1,n=(e=e||t,[]),i=0;function r(){}return r.prototype={getLength:function(){return n.length-i},isEmpty:function(){return 0==n.length},isFull:function(){return n.length-i>=e},enqueue:function(e){if(this.isFull())throw new Error("Queue is full can't add new records");n.push(e)},dequeue:function(){if(this.isEmpty())throw new Error("Can't remove element from an empty Queue");var e=n[i];return 2*++i>=n.length&&(n=n.slice(i),i=0),e},peek:function(){return n.length>0?n[i]:void 0},print:function(){console.log("Queue Length: "+(n.length-i)+"\r\n");for(var e=i;e<n.length;e++)console.log(n[e])}},new r(e)}function error(e){console.error(e),console.trace()}function assert(e,t){e||error(t)}function isPowerOfTwo(e){return 0==(e&e-1)}function text(e){return e.join("\n")}function getElementByAttributeValue(e,t,n){e=e||"*";for(var i=document.getElementsByTagName(e),r=0;r<i.length;r++)if(void 0!==n&&i[r].getAttribute(t)==n)return i[r]}function nextHighestPowerOfTwo(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1}function toHex(e){return"0x"+(e+65536).toString(16).substr(-4).toUpperCase()}function fromHex(e){return parseInt(e,16)}function epochToJsDate(e){return new Date(1e3*e)}function jsDateToEpoch(e){return(e.getTime()-e.getMilliseconds())/1e3}function Size(e,t,n,i){function r(e,t,n,i){void 0!==n&&(r.prototype.viewWidth=n),void 0!==i&&(r.prototype.viewHeight=i),r.prototype.w=e,r.prototype.h=t}return r.prototype={toString:function(){return"("+r.prototype.w+", "+r.prototype.h+")"},getHalfSize:function(){return new Size(r.prototype.w>>>1,r.prototype.h>>>1)},length:function(){return r.prototype.w*r.prototype.h}},new r(e,t,n,i)}function inherit(e,t){for(var n=Object.create(e.prototype),i=Object.keys(t),r=0;r<i.length;r++)n[i[r]]=t[i[r]];return n}function inheritObject(e,t){for(var n=Object.keys(t),i=0;i<n.length;i++)e[n[i]]=t[n[i]];return e}function isApp(){var e=!1;return-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")&&(e=!0),e}function BrowserDetect(){var e,t=navigator.userAgent.toLowerCase(),n=navigator.appName;return"Microsoft Internet Explorer"===n||t.indexOf("trident")>-1||t.indexOf("edge/")>-1?(e="ie","Microsoft Internet Explorer"===n?(t=/msie ([0-9]{1,}[\.0-9]{0,})/.exec(t),e+=parseInt(t[1])):t.indexOf("trident")>-1?e+=11:t.indexOf("edge/")>-1&&(e="edge")):t.indexOf("safari")>-1?e=t.indexOf("chrome")>-1?"chrome":"safari":t.indexOf("firefox")>-1&&(e="firefox"),e}function doCapture(e,t){document.createElement("a");for(var n=atob(e.substring("data:image/png;base64,".length)),i=new Uint8Array(n.length),r=0,a=n.length;r<a;++r)i[r]=n.charCodeAt(r);var o=new Blob([i.buffer],{type:"image/png"});saveAs(o,t+".png")}UmpMap.prototype={put:function(e,t){this.map[e]=t},get:function(e){return this.map[e]},containsKey:function(e){return e in this.map},containsValue:function(e){for(var t in this.map)if(this.map[t]==e)return!0;return!1},isEmpty:function(e){return 0==this.size()},clear:function(){for(var e in this.map)delete this.map[e]},remove:function(e){delete this.map[e]},keys:function(){var e=new Array;for(var t in this.map)e.push(t);return e},values:function(){var e=new Array;for(var t in this.map)e.push(this.map[t]);return e},size:function(){var e=0;for(var t in this.map)e++;return e}},function(){var e;if(types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],iods:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],trep:[],mehd:[],tkhd:[],vmhd:[],udta:[],meta:[],ilst:[],free:[],sidx:[]},"undefined"!=typeof Uint8Array){for(e in types)types.hasOwnProperty(e)&&(types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);MAJOR_BRAND=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),AVC1_BRAND=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),ISO5_BRAND=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"5".charCodeAt(0)]),DASH_BRAND=new Uint8Array(["d".charCodeAt(0),"a".charCodeAt(0),"s".charCodeAt(0),"h".charCodeAt(0)]),MINOR_VERSION=new Uint8Array([0,0,0,1]),VIDEO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,85,87,65,95,54,48,48,112,95,51,48,102,112,115,46,104,50,54,52,0]),AUDIO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),HDLR_TYPES={video:VIDEO_HDLR,audio:AUDIO_HDLR},DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),STCO=new Uint8Array([0,0,0,0,0,0,0,0]),STSC=STCO,STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),STTS=STCO,VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),box=function(e){var t,n,i=[],r=0;for(t=1;t<arguments.length;t++)i.push(arguments[t]);for(t=i.length;t--;)r+=i[t].byteLength;for(n=new Uint8Array(r+8),new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,n.byteLength),n.set(e,4),t=0,r=8;t<i.length;t++)n.set(i[t],r),r+=i[t].byteLength;return n},dinf=function(){return box(types.dinf,box(types.dref,DREF))},esds=function(e){return box(types.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},ftyp=function(){return box(types.ftyp,MAJOR_BRAND,MINOR_VERSION,AVC1_BRAND,ISO5_BRAND,DASH_BRAND)},hdlr=function(e){if(void 0===e){var t=new Uint8Array([0,0,0,0,0,0,0,0,109,100,105,114,0,0,0,0,0,0,0,0,0,0,0,0,0]);return box(types.hdlr,t)}return box(types.hdlr,HDLR_TYPES[e])},mdat=function(e){return box(types.mdat,e)},mdhd=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,0,39,16,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=255&e.samplerate),box(types.mdhd,t)},mdia=function(e){return box(types.mdia,mdhd(e),hdlr(e.type),minf(e))},mfhd=function(e){return box(types.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},minf=function(e){return box(types.minf,"video"===e.type?box(types.vmhd,VMHD):box(types.smhd,SMHD),dinf(),stbl(e))},moof=function(e,t){for(var n=[],i=t.length;i--;)n[i]=traf(t[i]);return box.apply(null,[types.moof,mfhd(e)].concat(n))},moov=function(e){for(var t=e.length,n=[];t--;)n[t]=trak(e[t]);return box.apply(null,[types.moov,mvhd(0)].concat(mvex(e)).concat(n))},mvex=function(e,t){for(var n=e.length,i=[];n--;)i[n]=trex(e[n],1e3/e[0].fps);return box.apply(null,[types.mvex].concat(i))},udta=function(){return box(types.udta,meta())},meta=function(){var e=new Uint8Array([0,0,0,0]);return box(types.meta,e,hdlr(),ilst())},styp=function(){var e=new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]);return box(types.styp,e)},sidx=function(e,t){var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,39,16,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,0,0,0,0,0,0,1,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,0,39,16,144,0,0,0]);return box(types.sidx,n)},free=function(){var e=new Uint8Array([73,115,111,77,101,100,105,97,32,70,105,108,101,32,80,114,111,100,117,99,101,100,32,119,105,116,104,32,71,80,65,67,32,48,46,54,46,50,45,68,69,86,45,114,101,118,54,50,55,45,103,56,97,57,102,57,56,51,45,109,97,115,116,101,114,0]);return box(types.free,e)},ilst=function(){var e=new Uint8Array([0,0,0,82,169,116,111,111,0,0,0,74,100,97,116,97,0,0,0,1,0,0,0,0,77,121,32,77,80,52,66,111,120,32,71,85,73,32,48,46,54,46,48,46,54,32,60,104,116,116,112,58,47,47,109,121,45,109,112,52,98,111,120,45,103,117,105,46,122,121,109,105,99,104,111,115,116,46,99,111,109,62]);return box(types.ilst,e)},mehd=function(){var e=new Uint8Array([0,0,0,0,0,0,44,16]);return box(types.mehd,e)},trep=function(){var e=new Uint8Array([0,0,0,0,0,0,0,0]);return box(types.trep,e)},mvhd=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,0,39,16,255,255,255,255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2]);return box(types.mvhd,t)},iods=function(){var e=new Uint8Array([0,0,0,0,16,7,0,79,255,255,255,21,255]);return box(types.iods,e)},sdtp=function(e){var t,n,i=e.samples||[],r=new Uint8Array(4+i.length);for(n=0;n<i.length;n++)t=i[n].flags,r[n+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return box(types.sdtp,r)},stbl=function(e){return box(types.stbl,stsd(e),box(types.stts,STTS),box(types.stsc,STSC),box(types.stsz,STSZ),box(types.stco,STCO))},function(){var e,t;stsd=function(n){return box(types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===n.type?e(n):t(n))},e=function(e){var t,n=e.vps||[],i=e.sps||[],r=e.pps||[],a=[],o=[],s=[];for(t=0;t<n.length;t++)a.push((65280&n[t].byteLength)>>>8),a.push(255&n[t].byteLength),a=a.concat(Array.prototype.slice.call(n[t]));for(t=0;t<i.length;t++)o.push((65280&i[t].byteLength)>>>8),o.push(255&i[t].byteLength),o=o.concat(Array.prototype.slice.call(i[t]));for(t=0;t<r.length;t++)s.push((65280&r[t].byteLength)>>>8),s.push(255&r[t].byteLength),s=s.concat(Array.prototype.slice.call(r[t]));return"H264"===e.codecType?box(types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),box(types.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([i.length]).concat(o).concat([r.length]).concat(s)))):box(types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),box(types.hvcC,new Uint8Array([1].concat(e.profileTierLevel).concat([240,0,252,253,248,248,0,0,15]).concat([n.length+i.length+r.length]).concat([160,0,n.length]).concat(a).concat([161,0,i.length]).concat(o).concat([162,0,r.length]).concat(s))))},t=function(e){return box(types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),esds(e))}}(),tkhd=function(e){var t=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return box(types.tkhd,t)},traf=function(e){var t,n,i;return t=box(types.tfhd,new Uint8Array([0,2,0,0,0,0,0,1])),n=box(types.tfdt,new Uint8Array([0,0,0,0,e.baseMediaDecodeTime>>>24&255,e.baseMediaDecodeTime>>>16&255,e.baseMediaDecodeTime>>>8&255,255&e.baseMediaDecodeTime])),72,i=trun(e,72),box(types.traf,t,n,i)},trak=function(e){return e.duration=e.duration||0,box(types.trak,tkhd(e),mdia(e))},trex=function(e,t){var n=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,0,0,0,0,1,0,0]);return"video"!==e.type&&(n[n.length-1]=0),box(types.trex,n)},function(){var e,t,n,i;n=function(e,t){return[0,0,2,5,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t,0,0,0,0]},i=function(e,t){return[0,0,3,5,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t,0,0,0,0]},t=function(e,t){var r,a,o,s;if(null==(a=e.samples||[])[0].frameDuration)for(t+=24+4*a.length,r=n(a,t),s=0;s<a.length;s++)o=a[s],r=r.concat([(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size]);else for(t+=24+4*a.length+4*a.length,r=i(a,t),s=0;s<a.length;s++)o=a[s],r=r.concat([(4278190080&o.frameDuration)>>>24,(16711680&o.frameDuration)>>>16,(65280&o.frameDuration)>>>8,255&o.frameDuration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size]);return box(types.trun,new Uint8Array(r))},e=function(e,t){var i,r,a,o;for(t+=20+8*(r=e.samples||[]).length,i=n(r,t),o=0;o<r.length;o++)a=r[o],i=i.concat([(4278190080&a.duration)>>>24,(16711680&a.duration)>>>16,(65280&a.duration)>>>8,255&a.duration,(4278190080&a.size)>>>24,(16711680&a.size)>>>16,(65280&a.size)>>>8,255&a.size]);return box(types.trun,new Uint8Array(i))},trun=function(n,i){return"audio"===n.type?e(n,i):t(n,i)}}(),Object.defineProperty(Object.prototype,"Enum",{value:function(){for(i in arguments)Object.defineProperty(this,arguments[i],{value:parseInt(i),writable:!1,enumerable:!0,configurable:!0})},toString:function(){return this.value().name.toString()},writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(Date.prototype,"YYYYMMDDHHMMSS",{value:function(){function e(e){return(e<10?"0":"")+e}return this.getFullYear()+e(this.getMonth()+1)+e(this.getDate())+e(this.getHours())+e(this.getMinutes())+e(this.getSeconds())}}),Object.defineProperty(Date.prototype,"YYYYMMDDTHHMMSSZ",{value:function(){function e(e){return(e<10?"0":"")+e}return this.getFullYear()+e(this.getMonth()+1)+e(this.getDate())+"T"+e(this.getHours())+e(this.getMinutes())+e(this.getSeconds())+"Z"}}),Object.defineProperty(Date.prototype,"format",{value:function(e){if(String.prototype.string=function(e){for(var t="",n=0;n++<e;)t+=this;return t},String.prototype.zf=function(e){return"0".string(e-this.length)+this},Number.prototype.zf=function(e){return this.toString().zf(e)},!this.valueOf())return" ";var t=["Sun.","Mon","Tue.","Wed.","Thu.","Fri.","Sat."],n=this;return e.replace(/(yyyy|yy|MM|dd|E|hh|mm|ss|sss|a\/p)/gi,function(e){switch(e){case"yyyy":return n.getFullYear();case"yy":return(n.getFullYear()%1e3).zf(2);case"MM":return(n.getMonth()+1).zf(2);case"dd":return n.getDate().zf(2);case"E":return t[n.getDay()];case"HH":return n.getHours().zf(2);case"hh":return((h=n.getHours()%12)?h:12).zf(2);case"mm":return n.getMinutes().zf(2);case"sss":return(n.getMilliseconds()%1e3).zf(3);case"ss":return n.getSeconds().zf(2);case"a/p":return n.getHours()<12?"AM":"PM";default:return e}})}});var base64ArrayBuffer=function(e){for(var t="",n=e.byteLength,i=0;i<n;i++)t+=String.fromCharCode(e[i]);return btoa(t)};function cloneArray(e){var t=e.BYTES_PER_ELEMENT,n=e.byteOffset,i=e.length;return new e.constructor(e.buffer.slice(n,n+t*i))}function BufferQueue(){this.first=null,this.size=0}function BufferNode(e){this.buffer=e,this.previous=null,this.next=null}function BufferList(){this._length=0,this.head=null,this.tail=null,this.curIdx=0}BufferQueue.prototype.enqueue=function(e){var t=new BufferNode(e);if(null==this.first)this.first=t;else{for(var n=this.first;null!=n.next;)n=n.next;n.next=t}return this.size+=1,t},BufferQueue.prototype.dequeue=function(){var e=null;return null!=this.first&&(e=this.first,this.first=this.first.next,this.size-=1),e},BufferQueue.prototype.clear=function(){console.log("BufferQueue clear!");for(var e=null;null!=this.first;)e=this.first,this.first=this.first.next,this.size-=1,e.buffer=null,e=null;this.size=0,this.first=null},BufferList.prototype.getCurIdx=function(){return this.curIdx},BufferList.prototype.push=function(e){var t=new BufferNode(e);return this._length>0?(this.tail.next=t,t.previous=this.tail,this.tail=t):(this.head=t,this.tail=t),this._length+=1,t},BufferList.prototype.pop=function(){var e=null;return this._length>1&&(e=this.head,this.head=this.head.next,null!=this.head?this.head.previous=null:this.tail=null,this._length-=1),e},BufferList.prototype.pushPop=function(e){var t=null;return null!=e?(t=new BufferNode(e),this._length>0?(this.tail.next=t,t.previous=this.tail,this.tail=t):(this.head=t,this.tail=t),this._length+=1):this._length>1&&(t=this.head,this.head=this.head.next,null!=this.head?this.head.previous=null:this.tail=null,this._length-=1),t},BufferList.prototype.searchNodeAt=function(e){var t=this.head,n=this._length,i=1;if(0===n||e<1||e>n)throw new Error("Failure: non-existent node in this list.");for(;i<e;)t=t.next,i++;return this.curIdx=i,console.log("searchNodeAt curIdx "+this.curIdx+" count "+i+" _length "+this._length),t},BufferList.prototype.clear=function(){console.log("BufferList clear!");for(var e=this.head,t=null;null!=e;)t=e,e=e.next,t.buffer=null,t=null;this._length=0,this.head=null,this.tail=null,this.curIdx=0},BufferList.prototype.remove=function(e){var t=this.head,n=this._length,i=1,r={failure:"Failure: non-existent node in this list."},a=null,o=null,s=null;if(0===n||e<1||e>n)throw new Error(r.failure);if(1===e)this.head=t.next,this.head?this.tail=null:this.head.previous=null;else if(e===this._length)this.tail=this.tail.previous,this.tail.next=null;else{for(;i<e;)t=t.next,i++;a=t.previous,o=t,s=t.next,a.next=s,s.previous=a,o,o=null}return this._length--,r.success},BufferList.prototype.removeTillCurrent=function(){for(var e,t=1;t<this.curIdx;)null!=(e=this.pop())&&(delete e.buffer,e.buffer=null,e.previous=null,e.next=null),t++;console.log("removeTillCurrent curIdx "+this.curIdx+" count "+t+" _length "+this._length)};var BufferPool=function(e){this.metrics={},this._clearMetrics(),this._objpool=[],this.bufferSize=e};BufferPool.prototype.alloc=function(){var e;return 0==this._objpool.length?(e=new Uint8Array(this.bufferSize),this.metrics.totalalloc++):(e=this._objpool.pop(),this.metrics.totalfree--),e},BufferPool.prototype.free=function(e){e.length>0&&(console.log("It is not zero length = "+e.length),this._objpool.push(e),this.metrics.totalfree++)},BufferPool.prototype.collect=function(e){this._objpool=[];var t=this.metrics.totalalloc-this.metrics.totalfree;this._clearMetrics(t)},BufferPool.prototype._clearMetrics=function(e){this.metrics.totalalloc=e||0,this.metrics.totalfree=0};var ImagePool=function(){this.metrics={},this._clearMetrics(),this._objpool=[]};function videoDigitalPTZ(){var e=null,t=1,n=0,i=!1,r=0,a=0,o=0,s=0,l=0,c=0,u=BrowserDetect(),d="transform";function p(){}function h(u,p,h){switch(p){case"mousewheel":u.stopPropagation(),u.preventDefault();var m=u.wheelDelta?u.wheelDelta:-u.detail;if((m/=120)>0&&t<16)t+=.1;else if(m<0&&t>1){t-=.1;var f=.1*e.clientWidth/2;1!=t?(parseInt(e.style.left,10)<0?e.style.left=parseInt(e.style.left,10)+f+"px":e.style.left=parseInt(e.style.left,10)-f+"px",parseInt(e.style.top,10)<0?e.style.top=parseInt(e.style.top,10)+f+"px":e.style.top=parseInt(e.style.top,10)-f+"px"):(e.style.left="0px",e.style.top="0px")}l=parseInt(e.clientWidth*(t-1)/2,10),c=parseInt(e.clientHeight*(t-1)/2,10),e.style[d]="scale("+t+") rotate("+n+"deg)";break;case"mousedown":i=!0,r=u.clientX,a=u.clientY;break;case"mouseup":case"mouseleave":i=!1;break;case"mousemove":i&&(o=r-u.clientX,s=a-u.clientY,r=u.clientX,a=u.clientY,o<0?parseInt(e.style.left,10)<l?e.style.left=parseInt(e.style.left,10)-o+"px":parseInt(e.style.left,10)!=l&&(e.style.left=l+"px"):o>0&&(parseInt(e.style.left,10)>-l?e.style.left=parseInt(e.style.left,10)-o+"px":parseInt(e.style.left,10)!=-l&&(e.style.left=-l+"px")),s<0?parseInt(e.style.top,10)<parseInt(c,10)?e.style.top=parseInt(e.style.top,10)-s+"px":parseInt(e.style.top,10)!=c&&(e.style.top=c+"px"):s>0&&(parseInt(e.style.top,10)>-c?e.style.top=parseInt(e.style.top,10)-s+"px":parseInt(e.style.top,10)!=-c&&(e.style.top=-c+"px")))}}function m(e){h(e,"mousewheel")}function f(e){h(e,"mousedown")}function g(e){h(e,"mouseup")}function v(e){h(e,"mousemove")}function y(e){h(e,"mouseleave")}return p.prototype={setVideoElement:function(t){var n;(e=t).style.left=0,e.style.top=0,e.style.position="relative",n=e,"firefox"===u?n.addEventListener("DOMMouseScroll",m):n.addEventListener("mousewheel",m),n.addEventListener("mousedown",f),n.addEventListener("mousemove",v),n.addEventListener("mouseup",g),n.addEventListener("mouseleave",y)}},new p}ImagePool.prototype.alloc=function(){var e;return 0==this._objpool.length?(e=new Image,this.metrics.totalalloc++):(e=this._objpool.pop(),this.metrics.totalfree--),e},ImagePool.prototype.free=function(e){e.length>0&&(console.log("It is not zero length = "+e.length),this._objpool.push(e),this.metrics.totalfree++)},ImagePool.prototype.collect=function(e){this._objpool=[];var t=this.metrics.totalalloc-this.metrics.totalfree;this._clearMetrics(t)},ImagePool.prototype._clearMetrics=function(e){this.metrics.totalalloc=e||0,this.metrics.totalfree=0};var fileMaker=null,callback=null;function backupWorkerMessage(e){var t=e.data;switch(t.type){case"backup":null!==fileMaker&&fileMaker.processMessage(t.data.target,t.data.data);break;case"backupResult":void 0!==callback&&null!==callback&&callback(t.data)}}function BackupProvider(){var e=0,t=1,n=e,i=null;function r(){}return r.prototype={init:function(t,r){n=e,(i=new Worker("./media/ump/Worker/Backup/backupWorker.js")).onmessage=backupWorkerMessage,callback=t,null===fileMaker&&(fileMaker=new FileMaker);var a={type:"start",data:{fileName:void 0===r?"":r}};i.postMessage(a)},onVideoData:function(r,a,o){if(n===e&&(n=t),n===t){var s={type:"sendVideoFrame",data:{frameInfo:{type:"video",channelId:r.channelId,frameType:a.frameType,codectype:r.codecType,PESsize:r.frameData.length,framerate:void 0!==r.timeStamp.timestamp_usec?60:a.framerate,timestamp:null===r.timeStamp.timestamp?r.timeStamp.rtpTimestamp:r.timeStamp.timestamp,timestamp_usec:r.timeStamp.timestamp_usec,width:a.width,height:a.height},streamData:r.frameData}};i.postMessage(s)}},receiveAudioData:function(e,r){if(n===t&&null!==i){var a={type:"sendAudioFrame",data:{frameInfo:{type:"audio",channelId:e.channelId,bitrate:r.bitrate,codectype:e.codecType,PESsize:e.frameData.length},streamData:e.frameData}};i.postMessage(a)}},closeStream:function(){if(null!==i){i.postMessage({type:"stop"}),n=e}}},new r}var FileMaker=function(){var e=null,t=null,n=null,i=null,r=null,a=null,o=null,s=null,l=null;function c(){e=[],t=[],n=[],i=[];try{"undefined"!=typeof MSBlobBuilder&&(console.log("support blob builder"),l=!0,a=new MSBlobBuilder,o=new MSBlobBuilder,s=new MSBlobBuilder)}catch(e){l=!1}}function u(){e=null,i=null,t=[],n=[],r=null}function d(c){if(null===r)if(l){var d=o.getBlob(),p=s.getBlob(),h=new FileReader,m=new FileReader;h.readAsArrayBuffer(d),h.onload=function(){a.append(e),a.append(this.result),m.readAsArrayBuffer(p)},m.onload=function(){a.append(i),a.append(this.result),window.navigator.msSaveOrOpenBlob(a.getBlob("application/octet-stream"),c+".avi"),console.log("....................msSaveOrOpenBlob"),h=null,m=null,u()}}else{var f=[];f.push(e);var g=0;for(g=0;g<t.length;g++)f.push(t[g]);for(f.push(i),g=0;g<n.length;g++)f.push(n[g]);r=new Blob(f,{type:"application/octet-stream"}),saveAs(r,c+".avi"),console.log("....................saveAs"),f=null,u()}}return c.prototype={processMessage:function(a,c){var u,p;"body"===a?(p=c,l?o.append(p):t.push(p),r=null):"mainHeader"===a?e=c:"tailHeader"===a?i=c:"tailBody"===a?(u=c,l?s.append(u):n.push(u)):"save"===a&&d(c)}},new c};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&_setPrototypeOf(r,n.prototype),r}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var LOG_TAG="ump-player",umpplayer_version="1.0.0",umpplayer_log=log4javascript.getLogger(LOG_TAG),UmpPlayType={};UmpPlayType.Enum("LIVE","PLAYBACK","BACKUP");var UmpPlayState={};UmpPlayState.Enum("STOPPED","PLAYING","PAUSED","STEP");var UmpPlaySpeed={speed_0_25x:{value:.25,name:"0.25x"},speed_0_50x:{value:.5,name:"0.50x"},speed_0_75x:{value:.75,name:"0.75x"},speed_1x:{value:1,name:"1x"},speed_2x:{value:2,name:"2x"},speed_4x:{value:4,name:"4x"},speed_8x:{value:8,name:"8x"},speed_16x:{value:16,name:"16x"},speed_32x:{value:32,name:"32x"},speed_64x:{value:64,name:"64x"},seek_0_25x:{value:-.25,name:"-0.25x"},seek_0_50x:{value:-.5,name:"-0.50x"},seek_0_75x:{value:-.75,name:"-0.75x"},seek_1x:{value:-1,name:"-1x"},seek_2x:{value:-2,name:"-2x"},seek_4x:{value:-4,name:"-4x"},seek_8x:{value:-8,name:"-8x"},seek_16x:{value:-16,name:"-16x"},seek_32x:{value:-32,name:"-32x"},seek_64x:{value:-64,name:"-64x"}},UmpPlayer=function(e){function t(){var e;return _classCallCheck(this,t),e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)),umpplayer_log.info("[ump-player] version: ",e.version()),e._hostname=null,e._channel=null,e._profile=null,e._profile_number=null,e._deviceType=null,e._username=null,e._password=null,e._iframe=!1,e._controls=!1,e._multicast=!1,e._width=0,e._height=0,e._background="black",e._readyState=UmpPlayState.STOPPED,e._currentTimestamp=null,e._sessionKey=null,e._source=null,e._autoplay=null,e._proxy=null,e._port=null,e._secure=!1,e._useIso=null,e.timezone_offset=null,e._filename=null,e._sunapiMng=new sunapiManager,e._playType=null,e._playSpeed=UmpPlaySpeed.speed_1x,e.listeners=new Map,e.info={callback:{close:e.onUmpClose.bind(_assertThisInitialized(_assertThisInitialized(e))),error:e.onUmpError.bind(_assertThisInitialized(_assertThisInitialized(e))),status:e.onUmpStatus.bind(_assertThisInitialized(_assertThisInitialized(e))),time:e.onUmpTimestamp.bind(_assertThisInitialized(_assertThisInitialized(e))),resize:e.onUmpResize.bind(_assertThisInitialized(_assertThisInitialized(e))),meta:e.onUmpMeta.bind(_assertThisInitialized(_assertThisInitialized(e))),vmode:e.onUmpVideoMode.bind(_assertThisInitialized(_assertThisInitialized(e))),statistics:e.onUmpStatistics.bind(_assertThisInitialized(_assertThisInitialized(e))),step:e.onUmpStep.bind(_assertThisInitialized(_assertThisInitialized(e))),capture:e.onUmpCapture.bind(_assertThisInitialized(_assertThisInitialized(e))),backup:e.onUmpBackup.bind(_assertThisInitialized(_assertThisInitialized(e)))},device:{ClientIPAddress:"127.0.0.1",hostname:"",cameraIp:"",port:80,captureName:"",protocol:"",username:"",password:"",deviceType:"",debug:!1,async:!1,channelId:0,proxy:""},media:{audioOutStatus:!1,framerate:30,govLength:60,instantPlaybackTime:30,bufferClearInterval:1,needToImmediate:!1,boxsize:4,mode:null,requestInfo:{cmd:"open",scale:1,url:null},transportType:"rtsp",type:"live"}},e.player=null,e.backupplayer=null,e.video=document.createElement("canvas"),e}return _inherits(t,_wrapNativeSuper(HTMLElement)),_createClass(t,[{key:"version",value:function(){return umpplayer_version}},{key:"attributeChangedCallback",value:function(e,t,n){"autoplay"===e&&(this._autoplay=!0),"hostname"===e&&(this._hostname=n,this.info.device.cameraIp=this._hostname,this.info.device.hostname=this._hostname),"channel"===e&&(this._channel=n),"profile"===e&&(this._profile=n),"profile_number"===e&&(this._profile_number=n),"device"===e&&(this._deviceType=n,this.info.device.deviceType=this._deviceType),"username"===e&&(this._username=n,this.info.device.user=this._username,this.info.device.username=this._username),"password"===e&&(this._password=n,this.info.device.password=this._password),"iframe"===e&&(this._iframe=!0),"controls"===e&&(this._controls=!0),"multicast"===e&&(this._multicast=!0),"width"===e&&(this._width=n),"height"===e&&(this._height=n),"mode"===e&&(this.mode=n),"proxy"===e&&(this._proxy=n),"port"===e&&(this._port=n),"secure"===e&&(this._secure=!0)}},{key:"connectedCallback",value:function(){if(null!==this.getAttribute("autoplay")&&void 0!==this.getAttribute("autoplay")&&(this._autoplay=!0),null!==this.getAttribute("device")&&void 0!==this.getAttribute("device")?this.info.device.deviceType=this.getAttribute("device"):this.info.device.deviceType="camera","camera"===this.info.device.deviceType?null!==this.getAttribute("hostname")&&void 0!==this.getAttribute("hostname")?this.info.device.cameraIp=this.getAttribute("hostname"):this.info.device.cameraIp=document.location.hostname:null!==this.getAttribute("hostname")&&void 0!==this.getAttribute("hostname")?this.info.device.hostname=this.getAttribute("hostname"):this.info.device.hostname=document.location.hostname,null!==this.getAttribute("username")&&void 0!==this.getAttribute("username")&&(this.info.device.username=this.getAttribute("username")),null!==this.getAttribute("password")&&void 0!==this.getAttribute("password")&&(this.info.device.password=this.getAttribute("password")),null!==this.getAttribute("profile")&&void 0!==this.getAttribute("profile")&&(this._profile=this.getAttribute("profile")),null!==this.getAttribute("profile_number")&&void 0!==this.getAttribute("profile_number")&&(this._profile_number=this.getAttribute("profile_number")),null!==this.getAttribute("controls")&&void 0!==this.getAttribute("controls")&&(this._controls=!0),null!==this.getAttribute("multicast")&&void 0!==this.getAttribute("multicast")&&(this._multicast=!0),null!==this.getAttribute("iframe")&&void 0!==this.getAttribute("iframe")&&(this._iframe=!0),null!==this.getAttribute("secure")&&void 0!==this.getAttribute("secure")&&(this._secure=!0),null!==this.getAttribute("proxy")&&void 0!==this.getAttribute("proxy")&&(this._proxy=this.getAttribute("proxy")),null!==this.getAttribute("port")&&void 0!==this.getAttribute("port")&&(this._port=this.getAttribute("port")),null===this.getAttribute("channel")||void 0===this.getAttribute("channel")?(this.video.id="live"+this.info.media.mode+"1",this.info.device.channelId=0):this.info.device.channelId=Number(this.getAttribute("channel"))-1,this.video.setAttribute("kind-channel-id",this.info.device.channelId),null===this.getAttribute("width")&&void 0===this.getAttribute("width")||(this.video.width=this.getAttribute("width")),null===this.getAttribute("height")&&void 0===this.getAttribute("height")||(this.video.height=this.getAttribute("height")),null===this.getAttribute("id")&&void 0===this.getAttribute("id")||(this.video.id="live-"+this.getAttribute("id"),this.video.setAttribute("kind-channel-mapped-id",this.getAttribute("id")),this.info.media.element=this.getAttribute("id")),null!==this.getAttribute("mode")&&void 0!==this.getAttribute("mode"))if("live"===this.getAttribute("mode"))this._playType=UmpPlayType.LIVE;else{if("playback"!==this.getAttribute("mode"))throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0412"),place:"ump-player.js:364",message:"play mode is not defined. please! check your mode attribute on your ump-player element."});this._playType=UmpPlayType.PLAYBACK}!0===this._controls&&(this.video.controls=!0),this.video.style="background:"+this._background+";",null!==this.info.media.element&&null!==this.info.media.element&&(this._updateSunapiManager(),this._updateRendering())}},{key:"_updateSunapiManager",value:function(){null!==this._hostname&&void 0!==this._hostname&&null!==this._username&&void 0!==this._username&&null!==this._password&&void 0!==this._password&&null!==this._deviceType&&void 0!==this._deviceType&&(this.info.device.cameraIp=this._hostname,this.info.device.hostname=this._hostname,this.info.device.user=this._username,this.info.device.username=this._username,this.info.device.password=this._password,this.info.device.deviceType=this._deviceType,this._sunapiMng.init(this.info.device))}},{key:"_updateRendering",value:function(){if(this.classList.add("ump-player"),this._playType===UmpPlayType.LIVE&&"nvr"===this._deviceType){var e,t=this;if(null!==this._sunapiMng.getSunapiClient()&&void 0!==this._sunapiMng.getSunapiClient())"camera"===this._deviceType?e=null===this._channel?0:this._channel-1:"nvr"===this._deviceType&&(e=this._channel-1),this._sunapiMng.getSnapshot(1,e).then(function(e){if(void 0!==e)try{console.log(e);var n=(window.URL||window.webkitURL).createObjectURL(e.data),i=document.createElement("img");i.setAttribute("id","snapshot"),i.setAttribute("src",n),i.setAttribute("width",t._width),i.setAttribute("height",t._height),i.classList.add("absolute"),t.video.classList.add("absolute"),t.appendChild(i)}catch(e){console.error("error: ",e.message)}}).catch(function(e){Number.isInteger(e)?(event=new CustomEvent("error",{bubbles:!0,detail:{channelId:e.channelId,elementId:t.getAttribute("id"),error:fromHex("0x1002"),message:"HTTP request error: "+HTTP_STATUS_CODES[e],place:"ump-player.js:89-"}}),t.dispatchEvent(event)):console.error("deviceInfo error: ",e.message)})}this.appendChild(this.video),null!==this._sunapiMng.getSunapiClient()&&void 0!==this._sunapiMng.getSunapiClient()&&!0===this._autoplay&&(null!==this._profile&&void 0!==this._profile||null!==this.profile_number&&this._profile_number)&&null!==this._deviceType&&void 0!==this._deviceType&&("nvr"===this._deviceType?null!==this._channel&&void 0!==this._channel&&this.play():this.play())}},{key:"addEventListener",value:function(e,t){this.listeners.set(t.bind(this),{type:e,listener:t})}},{key:"removeEventListener",value:function(e,t){var n=!0,i=!1,r=void 0;try{for(var a,o=this.listeners[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=_slicedToArray(a.value,2),l=s[0],c=s[1];c.type===e&&t===c.listener&&this.listeners.delete(l)}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}},{key:"dispatchEvent",value:function(e){Object.defineProperty(e,"target",{value:this}),this["on"+e.type]&&this["on"+e.type](e);var t=!0,n=!1,i=void 0;try{for(var r,a=this.listeners[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=_slicedToArray(r.value,2),s=o[0];o[1].type===e.type&&s(e)}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"onUmpVideoMode",value:function(e){var t,n,i,r;if(umpplayer_log.debug("onUmpVideoMode",e),n="live-"+e.elementId,null!==(t=document.getElementById(n))&&void 0!==t){i=t.parentElement;var a=t.getAttribute("width"),o=t.getAttribute("height"),s=t.getAttribute("kind-channel-id"),l=t.getAttribute("kind-channel-mapped-id"),c=t.getAttribute("style");this._playType===UmpPlayType.LIVE&&(r=t.classList),t.remove();var u=document.createElement(e.mode);void 0!==i.controls&&null!==i.controls&&(u.controls=!0),u.setAttribute("id",n),u.setAttribute("width",a),u.setAttribute("height",o),u.setAttribute("kind-channel-id",s),u.setAttribute("kind-channel-mapped-id",l),u.setAttribute("style",c),this._playType===UmpPlayType.LIVE&&u.setAttribute("class",r),i.appendChild(u)}var d=new CustomEvent("changeplayermode",{bubbles:!0,detail:{elementId:this.getAttribute("id"),mode:e.mode}});this.dispatchEvent(d)}},{key:"onUmpClose",value:function(e){umpplayer_log.debug("onUmpClose: ",JSON.stringify(e))}},{key:"onUmpError",value:function(e){var t;switch(umpplayer_log.debug("onUmpError: ",JSON.stringify(e)),toHex(e.errorCode)){case"0x0000":if(umpplayer_log.info("state chaned = playing"),"Play"===e.currentState||"Resume"===e.currentState){this._readyState=UmpPlayState.PLAYING;var n=document.getElementById("snapshot");void 0!==n&&null!==n&&n.classList.add("hidden")}else"Pause"===e.currentState&&(this._readyState=UmpPlayState.PAUSED);t=new CustomEvent("statechange",{bubbles:!0,detail:{elementId:this.getAttribute("id"),readyState:this.readyState}}),this.dispatchEvent(t);break;case"0x0001":umpplayer_log.info("state chaned = stopped"),this._readyState=UmpPlayState.STOPPED;var i=document.getElementById("snapshot");void 0!==i&&null!==i&&i.classList.remove("hidden"),t=new CustomEvent("statechange",{bubbles:!0,detail:{elementId:this.getAttribute("id"),readyState:this.readyState}}),this.dispatchEvent(t);break;case"0x0106":this.stop(),t=new CustomEvent("error",{bubbles:!0,detail:{channelId:e.channelId,elementId:this.getAttribute("id"),error:toHex(e.errorCode),message:e.description,place:e.place}}),this.dispatchEvent(t);break;case"0x0601":this.onUmpBackup(e);break;default:t=new CustomEvent("error",{bubbles:!0,detail:{channelId:e.channelId,elementId:this.getAttribute("id"),error:toHex(e.errorCode),message:e.description,place:e.place}}),this.dispatchEvent(t)}}},{key:"onUmpStatus",value:function(e){console.log("onUmpStatus: ",e)}},{key:"onUmpResize",value:function(e){console.log("onUmpResize: ",e);var t=getElementByAttributeValue(e.tagmode,"kind-channel-mapped-id",e.elementId);if(void 0!==t){var n;if(n=t.getAttribute("style",n),null!==t.style.width&&void 0!==t.style.width&&""!==t.style.width)return;if(null!==t.style.height&&void 0!==t.style.height&&""!==t.style.height)return;n+="width:"+t.width+"px;height:"+t.height+"px;",t.setAttribute("style",n)}meta.elementId=this.getAttribute("id");var i=new CustomEvent("resize",{bubbles:!0,detail:{width:e.width,height:e.height}});this.dispatchEvent(i)}},{key:"onUmpMeta",value:function(e){if(umpplayer_log.debug("meta on ump-player: ",e),void 0!==e.json&&void 0!==e.xml){e.elementId=this.getAttribute("id");var t=new CustomEvent("meta",{bubbles:!0,detail:{json:e.json,xml:e.xml}});this.dispatchEvent(t)}}},{key:"onUmpTimestamp",value:function(e){(new Date).getTimezoneOffset();var t,n=new Date(1e3*e.timestamp+e.timestamp_usec);null!==e.timezone&&void 0!==e.timezone&&(this.timezone_offset=e.timezone/60,t=new Date(n+36e5*this.timezone_offset)),this._currentTimestamp=n.toISOString(),event=new CustomEvent("timestamp",{bubbles:!0,detail:{elementId:this.getAttribute("id"),timestamp:this._currentTimestamp,local:void 0!==t?t.YYYYMMDDHHMMSS():t}}),this.dispatchEvent(event)}},{key:"onUmpStatistics",value:function(e){umpplayer_log.debug("statictics = ",JSON.stringify(e));var t=new CustomEvent("statistics",{bubbles:!0,detail:{elementId:this.getAttribute("id"),statictics:e}});this.dispatchEvent(t)}},{key:"onUmpStep",value:function(e){switch(umpplayer_log.info("step",JSON.stringify(e)),e){case"request":if("camera"===this._deviceType){umpplayer_log.info("request next packet");var t=new Date(this.currentTimestamp),n=new Date(t.getTime()-2e3);this._seekingTime=n.YYYYMMDDHHMMSS(),this.seeking()}break;case"complete":"camera"===this._deviceType&&this.pause(),event=new CustomEvent("statechange",{bubbles:!0,detail:{elementId:this.getAttribute("id"),readyState:UmpPlayState.STEP}}),this.dispatchEvent(event)}}},{key:"onUmpCapture",value:function(e){umpplayer_log.info("capture",e),null!==e&&void 0!==e&&(event=new CustomEvent("capture",{bubbles:!0,detail:{elementId:this.getAttribute("id"),blob:e.blob}}),this.dispatchEvent(event))}},{key:"onUmpBackup",value:function(e){if(umpplayer_log.info("backup",JSON.stringify(e)),null!==e&&void 0!==e)switch(toHex(e.errorCode)){case"0x0600":var t=new CustomEvent("backupstate",{bubbles:!0,detail:{elementId:this.getAttribute("id"),state:e.errorCode,filename:e.filename}});this.dispatchEvent(t);break;case"0x0601":this.stop();t=new CustomEvent("backupstate",{bubbles:!0,detail:{elementId:this.getAttribute("id"),state:e.errorCode,filename:e.filename}});this.dispatchEvent(t);break;case"0x0603":this.onUmpTimestamp(e.timeStamp)}}},{key:"play",value:function(){if(this.info.media.requestInfo.cmd="open",null!==this.mode&&void 0!==this.mode||(this.mode="live"),this.playType===UmpPlayType.LIVE)this.info.media.type="live",this.info.media.requestInfo.scale=1,"camera"===this._deviceType?this.info.media.boxsize=4:this.info.media.boxsize=10;else{if(this.info.media.type="playback",this.info.media.requestInfo.scale=1,this.info.media.needToImmediate=!1,this.info.media.boxsize=1,null===this.startTime||void 0===this.startTime)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0411"),place:"ump-player.js:1098",message:"start time is empty"});null!==this._currentTimestamp&&void 0!==this._currentTimestamp||(this._currentTimestamp=this.startTime),"camera"===this._deviceType||(this._useIso&&null!==this._useIso?(this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").slice(0,20),void 0!==this.endTime&&null!==this.endTime?this.info.media.requestInfo.rangeClock+="-"+this.endTime.replace(/-/g,"").replace(/:/gi,"").slice(0,20):this.info.media.requestInfo.rangeClock+="-"):(this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16),void 0!==this.endTime&&null!==this.endTime?this.info.media.requestInfo.rangeClock+="-"+this.endTime.replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16):this.info.media.requestInfo.rangeClock+="-"))}if(umpplayer_log.debug("playinfo: ",this.info),this.info.callback.close=this.onUmpClose.bind(this),this.info.callback.error=this.onUmpError.bind(this),this.info.callback.status=this.onUmpStatus.bind(this),this.info.callback.vmode=this.onUmpVideoMode.bind(this),null===this._username||void 0===this._username)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0402"),place:"ump-player.js:632",message:"username attribute is empty"});if(!(null!==this._password&&void 0!==this._password||null!==this._sunapiMng.getSunapiClient()&&void 0!==this._sunapiMng.getSunapiClient()))throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0402"),place:"ump-player.js:632",message:"password attribute is empty or sunapi client property is null"});null!==this._source&&void 0!==this._source||(this.info.media.requestInfo.url=this.generateRTSPURL()),null!==this._proxy&&void 0!==this._proxy&&(this.info.device.proxy=this._proxy),null!==this._port&&void 0!==this._port&&(this.info.device.port=this._port),this._secure&&(this.info.device.protocol="https",null!==this._port&&void 0!==this._port||(this.info.device.port="443")),void 0!==this.player&&null!==this.player||(this.player=new StreamPlayer(this.info,this._sunapiMng.getSunapiClient())),umpplayer_log.info("request play cmd: ",JSON.stringify(this.info)),this.player.control(this.info)}},{key:"generateRTSPURL",value:function(){var e,t,n,i="";log4javascript.getLogger("ump-player");if("camera"===this._deviceType)if(null!==this.info.media.type&&void 0!==this.info.media.type&&(e="live"===this.info.media.type?"":"recording"),null!==this._channel&&void 0!==this._channel&&(i+=Number(this._channel-1)+"/"),"live"===this.info.media.type){if(!0===this._multicast&&(i+="multicast/"),null!==this._profile&&void 0!==this._profile&&null!==this._profile_number&&void 0!==this._profile_number)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0406"),place:"ump-player.js:1054",message:"profile information is duplicated, you have to use only single attribute from both."});if(null!==this._profile&&void 0!==this._profile)i+=this._profile;else{if(null===this._profile_number||void 0===this._profile_number)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0406"),place:"ump-player.js:1054",message:"profile information is empty, you have to check profile attribute or profile_number attribute."});i+="profile"+this._profile_number}i+="/media.smp"}else if("playback"===this.info.media.type)i+=e+"/",this._useIso&&null!==this._useIso||(null!==this.startTime&&void 0!==this.startTime&&(t=(this.startTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16)),null!==this.seekingTime&&void 0!==this.seekingTime&&(t=(this.seekingTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16)),null!==this.endTime&&void 0!==this.endTime&&(n=(this.endTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16)),void 0!==t&&(i+=t),void 0!==n&&(i+="-"+n),i+="/"),null!==this.overlappedId&&void 0!==this.overlappedId&&(i+="OverlappedID="+this.overlappedId),i+="/play.smp";else{if("backup"!==this.info.media.type)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0906"),place:"ump-player.js:632",message:"Invalidate play mode: ["+this.info.media.type+"]"});i+=e+"/",this._useIso&&null!==this._useIso||(null!==this.startTime&&void 0!==this.startTime&&(t=(this.startTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16)),null!==this.seekingTime&&void 0!==this.seekingTime&&(t=(this.seekingTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16)),null!==this.endTime&&void 0!==this.endTime&&(n=(this.endTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16)),void 0!==t&&(i+=t),void 0!==n&&(i+="-"+n),i+="/"),null!==this.overlappedId&&void 0!==this.overlappedId&&(i+="OverlappedID="+this.overlappedId),i+="/backup.smp"}else{if("nvr"!==this._deviceType)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0404"),place:"ump-player.js:1174",message:"device attribute is not define."});if(null!==this.info.media.type&&void 0!==this.info.media.type)switch(this.info.media.type.toLowerCase()){case" live":e="LiveChannel";break;case"playback":e="PlaybackChannel";break;case"backup":e="BackupChannel";break;default:e="LiveChannel"}if(i=e+"/",null===this._channel||void 0===this._channel)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0408"),place:"ump-player.js:1093",message:"channel attribute is empty for nvr device type"});if(i+=this._channel-1+"/media.smp",null!==this._sessionKey&&void 0!==this._sessionKey?i+="/session="+this._sessionKey+"&":(console.warn("If you do not use session key, you could not play more 10 channel."),i+="/"),"playback"===this.info.media.type||"backup"===this.info.media.type)null===this.startTime&&null===this.endTime&&null===this.overlappedId||(null!==this.startTime&&void 0!==this.startTime&&(t=this._useIso&&null!==this._useIso?(this.startTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").slice(0,20):(this.startTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,15)),null!==this.endTime&&void 0!==this.endTime&&(n=this._useIso&&null!==this._useIso?(this.endTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").slice(0,20):(this.endTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,15)),void 0!==t&&(i+="start="+t),void 0!==n&&(i+="&end="+n),null!==this.overlappedId&&void 0!==this.overlappedId&&(i+="&overlap="+this.overlappedId));else if(null!==this._sessionKey&&void 0!==this._sessionKey&&(i+="&"),null!==this._profile_number&&void 0!==this._profile_number)i+="profile="+this._profile_number;else{if(null===this._profile||void 0===this._profile)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0406"),place:"ump-player.js:1054",message:"profile information is empty\t"});i+="profile="+this._profile}"iframe"===this.mode&&(i+="&iframe")}return umpplayer_log.debug("genetated rtsp url: ",i),i}},{key:"stop",value:function(){log4javascript.getLogger("ump-player");if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:897",message:"player object is not exist"});null!==this._source&&void 0!==this._source||(this.info.media.requestInfo.url=this.generateRTSPURL()),this.info.media.requestInfo.cmd="close",umpplayer_log.info("request stop cmd: ",this.info),this.player.control(this.info)}},{key:"pause",value:function(){log4javascript.getLogger("ump-player");if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});if("playback"===this.info.media.type)if("camera"===this._deviceType);else{if("nvr"!==this._deviceType)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0404"),place:"ump-player.js:983",message:"device type is undefined"});this.info.media.requestInfo.rangeClock=(this.currentTimestamp.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").slice(0,16)}null!==this._source&&void 0!==this._source||(this.info.media.requestInfo.url=this.generateRTSPURL()),this.info.media.requestInfo.cmd="pause",this.info.media.needToImmediate=!1,umpplayer_log.info("request pause cmd: ",this.info),this.player.control(this.info)}},{key:"resume",value:function(){log4javascript.getLogger("ump-player");if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});if("playback"===this.info.media.type)if("camera"===this._deviceType);else{if("nvr"!==this._deviceType)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0404"),place:"ump-player.js:983",message:"device type is undefined"});this._useIso&&null!==this._useIso?this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").slice(0,20):this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,20)}null!==this._source&&void 0!==this._source||(this.info.media.requestInfo.url=this.generateRTSPURL()),this.info.media.requestInfo.cmd="resume",this.info.media.needToImmediate=!1,this.info.media.requestInfo.scale=1,umpplayer_log.info("request pause cmd: ",this.info),this.player.control(this.info)}},{key:"isPlay",value:function(){var e;log4javascript.getLogger("ump-player");return void 0!==this.player&&null!==this.player&&(e="Playing"===this.player.getCurrentState(),umpplayer_log.debug("isPlay: ",e),e)}},{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"setSunapiClient",value:function(e){this.sunapiClient=e}},{key:"unmute",value:function(){log4javascript.getLogger("ump-player");if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});this.info.media.requestInfo.cmd="audioIn",this.info.media.requestInfo.data="unmute",umpplayer_log.debug("request unmute cmd: ",this.info),this.player.control(this.info)}},{key:"mute",value:function(){log4javascript.getLogger("ump-player");if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});this.info.media.requestInfo.cmd="audioIn",this.info.media.requestInfo.data="mute",umpplayer_log.debug("request mute cmd: ",this.info),this.player.control(this.info)}},{key:"getAudioVolume",value:function(){if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});return this.player.getAudioVolume()}},{key:"setAudioVolume",value:function(e){log4javascript.getLogger("ump-player");if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});this.info.media.requestInfo.cmd="audioIn",this.info.media.requestInfo.data=Number(e),umpplayer_log.debug("request set volume cmd: ",this.info),this.player.control(this.info)}},{key:"isMute",value:function(){if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});return this.player.isMute()}},{key:"speed",value:function(){log4javascript.getLogger("ump-player");if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});if("playback"!==this.info.media.type)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1001"),place:"ump-player.js:1246",message:"This function support only placyback mode."});if("camera"===this._deviceType)this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").slice(0,16);else{if("nvr"!==this._deviceType)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0404"),place:"ump-player.js:983",message:"device type is undefined"});this._useIso&&null!==this._useIso?this._playSpeed.value>0?(this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").slice(0,20),void 0!==this.endTime&&null!==this.endTime?this.info.media.requestInfo.rangeClock+="-"+this.endTime.replace(/-/g,"").replace(/:/gi,"").slice(0,20):this.info.media.requestInfo.rangeClock+="-"):void 0!==this.endTime&&null!==this.endTime?(this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").slice(0,20),this.info.media.requestInfo.rangeClock+="-"+this.startTime.replace(/-/g,"").replace(/:/gi,"").slice(0,20)):(this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").slice(0,20),this.info.media.requestInfo.rangeClock+="-"):this._playSpeed.value>0?(this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,20),void 0!==this.endTime&&null!==this.endTime?this.info.media.requestInfo.rangeClock+="-"+this.endTime.replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,20):this.info.media.requestInfo.rangeClock+="-"):void 0!==this.endTime&&null!==this.endTime?(this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,20),this.info.media.requestInfo.rangeClock+="-"+this.startTime.replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,20)):(this.info.media.requestInfo.rangeClock=this.currentTimestamp.replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,20),this.info.media.requestInfo.rangeClock+="-")}this.info.media.type="playback",this._playSpeed.value<0?this.info.media.requestInfo.cmd="seek":this.info.media.requestInfo.cmd="speed",this.info.media.requestInfo.scale=this._playSpeed.value,this.info.media.needToImmediate=!0,umpplayer_log.debug("request change speed cmd: ",JSON.stringify(this.info)),this.player.control(this.info)}},{key:"forward",value:function(){if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});if("playback"===this.info.media.type){var e=new Date(this.currentTimestamp),t=new Date(e.getTime()+1e3).toISOString();if("camera"===this._deviceType);else{if("nvr"!==this._deviceType)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0404"),place:"ump-player.js:983",message:"device type is undefined"});this._useIso&&null!==this._useIso?this.info.media.requestInfo.rangeClock=t.replace(/-/g,"").replace(/:/gi,"").slice(0,20):this.info.media.requestInfo.rangeClock=t.replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,20)}}this.info.media.type="playback",this.info.media.needToImmediate=!0,this.info.media.requestInfo.cmd="forward",this.info.media.requestInfo.scale=0,null!==this._source&&void 0!==this._source||(this.info.media.requestInfo.url=this.generateRTSPURL()),umpplayer_log.debug("request forward cmd: ",JSON.stringify(this.info)),this.player.control(this.info)}},{key:"backward",value:function(){if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});if("playback"===this.info.media.type){var e=new Date(this.currentTimestamp),t=new Date(e.getTime()-1e3).toISOString();if("camera"===this._deviceType);else{if("nvr"!==this._deviceType)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0404"),place:"ump-player.js:983",message:"device type is undefined"});this._useIso&&null!==this._useIso?this.info.media.requestInfo.rangeClock=t.replace(/-/g,"").replace(/:/gi,"").slice(0,20):this.info.media.requestInfo.rangeClock=t.replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,20)}}this.info.media.type="playback",this.info.media.needToImmediate=!0,this.info.media.requestInfo.cmd="backward",this.info.media.requestInfo.scale=0,null!==this._source&&void 0!==this._source||(this.info.media.requestInfo.url=this.generateRTSPURL()),umpplayer_log.debug("request backward cmd: ",JSON.stringify(this.info)),this.player.control(this.info)}},{key:"seeking",value:function(){if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});if("playback"===this.info.media.type)if("camera"===this._deviceType)this._useIso&&null!==this._useIso&&(this.info.media.requestInfo.rangeClock=this.seekingTime.replace(/-/g,"").replace(/:/gi,"").slice(0,20));else{if("nvr"!==this._deviceType)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0404"),place:"ump-player.js:983",message:"device type is undefined"});this._useIso&&null!==this._useIso?this.info.media.requestInfo.rangeClock=this.seekingTime.replace(/-/g,"").replace(/:/gi,"").slice(0,20):this.info.media.requestInfo.rangeClock=(this.seekingTime.split(".")[0]+"Z").replace(/-/g,"").replace(/:/gi,"").replace(/Z/gi,"").slice(0,16)}this.info.media.type="playback",this.info.media.requestInfo.scale=1,this.info.media.needToImmediate=!1,this.info.media.requestInfo.cmd="seek",null!==this._source&&void 0!==this._source||(this.info.media.requestInfo.url=this.generateRTSPURL()),umpplayer_log.debug("request seeking cmd: ",this.info),this._seekingTime=null,this.player.control(this.info)}},{key:"capture",value:function(e){if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:921",message:"player object is not exist"});void 0!==e&&(this._filename=e),this.info.device.channel=this.channel,this.info.device.captureName=this._filename,this.info.media.requestInfo.cmd="capture",this.player.control(this.info),this._filename=null}},{key:"talk",value:function(e){if(void 0===this.player||null===this.player)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:2611",message:"player object is not exist"});this.info.device.channel=this.channel,this.info.media.audioOutStatus=e,this.info.media.requestInfo.cmd="audioOut",this.info.media.requestInfo.data=!0===e?"on":"off",this.player.control(this.info)}},{key:"backup",value:function(e,t){if(this._playType!==UmpPlayType.BACKUP&&(void 0===this.player||null===this.player))throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1000"),place:"ump-player.js:2691",message:"player object is not exist"});if(this._playType!==UmpPlayType.BACKUP&&void 0===t&&null===this._filename)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x1003"),place:"ump-player.js:2701",message:"The file name is not input for capture."});if(this._playType!==UmpPlayType.BACKUP&&void 0!==t&&(this._filename=t),this._playType===UmpPlayType.BACKUP)if(!0===e){if(this.info.media.type="backup",this.info.media.requestInfo.scale=1,this.info.media.needToImmediate=!1,this.info.media.boxsize=1,null===this.startTime||void 0===this.startTime)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0411"),place:"ump-player.js:1098",message:"start time is empty"});if(null!==this._currentTimestamp&&void 0!==this._currentTimestamp||(this._currentTimestamp=this.startTime),"camera"===this._deviceType||(this._useIso&&null!==this._useIso?(this.info.media.requestInfo.rangeClock=this.startTime.replace(/-/g,"").replace(/:/gi,"").slice(0,20),void 0!==this.endTime&&null!==this.endTime?this.info.media.requestInfo.rangeClock+="-"+this.endTime.replace(/-/g,"").replace(/:/gi,"").slice(0,20):this.info.media.requestInfo.rangeClock+="-"):(this.info.media.requestInfo.rangeClock=this.startTime.replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16),void 0!==this.endTime&&null!==this.endTime?this.info.media.requestInfo.rangeClock+="-"+this.endTime.replace(/-/g,"").replace(/:/gi,"").replace(/T/gi,"").replace(/Z/gi,"").slice(0,16):this.info.media.requestInfo.rangeClock+="-")),this.info.media.requestInfo.cmd="backup",umpplayer_log.debug("playinfo: ",this.info),this.info.callback.close=this.onUmpClose.bind(this),this.info.callback.error=this.onUmpError.bind(this),this.info.callback.status=this.onUmpStatus.bind(this),this.info.callback.vmode=this.onUmpVideoMode.bind(this),null===this._username||void 0===this._username)throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0402"),place:"ump-player.js:632",message:"username attribute is empty"});if(!(null!==this._password&&void 0!==this._password||null!==this._sunapiMng.getSunapiClient()&&void 0!==this._sunapiMng.getSunapiClient()))throw new umpError({channelId:this.channel,elementId:this.getAttribute("id"),errorCode:fromHex("0x0402"),place:"ump-player.js:632",message:"password attribute is empty or sunapi client property is null"});null!==this._source&&void 0!==this._source||(this.info.media.requestInfo.url=this.generateRTSPURL()),null!==this._proxy&&void 0!==this._proxy&&(this.info.device.proxy=this._proxy),null!==this._port&&void 0!==this._port&&(this.info.device.port=this._port),this._secure&&(this.info.device.protocol="https",null!==this._port&&void 0!==this._port||(this.info.device.port="443")),void 0!==this.player&&null!==this.player||(this.player=new StreamPlayer(this.info,this._sunapiMng.getSunapiClient())),umpplayer_log.info("request play cmd: ",JSON.stringify(this.info)),this.player.control(this.info)}else this.stop();else this.info.device.channel=this.channel,this.info.device.captureName=this._filename,this.info.media.requestInfo.cmd=e?"backupstart":"backupstop",this.player.control(this.info)}},{key:"playType",get:function(){return this._playType},set:function(e){this._playType=e}},{key:"mode",get:function(){return this._playType===UmpPlayType.LIVE||null===this._playType?(this._playType=UmpPlayType.LIVE,"live"):(this._playType=UmpPlayType.PLAYBACK,"playback")},set:function(e){this._playType="live"===e?UmpPlayType.LIVE:"playback"===e?UmpPlayType.PLAYBACK:UmpPlayType.LIVE}},{key:"sessionKey",get:function(){return this._sessionKey},set:function(e){this._sessionKey=e}},{key:"sunapiClient",get:function(){return this._sunapiMng.getSunapiClient()},set:function(e){this._sunapiMng.setSunapiClient(e)}},{key:"startTime",get:function(){return this._startTime},set:function(e){this._startTime=e}},{key:"endTime",get:function(){return this._endTime},set:function(e){this._endTime=e}},{key:"seekingTime",get:function(){return this._seekingTime},set:function(e){this._seekingTime=e,this.isplay&&null!==this._seekingTime&&void 0!==this._seekingTime&&this.seeking()}},{key:"overlappedId",get:function(){return this._overlappedId},set:function(e){this._overlappedId=e}},{key:"currentTimestamp",get:function(){return this._currentTimestamp}},{key:"hostname",get:function(){return this._hostname},set:function(e){this.setAttribute("hostname",e)}},{key:"channel",get:function(){return this._channel},set:function(e){this.setAttribute("channel",e)}},{key:"profile",get:function(){return this._profile},set:function(e){this.setAttribute("profile",e)}},{key:"profile_number",get:function(){return this._profile_number},set:function(e){this.setAttribute("profile_number",e)}},{key:"device",get:function(){return this._deviceType},set:function(e){this.setAttribute("device",e)}},{key:"username",get:function(){return this._username},set:function(e){this.setAttribute("username",e)}},{key:"password",get:function(){return this._password},set:function(e){console.warn("This attribute is not safety. you would be recommand to use the sunapi client for your device safety."),this.setAttribute("password",e)}},{key:"iframe",get:function(){return this._iframe},set:function(e){this.setAttribute("iframe",e)}},{key:"controls",get:function(){return this._controls},set:function(e){this.setAttribute("controls",e)}},{key:"multicast",get:function(){return this._multicast},set:function(e){this.setAttribute("multicast",e)}},{key:"width",get:function(){return this._width},set:function(e){this.setAttribute("width",e)}},{key:"height",get:function(){return this._height},set:function(e){this.setAttribute("height",e)}},{key:"isplay",get:function(){return this.isPlay()}},{key:"ismute",get:function(){return this.isMute()}},{key:"readyState",get:function(){return this._readyState}},{key:"playSpeed",get:function(){return this._playSpeed.value},set:function(e){switch(Number(e)){case UmpPlaySpeed.speed_0_25x.value:case UmpPlaySpeed.speed_0_25x.name:this._playSpeed=UmpPlaySpeed.speed_0_25x;break;case UmpPlaySpeed.speed_0_50x.value:case UmpPlaySpeed.speed_0_50x.name:this._playSpeed=UmpPlaySpeed.speed_0_50x;break;case UmpPlaySpeed.speed_0_75x.value:case UmpPlaySpeed.speed_0_75x.name:this._playSpeed=UmpPlaySpeed.speed_0_75x;break;case UmpPlaySpeed.speed_1x.value:case UmpPlaySpeed.speed_1x.name:this._playSpeed=UmpPlaySpeed.speed_1x;break;case UmpPlaySpeed.speed_2x.value:case UmpPlaySpeed.speed_2x.name:this._playSpeed=UmpPlaySpeed.speed_2x;break;case UmpPlaySpeed.speed_4x.value:case UmpPlaySpeed.speed_4x.name:this._playSpeed=UmpPlaySpeed.speed_4x;break;case UmpPlaySpeed.speed_8x.value:case UmpPlaySpeed.speed_8x.name:this._playSpeed=UmpPlaySpeed.speed_8x;break;case UmpPlaySpeed.speed_16x.value:case UmpPlaySpeed.speed_16x.name:this._playSpeed=UmpPlaySpeed.speed_16x;break;case UmpPlaySpeed.speed_32x.value:case UmpPlaySpeed.speed_32x.name:this._playSpeed=UmpPlaySpeed.speed_32x;break;case UmpPlaySpeed.speed_64x.value:case UmpPlaySpeed.speed_64x.name:this._playSpeed=UmpPlaySpeed.speed_64x;break;case UmpPlaySpeed.seek_0_25x.value:case UmpPlaySpeed.seek_0_25x.name:this._playSpeed=UmpPlaySpeed.seek_0_25x;break;case UmpPlaySpeed.seek_0_50x.value:case UmpPlaySpeed.seek_0_50x.name:this._playSpeed=UmpPlaySpeed.seek_0_50x;break;case UmpPlaySpeed.seek_0_75x.value:case UmpPlaySpeed.seek_0_75x.name:this._playSpeed=UmpPlaySpeed.seek_0_75x;break;case UmpPlaySpeed.seek_1x.value:case UmpPlaySpeed.seek_1x.name:this._playSpeed=UmpPlaySpeed.seek_1x;break;case UmpPlaySpeed.seek_2x.value:case UmpPlaySpeed.seek_2x.name:this._playSpeed=UmpPlaySpeed.seek_2x;break;case UmpPlaySpeed.seek_4x.value:case UmpPlaySpeed.seek_4x.name:this._playSpeed=UmpPlaySpeed.seek_4x;break;case UmpPlaySpeed.seek_8x.value:case UmpPlaySpeed.seek_8x.name:this._playSpeed=UmpPlaySpeed.seek_8x;break;case UmpPlaySpeed.seek_16x.value:case UmpPlaySpeed.seek_16x.name:this._playSpeed=UmpPlaySpeed.seek_16x;break;case UmpPlaySpeed.seek_32x.value:case UmpPlaySpeed.seek_32x.name:this._playSpeed=UmpPlaySpeed.seek_32x;break;case UmpPlaySpeed.seek_64x.value:case UmpPlaySpeed.seek_64x.name:this._playSpeed=UmpPlaySpeed.seek_64x}this.speed()}},{key:"secure",get:function(){return this._secure},set:function(e){this.setAttribute("secure",e)}},{key:"src",get:function(){return this._source},set:function(e){this._source=e}},{key:"useIsoTimeFormat",get:function(){return this._useIso},set:function(e){this._useIso=e}},{key:"isTalk",get:function(){return this.info.media.audioOutStatus}},{key:"filename",get:function(){return this._filename},set:function(e){this._filename=e}}],[{key:"observedAttributes",get:function(){return["hostname","channel","profile","profile_number","device","username","password","iframe","controls","multicast","width","height","autoplay","mode","proxy","port","secure"]}}]),t}();customElements.define("ump-player",UmpPlayer);var umpError=function(){log4javascript.getLogger();function e(){if(!(this instanceof e))return new e(arguments);var t,n,i=Array.apply(null,"object"==typeof arguments[0]?arguments[0]:arguments);n=0!==i.length?i.shift()||"An exception has occurred":arguments[0].message;var r="object"!==arguments[0]?arguments[0].channelId:0,a="object"!==arguments[0]?arguments[0].elementId:"",o="object"!==arguments[0]?arguments[0].errorCode:0,s="object"!==arguments[0]?arguments[0].place:"";~n.indexOf("}")&&i.forEach(function(e,t){n=n.replace(RegExp("\\{"+t+"}","g"),e)}),(t=new Error(n)).name=this.name,Object.defineProperties(this,{stack:{enumerable:!1,get:function(){return t.stack}},message:{enumerable:!1,value:n},channel:{enumerable:!1,value:r},element:{enumerable:!1,value:a},errorCode:{enumerable:!1,value:o},place:{enumerable:!1,value:s}})}function t(e){return{configurable:!1,enumerable:!1,writable:!1,value:e}}return e.prototype=Object.create(Error.prototype,{constructor:t(e),name:t("UMP Error")}),e}(),StreamManager=function(){var e=log4javascript.getLogger("streammanager"),t=[],n=null;function i(){}return i.prototype={initStreamPlayer:function(e,i){var r=null===e.device.channelId?0:e.device.channelId;if(!1,t[r]){var a={channelId:r,cmd:"reassignCanvas",data:null};(n=t[r]).controlWorker(a)}else n=new StreamPlayer(e,i),t[r]=n,!0},controlPlayer:function(n){var i=null===n.device.channelId?0:n.device.channelId;t[i]?t[i].control(n):e.error("ERROR: StreamPlayer is not initialized")},controlWorker:function(n){var i=null===n.channelId?0:n.channelId;t[i]?t[i].controlWorker(n):e.error("ERROR: StreamPlayer is not initialized controlWorker::cmd = "+n.cmd)},destroyPlayer:function(e){this.controlWorker({channelId:e,cmd:"initVideo",data:[!1]}),this.controlWorker({channelId:e,cmd:"setLiveMode",data:["canvas"]}),this.controlWorker({channelId:e,cmd:"controlAudioListen",data:["volumn",0]}),this.controlWorker({channelId:e,cmd:"controlAudioTalk",data:["volumn",0]}),t[e]=null},getCurrentState:function(n){var i=null===n?0:n;if(t[i])return t[i].getCurrentState();e.error("ERROR: StreamPlayer is not initialized")},getVideoWidth:function(n){var i=null===n?0:n;if(t[i])return t[i].getVideoWidth();e.error("ERROR: StreamPlayer is not initialized")},getVideoHeight:function(n){var i=null===n?0:n;if(t[i])return t[i].getVideoHeight();e.error("ERROR: StreamPlayer is not initialized")},getVideoCodecType:function(n){var i=null===n?0:n;if(t[i])return t[i].getVideoCodecType();e.error("ERROR: StreamPlayer is not initialized")},getAudioVolume:function(n){var i=null===n?0:n;if(t[i])return t[i].getAudioVolume();e.error("ERROR: StreamPlayer is not initialized")},setAudioVolume:function(n,i){var r=null===n?0:n;if(t[r])return t[r].setAudioVolume(i);e.error("ERROR: StreamPlayer is not initialized")}},i}();function StreamPlayer(e,t){var n,i,r=log4javascript.getLogger("streamplayer"),a=e.device.channelId,o={protocol:"",hostname:"",port:80,proxy:""},s={device:{cameraIp:"",hostname:"",username:"admin",password:"",type:"camera",digest:""},media:{type:"live",requestInfo:{cmd:"open",url:"profile2",scale:1},framerate:0,govLength:null,mode:null,checkDelay:!0}},l={startTime:null,endTime:null},c={close:null,error:null,status:null,time:null,onResize:null,onMetaData:null,onVideoMode:null,onStatistics:null,onStepRequest:null,onCapture:null,onInstantPlayback:null,onBackup:null},u=null;function d(e){u=null;e.media.transportType;(i=new MediaRouter).setChannel(e.device.channelId),void 0!==e.media.audioInVolume&&i.setAudioVolume(e.media.audioInVolume),void 0!==e.media.instantPlaybackTime&&i.setMaxInstantPlaybackTime(e.media.instantPlaybackTime),void 0!==e.media.bufferClearInterval&&i.setBufferClearInterval(e.media.bufferClearInterval),void 0!==e.media.element&&i.setElement(e.media.element),null!==e.media.drop&&void 0!==e.media.drop&&"boolean"==typeof e.media.drop&&i.useDropPacket(e.media.drop),(n=new RtspClient(i)).SetSunapiClient(t)}var p=function(e,t){if(null!==e){if(void 0!==e.device.deviceType&&""!==e.device.deviceType&&null!==e.device.deviceType?s.device.type=e.device.deviceType:console.warn("The device type is not defined, set to 'camera' by default."),"nvr"===s.device.type&&(void 0===e.device.hostname||""===e.device.hostname&&null===e.device.hostname))throw new umpError({channelId:a,errorCode:fromHex("0x0401"),place:"streamPlayer.js:102",message:"hostname is empty from input parameter."});if("camera"===s.device.type&&(void 0===e.device.cameraIp||""===e.device.cameraIp||null===e.device.cameraIp))throw new umpError({channelId:a,errorCode:fromHex("0x0400"),place:"streamPlayer.js:111",message:"cameraIP is empty from input parameter."});if(o.protocol=e.device.protocol,o.hostname=e.device.hostname,o.port=e.device.port,o.ClientIPAddress=e.device.ClientIPAddress,null!==e.device.serverAddress&&void 0!==e.device.serverAddress&&""!==e.device.serverAddress?o.proxy=e.device.serverAddress:null!==e.device.proxy&&void 0!==e.device.proxy&&""!==e.device.proxy&&(o.proxy=e.device.proxy),s.device.cameraIp=e.device.cameraIp,void 0!==e.device.username)s.device.username=e.device.username;else{if(void 0===e.device.user)throw new umpError({channelId:a,errorCode:fromHex("0x0402"),place:"streamPlayer.js:96",message:"username is empty from input parameter."});s.device.username=e.device.user}var n;if(void 0!==e.device.password?s.device.password=e.device.password:console.warn("user password is empty"),s.media.type=e.media.type,s.media.requestInfo.cmd=e.media.requestInfo.cmd,s.media.requestInfo.url=e.media.requestInfo.url,s.media.requestInfo.scale=e.media.requestInfo.scale,s.media.element=e.media.element,s.media.framerate=e.media.framerate,s.media.govLength=e.media.govLength,s.media.mode=e.media.mode,void 0!==s.media.mode&&null!==s.media.mode&&v(s.media.mode),s.media.requestInfo.rangeClock=e.media.requestInfo.rangeClock,s.media.checkDelay=void 0===e.media.checkDelay,s.device.digest=e.device.digest,e.media.audioOutStatus?s.media.audioOutStatus="on":e.media.audioOutStatus||(s.media.audioOutStatus="off"),"backup"===e.media.type&&(u=!1),void 0!==e.media.boxsize&&null!==e.media.boxsize&&(s.media.boxsize=e.media.boxsize),c.status=e.callback.status,c.error=e.callback.error,c.time=e.callback.time,c.onResize=e.callback.resize,c.onMetaData=e.callback.meta,c.onVideoMode=e.callback.vmode,c.onStatistics=e.callback.statistics,c.onStepRequest=e.callback.step,c.onCapture=e.callback.capture,c.onInstantPlayback=e.callback.instantplayback,c.onBackup=e.callback.backup,m(),h(),"backup"===e.media.type)n=null!==c.onBackup&&void 0!==c.onBackup?c.onBackup:c.error,i.sendCommandData("backup",{command:"start",fileName:e.device.captureName,callback:n}),u=!0}else s.media.audioOutStatus=t,m(),h()};function h(){var e,t;e="camera"===s.device.type?o.hostname?o.hostname:s.device.cameraIp:"nvr"===s.device.type?o.hostname?o.hostname:s.device.hostname:o.hostname?o.hostname:s.device.cameraIp;var l,u=""==o.port?o.port:":"+o.port,d="http"==o.protocol||void 0===o.protocol||""==o.protocol?"ws://":"wss://",p="rtsp://"+e+"/"+s.media.requestInfo.url,h=window.location.pathname;if("/"!==h){var m=(h=(h=h.replace("/index.html","/")).replace("/wmf","")).lastIndexOf("/");h=h.substr(0,m)}-1==navigator.userAgent.indexOf("Trident")&&-1==navigator.userAgent.indexOf("Edge")||-1==o.proxy.indexOf(":")?l=""!==o.proxy?d+o.proxy+u+"/StreamingServer"+h:d+e+u+"/StreamingServer"+h:(t=(t=(t=(t=(t=""!==o.proxy?o.proxy+""+u:e+""+u).replace(/:/gi,"-")).replace(/::/gi,"--")).replace("[","")).replace("]",""),l=d+(t+=".ipv6-literal.net")+"/StreamingServer"+h);var f={wsUrl:l,id:s.device.username,pw:s.device.password,rtspUrl:p,mode:s.media.type,deviceType:s.device.type,useragent:"UWC["+o.ClientIPAddress+"]",audioOutStatus:s.media.audioOutStatus,ip:e,channelId:a,rangeClock:s.media.requestInfo.rangeClock,scale:s.media.requestInfo.scale,digest:s.device.digest};n.SetDeviceInfo(f),window.setTimeout(function(){r.info("Open ",a," Channel!"),null!==c.error&&void 0!==c.error&&(n.addEventListener("error",c.error),i.addListener("error",c.error)),null!==c.status&&void 0!==c.status&&n.addEventListener("status",c.status),null!==c.time&&void 0!==c.time&&i.addListener("timeStamp",c.time),null!==c.onResize&&void 0!==c.onResize&&i.addListener("resize",c.onResize),null!==c.onMetaData&&void 0!==c.onMetaData&&i.addListener("metaEvent",c.onMetaData),null!==c.onVideoMode&&void 0!==c.onVideoMode&&i.addListener("videoMode",c.onVideoMode),null!==c.onStepRequest&&void 0!==c.onStepRequest&&i.addListener("stepRequest",c.onStepRequest),null!==c.onStatistics&&void 0!==c.onStatistics&&i.addListener("statistics",c.onStatistics),null!==c.onCapture&&void 0!==c.onCapture&&i.addListener("capture",c.onCapture),null!==c.onInstantPlayback&&void 0!==c.onInstantPlayback&&i.addListener("instantplayback",c.onInstantPlayback),null!==s.media.boxsize&&void 0!==s.media.boxsize&&i.setBoxSize(s.media.boxsize),i.setDeviceType(s.device.type),n.Connect()},500)}function m(e){r.info("Close ",a,"Channel!"),n.Disconnect(),!0===u&&i.sendCommandData("backup",{command:"stop"}),void 0!==e&&v(null),i.terminate()}function f(e){i.sendCommandData("speed",e)}function g(e){i.sendCommandData("seek")}function v(e){i.sendCommandData("changeVideoMode",e)}return d.prototype={control:function(e){var t=e.media.requestInfo.cmd;switch(void 0===e&&console.log("info is undefined!"),void 0!==e.callback&&void 0!==e.callback.error&&n.SetErrorCallback(e.callback.error),void 0!==e.callback&&e.callback.close,null!==e.media.requestInfo.url&&void 0!==e.media.requestInfo.url&&function(e){var t=e.url.split("/");if(!("recording"!==t[0]||t.length<2)){var n=(t=t[1].split("-"))[0],r=t.length>1?t[1]:null;n===l.startTime&&r===l.endTime||(l.startTime=n,l.endTime=r||e.endTime,i.sendCommandData("requestTimeChanged",l))}}(e.media.requestInfo),t){case"open":p(e);break;case"close":m(e);break;case"terminate":!function(){throw new umpError({channelId:a,errorCode:fromHex("0x090A"),place:"streamPlayer.js:347",message:"this method was deplicated."})}();break;case"resume":!function(e){i.sendCommandData("resume",e.media.needToImmediate),!0!==e.media.streamControl&&(s.media.type=e.media.type,s.media.requestInfo.cmd="resume",s.media.requestInfo.url="rtsp://"+s.device.cameraIp+":554/"+e.media.requestInfo.url,s.media.requestInfo.scale=e.media.requestInfo.scale,s.media.needToImmediate=e.media.needToImmediate,null!==e.media.requestInfo.rangeClock&&void 0!==e.media.requestInfo.rangeClock&&(s.media.requestInfo.rangeClock=e.media.requestInfo.rangeClock),"live"===e.media.type&&(n.instantplayback=!1),n.ControlStream(s))}(e);break;case"pause":!function e(t){!1!==i.sendCommandData("pause")?!0!==t.media.streamControl&&(s.media.type=t.media.type,s.media.requestInfo.cmd="pause",s.media.requestInfo.url="rtsp://"+s.device.cameraIp+":554/"+t.media.requestInfo.url,s.media.needToImmediate=t.media.needToImmediate,null!==t.media.requestInfo.rangeClock&&void 0!==t.media.requestInfo.rangeClock&&(s.media.requestInfo.rangeClock=t.media.requestInfo.rangeClock),"live"===t.media.type&&(n.instantplayback=!0),n.ControlStream(s)):window.setTimeout(function(){e(t)},1e3)}(e);break;case"speed":!function(e){"live"!==s.media.type?(s.media.type=e.media.type,s.media.requestInfo.cmd="speed",s.media.requestInfo.scale=e.media.requestInfo.scale,s.media.requestInfo.url="rtsp://"+s.device.cameraIp+":554/"+e.media.requestInfo.url,s.media.requestInfo.rangeClock=e.media.requestInfo.rangeClock,s.media.needToImmediate=e.media.needToImmediate,null!==e.media.requestInfo.rangeClock&&void 0!==e.media.requestInfo.rangeClock&&(s.media.requestInfo.rangeClock=e.media.requestInfo.rangeClock),n.ControlStream(s),f(e.media.requestInfo.scale)):r.warning("speed is invalid command in live")}(e);break;case"seek":!function(e){"live"!==s.media.type?(s.media.type=e.media.type,s.media.requestInfo.cmd="seek",s.media.requestInfo.scale=e.media.requestInfo.scale,s.media.requestInfo.url="rtsp://"+s.device.cameraIp+":554/"+e.media.requestInfo.url,s.media.requestInfo.rangeClock=e.media.requestInfo.rangeClock,s.media.needToImmediate=e.media.needToImmediate,null!==e.media.requestInfo.rangeClock&&void 0!==e.media.requestInfo.rangeClock&&(s.media.requestInfo.rangeClock=e.media.requestInfo.rangeClock),n.ControlStream(s),1!==e.media.requestInfo.scale&&f(e.media.requestInfo.scale),g()):console.log(cmd,"is invalid command in live")}(e);break;case"capture":!function(e){i.sendCommandData(e.media.requestInfo.cmd,e.device.captureName)}(e);break;case"dZoom":!function(e){i.sendCommandData("digitalZoom",e.media.requestInfo.data)}(e);break;case"audioIn":!function(e){var t=e.media.requestInfo.data;i.sendCommandData("audioIn",t)}(e);break;case"audioOut":!function(e){var t=e.media.requestInfo.data;"on"!==t&&"off"!==t||p(null,t)}(e);break;case"forward":!function(e){i.sendCommandData("forward"),"nvr"===e.device.deviceType&&void 0!==e&&(s.media.type=e.media.type,s.media.requestInfo.cmd="forward",s.media.requestInfo.url="rtsp://"+s.device.cameraIp+":554/"+e.media.requestInfo.url,s.media.requestInfo.rangeClock=e.media.requestInfo.rangeClock,s.media.needToImmediate=e.media.needToImmediate,s.media.requestInfo.scale=e.media.requestInfo.scale,n.ControlStream(s))}(e);break;case"backward":!function(e){i.sendCommandData("backward"),"nvr"===e.device.deviceType&&void 0!==e&&(s.media.type=e.media.type,s.media.requestInfo.cmd="backward",s.media.requestInfo.url="rtsp://"+s.device.cameraIp+":554/"+e.media.requestInfo.url,s.media.requestInfo.rangeClock=e.media.requestInfo.rangeClock,s.media.needToImmediate=e.media.needToImmediate,s.media.requestInfo.scale=e.media.requestInfo.scale,n.ControlStream(s))}(e);break;case"step":!function(e){f(1),s.media.type=e.media.type,s.media.requestInfo.cmd="seek",s.media.requestInfo.scale=e.media.requestInfo.scale,s.media.requestInfo.url="rtsp://"+s.device.cameraIp+":554/"+e.media.requestInfo.url,n.ControlStream(s)}(e);break;case"backup":case"backupstart":case"backupstop":!function(e){var t;"live"===e.media.type?(t=null!==c.onBackup&&void 0!==c.onBackup?c.onBackup:c.close,i.sendCommandData("backup",{command:"backupstart"===e.media.requestInfo.cmd?"start":"stop",fileName:e.device.captureName,callback:t}),u=!0):"backup"===e.media.type&&p(e)}(e);break;case"changeStackCount":!function(e){var t=e.media.requestInfo.data;t=parseInt(t,10)}(e);break;case"minimap":!function(e){i.sendCommandData("minimap",e.media.requestInfo.data)}(e);break;default:console.log("Not Supported Commnad")}},controlWorker:function(e){var t,n=e.cmd;switch(n){case"setCallback":2===(t=e.data).length?i.addListener(t[0],t[1]):i.addListener(t[0],t[1],t[2]);break;case"timeStamp":case"initVideo":e.data;break;case"playbackSpeed":f(e.data);break;case"setLiveMode":case"openFPSmeter":case"closeFPSmeter":case"setFpsFrame":e.data;break;case"playbackSeek":g(e.data);break;case"playToggle":case"setPlaybackservice":e.data;break;case"reassignCanvas":break;case"clearBuffer":i.sendCommandData("clearBuffer");break;case"changeVideoMode":v(e.data);break;default:r.error("undefined command: ["+n+"]")}},getCurrentState:function(){return n.getCurrentState()},getVideoWidth:function(){return i.getVideoWidth()},getVideoHeight:function(){return i.getVideoHeight()},getVideoCodecType:function(){return i.getVideoCodecType()},isMute:function(){return i.mute},getAudioVolume:function(){return i.getAudioVolume()},setAudioVolume:function(e){i.setAudioVolume(e)}},new d(e)}function AudioDecoder(){function e(){e.prototype.channelId=0}return e.prototype={setChannel:function(t){e.prototype.channelId=null===t?0:t},getChannel:function(){return e.prototype.channelId},decode:function(e){},close:function(){}},new e}function AACAudioDecoder(){var e=null,t=null,n=null,i=null,r=new Float32Array;function a(){console.log("Construct AAC Codec"),e=Module.cwrap("init_aac_jsFFmpeg","void",[]),t=Module.cwrap("decode_aac_jsFFmpeg","number",["number","array","number","number","number"]),n=Module.cwrap("close_jsFFmpeg","number",["number"]),a.prototype.init()}return a.prototype=inheritObject(new AudioDecoder,{init:function(){console.log("AAC Decoder init"),null!==i&&(n(i),i=null),i=e();var t=Module._malloc(4096);r=new Float32Array(Module.HEAPF32.buffer,t,4096)},decode:function(e){if(null===i)return null;t(i,e,e.length,r.byteOffset,4096);var n=new Float32Array(r),a=new Float32Array(1024);return a.set(n.subarray(0,1024),0),a},close:function(){null!==i&&(n(i),i=null)}}),new a}function G711AudioDecoder(){var e=132,t=128,n=15,i=4,r=112;function a(){}return a.prototype=inheritObject(new AudioDecoder,{decode:function(a){for(var o,s,l,c=new Uint8Array(a),u=new Int16Array(c.length),d=0,p=c.length;d<p;d++)u[d]=(o=c[d],s=void 0,void 0,s=(((l=~o)&n)<<3)+e,s<<=(l&r)>>i,l&t?e-s:s-e);for(var h=new Float32Array(u.length),m=0,f=u.length;m<f;m++)h[m]=u[m]/Math.pow(2,15);return h}}),new a}function G726_16_AudioDecoder(){var e=3,t=[116,365,365,116],n=[-704,14048,14048,-704],i=[0,3584,3584,0],r={},a=null;function o(o,s){var l,c,u,d,p,h,m;switch(o&=3,c=(l=a.predictor_zero(r))>>1,u=l+a.predictor_pole(r)>>1,d=a.step_size(r),m=(h=(p=a.reconstruct(2&o,t[o],d))<0?u-(16383&p):u+p)-u+c,r=a.update(2,d,n[o],i[o],p,h,m,r),s){case e:return h<<2;default:return-1}}function s(){a=new CommonAudioUtil,r=a.g726_init_state()}return s.prototype=inheritObject(new AudioDecoder,{decode:function(t){for(var n=new Int16Array(4*t.length),i=0,r=(t.length,0);i<t.length;i++){var a;a=o(t[i]>>6,e),n[r]=65280&a,r++,a=o(t[i]>>4,e),n[r]=65280&a,r++,a=o(t[i]>>2,e),n[r]=65280&a,r++,a=o(t[i],e),n[r]=65280&a,r++}return n}}),new s}function G726_24_AudioDecoder(){var e=3,t=[-2048,135,273,373,373,273,135,-2048],n=[-128,960,4384,18624,18624,4384,960,-128],i=[0,512,1024,3584,3584,1024,512,0],r={},a=null;function o(o,s){var l,c,u,d,p,h,m;switch(o&=7,c=(l=a.predictor_zero(r))>>1,u=l+a.predictor_pole(r)>>1,d=a.step_size(r),m=(h=(p=a.reconstruct(4&o,t[o],d))<0?u-(16383&p):u+p)-u+c,r=a.update(3,d,n[o],i[o],p,h,m,r),s){case e:return h<<2;default:return-1}}function s(){a=new CommonAudioUtil,r=a.g726_init_state()}return s.prototype=inheritObject(new AudioDecoder,{decode:function(t){for(var n=new Int16Array(8*t.length/3),i=0,r=0,a=t.length;i<a-3;i+=3){var s;s=o(t[i]>>5,e),n[r]=65280&s,r++,s=o(t[i]>>2,e),n[r]=65280&s,r++,s=o(t[i]<<1|t[i+1]>>7,e),n[r]=65280&s,r++,s=o(t[i+1]>>4,e),n[r]=65280&s,r++,s=o(t[i+1]>>1,e),n[r]=65280&s,r++,s=o(t[i+1]<<2|t[i+2]>>6,e),n[r]=65280&s,r++,s=o(t[i+2]>>3,e),n[r]=65280&s,r++,s=o(t[i+2]>>0,e),n[r]=65280&s,r++}return n}}),new s}function G726_32_AudioDecoder(){var e=3,t=[-2048,4,135,213,273,323,373,425,425,373,323,273,213,135,4,-2048],n=[-12,18,41,64,112,198,355,1122,1122,355,198,112,64,41,18,-12],i=[0,0,0,512,512,512,1536,3584,3584,1536,512,512,512,0,0,0],r={},a=null;function o(o,s){var l,c,u,d,p,h,m,f;switch(o&=15,c=(l=a.predictor_zero(r))>>1,u=l+a.predictor_pole(r)>>1,d=a.step_size(r),m=(h=(p=a.reconstruct(8&o,t[o],d))<0?u-(16383&p):u+p)-u+c,r=a.update(4,d,n[o]<<5,i[o],p,h,m,r),s){case e:return f=(f=(f=h<<2)>32767?32767:f)<-32768?-32768:f;default:return-1}}function s(){a=new CommonAudioUtil,r=a.g726_init_state()}return s.prototype=inheritObject(new AudioDecoder,{decode:function(t){for(var n=new Int16Array(2*t.length),i=0,r=0,a=t.length;i<a;i++){var s;s=o((240&t[i])>>4,e),n[r]=65280&s,r++,s=o(15&t[i],e),n[r]=65280&s,r++}return n}}),new s}function G726_40_AudioDecoder(){var e=3,t=[-2048,-66,28,104,169,224,274,318,358,395,429,459,488,514,539,566,566,539,514,488,459,429,395,358,318,274,224,169,104,28,-66,-2048],n=[448,448,768,1248,1280,1312,1856,3200,4512,5728,7008,8960,11456,14080,16928,22272,22272,16928,14080,11456,8960,7008,5728,4512,3200,1856,1312,1280,1248,768,448,448],i=[0,0,0,0,0,512,512,512,512,512,1024,1536,2048,2560,3072,3072,3072,3072,2560,2048,1536,1024,512,512,512,512,512,0,0,0,0,0],r={},a=null;function o(o,s){var l,c,u,d,p,h,m;switch(o&=31,c=(l=a.predictor_zero(r))>>1,u=l+a.predictor_pole(r)>>1,d=a.step_size(r),m=(p=(h=a.reconstruct(16&o,t[o],d))<0?u-(32767&h):u+h)-u+c,r=a.update(5,d,n[o],i[o],h,p,m,r),s){case e:return p<<2;default:return-1}}function s(){a=new CommonAudioUtil,r=a.g726_init_state()}return s.prototype=inheritObject(new AudioDecoder,{decode:function(t){for(var n=new Int16Array(1.6*t.length),i=0,r=0,a=t.length;i<a-5;i+=5){var s;s=o(t[i]>>3,e),n[r]=65280&s,r++,s=o(t[i]<<2|t[i+1]>>6,e),n[r]=65280&s,r++,s=o(t[i+1]>>1,e),n[r]=65280&s,r++,s=o(t[i+1]<<4|t[i+2]>>4,e),n[r]=65280&s,r++,s=o(t[i+2]<<1|t[i+3]>>7,e),n[r]=65280&s,r++,s=o(t[i+3]>>2,e),n[r]=65280&s,r++,s=o(t[i+3]<<3|t[i+4]>>5,e),n[r]=65280&s,r++,s=o(t[i+4]>>0,e),n[r]=65280&s,r++}return n}}),new s}function G726xAudioDecoder(e){var t=null;function n(e){switch(e){case 16:t=new G726_16_AudioDecoder;break;case 24:t=new G726_24_AudioDecoder;break;case 32:t=new G726_32_AudioDecoder;break;case 40:t=new G726_40_AudioDecoder;break;default:console.log("wrong bits")}}return n.prototype={decode:function(e){for(var n=t.decode(e),i=new Float32Array(n.length),r=0,a=n.length;r<a;r++)i[r]=n[r]/Math.pow(2,15);return i}},new n(e)}function AudioPlayer(){function e(){this,e.prototype.channelId=0}return e.prototype={setChannel:function(t){e.prototype.channelId=null===t?0:t},getChannel:function(){return e.prototype.channelId},addEventListener:function(e,t){switch(e){case"error":void 0!==t&&t;break;default:log.error("undefined callback function")}},audioInit:function(){},isInit:function(){},Play:function(){},Stop:function(){},BufferAudio:function(e){},ControlVolume:function(){}},new e}function AudioPlayerAAC(){var e,t,n,i,r=null,a=0,o=new Uint8Array,s=0,l=0,c=null,u=!1,d=null,p=0;function h(e){switch(console.error(e),e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:console.error("audio tag error : You aborted the media playback.");break;case e.target.error.MEDIA_ERR_NETWORK:console.error("audio tag error : A network error caused the media download to fail.");break;case e.target.error.MEDIA_ERR_DECODE:console.error("audio tag error : The media playback was aborted due to a corruption problem or because the media used features your browser did not support.");break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("audio tag error : The media could not be loaded, either because the server or network failed or because the format is not supported.");break;default:console.error("audio tag error : An unknown media error occurred.")}}function m(){if(console.info("sourceopened"),null===r)try{!0,(r=t.addSourceBuffer(e)).addEventListener("updateend",f)}catch(e){return void console.error("Exception calling addSourceBuffer : "+e)}}function f(){n.paused&&n.play()}function g(){console.info("sourceclose"),!1}function v(){console.info("sourceended")}function y(){console.info("error")}function b(){console.info("abort")}function w(){i=this}return w.prototype=inheritObject(new AudioPlayer,{audioInit:function(r,a,o){e=/Apple Computer/.test(navigator.vendor)&&/Safari/.test(navigator.userAgent)?"audio/x-aac":"audio/aac",n=document.createElement("audio"),document.body.appendChild(n),n.addEventListener("error",h);var s=function(){var n=!1;if(window.MediaSource=window.MediaSource||window.WebKitMediaSource,!window.MediaSource)throw new umpError({channelId:i.getChannel(),errorCode:fromHex("0x030D"),place:"mediaRouter.js:440",message:"MediaSource API is not supported!"});return window.MediaSource.isTypeSupported(e)?((t=new MediaSource).addEventListener("sourceopen",m),t.addEventListener("sourceclose",g),t.addEventListener("sourceended",v),t.addEventListener("error",y),t.addEventListener("abort",b),n=!0):console.error("Unsupported MIME type or codec: ",e),n}();return s&&null!==n&&(n.src=window.URL.createObjectURL(t),this.ControlVolume(o),n.pause()),s},isInit:function(){return null!==r==!0},Play:function(){this.ControlVolume(a)},Stop:function(){n.volume=0,a=0},BufferAudio:function(e,t){!1;var i,a,l,h=t-s;if((h>200||h<0)&&(o=new Uint8Array,d=new Array,u=!0),u&&(d.push(p),p+=e.length),s=t,i=o,a=e,(l=new Uint8Array(i.byteLength+a.byteLength)).set(new Uint8Array(i),0),l.set(new Uint8Array(a),i.byteLength),o=l,null!==r&&!u&&!r.updating)try{null!==d?null!==c&&(parseInt(d.length/16)-parseInt(c)>=2&&(c+=1),(p=parseInt(16*c,10))<d.length?(r.appendBuffer(o.subarray(d[p],o.length)),r.buffered.length>0&&(n.currentTime=r.buffered.end(0))):r.buffered.length>0&&(n.currentTime=r.buffered.end(0)-.3)):r.appendBuffer(o),o=new Uint8Array,d=null,p=0}catch(e){console.error("Exception while appending : "+e)}},ControlVolume:function(e){if(a=e,null!==n){var t=e/5;n.volume=t<=0?0:t>=1?1:t}},GetVolume:function(){return a},terminate:function(){},setBufferingFlag:function(e,t){"init"==t?l=e:u&&(0===e||"undefined"===e||null===e?c=null:(c=e-l,l=0),u=!1)},getBufferingFlag:function(){return u},setInitVideoTimeStamp:function(e){l=e},getInitVideoTimeStamp:function(){return l}}),new w}function AudioPlayerGxx(){var e,t,n,i,r=log4javascript.getLogger(),a=0,o={type:"G.711",samplingRate:8e3,bitrate:"64000"},s=0,l=!1,c=0,u=0,d=null,p=!1,h=new Float32Array(8e4),m=0,f=null,g=null;function v(t,i){var a=i-c;if((a>200||a<0)&&(s=0,m=0,p=!0,null!==f&&f.stop()),s-e.currentTime<0&&(s=0),c=i,h=function(e,t,n){if(n+t.length>=e.length){var i=new Float32Array(e.length+8e4);i.set(e,0),e=i}return e.set(t,n),e}(h,t,m),m+=t.length,!p){var l=0;if(m/t.length>1&&(null!==d&&(l=8e3*d,r.debug("audioBuffering :: Origin Buffering Time G7xx: "+m/8e3+" sec"),r.debug("audioBuffering :: Waste Buffering Time G7xx: "+l/8e3+" sec")),l>=m||null===d))return void(m=0);h=/Apple Computer/.test(navigator.vendor)&&/Safari/.test(navigator.userAgent)?function(e){for(var t,n,i,r,a=(1-Math.cos(.2*Math.PI))/2,o=new Float32Array(4*e.length),s=0,l=0,c=e.length;s<c;s++)l=4*s,t=e[s],n=s<e.length-1?e[s+1]:t,i=s<e.length-2?e[s+2]:t,r=s<e.length-3?e[s+3]:t,r=(i=(n=t*(1-a)+n*a)*(1-a)+i*a)*(1-a)+r*a,o[l]=t,o[l+1]=n,o[l+2]=i,o[l+3]=r;return o}(h.subarray(l,m)):h.subarray(l,m);var u=e.createBuffer(1,h.length,o.samplingRate);u.getChannelData(0).set(h),m=0,(f=e.createBufferSource()).buffer=u,f.connect(n),s||(s=e.currentTime+.1),f.start(s),s+=u.duration}}function y(){i=this}return y.prototype=inheritObject(new AudioPlayer,{audioInit:function(a,c,u){if(r.debug("init Gxx player"),s=0,g=null,o.samplingRate=8e3,"G711"===a?g=new G711AudioDecoder:"AAC"===a?(g=new AACAudioDecoder,o.samplingRate=16e3):g=new G726xAudioDecoder(c),/Apple Computer/.test(navigator.vendor)&&/Safari/.test(navigator.userAgent)&&(o.samplingRate=4*o.samplingRate),o.type=a,void 0!==e&&null!==e)return r.debug("Audio context already defined!'"),!1;try{return window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,(e=new AudioContext).onstatechange=function(){null!==e&&void 0!==e&&(r.info("channel",i.getChannel()," Audio Context State changed :: ",e.state),"running"===e.state?l=!0:"closed"===e.state&&(l=!1,e=null))},void 0!==e&&null!==e&&(t=e.createGain(),(n=e.createBiquadFilter()).connect(t),n.type="lowpass",n.frequency.value=1e3,n.gain.value=25,t.connect(e.destination)),this.ControlVolume(u),!0}catch(e){throw console.warn("Web Audio API is not supported in this web browser! : ",e),new umpError({channelId:this.channelId,errorCode:fromHex("0x030F"),place:"audioPlayerGxx.js:201",message:"Audio error  ["+e.code+"], name ["+e.name+", message ["+e.message+"]"})}},isInit:function(){return null!==g==!0},Play:function(){this.ControlVolume(a)},Stop:function(){a=0,void 0!==t&&null!==t&&(t.gain.value=0),s=0},BufferAudio:function(e,t){l&&v(g.decode(e),t)},ControlVolume:function(e){if(void 0!==t&&null!==t){a=e;var n=e/5;n<=0?(t.gain.value=0,s=0):t.gain.value=n>=1?1:n}},GetVolume:function(){return a},terminate:function(){void 0!==e&&"closed"!==e.state&&(s=0,l=!1,e.close()),"AAC"===o.type&&g.close()},setBufferingFlag:function(e,t){"init"==t?(r.debug("audioBuffering :: init time ="+e),u=e):p&&(r.debug("audioBuffering :: currentTime = "+e),0===e||"undefined"===e||null===e?d=null:(d=e-u,u=0),p=!1)},getBufferingFlag:function(){return p},setInitVideoTimeStamp:function(e){u=e},getInitVideoTimeStamp:function(){return u}}),new y}var AACSession=function(){var e,t,n,i,r,a,o,s,l,c,u,d,p=log4javascript.getLogger("aacrtpsession"),h=new Uint8Array(7),m=!1,f=4,g={},v={},y=0,b=new Uint8Array(new ArrayBuffer(4)),w=new Uint8Array(new ArrayBuffer(4)),C=new Uint8Array(new ArrayBuffer(2));function S(){}return S.prototype=inheritObject(new RtpSession,{init:function(n){p.info("Set codec info. for AAC"),e=n.config,t=n.bitrate,n.clockFreq,m=!1,this.timeData={timestamp:null,timestamp_usec:null,timezone:null}},depacketize:function(S,_,T){p.debug("AACSession::depacketize"),f=4;var x=0,E=0;if(this.interleavedId,S[1],i=(192&_[0])>>6,r=(32&_[0])>>5==1,o=(16&_[0])>>4==1,a=15&_[0],s=(128&_[1])>>7==1,c=127&_[1],36!==S[0])throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0102"),place:"accSession.js:105",message:"it is not valid interleave header (RTSP over TCP). Interleaved[0] = "+S[0].toString(16)});if(0!==a)throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0103"),place:"accSession.js:112",message:"There is additional CSRC which is not handled in this version. CSRC count = "+a});if(r&&(x=T[T.length-1],p.debug("AAC PaddingSize - "+x)),o&&(E=4*(T[2]<<8|T[3])+4,"0xAB"==T[0]&&("0xAD"==T[1]||"0xAC"==T[1]))){var I=4;b.set(T.subarray(I,I+4),0),I+=4,w.set(T.subarray(I,I+4),0),"camera"===this.getDeviceType()&&(I+=6,C.set(T.subarray(I,I+2),0));var k={};if(k.timestamp=this.ntohl(b)-2208988800>>>0,k.timestamp_usec=this.ntohl(w)/4294967295*1e3,"camera"===this.getDeviceType()&&(k.timezone=(C[0]<<8|C[1])<<16>>16),null!=this.GetTimeStamp().timestamp&&null!==this.GetTimeStamp().timestamp_usec)if(p.debug("",k.timestamp,k.timestamp_usec,this.GetTimeStamp().timestamp,this.GetTimeStamp().timestamp_usec),Math.abs(k.timestamp-this.GetTimeStamp().timestamp)<=1){var A=Math.abs(1e3*k.timestamp+k.timestamp_usec-(1e3*this.GetTimeStamp().timestamp+this.GetTimeStamp().timestamp_usec));0!=A&&(this.setFramerate(Math.round(1e3/A)),p.debug("playback framerate = ",this.getFramerate()))}this.SetTimeStamp(k),m=!0}if(T.subarray(E,T.length-x),y=this.ntohl(_.subarray(4,8)),l=this.ntohl(_.subarray(2,3)),p.debug("interleaved id = ",this.interleavedId,", AAC RTP Version: ",("00"+i).slice(-2),", Padding: ",r,", ExtensionBit: ",o,", CSRC Count: ",a,", Marker Bit: ",s,", RTP Payload Type: ",c,", RTP Sequence Number: ",l,", RTP Timestamp: ",y,", RTCP Timestamp: "+this.rtcpSession.rtpTimestamp),s){this.rtpTimestamp=(y/90).toFixed(0),u=T.length-(f+E);var R=(d=T.subarray(f+E,T.length)).subarray(0,2);255===R[0]&&!0&R[1]||(d=function(t,n){if("string"==typeof e){var i=parseInt(e.substring(0,2),16),r=i>>3,a=(7&i)<<1|(128&parseInt(e.substring(2,4),16))>>7;h[0]=255,h[1]=249,h[2]=r-1<<6,h[2]|=a<<2,h[2]|=0,h[3]=64,h[3]|=(t+7&6144)>>11,h[4]=(t+7&2040)>>3,h[5]=(t+7&7)<<5,h[5]|=1,h[6]=84;var o=new Uint8Array(h.length+n.length);return o.set(h,0),o.set(n,h.length),o}p.warn("wrong type of config in SDP")}(u,d)),n=!0===m?"Playback":"Live",g={codecType:"AAC",frameData:d,channelId:this.channelId,timeStamp:{rtpTimestamp:this.rtpTimestamp,timestamp:this.timeData.timestamp,timestamp_usec:this.timeData.timestamp_usec,timezone:this.timeData.timezone},rtcp_interleavedId:this.rtcpSession.interleavedId},v={bitrate:t},this.eventAudioCallback(n,g,v)}}}),new S},AudioTalkSession=function(e){var t,n,i,r,a=65502,o=Math.floor(1e6*Math.random()+1),s=null,l=new G711AudioEncoder,c=function(e,t,n,i){for(var r,a=i;a>i-t;a-=1)r=255&e,n[a]=r,e=(e-r)/256};function u(e){s=e}return u.prototype=inheritObject(new RtpSession,{setSampleRate:function(e){l.setSampleRate(e)},getRTPPacket:function(e){var u,d=l.encode(e);return(t=new Uint8Array(new ArrayBuffer(4)))[0]=36,t[1]=s,u=12+d.length,c(u,2,t,3),(n=new Uint8Array(new ArrayBuffer(12)))[0]=128,n[1]=128,c(a+=1,2,n,3),i=new Date,c(i,4,n,7),c(o,4,n,11),(r=new Uint8Array(new ArrayBuffer(12+d.length+4))).set(t,0),r.set(n,4),r.set(d,16),r}}),new u(e)},G711Session=function(){var e,t,n,i,r,a,o,s,l,c=log4javascript.getLogger("g711rtpsession"),u=0,d=!1,p={},h={},m=0,f=new Uint8Array(new ArrayBuffer(4)),g=new Uint8Array(new ArrayBuffer(4)),v=new Uint8Array(new ArrayBuffer(2));function y(){}return y.prototype=inheritObject(new RtpSession,{init:function(e){c.info("Set codec info. for G711"),u=e.bitrate,e.clockFreq,d=!1,this.timeData={timestamp:null,timestamp_usec:null,timezone:null}},depacketize:function(y,b,w){c.debug("G711Session::depacketize");var C=0,S=0;if(this.interleavedId,y[1],n=(192&b[0])>>6,i=(32&b[0])>>5==1,a=(16&b[0])>>4==1,r=15&b[0],o=(128&b[1])>>7==1,l=127&b[1],36!==y[0])throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0102"),place:"g711Session.js:66",message:"it is not valid interleave header (RTSP over TCP). Interleaved[0] = "+y[0].toString(16)});if(0!==r)throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0103"),place:"g711Session.js:73",message:"There is additional CSRC which is not handled in this version. CSRC count = "+r});if(i&&(C=w[w.length-1],c.debug("G.711 PaddingSize - "+C)),a&&(S=4*(w[2]<<8|w[3])+4,"0xAB"==w[0]&&("0xAD"==w[1]||"0xAC"==w[1]))){var _=4;f.set(w.subarray(_,_+4),0),_+=4,g.set(w.subarray(_,_+4),0),"camera"===this.getDeviceType()&&(_+=6,v.set(w.subarray(_,_+2),0));var T={};if(T.timestamp=this.ntohl(f)-2208988800>>>0,T.timestamp_usec=this.ntohl(g)/4294967295*1e3,"camera"===this.getDeviceType()&&(T.timezone=(v[0]<<8|v[1])<<16>>16),null!=this.GetTimeStamp().timestamp&&null!==this.GetTimeStamp().timestamp_usec)if(c.debug("",T.timestamp,T.timestamp_usec,this.GetTimeStamp().timestamp,this.GetTimeStamp().timestamp_usec),Math.abs(T.timestamp-this.GetTimeStamp().timestamp)<=1){var x=Math.abs(1e3*T.timestamp+T.timestamp_usec-(1e3*this.GetTimeStamp().timestamp+this.GetTimeStamp().timestamp_usec));0!=x&&(this.setFramerate(Math.round(1e3/x)),c.debug("playback framerate = ",this.getFramerate()))}this.SetTimeStamp(T),d=!0}e=w.subarray(S,w.length),w.subarray(S,w.length-C),m=this.ntohl(b.subarray(4,8)),s=this.ntohl(b.subarray(2,3)),c.debug("interleaved id = ",this.interleavedId,", HEVC RTP Version: ",("00"+n).slice(-2),", Padding: ",i,", ExtensionBit: ",a,", CSRC Count: ",r,", Marker Bit: ",o,", RTP Payload Type: ",l,", RTP Sequence Number: ",s,", RTP Timestamp: ",m,", RTCP Timestamp: "+this.rtcpSession.rtpTimestamp),o&&(this.rtpTimestamp=(m/90).toFixed(0),t=!0===d?"Playback":"Live",p={codecType:"G711",frameData:e,channelId:this.channelId,timeStamp:{rtpTimestamp:this.rtpTimestamp,timestamp:this.timeData.timestamp,timestamp_usec:this.timeData.timestamp_usec,timezone:this.timeData.timezone},rtcp_interleavedId:this.rtcpSession.interleavedId},h={bitrate:u},this.eventAudioCallback(t,p,h))}}),new y},G726Session=function(){var e,t,n,i,r,a,o,s,l,c=log4javascript.getLogger("g726rtpsession"),u=0,d=!1,p={},h={},m=0,f=new Uint8Array(new ArrayBuffer(4)),g=new Uint8Array(new ArrayBuffer(4)),v=new Uint8Array(new ArrayBuffer(2));function y(){}return y.prototype=inheritObject(new RtpSession,{init:function(e){c.info("Set codec info. for G726"),e.clockFreq,u=e.bitrate,d=!1,this.timeData={timestamp:null,timestamp_usec:null,timezone:null}},depacketize:function(y,b,w){c.debug("G726Session::depacketize");var C=0,S=0;if(this.interleavedId,y[1],n=(192&b[0])>>6,i=(32&b[0])>>5==1,a=(16&b[0])>>4==1,r=15&b[0],o=(128&b[1])>>7==1,l=127&b[1],36!==y[0])throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0102"),place:"g726Session.js:65",message:"it is not valid interleave header (RTSP over TCP). Interleaved[0] = "+y[0].toString(16)});if(0!==r)throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0103"),place:"g726Session.js:72",message:"There is additional CSRC which is not handled in this version. CSRC count = "+r});if(i&&(C=w[w.length-1],c.debug("G.726 PaddingSize - "+C)),a&&(S=4*(w[2]<<8|w[3])+4,"0xAB"==w[0]&&("0xAD"==w[1]||"0xAC"==w[1]))){var _=4;f.set(w.subarray(_,_+4),0),_+=4,g.set(w.subarray(_,_+4),0),"camera"===this.getDeviceType()&&(_+=6,v.set(w.subarray(_,_+2),0));var T={};if(T.timestamp=this.ntohl(f)-2208988800>>>0,T.timestamp_usec=this.ntohl(g)/4294967295*1e3,"camera"===this.getDeviceType()&&(T.timezone=(v[0]<<8|v[1])<<16>>16),null!=this.GetTimeStamp().timestamp&&null!==this.GetTimeStamp().timestamp_usec)if(c.debug("",T.timestamp,T.timestamp_usec,this.GetTimeStamp().timestamp,this.GetTimeStamp().timestamp_usec),Math.abs(T.timestamp-this.GetTimeStamp().timestamp)<=1){var x=Math.abs(1e3*T.timestamp+T.timestamp_usec-(1e3*this.GetTimeStamp().timestamp+this.GetTimeStamp().timestamp_usec));0!=x&&(this.setFramerate(Math.round(1e3/x)),c.debug("playback framerate = ",this.getFramerate()))}this.SetTimeStamp(T),d=!0}e=w.subarray(S,w.length),w.subarray(S,w.length-C),m=this.ntohl(b.subarray(4,8)),s=this.ntohl(b.subarray(2,3)),c.debug("interleaved id = ",this.interleavedId,", G.726 RTP Version: ",("00"+n).slice(-2),", Padding: ",i,", ExtensionBit: ",a,", CSRC Count: ",r,", Marker Bit: ",o,", RTP Payload Type: ",l,", RTP Sequence Number: ",s,", RTP Timestamp: ",m,", RTCP Timestamp: "+this.rtcpSession.rtpTimestamp),o&&(this.rtpTimestamp=(m/90).toFixed(0),t=!0===d?"Playback":"Live",p={codecType:"G726",frameData:e,channelId:this.channelId,timeStamp:{rtpTimestamp:this.rtpTimestamp,timestamp:this.timeData.timestamp,timestamp_usec:this.timeData.timestamp_usec,timezone:this.timeData.timezone},rtcp_interleavedId:this.rtcpSession.interleavedId},h={bitrate:u},this.eventAudioCallback(t,p,h))}}),new y};function MediaRouter(){var e,t,n,i,r,a=log4javascript.getLogger("router"),o=BrowserDetect(),s=null,l=null,c=null,u=null,d=null,p=null,h=2073600,m={Live:1048576,Playback:786432},f=null,g="canvas",v=null,y=1,b=1,w=null,C=null,S=null,_=null,T=null,x=null,E=null,I=null,k=null,A=null,R=!1,L=null,P=null,M=null,D=null,N=null,H=null,U=null,F=!1,O="forward",B="request",j=null,V=null,q={codec:"",size:0,isLimitSpeed:!1},z=2073600;function G(){r=this,G.prototype.audioVolume=0,G.prototype.minRemainTime=5,G.prototype.minTimerInterval=1,G.prototype.mute=!0,G.prototype.drop=!1,G.prototype.boxsize=4}function W(){null!==s&&s.close(),s=null,c=null,l=null,g="canvas",i=r.getDeviceType()}function J(e){g=e,null!==N&&void 0!==N&&(a.info("videoModeCallback channelId: ",r.getChannel()),N({channelId:r.getChannel(),elementId:r.getElement(),mode:g})),"canvas"===g?void 0===(f=getElementByAttributeValue("canvas","kind-channel-mapped-id",r.getElement()))&&void 0===(f=getElementByAttributeValue("canvas","kind-channel-mapped-id",r.getChannel()))&&(f=getElementByAttributeValue("canvas","kind-channel-id",r.getChannel())):void 0!==(f=getElementByAttributeValue("video","kind-channel-mapped-id",r.getElement()))&&null!==f||void 0!==(f=getElementByAttributeValue("video","kind-channel-mapped-id",r.getChannel()))&&null!==f||(f=getElementByAttributeValue("video","kind-channel-id",r.getChannel())),a.debug("setVideoMode: channel",r.getChannel(),", video element id: ",f.id)}function Y(e,t){var n={width:0,height:0,decodeSize:0,cropWidth:0,cropHeight:0};return"MJPEG"!==e&&(!function(e,t){l!==t&&(p="H264"===t?new H264SPSParser:new H265SPSParser),p.parse(e)}(t.spsPayload,e),t.width=p.getSizeInfo().width,t.width+=p.getSizeInfo().cropWidth,t.height=p.getSizeInfo().height,n=p.getSizeInfo()),n.decodeSize=t.width*t.height,n}function K(o,l,c,u,d){var f=void 0===d?0:d,v=null;if(null!==s&&(s.close(),s=null),g="canvas",!0===F)return v=new CanvasTagPlayer;switch("Playback"===l&&function(e,t){q.codec===e&&q.size===t||("MJPEG"===e&&t>z?null!==q.isLimitSpeed&&!1!==q.isLimitSpeed||(q.isLimitSpeed=!0,L({errorCode:fromHex("0x0302"),oldErrorCode:"103",isLimit:!0,description:"limit speed",place:"mediaRouter.js:197",channelId:r.getChannel()})):null!==q.isLimitSpeed&&!0!==q.isLimitSpeed||(q.isLimitSpeed=!1,L({errorCode:fromHex("0x0302"),oldErrorCode:"103",isLimit:!1,description:"default speed list",place:"mediaRouter.js:210",channelId:r.getChannel()})),q.codec=e,q.size=t)}(c,u),c){case"MJPEG":g="canvas";break;case"H264":case"H265":var y='video/mp4;codecs="'+p.getCodecInfo()+'"';MediaSource.isTypeSupported(y)?g="H264"===c?"nvr"===r.getDeviceType()?"video":null!==w?w:u>m[l]?"video":"canvas":"video":"H264"===c&&u>h||"H265"===c&&"Main"!==p.getProfileName()?L({errorCode:fromHex("0x0301"),oldErrorCode:"996",description:"Not enough decoding for currnet profile, Change UWA profile",place:"mediaRouter.js:331",channelId:r.getChannel()}):g="canvas";break;default:a.error("Undefineded Audio codecType = "+c)}return"video"===g?((v=new VideoTagPlayer).setDeviceType(i),C&&v.setRequestTime&&v.setRequestTime(C)):v=new CanvasTagPlayer,J(g),"nvr"===r.getDeviceType()&&v.setDefaultDelay(1),v.useDropPacket(r.isDropPacket()),v.addEventListener("statistics",e),v.addEventListener("capture",t),v.addEventListener("instantplayback",n),v.setFrameRate(f),a.debug("max Instant playback time: "+r.getMaxInstantPlaybackTime()+", interval: "+r.getBufferClearInterval()),v.setMaxInstantPlayback(r.getMaxInstantPlaybackTime()),v.setBufferClearInterval(r.getBufferClearInterval()),v.setBoxSize(r.getBoxSize()),a.info("Channel Idx: "+o+", Video Tag type = "+g),v}function X(e){null!==P&&(v=e,P(e,F))}function $(){B="request",F=!0,W(),D("request",U)}return G.prototype={setChannel:function(e){G.prototype.channelId=null===e?0:e},getChannel:function(){return G.prototype.channelId},onVideoData:function(e,t,n){a.debug("mediaRouter::onVideoData: channel [",this.getChannel(),"] rtp timestamp: [",t.timeStamp.rtpTimestamp,"] play mode: [",e,"] video info: ",JSON.stringify(n));var i=0,o=null;if(!0===R&&null!==A&&(o=cloneArray(t.frameData)),S&&_&&t.timeStamp.rtpTimestamp&&(t.timeStamp.utcDatetime=new Date(S.valueOf()+(t.timeStamp.rtpTimestamp-_)),a.debug("mediaRouter::onVideoData: channel [",this.getChannel(),"] NTPDateTime : [",S.valueOf(),"] video rtptime : [",t.timeStamp.rtpTimestamp,"] rtcp rtptime : []",_,"utcDatetime: [",t.timeStamp.utcDatetime.toISOString(),"] ")),"I"===n.frameType){if(i=Y(t.codecType,n),!(!1!==R&&"Live"!==e||l===t.codecType&&i.decodeSize===c&&n.width===u&&n.height===d&&null!==s)){if(null===(s=K(this.channelId,e,t.codecType,i.decodeSize,n.framerate)))return;if(s.playmode=e.toString().toLowerCase(),s.channelId=this.channelId,s.setTimeStampCallback(X),s.setErrorCallback(L),s.setResizeCallback(M),1!==y&&"video"===g&&s.setSpeedPlay(y),J(g),s.init(f),l=t.codecType,c=i.decodeSize,n.width!==u||n.height!==d){u=n.width,d=n.height;var h={channelId:this.channelId,elementId:r.getElement(),tagmode:g,width:u,height:d};void 0!==M&&null!==M&&M(h)}}}else null!==u&&(n.width=u,n.height=d);if(null!==s){n.dropOut=b,"video"===g&&"I"===n.frameType&&(n.codecInfo=p.getCodecInfo(),"H264"===t.codecType?(n.profileIdc=p.getSpsValue("profile_idc"),n.levelIdc=p.getSpsValue("level_idc")):"H265"===t.codecType&&(n.profileTierLevel=p.getProfileTierLevel()));var m=function(e,t){return"Playback"===e&&"H265"===t&&"canvas"===g}(e,t.codecType);if(!0===F)if("camera"===this.getDeviceType())!1===s.bufferingVideoData(e,t,n)&&"request"===B&&(B="complete",D("complete"),s.controlStepPlay(v,O));else s.onVideoData(e,t,n),B="complete",D("complete");else!1===F&&!1===m?s.onVideoData(e,t,n):s.sendToBufferManager(e,t,n,L)}null!==o&&(t.frameData=o,A.onVideoData(t,n))},onAudioData:function(e,t,n){a.debug("mediaRouter::onAudioData: channel [",this.getChannel(),"] rtp timestamp: [",t.timeStamp.rtpTimestamp,"] play mode: [",e,"] audio info: ",JSON.stringify(n));var i=null;try{if(!0===R&&null!==A&&(i=cloneArray(t.frameData)),this.mute){if(null!==T)return void this.deleteAudioPlayer()}else null!==T&&void 0!==T||this.createAudioPlayer(t.codecType),(x!==t.codecType||"G726"===t.codecType&&E!==n.bitrate)&&(x=t.codecType,E=n.bitrate,T.setInitVideoTimeStamp(0),T.audioInit(t.codecType,n.bitrate,this.getAudioVolume()),T.Play());null!==T&&!0===T.isInit()&&T.getChannel()===this.getChannel()&&(!1!==R&&"Live"!==e||(a.debug("input audio data from channel: ",this.getChannel()),T.BufferAudio(t.frameData,t.timeStamp.rtpTimestamp),T.setBufferingFlag(t.timeStamp.rtpTimestamp,"currentTime"))),null!==i&&(t.frameData=i,A.receiveAudioData(t,n))}catch(e){throw new umpError({channelId:this.channelId,errorCode:fromHex("0x030B"),place:"mediaRouter.js:609",message:"onAudioData from mediaRouter: errorcode ["+e.errorCode+"], message  ["+e.message+"]"})}},onMetadata:function(e){a.debug("mediaRouter::onMetadata: channel [",this.getChannel(),"] rtp timestamp: [",e.timeStamp.rtpTimestamp,"]"),null!==k&&k.parse(e.frameData)},onRtcpData:function(e){a.debug("mediaRouter::onRtcpData: channel [",this.getChannel(),"] rtcp info: ",JSON.stringify(e));var t=new Date(1e3*e.timeStamp.timestamp+e.timeStamp.timestamp_usec);1===e.interleaved?(S=t,_=e.rtpTimestamp):3===e.interleaved&&(t,e.rtpTimestamp)},controlAudioPlayer:function(e){if(null!==T)if("on"===e||"unmute"===e)a.info("already start audio decoder, set volume"),this.mute=!1;else if("off"===e||"mute"===e)this.mute=!0,a.info("destory audio player and mute channel: ",this.getChannel());else{if(!Number.isInteger(Number(e)))throw a.warn("this is not audio volume value"),new umpError({channelId:this.getChannel(),errorCode:fromHex("0x030E"),place:"mediaRouter.js:362",message:"audio volume do not set"});this.setAudioVolume(e),T.ControlVolume(e)}else if("unmute"!==e&&"on"!==e||(this.mute=!1),"on"!==e&&"off"!==e&&"mute"!==e&&"unmute"!==e){if(!Number.isInteger(Number(e)))throw a.warn("this is not audio volume value"),new umpError({channelId:this.getChannel(),errorCode:fromHex("0x030E"),place:"mediaRouter.js:389",message:"audio volume do not set"});this.setAudioVolume(e)}},createAudioPlayer:function(e){if(null===T){switch(a.info("generate audio player and unmute channel: ",this.getChannel()),e){case"G711":case"G726":case"AAC":T=new AudioPlayerGxx;break;default:a.warn("this audio codec is not supported from this client.")}T.setChannel(this.getChannel()),0!==this.getAudioVolume()&&T.ControlVolume(this.getAudioVolume())}},deleteAudioPlayer:function(){null!==T&&(T.Stop(),T.terminate(),T=null,x=null,E=null)},startAudioTalk:function(e){return new Promise(function(t,n){(I=new Talk).init()?(I.setSendAudioTalkBufferCallback(e),I.initAudioOut().then(function(e){t(e)}).catch(function(e){L({errorCode:fromHex("0x020A"),description:"Talk service unavailable",place:"mediaRouter:649",channelId:r.getChannel()}),n(new Error("Failure"))})):(L({errorCode:fromHex("0x020A"),description:"Talk service unavailable",place:"mediaRouter:658",channelId:r.getChannel()}),n(new Error("Web Audio API is not supported in this web browser")))})},onStatistics:function(t){this.changeBoxSize(t.fps),void 0!==e&&(a.debug("Statistics: "+JSON.stringify(t)),e(t))},changeBoxSize:function(e){void 0!==s&&null!==s&&(e>30&&5!==s.getBoxSize()?s.setBoxSize(5):e>20&&e<=30&&4!==s.getBoxSize()?s.setBoxSize(4):e>10&&e<=20&&3!==s.getBoxSize()?s.setBoxSize(3):e>5&&e<=10&&2!==s.getBoxSize()?s.setBoxSize(2):e<5&&1!==s.getBoxSize()?s.setBoxSize(1):a.debug("mediaRouter::changeBoxSize, current fps: "+e+", same boxsize: "+s.getBoxSize()))},sendCommandData:function(e,t){var n="";switch(e){case"capture":null!==s&&s.capture(t);break;case"backup":"start"===(n=t.command)?(R=!0,(A=new BackupProvider(t.callback)).init(t.callback,t.fileName)):null!==A&&"stop"===n&&(R=!1,A.closeStream());break;case"forward":O="forward",!1===F?$():s.forward()||(B="request",D("request",U));break;case"backward":O="backward",!1===F?$():s.backward()||(B="request",D("request",U));break;case"speed":y=t,null!==s&&"video"===g&&s.setSpeedPlay(t),b=1,(y>=4||y<=-4)&&(b=2);break;case"pause":return null!==s&&(s.pause(),!0);case"resume":!0===F?(F=!1,W()):(null!==s&&s.resume(),!0===t&&W());break;case"seek":W();break;case"audioIn":this.controlAudioPlayer(t);break;case"digitalZoom":null!==s&&"video"!==g&&s.digitalZoom(t);break;case"clearBuffer":!0===F&&(s.clearBuffer(),F=!1);break;case"changeVideoMode":w=t;break;case"minimap":"on"===t.mode?(null!==s&&s.updateMiniMapInfo({mode:"draw",target:j}),V&&(clearInterval(V),V=null),V=setInterval(function(){s&&s.updateMiniMapInfo({mode:"draw",target:j})},3e3),j=t.target||null):"off"===t.mode&&(clearInterval(V),V=null,j=null),null!==s&&s.updateMiniMapInfo(t);break;case"requestTimeChanged":"firefox"!==o&&(C=t);break;default:a.error("mediaRouter::sendCommadnData type is unknwon")}},addListener:function(i,o,s){switch(i){case"timeStamp":P=o;break;case"resize":M=o;break;case"stepRequest":D=o,U=s;break;case"metaEvent":(k=new MetaDataParser(o)).setChannel(r.getChannel());break;case"videoMode":N=o;break;case"rtpClient":H=o;break;case"error":L=o;break;case"statistics":e=o;break;case"capture":t=o;break;case"instantplayback":n=o;break;default:a.error("MediaRouter::addListener type is unknown: ["+i+"]")}},terminate:function(){null!==s&&(s.close(),s=null,l=null,c=null,u=null,d=null),this.deleteAudioPlayer(),null!==I&&(I.terminate(),I=null),null!==H&&H("close",""),f=null,F=!1},getVideoWidth:function(){return u},getVideoHeight:function(){return d},getVideoCodecType:function(){return l},getDeviceType:function(){return i},setDeviceType:function(e){i=e},setMaxInstantPlaybackTime:function(e){G.prototype.minRemainTime=e},getMaxInstantPlaybackTime:function(){return G.prototype.minRemainTime},setBufferClearInterval:function(e){G.prototype.minTimerInterval=e},getBufferClearInterval:function(){return G.prototype.minTimerInterval},setAudioVolume:function(e){G.prototype.audioVolume=e},getAudioVolume:function(){return G.prototype.audioVolume},setProfile:function(e){G.prototype.profile=e},getProfile:function(){return G.prototype.profile},setElement:function(e){G.prototype.DOMElement=e},getElement:function(){return G.prototype.DOMElement},useDropPacket:function(e){G.prototype.drop=e},isDropPacket:function(){return G.prototype.drop},setBoxSize:function(e){G.prototype.boxsize=e},getBoxSize:function(){return G.prototype.boxsize}},Object.defineProperty(this,"mute",{get:function(){return mute},set:function(e){mute=e}}),new G}var RTCPSession=function(){var e,t,n,i,r,a=log4javascript.getLogger("rtcpsession"),o=new Uint8Array(4),s=new Uint8Array(4),l=new Uint8Array(4),c=new Uint8Array(4),u=0;function d(){d.prototype.codec="",d.prototype.rtcpSession=null}return d.prototype=inheritObject(new Session,{init:function(){a.info("RTCPSession::init")},depacketize:function(d,p,h){if(a.info("RTCPSession::depacketize"),e=(192&p[0])>>6,t=(32&p[0])>>5==1,n=31&p[0],i=p[1],r=(p[2]<<8)+p[3],200===i){a.info("interleaved id = ",this.interleavedId,"RTCP Header: version = ",e,", Padding = ",t,", Count = ",n,", Type = ",i,"Length = ",r),u=4,o.set(p.subarray(u,u+4),0),a.info("interleaved id = ",this.interleavedId,"SSRC of sender = ",this.ntohl(o)),u+=4,s.set(p.subarray(u,u+4),0),u=0,l.set(h.subarray(u,u+4),0);var m={};m.timestamp=this.ntohl(s)-2208988800>>>0,m.timestamp_usec=this.ntohl(l)/4294967295*1e3,this.SetTimeStamp(m),a.info("----------- interleaved id = ",this.interleavedId,"NTP_MSW = ",this.timeData.timestamp,", NTP_LSW = ",this.timeData.timestamp_usec),u+=4,c.set(h.subarray(u,u+4),0),this.rtpTimestamp=(this.ntohl(c)/90).toFixed(0),a.info("interleaved id = ",this.interleavedId,"RTP = ",this.rtpTimestamp);var f={interleaved:this.interleavedId,timeStamp:{rtpTimestamp:this.rtpTimestamp,timestamp:this.timeData.timestamp,timestamp_usec:this.timeData.timestamp_usec,timezone:this.timeData.timezone}};this.eventRtcpCallback(f)}},close:function(){a.info("RTCPSession::close")}}),new d};function RtpClient(e){var t=log4javascript.getLogger("rtpclient"),n=[],i=null,r=null;function a(e,i){switch(e){case"close":n.length>0&&(n.forEach(function(e){e.close()}),n=[]);break;case"backup":case"stepPlay":case"bufferFree":case"audioBackup":break;default:t.error("Invalild mediaRouter cmd")}}function o(t,n,i){e.onVideoData(t,n,i)}function s(t,n,i){e.onAudioData(t,n,i)}function l(t){e.onMetadata(t)}function c(e){var t=r.getRTPPacket(e);i(t)}function u(t){e.onStatistics(t)}function d(t){e.onRtcpData(t)}function p(e){r.setSampleRate(e)}function h(e){console.log("error"+e.message)}function m(e){e.addListener("rtpClient",a),this.setChannel(e.getChannel())}return m.prototype={setChannel:function(e){this.channelId=null===e?0:e},getChannel:function(){return this.channelId},sendSdpInfo:function(i){for(var a=0;a<i.length;a++){var m=null,f=null;switch(t.info("Create Session: "+i[a].codecName),i[a].codecName){case"H264":(m=new H264Session).init(),m.setFramerate(void 0===i[a].Framerate?0:i[a].Framerate),m.addEventListener("video",o);break;case"H265":(m=new H265Session).init(),m.setFramerate(void 0===i[a].Framerate?0:i[a].Framerate),m.addEventListener("video",o);break;case"JPEG":(m=new MjpegSession).init(),m.addEventListener("video",o);break;case"G.711":if(-1===i[a].trackID.search("trackID=t")&&-1===i[a].trackID.search("trackID=back")){var g={clockFreq:i[a].ClockFreq,bitrate:i[a].Bitrate};(m=new G711Session).init(g),m.addEventListener("audio",s)}else r=new AudioTalkSession(i[a].RtpInterlevedID),e.startAudioTalk(c).then(p).catch(h);break;case"G.726-16":case"G.726-24":case"G.726-32":case"G.726-40":if(-1===i[a].trackID.search("trackID=t")&&-1===i[a].trackID.search("trackID=back")){var v={clockFreq:i[a].ClockFreq,bitrate:parseInt(i[a].codecName.substr(6,2),10)};(m=new G726Session).init(v),m.addEventListener("audio",s)}break;case"mpeg4-generic":if(-1===i[a].trackID.search("trackID=t")&&-1===i[a].trackID.search("trackID=back")){var y={config:i[a].config,clockFreq:i[a].ClockFreq,bitrate:i[a].Bitrate};(m=new AACSession).init(y),m.addEventListener("audio",s)}break;case"MetaData":(m=new MetaSession).init(),m.addEventListener("text",l)}null!==m&&((f=new RTCPSession).interleavedId=i[a].RtcpInterlevedID,f.channelId=this.channelId,f.addEventListener("rtcp",d),m.addEventListener("statistics",u),m.setDeviceType(e.getDeviceType()),m.codec=i[a].codecName,m.interleavedId=i[a].RtpInterlevedID,m.channelId=this.channelId,m.rtcpSession=f,n[parseInt(i[a].RtpInterlevedID)]=m,n[parseInt(i[a].RtcpInterlevedID)]=f)}},sendRtpData:function(e,i,r){var a=e[1];void 0!==n[a]&&(t.debug("media type index = ",a,", codec = ",n[a].codecName,", length = ",r.length),n[a].depacketize(e,i,r))},addListener:function(e,n){switch(e){case"audioTalk":i=n;break;default:t.error("RtpClient::addListener type is unknown")}}},new m(e)}function RtpSession(){log4javascript.getLogger("rtpsession");var e,t,n,i=null,r=new Queue(10);function a(){this.decoder=null,a.prototype.numberOfDroppedPacket=0,a.prototype.numberOfReceivedPacket=0,a.prototype.numberOfPrevTotalCount=0,a.prototype.numberOfMediaTimerCount=0,a.prototype.deviceType="camera",a.prototype.codec="",a.prototype.rtcpSession=null,e=this}return a.prototype=inheritObject(new Session,{setFrameCallback:function(e){this.rtpPayloadCbFunc=e},setBufferingCallback:function(e){this.rtpBufferingCbFunc=e},setTimestampCallback:function(e){this.rtpTimestampCbFunc=e},setOutputSizeCallback:function(e){this.rtpOutputSizeCbFunc=e},setAACCodecInfo:function(e){},depacketize:function(e,t,n){},bufferingRtpData:function(e,t,n){},getRTPPacket:function(e,t){},calculatePacketTime:function(e){},ntohl:function(e){return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]>>>0},appendBuffer:function(e,t,n){if(n+t.length>=e.length){var i=new Uint8Array(e.length+1048576);i.set(e,0),e=i}return e.set(t,n),e},setFramerate:function(e){a.prototype.frameRate=e},getFramerate:function(){return a.prototype.frameRate},setGovLength:function(e){i=e},getGovLength:function(){return i},setDecodingTime:function(e){e},getDropPercent:function(){return 0},getDropCount:function(){return 0},initStartTime:function(){this.firstDiffTime=0,0},setCheckDelay:function(e){this.checkDelay=e},close:function(){this.stopMediaTimer(),clearInterval(void 0)},startMediaTimer:function(i,r){r;var o={interval:33};o.interval=void 0!==i?i:Math.floor(1e3/a.prototype.frameRate),e=this,t=setInterval(this.onMediaTimer,o.interva),n=setInterval(this.onStatisticsTimer,1e3)},stopMediaTimer:function(){void 0!==t&&null!==t&&clearInterval(t),void 0!==n&&null!==n&&clearInterval(n)},setStartTimeStamp:function(e){a.prototype.startTimestamp=e,a.prototype.sumOfInterval=0},getTimerStamp:function(){return Number(a.prototype.startTimestamp)+a.prototype.sumOfInterval},increaseNumberOfReceivedPacketCount:function(){a.prototype.numberOfReceivedPacket++},getNumberOfReceivedPacketCount:function(){return a.prototype.numberOfReceivedPacket},setNumberOfReceivedPacketCount:function(e){a.prototype.numberOfReceivedPacket=Number(e)},isInitializeReceivedPacketCount:function(){return 0===a.prototype.numberOfReceivedPacket},increaseNumberOfDroppedPacket:function(){a.prototype.numberOfDroppedPacket++},getNumberOfDroppedPacketCount:function(){return a.prototype.numberOfDroppedPacket},setDeviceType:function(e){a.prototype.deviceType=e},getDeviceType:function(){return a.prototype.deviceType},addPacket:function(e){try{if(void 0!==r)for(r.enqueue(e);!r.isEmpty();){var t=r.peek();if(null!==t&&void 0!==t){var n=Math.abs(Number(t.packet.timeStamp.rtpTimestamp)-this.getTimerStamp(),.5);n>0&&n<Math.floor(1e3/a.prototype.frameRate*5)?(-1==a.prototype.channelId&&console.log("Channel: "+("00"+a.prototype.channelId).slice(-2)+", Packet Number: "+("000000"+t.index).slice(-6)+", Queue Size: "+("00"+r.getLength()).slice(-2)+", timerStamp: "+this.getTimerStamp().toFixed(0)+", timeStamp: "+Number(t.packet.timeStamp.rtpTimestamp).toFixed(2)+", gap: "+("00000"+Number(Math.abs(Number(t.packet.timeStamp.rtpTimestamp)-this.getTimerStamp(),.5)).toFixed(2)).slice(-5)+", Frame Type: "+t.info.frameType+", Frame Length: "+t.packet.frameData.length+"\r\n",t.packet.frameData),this.eventVideoCallback(t.mode,t.packet,t.info),r.dequeue()):"I"===t.info.frameType?(-1==a.prototype.channelId&&console.log("Channel: "+("00"+a.prototype.channelId).slice(-2)+", Packet Number: "+("000000"+t.index).slice(-6)+", Queue Size: "+("00"+r.getLength()).slice(-2)+", timerStamp: "+this.getTimerStamp().toFixed(0)+", timeStamp: "+Number(t.packet.timeStamp.rtpTimestamp).toFixed(2)+", gap: "+("00000"+Number(Math.abs(Number(t.packet.timeStamp.rtpTimestamp)-this.getTimerStamp(),.5)).toFixed(2)).slice(-5)+", Frame Type: "+t.info.frameType+", Frame Length: "+t.packet.frameData.length+"\r\n",t.packet.frameData),this.eventVideoCallback(t.mode,t.packet,t.info),r.dequeue()):(this.increaseNumberOfDroppedPacket(),r.dequeue())}}}catch(e){console.warn("Error add packet, Channel: "+("00"+a.prototype.channelId).slice(-2)+", error message: ",e),this.increaseNumberOfDroppedPacket()}},onMediaTimer:function(e){a.prototype.numberOfMediaTimerCount++,void 0!==e&&(a.prototype.sumOfInterval+=e.data.interval)},onStatisticsTimer:function(){if(void 0!==e.eventStatisticsCallback){var t={codec:e.codec,channelId:e.channelId,type:"rtp",queue:r.getLength(),fps:a.prototype.numberOfReceivedPacket-a.prototype.numberOfPrevTotalCount,interval:~~(a.prototype.sumOfInterval/a.prototype.numberOfMediaTimerCount),receviedPacket:a.prototype.numberOfReceivedPacket,droppedPacket:a.prototype.numberOfDroppedPacket};e.eventStatisticsCallback(t)}a.prototype.numberOfPrevTotalCount=a.prototype.numberOfReceivedPacket}}),Object.defineProperty(this,"codec",{get:function(){return codec_name},set:function(e){codec_name=e}}),Object.defineProperty(this,"rtcpSession",{get:function(){return rtcp_session},set:function(e){rtcp_session=e}}),new a}var Session=function(){var e=log4javascript.getLogger("session");function t(){this.interleavedId=0,this.channelId=0,this.timeData=null}return t.prototype={init:function(){e.info("Session::init")},depacketize:function(t,n,i){e.info("Session::depacketize")},ntohl:function(e){return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]>>>0},addEventListener:function(e,t){switch(e){case"text":this.eventMetaCallback=t;break;case"video":this.eventVideoCallback=t;break;case"audio":this.eventAudioCallback=t;break;case"rtcp":this.eventRtcpCallback=t;break;case"statistics":this.eventStatisticsCallback=t;break;default:rtpsession_log.error("can not add event listener. it is not defined")}},removeEventListener:function(e,t){switch(e){case"text":this.eventMetaCallback=null;break;case"video":this.eventVideoCallback=null;break;case"audio":this.eventAudioCallback=null;break;case"statistics":this.eventStatisticsCallback=null;break;default:rtpsession_log.error("can not add event listener. it is not defined")}},SetTimeStamp:function(e){this.timeData=e},GetTimeStamp:function(){return this.timeData}},Object.defineProperty(this,"channelId",{get:function(){return channel_Id},set:function(e){channel_Id=e}}),Object.defineProperty(this,"interleavedId",{get:function(){return interleaved_Id},set:function(e){interleaved_Id=e}}),Object.defineProperty(this,"rtpTimestamp",{get:function(){return rtp_timestamp},set:function(e){rtp_timestamp=e}}),new t},MetaSession=function(){var e,t,n,i,r,a,o,s=log4javascript.getLogger("metasession"),l=0,c=Math.floor(1433.6),u=new Uint8Array(c),d=0,p=new Uint8Array(new ArrayBuffer(4)),h=new Uint8Array(new ArrayBuffer(4)),m=new Uint8Array(new ArrayBuffer(2));function f(){}return f.prototype=inheritObject(new RtpSession,{init:function(){!1,this.timeData={timestamp:null,timestamp_usec:null,timezone:null}},depacketize:function(c,f,g){if(0,e=(192&f[0])>>6,t=(32&f[0])>>5==1,i=(16&f[0])>>4==1,n=15&f[0],r=(128&f[1])>>7==1,a=127&f[1],36!==c[0])throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0102"),place:"metaSession.js:53",message:"it is not valid interleave header (RTSP over TCP). Interleaved[0] = "+c[0].toString(16)});if(0!==n)throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0103"),place:"metaSession.js:60",message:"There is additional CSRC which is not handled in this version. CSRC count = "+n});if(t&&(PaddingSize=g[g.length-1],s.debug("Meta PaddingSize - "+PaddingSize)),i&&(4*(g[2]<<8|g[3])+4,"0xAB"==g[0]&&("0xAD"==g[1]||"0xAC"==g[1]))){var v=4;p.set(g.subarray(v,v+4),0),v+=4,h.set(g.subarray(v,v+4),0),"camera"===this.getDeviceType()&&(v+=6,m.set(g.subarray(v,v+2),0));var y={};if(y.timestamp=this.ntohl(p)-2208988800>>>0,y.timestamp_usec=this.ntohl(h)/4294967295*1e3,"camera"===this.getDeviceType()&&(y.timezone=(m[0]<<8|m[1])<<16>>16),null!=this.GetTimeStamp().timestamp&&null!==this.GetTimeStamp().timestamp_usec)if(s.debug("",y.timestamp,y.timestamp_usec,this.GetTimeStamp().timestamp,this.GetTimeStamp().timestamp_usec),Math.abs(y.timestamp-this.GetTimeStamp().timestamp)<=1){var b=Math.abs(1e3*y.timestamp+y.timestamp_usec-(1e3*this.GetTimeStamp().timestamp+this.GetTimeStamp().timestamp_usec));0!=b&&(this.setFramerate(Math.round(1e3/b)),s.debug("playback framerate = ",this.getFramerate()))}this.SetTimeStamp(y),!0}if(d=this.ntohl(f.subarray(4,8)),o=this.ntohl(f.subarray(2,3)),s.debug("interleaved id = ",this.interleavedId,", MetaSession RTP Version: ",("00"+e).slice(-2),", Padding: ",t,", ExtensionBit: ",i,", CSRC Count: ",n,", Marker Bit: ",r,", RTP Payload Type: ",a,", RTP Sequence Number: ",o,", RTP Timestamp: ",d,", RTCP Timestamp: "+this.rtcpSession.rtpTimestamp),function(e){if(l+e.length>u.length){var t=u;u=null,(u=new Uint8Array(t.length+e.length)).set(t,0),t=null}u.set(e,l),l+=e.length}(g),r){var w=u.subarray(0,l);this.rtpTimestamp=(d/90).toFixed(0),l=0;var C={frameData:w,channelId:this.channelId,receiveClock:performance.now(),timeStamp:{rtpTimestamp:this.rtpTimestamp,timestamp:this.timeData.timestamp,timestamp_usec:this.timeData.timestamp_usec,timezone:this.timeData.timezone},rtcp_interleavedId:this.rtcpSession.interleavedId};this.eventMetaCallback(C)}}}),new f},InitState=function(e){this.manager=e,this.isReadyToPop=function(){return!1},this.push=function(){return this.manager.change(new PlayState(this.manager)),!0},this.pause=function(){},this.full=function(){},this.restart=function(){},this.clear=function(){},this.resume=function(){}},PlayState=function(e){this.manager=e,this.isReadyToPop=function(){return!0},this.push=function(){return!1},this.pause=function(e){this.manager.change(new PauseState(this.manager))},this.full=function(){var e={};return e.errorCode=fromHex("0x0500"),e.oldErrorCode="600",e.description="error",this.manager.change(new WaitPauseState(this.manager)),e},this.clear=function(){this.manager.change(new InitState(this.manager))},this.restart=function(){this.manager.change(new InitState(this.manager))},this.checkBufferLength=function(){}},WaitPauseState=function(e){this.manager=e,this.isReadyToPop=function(){return!0},this.push=function(){return!1},this.pause=function(e){this.manager.change(new FullState(this.manager))},this.clear=function(){this.manager.change(new InitState(this.manager))},this.full=function(){},this.restart=function(){},this.checkBufferLength=function(){}},FullState=function(e){this.manager=e,this.isReadyToPop=function(){return!0},this.pause=function(e){this.manager.change(new FakePauseState(this.manager));var t={};return t.errorCode=fromHex("0x0000"),t.oldErrorCode="200",t.currentState="Pause",t.description="BufferManager process PAUSE",t},this.restart=function(){this.manager.change(new InitState(this.manager));var e={};return e.errorCode=fromHex("0x0501"),e.oldErrorCode="601",e.description="error",e},this.clear=function(){this.manager.change(new InitState(this.manager))},this.push=function(){return!1},this.resume=function(){},this.full=function(){}},FakePauseState=function(e){this.manager=e,this.isReadyToPop=function(){return!1},this.resume=function(){this.manager.change(new FullState(this.manager));var e={};return e.errorCode=fromHex("0x0000"),e.oldErrorCode="200",e.currentState="Resume",e.description="BufferManager process RESUME",e},this.clear=function(){this.manager.change(new InitState(this.manager))},this.push=function(){return!1},this.full=function(){},this.restart=function(){},this.pause=function(){},this.checkBufferLength=function(){}},PauseState=function(e){this.manager=e,this.isReadyToPop=function(){return!1},this.resume=function(){this.manager.change(new InitState(this.manager))},this.clear=function(){this.manager.change(new InitState(this.manager))},this.push=function(){return!1},this.full=function(){},this.restart=function(){},this.pause=function(){},this.checkBufferLength=function(){}},H264Session=function(){var e,t,n,i,r,a,o,s,l,c,u,d=log4javascript.getLogger("h264rtpsession"),p=0,h=0,m=Math.floor(1433.6),f=!1,g=new Uint8Array(m),v=new Uint8Array(4),y=new Uint8Array(new ArrayBuffer(4)),b=new Uint8Array(new ArrayBuffer(4)),w=new Uint8Array(new ArrayBuffer(2)),C=null;v[0]="0x00",v[1]="0x00",v[2]="0x00",v[3]="0x01";var S={};S.Enum("H264_NAL_UNSPECIFIED","H264_NAL_SLICE","H264_NAL_DPA","H264_NAL_DPB","H264_NAL_DPC","H264_NAL_IDR_SLICE","H264_NAL_SEI","H264_NAL_SPS","H264_NAL_PPS","H264_NAL_AUD","H264_NAL_END_SEQUENCE","H264_NAL_END_STREAM","H264_NAL_FILLER_DATA","H264_NAL_SPS_EXT","H264_NAL_PREFIX","H264_NAL_SUB_SPS","H264_NAL_DPS","H264_NAL_RESERVED17","H264_NAL_RESERVED18","H264_NAL_AUXILIARY_SLICE","H264_NAL_EXTEN_SLICE","H264_NAL_DEPTH_EXTEN_SLICE","H264_NAL_RESERVED22","H264_NAL_RESERVED23","H264_NAL_UNSPECIFIED24","H264_NAL_UNSPECIFIED25","H264_NAL_UNSPECIFIED26","H264_NAL_UNSPECIFIED27","H264_NAL_UNSPECIFIED28","H264_NAL_UNSPECIFIED29","H264_NAL_UNSPECIFIED30","H264_NAL_UNSPECIFIED31");var _=function(e){if(h+e.length>g.length){var t=g;g=null,(g=new Uint8Array(t.length+e.length)).set(t,0),t=null}return g.set(e,h),h+=e.length,g};function T(){}return T.prototype=inheritObject(new RtpSession,{init:function(){f=!1,this.timeData={timestamp:null,timestamp_usec:null,timezone:null}},depacketize:function(m,T,x){var E,I=0,k=0;if(this.interleavedId,m[1],e=(192&T[0])>>6,t=(32&T[0])>>5==1,i=(16&T[0])>>4==1,n=15&T[0],r=(128&T[1])>>7==1,o=127&T[1],36!==m[0])throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0102"),place:"h264Session.js:87",message:"it is not valid interleave header (RTSP over TCP). Interleaved[0] = "+m[0].toString(16)});if(0!==n)throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0103"),place:"h264Session.js:94",message:"There is additional CSRC which is not handled in this version. CSRC count = "+n});if(t&&(k=x[x.length-1],d.debug("H.264 PaddingSize - "+k)),i&&(I=4*(x[2]<<8|x[3])+4,"0xAB"==x[0]&&("0xAD"==x[1]||"0xAC"==x[1]))){var A=4;y.set(x.subarray(A,A+4),0),A+=4,b.set(x.subarray(A,A+4),0),"camera"===this.getDeviceType()&&(A+=6,w.set(x.subarray(A,A+2),0));var R={};if(R.timestamp=this.ntohl(y)-2208988800>>>0,R.timestamp_usec=this.ntohl(b)/4294967295*1e3,"camera"===this.getDeviceType()&&(R.timezone=(w[0]<<8|w[1])<<16>>16),null!=this.GetTimeStamp().timestamp&&null!==this.GetTimeStamp().timestamp_usec)if(d.debug("",R.timestamp,R.timestamp_usec,this.GetTimeStamp().timestamp,this.GetTimeStamp().timestamp_usec),Math.abs(R.timestamp-this.GetTimeStamp().timestamp)<=1){var L=Math.abs(1e3*R.timestamp+R.timestamp_usec-(1e3*this.GetTimeStamp().timestamp+this.GetTimeStamp().timestamp_usec));0!=L&&(this.setFramerate(Math.round(1e3/L)),d.debug("playback framerate = ",this.getFramerate()))}this.SetTimeStamp(R),f=!0}if(E=x.subarray(I,x.length-k),p=this.ntohl(T.subarray(4,8)),a=this.ntohl(T.subarray(2,3)),d.debug("interleaved id = ",this.interleavedId,", H.264 RTP Version: ",("00"+e).slice(-2),", Padding: ",t,", ExtensionBit: ",i,", CSRC Count: ",n,", Marker Bit: ",r,", RTP Payload Type: ",o,", RTP Sequence Number: ",a,", RTP Timestamp: ",p,", RTCP Timestamp: "+this.rtcpSession.rtpTimestamp),c=(128&E[0])>>7,s=(96&E[0])>>5,0==(l=31&E[0]))throw console.warn("This NAL type does not support on this application. nal_type = "+toHex(l)),new umpError({channelId:this.channelId,errorCode:fromHex("0x0101"),place:"h264Session.js:155",message:"This NAL type does not support on this application. nal_type = "+toHex(l)});switch(d.debug("H.264 Forbidden Zero Bit: "+c+", NRI: "+s.toString(2)+", Nal Unit Type: "+toHex(l)+", Payload length: "+E.length),l){case S.H264_NAL_SPS:g=_(v),g=_(E),C=E;break;case S.H264_NAL_PPS:g=_(v),g=_(E),u=E;break;case S.H264_NAL_SPS_EXT:throw console.warn("H.264 SPS (Sequence Parameter Set) extension\r\nReference: https://tools.ietf.org/html/rfc3984#section-5.7"),new umpError({channelId:this.channelId,errorCode:fromHex("0x0101"),place:"h264Session.js:195",message:"SPS (Sequence Parameter Set) extension is additional which is not handled in this version. NALType  = "+l});case S.H264_NAL_SUB_SPS:throw console.warn("H.264 SSPS (Subset Sequence parameter Set) \r\nReference: https://tools.ietf.org/html/rfc3984#section-5.7"),new umpError({channelId:this.channelId,errorCode:fromHex("0x0101"),place:"h264Session.js:204",message:"SSPS (Subset Sequence parameter Set) is additional which is not handled in this version. NALType  = "+l});case S.H264_NAL_UNSPECIFIED28:var P=128==(128&E[1]),M=64==(64&E[1]),D=32==(32&E[1]),N=31&E[1];if(d.debug("start bit: "+P+", end bit: "+M+", reserved bit: "+D+", Fu Type: "+N),1==P&&0==M){var H=new Uint8Array(1);H[0]=96&E[0]|N,g=_(v),g=_(H),g=_(E.subarray(2,E.length))}else g=_(E.subarray(2,E.length));d.debug("H.264 Raw Length: "+E.length),d.debug("H.264 Buff Length: "+g.length);break;case S.H264_NAL_AUD:d.debug("H.264 Coded slice of an ("+l+").\r\nReference: https://tools.ietf.org/html/rfc3984#section-5.7");default:d.debug("H.264 Coded slice of an ("+l+").\r\nReference: https://tools.ietf.org/html/rfc3984#section-5.7"),g=_(v),g=_(E)}if(r){var U=g.subarray(0,h),F="";if(this.rtpTimestamp=(p/90).toFixed(0),h=0,this.isInitializeReceivedPacketCount()&&(this.setStartTimeStamp(this.rtpTimestamp),this.startMediaTimer()),7==(31&U[3]))throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0101"),place:"h264Session.js:264",message:"3 byte start code is additional which is not handled in this version. inputBufferSub[3].toString(16): "+U[3].toString(16)});this.increaseNumberOfReceivedPacketCount(),F=7==(31&U[4])||9==(31&U[4])?"I":"P";var O=!0===f?"Playback":"Live",B={codecType:"H264",frameData:U,channelId:this.channelId,packetSeq:this.getNumberOfReceivedPacketCount(),receiveClock:performance.now(),timeStamp:{rtpTimestamp:this.rtpTimestamp,timestamp:this.timeData.timestamp,timestamp_usec:this.timeData.timestamp_usec,timezone:this.timeData.timezone},rtcp_interleavedId:this.rtcpSession.interleavedId},j={frameType:F,spsPayload:C,ppsPayload:u,framerate:this.getFramerate()};this.eventVideoCallback(O,B,j)}else;}}),new T},H265Session=function(){var e,t,n,i,r,a,o,s,l,c,u,d=log4javascript.getLogger("h265rtpsession"),p=0,h=0,m=Math.floor(1433.6),f=!1,g=new Uint8Array(m),v=new Uint8Array(4),y=new Uint8Array(new ArrayBuffer(4)),b=new Uint8Array(new ArrayBuffer(4)),w=new Uint8Array(new ArrayBuffer(2)),C=null,S=null,_=null;v[0]="0x00",v[1]="0x00",v[2]="0x00",v[3]="0x01";var T={};T.Enum("HEVC_NAL_TRAIL_N","HEVC_NAL_TRAIL_R","HEVC_NAL_TSA_N","HEVC_NAL_TSA_R","HEVC_NAL_STSA_N","HEVC_NAL_STSA_R","HEVC_NAL_RADL_N","HEVC_NAL_RADL_R","HEVC_NAL_RASL_N","HEVC_NAL_RASL_R","HEVC_NAL_VCL_N10","HEVC_NAL_VCL_R11","HEVC_NAL_VCL_N12","HEVC_NAL_VCL_R13","HEVC_NAL_VCL_N14","HEVC_NAL_VCL_R15","HEVC_NAL_BLA_W_LP","HEVC_NAL_BLA_W_RADL","HEVC_NAL_BLA_N_LP","HEVC_NAL_IDR_W_RADL","HEVC_NAL_IDR_N_LP","HEVC_NAL_CRA_NUT","HEVC_NAL_IRAP_VCL22","HEVC_NAL_IRAP_VCL23","HEVC_NAL_RSV_VCL24","HEVC_NAL_RSV_VCL25","HEVC_NAL_RSV_VCL26","HEVC_NAL_RSV_VCL27","HEVC_NAL_RSV_VCL28","HEVC_NAL_RSV_VCL29","HEVC_NAL_RSV_VCL30","HEVC_NAL_RSV_VCL31","HEVC_NAL_VPS","HEVC_NAL_SPS","HEVC_NAL_PPS","HEVC_NAL_AUD","HEVC_NAL_EOS_NUT","HEVC_NAL_EOB_NUT","HEVC_NAL_FD_NUT","HEVC_NAL_SEI_PREFIX","HEVC_NAL_SEI_SUFFIX","HEVC_NAL_RSV_NVCL41","HEVC_NAL_RSV_NVCL42","HEVC_NAL_RSV_NVCL43","HEVC_NAL_RSV_NVCL44","HEVC_NAL_RSV_NVCL45","HEVC_NAL_RSV_NVCL46","HEVC_NAL_RSV_NVCL47","HEVC_NAL_UNSPEC48","HEVC_NAL_UNSPEC49","HEVC_NAL_UNSPEC50","HEVC_NAL_UNSPEC51","HEVC_NAL_UNSPEC52","HEVC_NAL_UNSPEC53","HEVC_NAL_UNSPEC54","HEVC_NAL_UNSPEC55","HEVC_NAL_UNSPEC56","HEVC_NAL_UNSPEC57","HEVC_NAL_UNSPEC58","HEVC_NAL_UNSPEC59","HEVC_NAL_UNSPEC60","HEVC_NAL_UNSPEC61","HEVC_NAL_UNSPEC62","HEVC_NAL_UNSPEC63");var x=function(e){if(h+e.length>g.length){var t=g;g=null,(g=new Uint8Array(t.length+e.length)).set(t,0),t=null}return g.set(e,h),h+=e.length,g};function E(){}return E.prototype=inheritObject(new RtpSession,{init:function(){f=!1,this.timeData={timestamp:null,timestamp_usec:null,timezone:null}},depacketize:function(m,E,I){var k,A=0,R=0;if(this.interleavedId,m[1],e=(192&E[0])>>6,t=(32&E[0])>>5==1,i=(16&E[0])>>4==1,n=15&E[0],r=(128&E[1])>>7==1,o=127&E[1],36!==m[0])throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0102"),place:"h265Session.js:156",message:"it is not valid interleave header (RTSP over TCP). Interleaved[0] = "+m[0].toString(16)});if(15==(15&E[0]))throw new umpError({channelId:this.channelId,errorCode:fromHex("0x0103"),place:"h265Session.js:164",message:"There is additional CSRC which is not handled in this version. CSRC count = "+n});if(32==(32&E[0])&&(R=I[I.length-1],d.debug("H265Session::PaddingSize - "+R)),i&&(A=4*(I[2]<<8|I[3])+4,"0xAB"==I[0]&&("0xAD"==I[1]||"0xAC"==I[1]))){var L=4;y.set(I.subarray(L,L+4),0),L+=4,b.set(I.subarray(L,L+4),0),"camera"===this.getDeviceType()&&(L+=6,w.set(I.subarray(L,L+2),0));var P={};if(P.timestamp=this.ntohl(y)-2208988800>>>0,P.timestamp_usec=this.ntohl(b)/4294967295*1e3,"camera"===this.getDeviceType()&&(P.timezone=(w[0]<<8|w[1])<<16>>16),null!=this.GetTimeStamp().timestamp&&null!==this.GetTimeStamp().timestamp_usec)if(d.debug("",P.timestamp,P.timestamp_usec,this.GetTimeStamp().timestamp,this.GetTimeStamp().timestamp_usec),Math.abs(P.timestamp-this.GetTimeStamp().timestamp)<=1){var M=Math.abs(1e3*P.timestamp+P.timestamp_usec-(1e3*this.GetTimeStamp().timestamp+this.GetTimeStamp().timestamp_usec));0!=M&&(this.setFramerate(Math.round(1e3/M)),d.debug("playback framerate = ",this.getFramerate()))}this.SetTimeStamp(P),f=!0}if(k=I.subarray(A,I.length-R),p=this.ntohl(E.subarray(4,8)),a=this.ntohl(E.subarray(2,3)),d.debug("interleaved id = ",this.interleavedId,", HEVC RTP Version: ",("00"+e).slice(-2),", Padding: ",t,", ExtensionBit: ",i,", CSRC Count: ",n,", Marker Bit: ",r,", RTP Payload Type: ",o,", RTP Sequence Number: ",a,", RTP Timestamp: ",p,", RTCP Timestamp: "+this.rtcpSession.rtpTimestamp),u=(128&k[0])>>7,c=k[0]>>1&63,s=((1&k[0])<<6)+((248&k[1])>>3),l=7&k[1],0==c)throw console.warn("This NAL type does not support on this application. nal_type = "+toHex(c)),new umpError({channelId:this.channelId,errorCode:fromHex("0x0101"),place:"h265Session.js:154",message:"This NAL type does not support on this application. nal_type = "+toHex(c)});switch(d.debug("HEVC Forbidden Zero Bit: "+u+", Nal Unit Type: "+toHex(c)+", LayerId: "+toHex(s)+", TDI: "+toHex(l)+", Payload length: "+k.length),c){case T.HEVC_NAL_VPS:g=x(v),g=x(k),C=k;break;case T.HEVC_NAL_SPS:g=x(v),g=x(k),S=k;break;case T.HEVC_NAL_PPS:g=x(v),g=x(k),_=k;break;case T.HEVC_NAL_AUD:break;case T.HEVC_NAL_UNSPEC49:var D=128==(128&k[2]),N=64==(64&k[2]),H=63&k[2];k.subarray(3,k.length);if(1==D&&0==N){var U=new Uint8Array(2);U[0]=129&k[0]|H<<1,U[1]=k[1],g=x(v),g=x(U),g=x(k.subarray(3,k.length))}else g=x(k.subarray(3,k.length));d.debug("HEVC Raw Length: "+k.length),d.debug("HEVC Buff Length: "+g.length);break;default:d.debug("HEVC Coded slice of an ("+c+").\r\nReference: https://tools.ietf.org/html/rfc3984#section-5.7"),g=x(v),g=x(k)}if(r){d.debug("HEVC Length: "+g.length+"\r\nData: ",g);var F=g.subarray(0,h),O="";this.rtpTimestamp=(p/90).toFixed(0),h=0,this.isInitializeReceivedPacketCount()&&(this.setStartTimeStamp(this.rtpTimestamp),this.startMediaTimer()),this.increaseNumberOfReceivedPacketCount(),O=64==F[4]?"I":"P";var B=!0===f?"Playback":"Live",j={codecType:"H265",frameData:F,channelId:this.channelId,packetSeq:this.getNumberOfReceivedPacketCount(),receiveClock:performance.now(),timeStamp:{rtpTimestamp:this.rtpTimestamp,timestamp:this.timeData.timestamp,timestamp_usec:this.timeData.timestamp_usec,timezone:this.timeData.timezone},rtcp_interleavedId:this.rtcpSession.interleavedId},V={frameType:O,vpsPayload:C,spsPayload:S,ppsPayload:_,framerate:this.getFramerate()};this.eventVideoCallback(B,j,V)}else;}}),new E},MjpegSession=function(){var e=log4javascript.getLogger("mjpegrtpsession"),t=new Array,n=null,i=null,r=0;function a(){}function o(e){var t=e.data;i.eventVideoCallback(t.playMode,t.streamData,t.videoInfo)}return a.prototype=inheritObject(new RtpSession,{init:function(){null===n&&(e.info("generate depacketize worker."),(n=new Worker("./media/ump/Worker/MjpegSession/mjpegDepacketizeWorker.js")).onmessage=o),i=this},depacketize:function(e,i,a){var o={rtspInterleave:e,channelId:this.channelId,header:i,payload:a};if(r=this.ntohl(i.subarray(4,8)),t.push(o),t.length>=50||128==(128&i[1])){this.rtpTimestamp=(r/90).toFixed(0),this.isInitializeReceivedPacketCount()&&(this.setStartTimeStamp(this.rtpTimestamp),this.startMediaTimer()),this.increaseNumberOfReceivedPacketCount();var s={dataArray:t.splice(0,50)};n&&n.postMessage(s)}},close:function(){n&&(n.terminate(),n=null,e.info("terminate depacketize worker."))}}),new a};function PlaybackBufferManager(){var e=log4javascript.getLogger("rtp_video"),t=null,n=null,i=0,r=null,a=null;function o(){var e=t.full();void 0!==e&&r(e)}function s(){e.debug("[#####PlaybackBufferManager#####]Create PlaybackBufferManager"),this,t=new InitState(this),(n=new VideoBufferList).setBufferFullCallback(o),s.prototype.channelId=0}return s.prototype={init:function(e){t=new InitState(this),r=e,void 0!==n&&null!==n&&n.clearBuffer()},change:function(e){t=e},push:function(e){return null!==n&&(void 0!==e.videoInfo.framerate&&4*e.videoInfo.framerate!==i&&(i=4*e.videoInfo.framerate,n.setBUFFERING(i),n.setMaxLength(6*e.videoInfo.framerate)),e.streamData.frameData=new Uint8Array(e.streamData.frameData),n.push(e.streamData.frameData,e.videoInfo.width,e.videoInfo.height,e.streamData.codecType,e.videoInfo.frameType,e.streamData.timeStamp),t.push())},front:function(){n.front(a),a=null},pause:function(){var e=t.pause(n);void 0!==e&&r(e)},resume:function(){var e=t.resume(n);return void 0!==e&&r(e),t.isReadyToPop()},pop:function(e){if(null!==n){var i=n.pop();if(null===i||void 0===i)return t.clear(),!1;a=i;var o,s={playMode:"Playback",streamData:{},videoInfo:{}};return s.streamData.codecType=i.codecType,s.streamData.frameData=i.buffer,s.streamData.timeStamp=i.timeStamp,s.videoInfo.frameType=i.frameType,s.videoInfo.width=i.width,s.videoInfo.height=i.height,n.getBufferLength()<1&&e&&void 0!==(o=t.restart())&&r(o),s}},full:function(){return t.full()},restart:function(){return t.restart()},isReadyToPop:function(){return t.isReadyToPop()},clear:function(){t.clear()}},Object.defineProperty(this,"channelId",{get:function(){return channel},set:function(e){channel=e}}),new s}var videoBufferNode=function(){return function(e,t,n,i,r,a){BufferNode.call(this,e),this.width=t,this.height=n,this.codecType=i,this.frameType=r,this.timeStamp=a}}();function VideoBufferList(){var e=0,t=240,n=null,i=!1;function r(){BufferList.call(this),e=360,t=240,n=null,i=!1}return r.prototype=inherit(BufferList,{push:function(e,r,a,o,s,l){var c=new videoBufferNode(e,r,a,o,s,l);return this._length>0?(this.tail.next=c,c.previous=this.tail,this.tail=c):(this.head=c,this.tail=c),this._length+=1,null!==n&&this._length>=t?!1===i&&(i=!0,n()):i&&(i=!1),c},front:function(e){null!==e&&(this._length>0?(this.head.previous=e,e.next=this.head,this.head=e):(this.head=e,this.tail=e),this._length+=1)},pop:function(){var e=null;return this._length>0&&(e=this.head,this.head=this.head.next,null!==this.head?this.head.previous=null:this.tail=null,this._length-=1),e},setMaxLength:function(t){(e=t)>360?e=360:e<30&&(e=30)},setBUFFERING:function(e){(t=e)>240?t=240:t<20&&(t=20)},setBufferFullCallback:function(e){n=e},searchTimestamp:function(e){var t=this.head,n=this._length,i=1;if(0===n||e<=0||null===t)throw new Error("Failure: non-existent node in this list.");for(;null!==t&&(t.timeStamp.timestamp!==e.timestamp||t.timeStamp.timestamp_usec!==e.timestamp_usec);)t=t.next,i++;return n<i?t=null:this.curIdx=i,t},findIFrame:function(e){var t=this.head,n=this._length,i=1;if(0===n)throw new Error("Failure: non-existent node in this list.");for(;i<this.curIdx;)t=t.next,i++;if(!0===e)for(;"I"!==t.frameType;)t=t.next,i++;else for(;"I"!==t.frameType;)t=t.previous,i--;return n<i?t=null:this.curIdx=i,t},clearBuffer:function(){this.clear()},getBufferLength:function(){return this._length}}),new r}var RtcpSession=function(e){var t,n,i,r=0,a={},o=e;function s(){}return s.prototype=inheritObject(new RtpSession,{SendRtpData:function(e,o,s){var l=0,c=s.length+12,u=new Uint8Array(new ArrayBuffer(c));u.set(o,0),u.set(s,12);u[0];var d=u[1];u[2],u[3];if(l+=4,new Uint8Array(new ArrayBuffer(4)).set(u.subarray(l,l+4),0),l+=4,200===d){var p=new Uint8Array(new ArrayBuffer(4));p.set(u.subarray(l,l+4),0),t=this.ntohl(p),l+=4;var h=new Uint8Array(new ArrayBuffer(4));h.set(u.subarray(l,l+4),0),n=this.ntohl(h),l+=4;var m=new Uint8Array(new ArrayBuffer(4));m.set(u.subarray(l,l+4),0),i=this.ntohl(m),l+=4,function(e,t,n){var i=15625*t/67108864;a.seconds=e-2208988800,a.useconds=i+.5,r=n}(t,n,i)}},calculatePacketTime:function(e){var t,n,i={},s=(e-r)/o;return 0===a.seconds&&(a.seconds=Math.round(new Date/1e3),a.useconds=0),s>=0?(t=a.seconds+s,(n=a.useconds+1e6*(s-s))>=1e6&&(n-=1e6,++t)):(s=-s,t=a.seconds-s,(n=a.useconds-1e6*(s-s))<0&&(n+=1e6,--t)),i.tv_sec=t,i.tv_usec=n,i}}),new s},HTTP_STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Checkpoint",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",218:"This is fine",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",420:"Method Failure",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",440:"Login Time-out",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",490:"Maximum account rearched",498:"Invalid Token",499:"Token Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",530:"Site is frozen",598:"Network read timeout error"};function SunapiClient(e){var t,n={},i=!1,r=!0,a=0,o={clientVersion:"1.00_20160404",serverType:"camera",authType:a,cors:!1,digest:{hostname:"",port:80,protocol:"http",rtspPort:554,ClientIPAddress:"127.0.0.1",username:"",password:"",authType:a}};function s(e){if(void 0!==e.debug&&(i=e.debug),void 0!==e.deviceType&&""!==e.deviceType&&null!==e.deviceType?o.serverType=e.deviceType:console.warn("The device type is not defined, set to 'camera' by default."),"nvr"===o.serverType&&(void 0===e.hostname||""===e.hostname&&null===e.hostname))throw new umpError({errorCode:fromHex("0x0401"),place:"sunapiClient.js:52",message:"hostname is empty from input parameter."});if("camera"===o.serverType&&(void 0===e.cameraIp||""===e.cameraIp||null===e.cameraIp))throw new umpError({errorCode:fromHex("0x0400"),place:"sunapiClient.js:60",message:"cameraIP is empty from input parameter."});if(void 0===o.serverType||null===o.serverType)throw new umpError({errorCode:fromHex("0x0404"),place:"sunapiClient.js:67",message:"device type is undefined."});if("nvr"===o.serverType&&(void 0===e.username||""===e.username||null===e.username))throw new umpError({errorCode:fromHex("0x0402"),place:"sunapiClient.js:70",message:"username is empty from input parameter."});if("camera"===o.serverType&&(void 0===e.user||""===e.user||null===e.user))throw new umpError({errorCode:fromHex("0x0402"),place:"sunapiClient.js:78",message:"user id is empty from input parameter."});if(void 0===e.password||""===e.password||null===e.password)throw new umpError({errorCode:fromHex("0x0403"),place:"sunapiClient.js:80",message:"password is empty from input parameter."});o.authType=e.authType,"camera"===o.serverType?(r?(o.digest.hostname=e.hostname,o.digest.port=e.port):(o.digest.hostName=window.location.hostname,o.digest.port=window.location.port),o.digest.protocol=e.protocol,o.digest.username=e.user,null!==e.username&&void 0!==e.username&&(o.digest.username=e.username)):"nvr"===o.serverType&&(o.digest.hostname=e.hostname,o.digest.port=e.port,o.digest.protocol=e.protocol,o.digest.username=e.username),o.digest.ClientIPAddress=e.ClientIPAddress,o.digest.password=e.password}var l=function(e){i&&console.log("[sunapiClient] "+e)};function c(e,t,n,i){var r,a={};"blob"===e.responseType||"arraybuffer"===e.responseType||null!==e.responseXML||i?(a.data=e.response,t(a)):"object"==typeof(r=!1===function(e){try{return JSON.parse(e)&&!!e}catch(e){return!1}}(e.response)?function(e){for(var t={},n={},i=e.split("\r\n"),r=0;r<i.length;r++)if(i[r]){var a=i[r].split("="),o=a[0].split(".");if(1==o.length)t[o[0]]=a[1];else for(var s=0;s<o.length;s++)0==s?(t[o[s]]||(t[o[s]]={}),n=t[o[s]]):s<o.length-1?(n[o[s]]||(n[o[s]]={}),n=n[o[s]]):s==o.length-1&&(n[o[s]]=a[1])}return l("result : "+JSON.stringify(t)),t}(e.response):JSON.parse(e.response))?(a.data=r,"Fail"===a.data.Response?n(a.data.Error):t(a)):(a.data=e.response,t(a))}function u(e,t){ModalManagerService.open("message",{buttonCount:0,message:"Exceeded maximum login attempts, please try after some time"}),$location.path("/login"),!1===SessionOfUserManager.IsLoginSuccess()&&(e("HTTP Error : ",t.status),l("After calling Account block fail fn"))}function d(e,t,n,i,r){void 0!==n&&""!==n&&(void 0!==n.ProgressEvent&&e.upload.addEventListener("progress",n.ProgressEvent,!1),void 0!==n.CompleteEvent&&e.addEventListener("load",n.CompleteEvent,!1),void 0!==n.CancelEvent&&e.addEventListener("abort",n.CancelEvent,!1),void 0!==n.FailEvent?e.addEventListener("error",n.FailEvent,!1):e.addEventListener("error",function(e){r("Network Error")},!1)),e.timeout="POST"===t?3e5:5e3,-1!==i.indexOf("snapshot")&&(e.responseType="blob"),-1!==i.indexOf("configbackup")&&(e.responseType="arraybuffer"),-1!==i.indexOf("opensdk")&&(e.withCredentials=!0)}function p(e,n,i,r,a){var s=o.digest,l=s.protocol+"://"+s.hostname;void 0!==s.port&&null!==s.port&&""!==s.port&&(l+=":"+s.port);var c=new XMLHttpRequest;return c.open(e,l+n,i),"camera"===o.serverType&&o.cors&&c.setRequestHeader("XClient","XMLHttpRequest"),a||c.setRequestHeader("Accept","application/json"),""!==r&&void 0!==r&&null!==r&&(t=v(r)),void 0!==t&&"Digest"===t.scheme&&function(e,t,n,i){var r,a;i?"digest"===i.scheme.toLowerCase()?(i.nc=i.nc+1,i.cnonce=f(),r=g(o.digest.username,o.digest.password,n,i.realm,t.toUpperCase(),i.nonce,i.nc,i.cnonce,i.qop),a=i.scheme+' username="'+o.digest.username+'", realm="'+i.realm+'", nonce="'+i.nonce+'", uri="'+n+'", cnonce="'+i.cnonce+'" nc='+y(i.nc,8)+", qop="+i.qop+', response="'+r+'"',e.setRequestHeader("Authorization",a)):"xdigest"===i.scheme.toLowerCase()?(i.nc=i.nc+1,i.cnonce=f(),r=g(o.digest.username,o.digest.password,n,i.realm,t.toUpperCase(),i.nonce,i.nc,i.cnonce,i.qop),a=i.scheme+' username="'+o.digest.username+'", realm="'+i.realm+'", nonce="'+i.nonce+'", uri="'+n+'", cnonce="'+i.cnonce+'" nc='+y(i.nc,8)+", qop="+i.qop+', response="'+r+'"',e.setRequestHeader("Authorization",a)):"basic"===i.scheme.toLowerCase()&&(a=i.scheme+" "+btoa(o.digest.username+":"+o.digest.password),e.setRequestHeader("Authorization",a)):(i={scheme:"Digest",realm:"",nonce:null,opaque:null,qop:"auth",nc:null,cnonce:null},r=g(o.digest.username,o.digest.password,n,i.realm,t.toUpperCase(),i.nonce,i.nc,i.cnonce,i.qop),a=i.scheme+' username="'+o.digest.username+'", realm="'+i.realm+'", nonce="'+i.nonce+'", uri="'+n+'", cnonce="'+i.cnonce+'" nc='+y(i.nc,8)+", qop="+i.qop+', response="'+r+'"',e.setRequestHeader("Authorization",a))}(c,e,n,t),c}n.post=function(e,t,n,i,r,a,o){return void 0!==t&&(e+=b(t)),m("POST",e,n,i,r,a,o)},n.get=function(e,t,n,i,r,a,o){(e=encodeURI(e),void 0!==t)&&(-1==(e+=b(t)).indexOf("attributes.cgi")&&(e+="&SunapiSeqId="+(new Date).getTime()));return-1!==e.indexOf("configbackup")||!0===a?m("GET",e,n,i,r,"","",o):h("GET",e,n,i,o)},n.mobile=function(e,t,n,i,r){var a,s="http",c=new XMLHttpRequest,u=!1,d=!1;void 0!==r&&(void 0!==r.protocol&&(s=r.protocol),void 0!==r.updateDate&&(e+=b(r.updateDate)),void 0!==r.auth&&(u=!0)),a=s+"://"+t.rtsp_url+":"+t.rtsp_tunneling_port+e,o.digest.username=t.rtsp_id,o.digest.password=t.rtsp_pwd;if(Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?(c.onload=c.onabort=function(){if(401===this.status){this.getResponseHeader("www-authenticate");var e=new XMLHttpRequest;e.onload=e.onabort=function(){if(d=!1,200===this.status)if(void 0!==this.response&&""!==this.response){var t={};if("arraybuffer"===this.responseType||null!==this.responseXML)t.data=this.response,n(t);else{var r=JSON.parse(this.response);"object"==typeof r?(t.data=r,"Fail"===t.data.Response?i(t.data.Error.Details):n(t)):(t.data=this.response,n(t))}}else i("No response");else i(e.status)},e.onerror=function(){i(e.status)},e.ontimeout=function(){i(408)},u?e.open("GET",a,!1,o.digest.username,o.digest.password):(e.open("GET",a,!0,o.digest.username,o.digest.password),e.timeout=1e4),e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Cache-Control","no-cache"),e.send()}else if(d=!1,200===this.status)if(void 0!==this.response&&""!==this.response){var t={};if("arraybuffer"===this.responseType||null!==this.responseXML)t.data=this.response,n(t);else{var r=JSON.parse(this.response);"object"==typeof r?(t.data=r,"Fail"===t.data.Response?i(t.data.Error.Details):n(t)):(t.data=this.response,n(t))}}else i("No response")},c.onerror=function(){i(c.status)},c.ontimeout=function(){i(408)}):(d=!1,c.onreadystatechange=function(){if(4===this.readyState)if(401===this.status){this.getResponseHeader("www-authenticate");var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState)if(200===this.status)if(void 0!==this.response&&""!==this.response){var t={};if("arraybuffer"===this.responseType||null!==this.responseXML)t.data=this.response,n(t);else{var r=JSON.parse(this.response);"object"==typeof r?(t.data=r,"Fail"===t.data.Response?i(t.data.Error.Details):n(t)):(t.data=this.response,n(t))}}else i("No response");else i(e.status)},e.open("GET",a,!0,o.digest.username,o.digest.password),e.timeout=5e3,e.setRequestHeader("Accept","application/json"),e.ontimeout=function(){i(408)},e.send()}else if(200===this.status)if(void 0!==this.response&&""!==this.response){var t={};if("arraybuffer"===this.responseType||null!==this.responseXML)t.data=this.response,n(t);else{var r=JSON.parse(this.response);"object"==typeof r?(t.data=r,"Fail"===t.data.Response?i(t.data.Error.Details):n(t)):(t.data=this.response,n(t))}}else i("No response")}),c.open("GET",a,!0,o.digest.username,o.digest.password),c.timeout=5e3,c.ontimeout=function(){i(408)},c.onerror=function(){i(c.status)},c.setRequestHeader("Accept","application/json"),c.setRequestHeader("Cache-Control","no-cache"),l(a),Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0){var p=$timeout(function(){d=!0,c.send()},500);u&&$timeout(function(){d&&($timeout.cancel(p),i("408"))},1e4)}else c.send()},n.clearDigestCache=function(){l("Clearing the Diegest cache !!!!!!!!!!!! "),t=void 0};var h=function(e,t,n,i,r){var a,o;(o=p(e,t,!1,"",r)).onreadystatechange=function(){var a,o;this.readyState===this.HEADERS_RECEIVED&&(a=this.getResponseHeader("www-authenticate"),o=p(e,t,!0,a,r)),this.readyState===XMLHttpRequest.DONE&&(401===this.status?(a=this.getResponseHeader("www-authenticate"),(o=p(e,t,!0,a,r)).onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&(200===this.status?void 0!==this.response&&""!==this.response?c(this,n,i,r):i("No response"):(490===this.status&&(ModalManagerService.open("message",{buttonCount:0,message:"Exceeded maximum login attempts, please try after some time"}),$location.path("/login")),i("HTTP Error : ",this.status)))},o.onerror=function(){l("error response status"+o.status)},l(t),"undefined"!=typeof fileData&&null!==fileData&&""!==fileData?o.send(fileData):o.send()):200===this.status?void 0!==this.response&&""!==this.response?c(this,n,i,r):i("No response"):(490===this.status&&(ModalManagerService.open("message",{buttonCount:0,message:"Exceeded maximum login attempts, please try after some time"}),$location.path("/login")),i("HTTP Error : ",this.status)))},o.onerror=function(){l("error response status"+this.status)},l("=====================================>",o),o.send(),200===o.status?void 0!==o.response&&""!==o.response?c(o,n,i,r):i("No response"):401===o.status?(a=o.getResponseHeader("www-authenticate"),l("sync wwwAuthenticate : ",a),(o=p(e,t,!1,a,r)).send(),200===o.status?void 0!==o.response&&""!==o.response?c(o,n,i,r):i("No response"):490===o.status?u(i,o):i("HTTP Error : ",o.status)):490===o.status?u(i,o):i("HTTP Error : ",o.status)},m=function(e,t,n,i,r,a,o,s){var u;if(d(u=p(e,t,!0,"",s),e,r,t,i),void 0!==o){var h=0;for(h=0;h<o.length;h+=1)u.setRequestHeader(o[h].Type,o[h].Header)}u.onreadystatechange=function(){var o,u;switch(this.readyState){case this.DONE:l("Done");break;case this.LOADING:l("Loading");break;case this.OPENED:l("Opened");break;case this.HEADERS_RECEIVED:l("Header received");break;case this.UNSENT:l("Unsent")}this.readyState===this.DONE&&(401===this.status?(o=this.getResponseHeader("www-authenticate"),l("async wwwAuthenticate : ",o),d(u=p(e,t,!0,o,s),e,r,t,i),u.onreadystatechange=function(){this.readyState===this.DONE&&(200===this.status?void 0!==this.response&&""!==this.response?c(this,n,i,s):i("No response"):(490===this.status&&(void 0!==ModalManagerService&&(ModalManagerService.open("message",{buttonCount:0,message:"Exceeded maximum login attempts, please try after some time"}),$location.path("/login")),i(this.status)),i(this.status)))},u.onerror=function(){l("error response status"+this.status)},l(t),void 0!==a&&null!==a&&""!==a?u.send(a):u.send()):200===this.status?void 0!==this.response&&""!==this.response?(l(this.response),c(this,n,i,s)):i("No response"):(490===this.status&&(ModalManagerService.open("message",{buttonCount:0,message:"Exceeded maximum login attempts, please try after some time"}),$location.path("/login")),i("HTTP Error : ",this.status)))},u.onerror=function(){l("error response status"+this.status)},l(t),void 0!==a&&null!==a&&""!==a?u.send(a):u.send()},f=function(){for(var e="",t=0;t<16;t++){var n=Math.round(Math.random()*"abcdef0123456789".length);e+="abcdef0123456789".substr(n,1)}return e},g=function(e,t,n,i,r,a,o,s,l){var c=CryptoJS.MD5(e+":"+i+":"+t).toString(),u=CryptoJS.MD5(r+":"+n).toString();return CryptoJS.MD5(c+":"+a+":"+y(o,8)+":"+s+":"+l+":"+u).toString()},v=function(e){var t,n=e,i=null,r=null,a=null,o=null,s=null,l=null;if(null!==n){i=(n=n.split(","))[0].split(/\s/)[0];for(var c=0;c<n.length;c++){var u=n[c].split("="),d=u[0],p=u[1].replace(/\"/g,"").trim();null!==d.match(/realm/i)&&(r=p),null!==d.match(/nonce/i)&&(a=p),null!==d.match(/opaque/i)&&(o=p),null!==d.match(/qop/i)&&(s=p)}t={scheme:i,realm:r,nonce:a,opaque:o,qop:s,cnonce:f(),nc:++l}}return t},y=function(e,t){var n=Number(e).toString(16);for(t=void 0===t||null===t?t=2:t;n.length<t;)n="0"+n;return n},b=function(e){var t="";for(var n in e)"boolean"==typeof e[n]?t+="&"+n+"="+(!0===e[n]?"True":"False"):t+="&"+n+"="+e[n];return t};return s.prototype={get:function(e,t,i,r,a,o,s){return n.get(e,t,i,r,a,o,s)},post:function(e,t,i,r,a,o,s){return n.post(e,t,i,r,a,o,s)},setTimeout:function(e){"undefined"!==e&&(o.digest.timeout=e)}},new s(e)}sunapiException=function(){},sunapiException.prototype.toString=function(){return"["+(this.name||"unknown")+"] "+(this.message||"no description")};var sunapiManager=function(){var e,t=log4javascript.getLogger(),n="system.cgi",i="media.cgi",r="recording.cgi",a="video.cgi",o="deviceinfo",s="videoprofile",l="videoprofilepolicy",c="streamuri",u="sessionkey",d="storage",p="general",h="searchrecordingperiod",m="calendarsearch",f="overlapped",g="timeline",v="snapshot",y="view",b={ClientIPAddress:"127.0.0.1",cameraIp:"",captureName:"",username:"",password:"",port:80,protocol:window.location.protocol.split(":")[0],hostname:"",deviceType:"nvr",timeout:10,debug:!0,async:!1},w=function(){return"0.0.2"};function C(){C.prototype.version=w()}return C.prototype={init:function(t){b=t;var n=window.location.protocol.split(":");b.protocol!==n[0]&&(b.protocol=n[0]),"nvr"!==t.deviceType&&(t.hostname=t.cameraIp,t.username=t.user),t.port!==window.location.port&&(b.port=t.port),void 0!==e&&(e=null),void 0===e&&(e=new SunapiClient(b))},getSunapiClient:function(){return e},setSunapiClient:function(t){e=t},getDeviceInfo:function(){return new Promise(function(t,i){var r="/stw-cgi/"+n;r+="?msubmenu="+o,r+="&action="+y;try{e.get(r,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),void 0!==callback&&null!=callback?callback(e):t(e)},function(e){void 0!==callback&&null!=callback?callback(e):i(e)},"",!!b.async)}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getSnapshot:function(t,n){return new Promise(function(i,r){var o="/stw-cgi/"+a;if(o+="?msubmenu="+v,o+="&action="+y,null!==t&&void 0!==t){if(!Number.isInteger(Number(t)))throw new umpError({errorCode:fromHex("0x0409"),message:"Invalid profile number"});o+="&Profile="+t}if(null!==n&&void 0!==n){if(!Number.isInteger(Number(n)))throw new umpError({errorCode:fromHex("0x0409"),message:"Invalid profile number"});o+="&Channel="+n}else o+="&Channel=0";try{e.get(o,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&0!==e.data.size&&(void 0!==callback&&null!=callback?callback(e):i(e))},function(e){void 0!==callback&&null!=callback?callback(e):r(e)},"",!0)}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getVideoProfileAll:function(){return new Promise(function(n,r){var a="/stw-cgi/"+i;a+="?msubmenu="+s,a+="&action="+y;t.debug("sunapi URI",a);try{e.get(a,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),void 0!==callback&&null!=callback?callback(e.VideoProfiles):n(e.VideoProfiles)},function(e){void 0!==callback&&null!=callback?callback(e):r(e)},"",!!b.async)}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getVideoProfile:function(n){return new Promise(function(r,a){var o="/stw-cgi/"+i;o+="?msubmenu="+s,o+="&action="+y,void 0!==n&&(t.debug("request channel number: "+n),o+="&Channel="+n);t.debug("sunapi URI",o);try{e.get(o,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),void 0!==callback&&null!=callback?callback(e.VideoProfiles):r(e.VideoProfiles)},function(e){void 0!==callback&&null!=callback?callback(e):a(e)},"",!!b.async)}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getVideoProfilePolicyAll:function(){return new Promise(function(n,r){var a="/stw-cgi/"+i;a+="?msubmenu="+l,a+="&action="+y;t.debug("sunapi URI",a);try{e.get(a,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),void 0!==callback&&null!=callback?callback(e.VideoProfilePolicies):n(e.VideoProfilePolicies)},function(e){void 0!==callback&&null!=callback?callback(e):r(e)},"",!!b.async)}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getVideoProfilePolicy:function(n){return new Promise(function(r,a){var o="/stw-cgi/"+i;o+="?msubmenu="+l,o+="&action="+y,void 0!==n&&(t.debug("request channel number: "+n),o+="&Channel="+n);t.debug("sunapi URI",o);try{e.get(o,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),void 0!==callback&&null!=callback?callback(e.VideoProfilePolicies):r(e.VideoProfilePolicies)},function(e){void 0!==callback&&null!=callback?callback(e):a(e)},"",!!b.async)}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getRtspStreamURL:function(n,r,a,o){return new Promise(function(s,l){t.debug("getRtspURL: channel ("+n+"), profile: ("+r+")), MediaType: ("+a+"), mode: ("+o);var u="/stw-cgi/"+i;u+="?msubmenu="+c,u+="&action="+y,void 0!==n&&(t.debug("request channel number: "+n),u+="&Channel="+n),void 0!==r&&(t.debug("request profile number: "+r),u+="&Profile="+r),void 0!==o&&(u+="&Mode="+o),void 0!==a&&(u+="&MediaType="+a),u+="&StreamType=RTPUnicast&TransportProtocol=TCP&RTSPOverHTTP=False&ClientType=PC";t.debug("sunapi URI",u);try{e.get(u,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),void 0!==callback&&null!=callback?callback(e):s(e)},function(e){void 0!==callback&&null!=callback?callback(e):l(e)},"",!!b.async)}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getSessionKey:function(){return new Promise(function(n,r){t.debug("getSessionKey");var a="/stw-cgi/"+i;a+="?msubmenu="+u,a+="&action="+y;t.debug("sunapi URI",a);try{e.get(a,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),e,void 0!==callback&&null!=callback?callback(e):n(e)},function(e){void 0!==callback&&null!=callback?callback(e):r(e)},"",!!b.async),e.join()}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getStorageInfo:function(){return new Promise(function(n,i){t.debug("getStorageInfo");var a="/stw-cgi/"+r;a+="?msubmenu="+d,a+="&action="+y;t.debug("sunapi URI",a);try{e.get(a,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),e,void 0!==callback&&null!=callback?callback(e):n(e)},function(e){void 0!==callback&&null!=callback?callback(e):i(e)},"",!!b.async),e.join()}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getRecordingSetup:function(){return new Promise(function(n,i){t.debug("getRecordingSetup");var a="/stw-cgi/"+r;a+="?msubmenu="+p,a+="&action="+y;t.debug("sunapi URI",a);try{e.get(a,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),e,void 0!==callback&&null!=callback?callback(e):n(e)},function(e){void 0!==callback&&null!=callback?callback(e):i(e)},"",!!b.async),e.join()}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getSearchRecordingPeriod:function(){return new Promise(function(n,i){t.debug("getSearchRecordingPeriod");var a="/stw-cgi/"+r;a+="?msubmenu="+h,a+="&action="+y;t.debug("sunapi URI",a);try{e.get(a,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),e,void 0!==callback&&null!=callback?callback(e):n(e)},function(e){void 0!==callback&&null!=callback?callback(e):i(e)},"",!!b.async),e.join()}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getCalendarSearch:function(n,i){return new Promise(function(a,o){t.debug("getCalendarSearch");var s="/stw-cgi/"+r;s+="?msubmenu="+m,s+="&action="+y,void 0!==n&&(t.debug("request month: "+n),s+="&Month="+n),void 0!==i?(t.debug("request ChannelIdList number: "+i),s+="&ChannelIdList="+i):e.setTimeout(15e3);t.debug("sunapi URI",s);try{e.get(s,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),void 0!==callback&&null!=callback?callback(e):a(e)},function(e){void 0!==callback&&null!=callback?callback(e):o(e)},"",!!b.async),e.join()}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getOverlappedIdList:function(n,i,a){return new Promise(function(o,s){t.debug("getOverlappedIdList");var l="/stw-cgi/"+r;if(l+="?msubmenu="+f,l+="&action="+y,void 0===n||void 0===i)throw new sunapiException("Invalid Parameter. This request do not execute.");t.debug("From Date: "+n+", ToDate"+i),l+="&FromDate="+n,l+="&ToDate="+i,void 0!==a&&(t.debug("request ChannelIdList number: "+a),l+="&ChannelIdList="+a);t.debug("sunapi URI",l);try{e.get(l,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),void 0!==callback&&null!=callback?callback(e):o(e)},function(e){void 0!==callback&&null!=callback?callback(e):s(e)},"",!!b.async),e.join()}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})},getTimeline:function(n,i,a,o,s){return new Promise(function(l,c){t.debug("getTimeline");var u="/stw-cgi/"+r;if(u+="?msubmenu="+g,u+="&action="+y,void 0===n)throw new sunapiException("Invalid Parameter. This request do not execute.");if(t.debug("From Date: "+n),u+="&FromDate="+n,void 0===i)throw new sunapiException("Invalid Parameter. This request do not execute.");t.debug("ToDate"+i),u+="&ToDate="+i,void 0!==a&&(t.debug("request ChannelIdList number: "+a),u+="&ChannelIdList="+a),void 0!==o?(t.debug("request ChannelIdList number: "+o),u+="&OverlappedID="+o):u+="&OverlappedID=",u+=void 0!==s?"&Type="+s:"&Type=All";t.debug("sunapi URI",u);try{e.get(u,{},function(e){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.data&&(e=e.data),void 0!==callback&&null!=callback?callback(e):l(e)},function(e){void 0!==callback&&null!=callback?callback(e):c(e)},"",!!b.async),e.join()}catch(e){throw new umpError({errorCode:fromHex("0x0700"),message:e.message})}})}},new C},sunapiRestClient=function(){var e,t,n,i,r,a=log4javascript.getLogger(),o={serverType:"camera",hostname:"",port:80,protocol:"http",rtspPort:554,ClientIPAddress:"127.0.0.1",username:"",password:""},s=null,l=function(){return"0.0.1"};function c(){this,c.prototype.version=l()}return c.prototype={init:function(e){if(a.info("Version: "+c.prototype.version),void 0!==e.deviceType&&""!==e.deviceType&&null!==e.deviceType?o.serverType=e.deviceType:console.warn("The device type is not defined, set to 'camera' by default."),"nvr"===o.serverType&&(void 0===e.hostname||""===e.hostname&&null===e.hostname))throw new umpError({errorCode:fromHex("0x0401"),place:"sunapiClient.js:52",message:"hostname is empty from input parameter."});if("camera"===o.serverType&&(void 0===e.cameraIp||""===e.cameraIp||null===e.cameraIp))throw new umpError({errorCode:fromHex("0x0400"),place:"sunapiClient.js:60",message:"cameraIP is empty from input parameter."});if("nvr"===o.serverType&&(void 0===e.username||""===e.username||null===e.username))throw new umpError({errorCode:fromHex("0x0402"),place:"sunapiClient.js:70",message:"username is empty from input parameter."});if("camera"===o.serverType&&(void 0===e.user||""===e.user||null===e.user))throw new umpError({errorCode:fromHex("0x0402"),place:"sunapiClient.js:78",message:"user id is empty from input parameter."});if(void 0===e.password||""===e.password||null===e.password)throw new umpError({errorCode:fromHex("0x0403"),place:"sunapiClient.js:80",message:"password is empty from input parameter."});var t=window.location.protocol.split(":");o.serverType=e.deviceType,o.hostname=e.hostname,o.port=e.port,o.protocol=t[0],o.ClientIPAddress=e.ClientIPAddress,o.username=e.username,o.password=e.password},get:function(l,c,u,d,p,h,m){return e=u,t=d,function(l,c,u,d,p){s={async:!!d,deviceInfo:o,method:"get",uri:l,body:c,scope:u,isText:p,auth:i,promise:!0},n=new Worker("/media/ump/Worker/sunapi/sunapiRequestTask.js"),r=new Promise(function(r,o){n.onmessage=function(n){a.debug("onMessage Event: ",JSON.stringify(n)),""!==n.data&&null!==n.data&&void 0!==n.data&&("auth"===n.data.id?"object"==typeof n.data.auth&&(i=n.data.auth):(n.data.success&&"response"===n.data.id?e(n.data.response):t(n.data),r(),this.terminate()))},n.onerror=function(e){a.error("Worker Error: "+e)}}),n.postMessage(s)}(l,c,p,h,m)},post:function(l,c,u,d,p,h,m){return e=u,t=d,function(l,c,u,d,p){s={async:!0,deviceInfo:o,method:"post",uri:l,body:c,scope:u,file:d,header:p,isText:isText,auth:i,promise:!0},n=new Worker("/media/ump/Worker/sunapi/sunapiRequestTask.js"),r=new Promise(function(r,o){n.onmessage=function(n){a.debug("onMessage Event: ",JSON.stringify(n)),""!==n.data&&null!==n.data&&void 0!==n.data&&("auth"===n.data.id?"object"==typeof n.data.auth&&(i=n.data.auth):(n.data.success&&"response"===n.data.id?e(n.data.response):t(n.data),r(),this.terminate()))},n.onerror=function(e){a.error("Worker Error: "+e)}}),n.postMessage(s)}(l,c,p,h,m)},join:function(){Promise.resolve(r)},setTimeout:function(e){"undefined"!==e&&(o.timeout=e)}},new c},RTSP=function(){var e=log4javascript.getLogger("rtsp:parser"),t={};t.Enum("Basic","Digest");function n(){n.prototype.channelId=0}return{}.Enum("OPTIONS ","DESCRIBE","SETUP","PLAY","PAUSE","GET_PARAMETER","SET_PARAMETER","RECORD","ANNOUNCE","REDIRECT","TEARDOWN"),n.prototype={init:function(){e.info("Session::init"),this.sequence_number=0,this.version=0,this.status=new RtspStatusCode(-1),this.auth=t.Basic},rtspParser:function(n){if(-1!==n.search("Content-Type: application/sdp")){var i=n.split("\r\n\r\n");n=i[0]}var r=this;n.split("\r\n").forEach(function(i){if(i.toLowerCase().indexOf("rtsp")>=0){var a=i.split(" "),o=r;a.forEach(function(t){t.toLowerCase().indexOf("rtsp")>=0&&(o.version=t.split("/")[1],e.debug("RTSP Version:",o.version)),isNaN(parseInt(t))||(o.status=new RtspStatusCode(parseInt(t)),e.debug("RTSP Status:",o.status.getStatusCode(),o.status.getDescription()))})}if(i.toLowerCase().indexOf("cseq")>=0){var s=i.search("CSeq: ")+5;r.CSeq=parseInt(n.slice(s,s+10))+1,e.debug("RTSP CSeq:",r.CSeq)}if(i.toLowerCase().indexOf("www-authenticate")>=0){a=i.split(" ");e.debug("RTSP Authenticate Info.:",JSON.stringify(a));o=r;a.forEach(function(n){if(n.toLowerCase().indexOf("basic")>=0?o.auth=t.Basic:n.toLowerCase().indexOf("digest")>=0&&(o.auth=t.Digest),n.toLowerCase().indexOf("realm")>=0){var i=/[",]/g;o.realm=n.split("=")[1].replace(i,""),e.debug("RTSP realm Info.:",JSON.stringify(o.realm))}if(n.toLowerCase().indexOf("nonce")>=0){i=/[",]/g;o.nonce=n.split("=")[1].replace(i,""),e.debug("RTSP nonce Info.:",JSON.stringify(o.nonce))}if(n.toLowerCase().indexOf("opaque")>=0){i=/[",]/g;o.opaque=n.split("=")[1].replace(i,""),e.debug("RTSP opaque Info.:",JSON.stringify(o.opaque))}if(n.toLowerCase().indexOf("qop")>=0){i=/[",]/g;o.qop=n.split("=")[1].replace(i,""),e.debug("RTSP qop Info.:",JSON.stringify(o.qop))}if(n.toLowerCase().indexOf("algorithm")>=0){i=/[",]/g;o.algorithm=n.split("=")[1].replace(i,""),e.debug("RTSP qop Info.:",JSON.stringify(o.algorithm))}})}if(i.toLowerCase().indexOf("date:")>=0&&(r.date=new Date(i.split(": ")[1]),e.debug("RTSP date Info.:",r.date)),i.toLowerCase().indexOf("public:")>=0){a=i.split(": ")[1].replace(/[ ]/g,"");r.control_messages=a.split(","),e.debug("RTSP public Info.:",JSON.stringify(r.control_messages))}})},onOptionMessage:function(e){},onDescribeMessage:function(e){},onSetupMessage:function(e){}},Object.defineProperty(this,"CSeq",{get:function(){return sequence_number_},set:function(e){sequence_number_=e}}),Object.defineProperty(this,"status",{get:function(){return status_},set:function(e){status_=e}}),Object.defineProperty(this,"version",{get:function(){return version_},set:function(e){version_=e}}),Object.defineProperty(this,"auth",{get:function(){return auth_},set:function(e){auth_=e}}),Object.defineProperty(this,"realm",{get:function(){return realm_},set:function(e){realm_=e}}),Object.defineProperty(this,"nonce",{get:function(){return nonce_},set:function(e){nonce_=e}}),Object.defineProperty(this,"date",{get:function(){return date_},set:function(e){date_=e}}),Object.defineProperty(this,"control_messages",{get:function(){return control_messages_},set:function(e){control_messages_=e}}),new n},RtspClient=function(e){var t,n,i,r,a,o,s,l,c,u,d,p,h,m=log4javascript.getLogger("rtsp"),f={},g="off",v="GET_PARAMETER",y="",b=[],w=new DigestGenerator,C=1,S=!1,_=0,T=null,x="",E=!1,I=null,k=null,A=!1,R=!1,L=!1,P=!1,M=new RTSP,D={},N={},H=new RtpClient(e),U=function(n,i,a){var o="",s="User-Agent: "+r+"\r\n";switch(n){case"OPTIONS":case"TEARDOWN":case"GET_PARAMETER":case"SET_PARAMETERS":o=n+" "+t+" RTSP/1.0\r\nCSeq: "+C+"\r\n"+y+s+"\r\n";break;case"DESCRIBE":o="on"==g?n+" "+t+" RTSP/1.0\r\nCSeq: "+C+"\r\n"+y+"Require: www.onvif.org/ver20/backchannel\r\n"+s+"\r\n":n+" "+t+" RTSP/1.0\r\nCSeq: "+C+"\r\n"+y+s+"\r\n";break;case"SETUP":o=-1!==i.toLowerCase().indexOf("rtsp:")?n+" "+i+" RTSP/1.0\r\nCSeq: "+C+"\r\n"+y+s:void 0!==D.ContentBase?n+" "+D.ContentBase+i+" RTSP/1.0\r\nCSeq: "+C+"\r\n"+y+s:n+" "+t+"/"+i+" RTSP/1.0\r\nCSeq: "+C+"\r\n"+y+s,a&&(o+=a),o+="\r\n";break;case"PLAY":i?(o=n+" "+i+" RTSP/1.0\r\n",t=i):o=n+" "+t+" RTSP/1.0\r\n",o+="CSeq: "+C+"\r\nSession: "+T+"\r\n",o+=s,"playback"!==x&&"backup"!==x||(o+="camera"===h?"Require: samsung-replay-timezone\r\n":"Require: onvif-replay\r\n"),a&&(o+=a),o+="\r\n";break;case"PAUSE":i?(o=n+" "+i+" RTSP/1.0\r\n",t=i):o=n+" "+t+" RTSP/1.0\r\n",o+="CSeq: "+C+"\r\nSession: "+T+"\r\n",o+=s,a&&(o+=a),o+="\r\n"}return m.debug("RTSP Send [Channel "+e.getChannel()+"]: "+o),o};f.parseDescribeResponse=function(e){var t,n={};(n.Sessions=[],-1!==e.search("Content-Type: application/sdp"))?t=e.split("\r\n\r\n")[1]:t=e;var i,r=t.split("\r\n"),a=!1;for(i=0;i<r.length;i++){var o=r[i].split("=");if(o.length>0)switch(o[0]){case"a":var s=o[1].split(":");if(s.length>1)if("control"==s[0]){var l=r[i].search("control:");1==a?-1!==l&&(n.Sessions[n.Sessions.length-1].ControlURL=r[i].substr(l+8)):-1!==l&&(n.BaseURL=r[i].substr(l+8))}else if("rtpmap"==s[0]){var c=s[1].split(" ");n.Sessions[n.Sessions.length-1].PayloadType=c[0];var u=c[1].split("/");n.Sessions[n.Sessions.length-1].CodecMime=u[0],u.length>1&&(n.Sessions[n.Sessions.length-1].ClockFreq=u[1])}else if("framesize"==s[0]){var d=s[1].split(" ");if(d.length>1){var p=d[1].split("-");n.Sessions[n.Sessions.length-1].Width=p[0],n.Sessions[n.Sessions.length-1].Height=p[1]}}else if("framerate"==s[0])n.Sessions[n.Sessions.length-1].Framerate=s[1];else if("fmtp"==s[0]){var h=r[i].split(" ");if(h.length<2)continue;for(var m=1;m<h.length;m++){var f,g=h[m].split(";");for(f=0;f<g.length;f++){var v=g[f].search("mode=");if(-1!==v&&(n.Sessions[n.Sessions.length-1].mode=g[f].substr(v+5)),-1!==(v=g[f].search("config="))&&(n.Sessions[n.Sessions.length-1].config=g[f].substr(v+7),N.config=n.Sessions[n.Sessions.length-1].config,N.clockFreq=n.Sessions[n.Sessions.length-1].ClockFreq,N.bitrate=n.Sessions[n.Sessions.length-1].Bitrate),-1!==(v=g[f].search("sprop-vps="))&&(n.Sessions[n.Sessions.length-1].VPS=g[f].substr(v+10)),-1!==(v=g[f].search("sprop-sps="))&&(n.Sessions[n.Sessions.length-1].SPS=g[f].substr(v+10)),-1!==(v=g[f].search("sprop-pps="))&&(n.Sessions[n.Sessions.length-1].PPS=g[f].substr(v+10)),-1!==(v=g[f].search("sprop-parameter-sets="))){var y=g[f].substr(v+21).split(",");y.length>1&&(n.Sessions[n.Sessions.length-1].SPS=y[0],n.Sessions[n.Sessions.length-1].PPS=y[1])}}}}break;case"m":var b=o[1].split(" "),w={};w.Type=b[0],w.Port=b[1],w.Payload=b[3],n.Sessions.push(w),a=!0;break;case"b":if(1==a){var C=o[1].split(":");n.Sessions[n.Sessions.length-1].Bitrate=C[1]}}}return n},f.toStringExtensionScale=function(e){var t="";return"string"==typeof e?t+="Scale: "+e+"\r\n":0===Number(e)?t+="Scale: +"+e.toFixed(1).toString()+"\r\n":t+="Scale: "+e.toFixed(1).toString()+"\r\n",t},f.parseRtspResponse=function(e){var t,n,i,r,a={};-1!==e.search("Content-Type: application/sdp")?r=e.split("\r\n\r\n")[0]:r=e;var o=r.split("\r\n"),s=o[0].split(" ");if(s.length>2&&(a.ResponseCode=parseInt(s[1]),a.ResponseMessage=s[2]),200===a.ResponseCode){for(t=1;t<o.length;t++)if("Public"===(i=o[t].split(":"))[0])a.MethodsSupported=i[1].split(",");else if("CSeq"===i[0])a.CSeq=parseInt(i[1]);else if("Content-Type"===i[0])a.ContentType=i[1],-1!==a.ContentType.search("application/sdp")&&(a.SDPData=this.parseDescribeResponse(e));else if("Content-Length"===i[0])a.ContentLength=parseInt(i[1]);else if("Content-Base"===i[0]){var l=o[t].search("Content-Base:");-1!==l&&(a.ContentBase=o[t].substr(l+13))}else if("Session"===i[0]){var c=i[1].split(";");a.SessionID=parseInt(c[0])}else if("Transport"===i[0]){var u=i[1].split(";");for(n=0;n<u.length;n++){var d=u[n].search("interleaved=");if(-1!==d){var p=u[n].substr(d+12).split("-");p.length>1&&(a.RtpInterlevedID=parseInt(p[0]),a.RtcpInterlevedID=parseInt(p[1]))}}}else if("RTP-Info"===i[0]){i[1]=o[t].substr(9);var h=i[1].split(",");for(a.RTPInfoList=[],n=0;n<h.length;n++){var m,f=h[n].split(";"),g={};for(m=0;m<f.length;m++){var v=f[m].search("url=");-1!==v&&(g.URL=f[m].substr(v+4)),-1!==(v=f[m].search("seq="))&&(g.Seq=parseInt(f[m].substr(v+4)))}a.RTPInfoList.push(g)}}}else if(401===a.ResponseCode)for(t=1;t<o.length;t++)if("CSeq"===(i=o[t].split(":"))[0])a.CSeq=parseInt(i[1]);else if("WWW-Authenticate"===i[0]){var y=i[1].split(",");for(n=0;n<y.length;n++){var b=y[n].search("Digest realm=");if(-1!==b){var w=y[n].substr(b+13).split('"');a.Realm=w[1]}if(-1!==(b=y[n].search("nonce="))){var C=y[n].substr(b+6).split('"');a.Nonce=C[1]}}}return a};var F=function(){var e="";"Options"===c?o.SendRtspCommand(U("OPTIONS",null,null)):"Describe"===c?o.SendRtspCommand(U("DESCRIBE",null,null)):"Setup"===c?(e="Transport: RTP/AVP/TCP;unicast;interleaved="+(2*u).toString()+"-"+(2*u+1).toString()+"\r\n",o.SendRtspCommand(U("SETUP",b[u].trackID,e))):"Play"===c?("playback"===x?e="Immediate: yes\r\nScale: 1.000000\r\nRange: npt=0.000-\r\nRate-Control: yes\r\n":"backup"===x&&(e+="Rate-Control: no\r\n"),o.SendRtspCommand(U("PLAY",null,e)),R=!1):"Pause"===c?(o.SendRtspCommand(U("PAUSE",null,null)),R=!0):"Teardown"===c&&o.SendRtspCommand(U("TEARDOWN",null,null))},O=function(t){var n=0;"backup"!==t&&"playback"!==t||null===k&&(k=setInterval(function(){if(A)n=0;else{if(n>3)return clearInterval(k),k=null,void l({errorCode:fromHex("0x0601"),oldErrorCode:"990",description:"end of backup",place:"RtspClient.js:473",channelId:e.getChannel()});n++}A=!1},1e3))};function B(){return setInterval(function(){o&&(o.SendRtspCommand(U(v,null,null)),P=!0)},1e4)}function j(){return setInterval(function(){if(m.debug("RTP running = ",A,", alive counter = ",_),!A){if(_>6){if(clearInterval(k),clearInterval(I),k=null,I=null,S)try{o.SendRtspCommand(U(v,null,null)),L=!0,setTimeout(function(){L&&(L=!1,l({errorCode:fromHex("0x0209"),oldErrorCode:"999",description:"no rtsp response",place:"RtspClient.js:515",channelId:e.getChannel()}))},5e3)}catch(t){l({errorCode:fromHex("0x0209"),oldErrorCode:"999",description:"no rtsp response",place:"RtspClient.js:525",channelId:e.getChannel()})}else l({errorCode:fromHex("0x0006"),type:"rtsp",description:"tranport is not exist",place:"RtspClient.js:534",channelId:e.getChannel()});return}_++}f.instantplayback||(R||"live"===x)&&(A=!1)},1e3)}return f.RtspResponseHandler=function(r){var a,g,v="";M.rtspParser(r),m.debug("RTSP Version",M.version,"RTSP Status:",M.status.toString(),"RTSP CSeq:",M.CSeq);var S=r.search("CSeq: ")+5;if(C=parseInt(r.slice(S,S+10))+1,m.debug("RTSP Recv [Channel "+e.getChannel()+"]: "+r),a=f.parseRtspResponse(r),L&&(L=!1,200===a.ResponseCode?(I=B(),k=j()):l({errorCode:fromHex("0x0209"),oldErrorCode:"999",description:"no rtsp response",place:"RtspClient.js:572",channelId:e.getChannel()})),401===a.ResponseCode)!function(r){var a,o=r.slice(r.search("WWW-Authenticate"),r.length),l=w.getDigestInfoInWwwAuthenticate(o),u={};if(u.Method=c.toUpperCase(),u.Realm=l.realm,u.Nonce=l.nonce,u.Uri=encodeURIComponent(t),void 0!==i&&null!==i&&"string"==typeof i&&""!==i)a=w.formulateResponse(n,i,t,u.Realm,u.Method,u.Nonce),y='Authorization: Digest username="'+n+'", realm="'+l.realm+'", ',y+='nonce="'+l.nonce+'", uri="'+t+'", response="'+a+'"\r\n',F();else{if(null===s||void 0===s)throw new umpError({channelId:e.getChannel(),errorCode:fromHex("0x0403"),place:"rtspClient.js:404",message:"The sunapi client & password is not exist. If you want to connect deivce, you have to put the user password or sunapi client for device connect"});s.get("/stw-cgi/security.cgi?msubmenu=digestauth&action=view",u,function(e){a="camera"===h?e.data.Response:void 0!==e.data?e.data.Response:e.Response,y='Authorization: Digest username="'+n+'", realm="'+l.realm+'", ',y+='nonce="'+l.nonce+'", uri="'+t+'", response="'+a+'"\r\n',F()},function(e,t){m.error(e)},"",!0)}}(r);else if(200===a.ResponseCode){if("Options"===c)c="Describe",o.SendRtspCommand(U("DESCRIBE",null,null)),"Setup";else if("Describe"===c){E=!1,D=f.parseDescribeResponse(r),void 0!==a.ContentBase&&(D.ContentBase=a.ContentBase);var _=0;for(_=0;_<D.Sessions.length;_+=1){var N={};"JPEG"===D.Sessions[_].CodecMime||"H264"===D.Sessions[_].CodecMime||"H265"===D.Sessions[_].CodecMime?(N.codecName=D.Sessions[_].CodecMime,N.trackID=D.Sessions[_].ControlURL,N.ClockFreq=D.Sessions[_].ClockFreq,N.Port=parseInt(D.Sessions[_].Port),void 0!==D.Sessions[_].Framerate&&(N.Framerate=parseInt(D.Sessions[_].Framerate)),b.push(N)):"PCMU"===D.Sessions[_].CodecMime||-1!==D.Sessions[_].CodecMime.search("G726-16")||-1!==D.Sessions[_].CodecMime.search("G726-24")||-1!==D.Sessions[_].CodecMime.search("G726-32")||-1!==D.Sessions[_].CodecMime.search("G726-40")?-1!==D.Sessions[_].ControlURL.search("trackID=t")||-1!==D.Sessions[_].ControlURL.search("trackID=back")?(N.codecName="G.711",N.trackID=D.Sessions[_].ControlURL,N.Port=parseInt(D.Sessions[_].Port),N.Bitrate=parseInt(D.Sessions[_].Bitrate),b.push(N),E=!0):("PCMU"===D.Sessions[_].CodecMime?N.codecName="G.711":"G726-16"===D.Sessions[_].CodecMime?N.codecName="G.726-16":"G726-24"===D.Sessions[_].CodecMime?N.codecName="G.726-24":"G726-32"===D.Sessions[_].CodecMime?N.codecName="G.726-32":"G726-40"===D.Sessions[_].CodecMime&&(N.codecName="G.726-40"),N.trackID=D.Sessions[_].ControlURL,N.ClockFreq=D.Sessions[_].ClockFreq,N.Port=parseInt(D.Sessions[_].Port),N.Bitrate=parseInt(D.Sessions[_].Bitrate),b.push(N)):"mpeg4-generic"===D.Sessions[_].CodecMime?(N.codecName="mpeg4-generic",N.trackID=D.Sessions[_].ControlURL,N.ClockFreq=D.Sessions[_].ClockFreq,N.Port=parseInt(D.Sessions[_].Port),N.Bitrate=parseInt(D.Sessions[_].Bitrate),N.config=D.Sessions[_].config,b.push(N)):"vnd.onvif.metadata"===D.Sessions[_].CodecMime?(N.codecName="MetaData",N.trackID=D.Sessions[_].ControlURL,N.ClockFreq=D.Sessions[_].ClockFreq,N.Port=parseInt(D.Sessions[_].Port),b.push(N)):(m.debug("Unknown codec type:",D.Sessions[_].CodecMime,D.Sessions[_].ControlURL),l({errorCode:fromHex("0x0300"),description:"Unknown codec type:"+D.Sessions[_].CodecMime+", Control URL:"+D.Sessions[_].ControlURL,place:"RtspClient.js:661",channelId:e.getChannel()}))}c="Setup",v="Transport: RTP/AVP/TCP;unicast;interleaved="+(2*(u=0)).toString()+"-"+(2*u+1).toString()+"\r\n",o.SendRtspCommand(U("SETUP",b[u].trackID,v)),b.length>1?"Setup":"Play"}else"Setup"===c?u<b.length?(b[u].RtpInterlevedID=a.RtpInterlevedID,b[u].RtcpInterlevedID=a.RtcpInterlevedID,T=a.SessionID,(u+=1)!==b.length?(v="Transport: RTP/AVP/TCP;unicast;interleaved="+(2*u).toString()+"-"+(2*u+1).toString()+"\r\n",o.SendRtspCommand(U("SETUP",b[u].trackID,v))):(H.sendSdpInfo(b),E&&H.addListener("audioTalk",f.SendAudioTalkData),c="Play","playback"===x?(v="Immediate: yes\r\n",v+="camera"===h?"Scale: 1.000000\r\n":f.toStringExtensionScale(p),void 0!==d?(v+="Range: clock="+d,-1===d.search("-")&&(v+="-"),v+="\r\n"):v+="Range: npt=0.000-\r\n"):"backup"===x&&(v+="Rate-Control: no\r\n"),o.SendRtspCommand(U("PLAY",null,v)),"Playing","backup"===x&&setTimeout(function(){O(x)},1e3))):m.debug("Unknown setup SDP index",b):"Play"===c?(g=new RtspStatusCode(a.ResponseCode),T=a.SessionID,l({errorCode:fromHex("0x0000"),currentState:c,oldErrorCode:"200",rtspCode:g.getStatusCode(),description:"RTSP Play Streaming: "+g.getStatusCode()+", error message: "+g.getDescription(),name:g.getName(),place:"RtspClient.js:730",channelId:e.getChannel()}),I=B(),"live"===x?k=j():"backup"===x&&O(x),c="Playing",m.debug("Current State: "+c+", Pausing: "+R+", RTPRunning: "+A+", instant playback = "+f.instantplayback)):"Playing"===c?(R&&A?(c="Pause",g=new RtspStatusCode(a.ResponseCode),T=a.SessionID,l({errorCode:fromHex("0x0000"),oldErrorCode:"200",currentState:c,pause:R,rtspCode:g.getStatusCode(),description:"RTSP Pause Streaming: "+g.getStatusCode()+", error message: "+g.getDescription(),name:g.getName(),place:"RtspClient.js:773",channelId:e.getChannel()})):"playback"===x&&(P||(g=new RtspStatusCode(a.ResponseCode),T=a.SessionID,l({errorCode:fromHex("0x0000"),oldErrorCode:"200",currentState:c,pause:R,rtspCode:g.getStatusCode(),description:"RTSP Seek Streaming: "+g.getStatusCode()+", error message: "+g.getDescription(),name:g.getName(),place:"RtspClient.js:790",channelId:e.getChannel()}))),m.info("Current State: "+c+", Pausing: "+R+", RTPRunning: "+A)):"Pause"===c?(!R&&A&&(c="Playing",g=new RtspStatusCode(a.ResponseCode),T=a.SessionID,l({errorCode:fromHex("0x0000"),oldErrorCode:"200",currentState:"Resume",pause:R,rtspCode:g.getStatusCode(),description:"RTSP Resume Streaming: "+g.getStatusCode()+", error message: "+g.getDescription(),name:g.getName(),place:"RtspClient.js:801",channelId:e.getChannel()})),m.debug("Current State: "+c+", Pausing: "+R+", RTPRunning: "+A+", instant playback = "+f.instantplayback)):m.error("unknown rtsp state:",c);P&&(P=!1)}else if(503===a.ResponseCode)"Setup"!==c||-1===b[u].trackID.search("trackID=t")&&-1===b[u].trackID.search("trackID=back")?(m.debug("2nd unknown rtsp state:",c),g=new RtspStatusCode(a.ResponseCode),l({errorCode:fromHex("0x0201"),oldErrorCode:"503",rtspCode:g.getStatusCode(),description:"RTSP error code: "+g.getStatusCode()+", error message: "+g.getDescription(),name:g.getName(),place:"RtspClient.js:861",channelId:e.getChannel()})):(b[u].RtpInterlevedID=-1,b[u].RtcpInterlevedID=-1,u+=1,E=!1,l({errorCode:fromHex("0x020A"),oldErrorCode:"504",description:"Talk Service Unavilable",place:"RtspClient.js:824",channelId:e.getChannel()}),u<b.length?(v="Transport: RTP/AVP/TCP;unicast;interleaved="+(2*u).toString()+"-"+(2*u+1).toString()+"\r\n",o.SendRtspCommand(U("SETUP",b[u].trackID,v))):(c="Play","playback"===x&&(v="Immediate: yes\r\nRate-Control: yes\r\n",v+="camera"===h?"Scale: 1.000000\r\n":this.toStringExtensionScale(p),void 0!==d?(v+="Range: clock="+d,-1===d.search("-")&&(v+="-"),v+="\r\n"):v+="Range: npt=0.000-\r\n"),o.SendRtspCommand(U("PLAY",null,v)),"Playing"));else if(560===a.ResponseCode)g=new RtspStatusCode(a.ResponseCode),l({errorCode:fromHex("0x0204"),rtspCode:g.getStatusCode(),description:"RTSP error code: "+g.getStatusCode()+", error message: "+g.getDescription(),name:g.getName(),place:"RtspClient.js:873",channelId:e.getChannel()});else if(404===a.ResponseCode){if("Options"===c)return g=new RtspStatusCode(a.ResponseCode),void l({errorCode:fromHex("0x0205"),oldErrorCode:"404",rtspCode:g.getStatusCode(),description:"RTSP error code: "+g.getStatusCode()+", error message: "+g.getDescription(),name:g.getName(),place:"RtspClient.js:886",channelId:e.getChannel()})}else if(490===a.ResponseCode){if("Options"===c)return g=new RtspStatusCode(a.ResponseCode),void l({errorCode:fromHex("0x020B"),oldErrorCode:"490",rtspCode:g.getStatusCode(),description:"RTSP error code: "+g.getStatusCode()+", error message: "+g.getDescription(),name:g.getName(),place:"RtspClient.js:901",channelId:e.getChannel()})}else m.warn("RTSP Response: ",JSON.stringify(a)),g=new RtspStatusCode(a.ResponseCode),l({errorCode:fromHex("0x0203"),rtspCode:g.getStatusCode(),description:"RTSP error code: "+g.getStatusCode()+", error message: "+g.getDescription(),name:g.getName(),place:"RtspClient.js:915",channelId:e.getChannel()})},f.RtpDataHandler=function(e,t,n){H.sendRtpData(e,t,n),A=!0,0!==_&&(_=0)},f.SendAudioTalkData=function(e){o&&E&&"on"===g&&o.SendRtpData(e)},f.connectionCbFunc=function(t,n){"open"===t?(C=1,c="Options","Describe",o.SendRtspCommand(U("OPTIONS",null,null))):"error"===t?(m.debug("connection error"+JSON.stringify(n.getObject())),"999"===n.getStatusCode()||("backup"===x?l({errorCode:fromHex("0x0602"),oldErrorCode:-5,description:"backup has error",place:"RtspClient.js:996",channelId:e.getChannel()}):(l({errorCode:fromHex("0x0003"),description:"websocket disconnected error: status code ("+n.getStatusCode()+"), Message: "+n.getDescription(),place:"RtspClient.js:1004",channelId:e.getChannel()}),o.Disconnect())),c="Options","Describe",C=1):"close"===t&&(c="Teardown",o=null,l({errorCode:fromHex("0x0001"),description:"websocket closed: status code ("+n.getStatusCode()+"), Message: "+n.getDescription(),place:"RtspClient.js:962",channelId:e.getChannel()}))},f.SetErrorCallback=function(e){l=e},f.addEventListener=function(e,t){switch(e){case"error":void 0!==t&&(l=t);break;case"status":void 0!==t&&t;break;default:m.error("undefined callback function")}},f.SetSunapiClient=function(e){s=e},f.SetDeviceInfo=function(e){n=e.id,i=e.pw,a=e.wsUrl,t=e.rtspUrl,x=e.mode,d=e.rangeClock,p=e.scale,r=e.useragent,h=e.deviceType,g=e.audioOutStatus},f.Connect=function(){try{null!==o&&void 0!==o||((o=new Transport(a)).setChannel(e.getChannel()),o.SetCallback(this.connectionCbFunc,this.RtspResponseHandler,this.RtpDataHandler,l),o.Connect(),S=!0)}catch(e){m.error("Connection error occurred",e)}},f.Disconnect=function(){null!==o&&void 0!==o&&(o.SendRtspCommand(U("TEARDOWN",null,null)),o.Disconnect(),o=null),clearInterval(I),clearInterval(k),I=null,k=null,S=!1,b=[],y=""},f.close=function(){o.close()},f.ControlStream=function(e){var t="",n=null;o?"resume"===e.media.requestInfo.cmd?(n="PLAY","playback"===e.media.type?(t+="Rate-Control: yes\r\n",void 0!==e.media.requestInfo.scale?t+=this.toStringExtensionScale(e.media.requestInfo.scale):t+="Scale: 1.00000\r\n",void 0!==e.media.requestInfo.rangeClock?(t+="Range: clock="+e.media.requestInfo.rangeClock,-1===e.media.requestInfo.rangeClock.search("-")&&(t+="-"),t+="\r\n"):t+="Range: npt=0.000-\r\n",!0===e.media.needToImmediate&&(t+="Immediate: yes\r\n")):"backup"===e.media.type&&(t+="Rate-Control: no\r\n"),o.SendRtspCommand(U(n,e.media.requestInfo.url,t)),R=!1):"seek"===e.media.requestInfo.cmd?(n="PLAY","playback"===e.media.type||"step"===e.media.type?(t+="Immediate: yes\r\nRate-Control: yes\r\n",void 0!==e.media.requestInfo.scale?t+=this.toStringExtensionScale(e.media.requestInfo.scale):t+="Scale: 1.00000\r\n",void 0!==e.media.requestInfo.rangeClock?(t+="Range: clock="+e.media.requestInfo.rangeClock,-1===e.media.requestInfo.rangeClock.search("-")&&(t+="-"),t+="\r\n"):t+="Range: npt=0.000-\r\n"):"backup"===e.media.type&&(t+="Rate-Control: no\r\nImmediate: yes\r\n"),o.SendRtspCommand(U(n,e.media.requestInfo.url,t)),R=!1):"forward"===e.media.requestInfo.cmd?(n="PLAY","playback"===e.media.type||"step"===e.media.type?(t+="Immediate: yes\r\nRate-Control: yes\r\n",void 0!==e.media.requestInfo.scale?t+=this.toStringExtensionScale(e.media.requestInfo.scale):t+="Scale: 1.00000\r\n",void 0!==e.media.requestInfo.rangeClock?(t+="Range: clock="+e.media.requestInfo.rangeClock,-1===e.media.requestInfo.rangeClock.search("-")&&(t+="-"),t+="\r\n"):t+="Range: npt=0.000-\r\n"):"backup"===e.media.type&&(t+="Rate-Control: no\r\nImmediate: yes\r\n"),o.SendRtspCommand(U(n,e.media.requestInfo.url,t))):"backward"===e.media.requestInfo.cmd?(n="PLAY","playback"===e.media.type||"step"===e.media.type?(t+="Immediate: yes\r\nRate-Control: yes\r\n",void 0!==e.media.requestInfo.scale?t+=this.toStringExtensionScale(e.media.requestInfo.scale):t+="Scale: 1.00000\r\n",void 0!==e.media.requestInfo.rangeClock?(t+="Range: clock="+e.media.requestInfo.rangeClock,-1===e.media.requestInfo.rangeClock.search("-")&&(t+="-"),t+="\r\n"):t+="Range: npt=0.000-\r\n"):"backup"===e.media.type&&(t+="Rate-Control: no\r\nImmediate: yes\r\n"),o.SendRtspCommand(U(n,e.media.requestInfo.url,t))):"pause"===e.media.requestInfo.cmd?(n="PAUSE",t+="Scale: 1.000000\r\n",void 0!==e.media.requestInfo.rangeClock?(t+="Range: clock="+e.media.requestInfo.rangeClock,-1===e.media.requestInfo.rangeClock.search("-")&&(t+="-"),t+="\r\n"):t+="Range: npt=0.000-\r\n",o.SendRtspCommand(U(n,e.media.requestInfo.url,t)),R=!0):"speed"===e.media.requestInfo.cmd?(n="PLAY",void 0!==e.media.requestInfo.scale?t+=this.toStringExtensionScale(e.media.requestInfo.scale):t+="Scale: 1.00000\r\n",t+="Rate-Control: yes\r\n",void 0!==e.media.requestInfo.rangeClock?(t+="Range: clock="+e.media.requestInfo.rangeClock,-1===e.media.requestInfo.rangeClock.search("-")&&(t+="-"),t+="\r\n"):t+="Range: npt=0.000-\r\n","camera"===h&&(e.media.requestInfo.scale<-1||e.media.requestInfo.scale>1)&&(t+="Frames: intra\r\n"),o.SendRtspCommand(U(n,e.media.requestInfo.url,t))):"backup"===e.media.requestInfo.cmd?(n="PLAY",t+="Rate-Control: no\r\n",o.SendRtspCommand(U(n,e.media.requestInfo.url,t))):m.error("RTSP ControlStream- Unknown command:",e.cmd):m.error("RTSP ControlStream- Web socket does not exist:")},f.getCurrentState=function(){return c},Object.defineProperty(this,"instantplayback",{get:function(){return instantplayback},set:function(e){instantplayback=e}}),f.instantplayback=!1,f},RtspClientManager=function(){var e;return{getInstance:function(){var t;return e||(t=[],e={CreateRtspClient:function(){var e=RtspClient();return t.push(e),RtspClient},DeleteRtspClient:function(e){-1!==(idx=t.indexOf(e))&&t.splice(idx,1)},GetRtspClientCount:function(){return t.length}}),e}}}(),RtspStatusCode=function(e){log4javascript.getLogger();var t={Continue:{value:100,name:"Continue",description:"RTSP 100 Continue"},OK:{value:200,name:"OK",description:"RTSP 200 OK"},Created:{value:201,name:"Created",description:"RTSP 201 Created"},LowonStorageSpace:{value:250,name:"Low on Storage Space",description:"RTSP 250 Low on Storage Space"},MultipleChoices:{value:300,name:"Multiple Choices",description:"RTSP 300 Multiple Choices"},MovedPermanently:{value:301,name:"Moved Permanently",description:"RTSP 301 Moved Permanently"},MovedTemporarily:{value:302,name:"Moved Temporarily",description:"RTSP 302 Moved Temporarily"},SeeOther:{value:303,name:"See Other",description:"RTSP 303 See Other"},NotModified:{value:304,name:"Not Modified",description:"RTSP 304 Not Modified"},UseProxy:{value:305,name:"Use Proxy",description:"RTSP 305 Use Proxy"},BadRequest:{value:400,name:"Bad Request",description:"RTSP 400 Bad Request"},Unauthorized:{value:401,name:"Unauthorized",description:"RTSP 401 Unauthorized"},PaymentRequired:{value:402,name:"Payment Required",description:"RTSP 402 Payment Required"},Forbidden:{value:403,name:"Forbidden",description:"RTSP 403 Forbidden"},NotFound:{value:404,name:"Not Found",description:"RTSP 404 Not Found"},MethodNotAllowed:{value:405,name:"Method Not Allowed",description:"RTSP 405 Method Not Allowed"},NotAcceptable:{value:406,name:"Not Acceptable",description:"RTSP 406 Not Acceptable"},ProxyAuthenticationRequired:{value:407,name:"Proxy Authentication Required",description:"RTSP 407 Proxy Authentication Required"},RequestTimeout:{value:408,name:"Request Time-out",description:"RTSP 408 Request Time-out"},Gone:{value:410,name:"Gone",description:"RTSP 410 Gone"},LengthRequired:{value:411,name:"Length Required",description:"RTSP 411 Length Required"},PreconditionFailed:{value:412,name:"Precondition Failed",description:"RTSP 412 Precondition Failed"},RequestEntityTooLarge:{value:413,name:"Request Entity Too Large",description:"RTSP 413 Request Entity Too Large"},RequestURITooLarge:{value:414,name:"Request-URI Too Large",description:"RTSP 414 Request-URI Too Large"},UnsupportedMediaType:{value:415,name:"Unsupported Media Type",description:"RTSP 415 Unsupported Media Type"},ParameterNotUnderstood:{value:451,name:"Parameter Not Understood",description:"RTSP 451 Parameter Not Understood"},ConferenceNotFound:{value:452,name:"Conference Not Found",description:"RTSP 452 Conference Not Found"},NotEnoughBandwidth:{value:453,name:"Not Enough Bandwidth",description:"RTSP 453 Not Enough Bandwidth"},SessionNotFound:{value:454,name:"Session Not Found",description:"RTSP 454 Session Not Found"},MethodNotValidinThisState:{value:455,name:"Method Not Valid in This State",description:"RTSP 455 Method Not Valid in This State"},HeaderFieldNotValidforResource:{value:456,name:"Header Field Not Valid for Resource",description:"RTSP 456 Header Field Not Valid for Resource"},InvalidRange:{value:457,name:"Invalid Range",description:"RTSP 457 Invalid Range"},ParameterIsReadOnly:{value:458,name:"Parameter Is Read-Only",description:"RTSP 458 Parameter Is Read-Only"},AggregateOperationNotAllowed:{value:459,name:"Aggregate operation not allowed",description:"RTSP 459 Aggregate operation not allowed"},OnlyAggregateOperationAllowed:{value:460,name:"Only aggregate operation allowed",description:"RTSP 460 Only aggregate operation allowed"},UnsupportedTransport:{value:461,name:"Unsupported transport",description:"RTSP 461 Unsupported transport"},DestinationUnreachable:{value:462,name:"Aggregate operation not allowed",description:"RTSP 462 Destination unreachable"},KeyManagementFailure:{value:463,name:"Key management Failure",description:"RTSP 463 Key management Failure"},AccountBlocked:{value:490,name:"Account Blocked",description:"RTSP 490 Account Blocked"},InternalServerError:{value:500,name:"Internal Server Error",description:"RTSP 500 Internal Server Error"},NotImplemented:{value:501,name:"Not Implemented",description:"RTSP 501 Not Implemented"},BadGateway:{value:502,name:"Bad Gateway",description:"RTSP 502 Bad Gateway"},ServiceUnavailable:{value:503,name:"Service Unavailable",description:"RTSP 503 Service Unavailable"},GatewayTimeout:{value:504,name:"Gateway Time-out",description:"RTSP 504 Gateway Time-out"},RTSPVersionNotSupported:{value:505,name:"RTSP Version not supported",description:"RTSP 505 RTSP Version not supported"},OptionNotSupported:{value:551,name:"Option not supported",description:"RTSP 551 Option not supported"},MaximumUserReached:{value:560,name:"Maximum user Reached",description:"RTSP 560 Maximum user Reached for HTW NVR Device"},InvalidRequestSearchTime:{value:702,name:"Invalid Request Search Time",description:"RTSP 702 Invalid Request Search Time"},Unknown:{value:-1,name:"Unknown",description:"RTSP -1 Unknown"}};function n(e){switch(this,Number(e)){case 100:n.prototype.status=t.Continue;break;case 200:n.prototype.status=t.OK;break;case 201:n.prototype.status=t.Created;break;case 250:n.prototype.status=t.LowonStorageSpace;break;case 300:n.prototype.status=t.MultipleChoices;break;case 301:n.prototype.status=t.MovedPermanently;break;case 302:n.prototype.status=t.MovedTemporarily;break;case 303:n.prototype.status=t.SeeOther;break;case 304:n.prototype.status=t.NotModified;break;case 305:n.prototype.status=t.UseProxy;break;case 400:n.prototype.status=t.BadRequest;break;case 401:n.prototype.status=t.Unauthorized;break;case 402:n.prototype.status=t.PaymentRequired;break;case 403:n.prototype.status=t.Forbidden;break;case 404:n.prototype.status=t.NotFound;break;case 405:n.prototype.status=t.MethodNotAllowed;break;case 406:n.prototype.status=t.NotAcceptable;break;case 407:n.prototype.status=t.ProxyAuthenticationRequired;break;case 408:n.prototype.status=t.RequestTimeout;break;case 410:n.prototype.status=t.Gone;break;case 411:n.prototype.status=t.LengthRequired;break;case 412:n.prototype.status=t.PreconditionFailed;break;case 413:n.prototype.status=t.RequestEntityTooLarge;break;case 414:n.prototype.status=t.RequestURITooLarge;break;case 415:n.prototype.status=t.UnsupportedMediaType;break;case 451:n.prototype.status=t.ParameterNotUnderstood;break;case 452:n.prototype.status=t.ConferenceNotFound;break;case 453:n.prototype.status=t.NotEnoughBandwidth;break;case 454:n.prototype.status=t.SessionNotFound;break;case 455:n.prototype.status=t.MethodNotValidinThisState;break;case 456:n.prototype.status=t.HeaderFieldNotValidforResource;break;case 457:n.prototype.status=t.InvalidRange;break;case 458:n.prototype.status=t.ParameterIsReadOnly;break;case 459:n.prototype.status=t.AggregateOperationNotAllowed;break;case 460:n.prototype.status=t.OnlyAggregateOperationAllowed;break;case 461:n.prototype.status=t.UnsupportedTransport;break;case 462:n.prototype.status=t.DestinationUnreachable;break;case 463:n.prototype.status=t.KeyManagementFailure;break;case 490:n.prototype.status=t.AccountBlocked;break;case 500:n.prototype.status=t.InternalServerError;break;case 501:n.prototype.status=t.NotImplemented;break;case 502:n.prototype.status=t.BadGateway;break;case 503:n.prototype.status=t.ServiceUnavailable;break;case 504:n.prototype.status=t.GatewayTimeout;break;case 505:n.prototype.status=t.RTSPVersionNotSupported;break;case 551:n.prototype.status=t.OptionNotSupported;break;case 560:n.prototype.status=t.MaximumUserReached;break;case 702:n.prototype.status=t.InvalidRequestSearchTime;break;default:status=t.Unknown}}return n.prototype={getDescription:function(){return n.prototype.status.description},getStatusCode:function(){return n.prototype.status.value},getName:function(){return n.prototype.status.name},getObject:function(){return n.prototype.status},toString:function(){return JSON.stringify(n.prototype.status)}},new n(e)},Transport=function(e){var t,n,i,r,a,o,s,l,c=log4javascript.getLogger("transport"),u={},d=null,p=0,h=0,m=!1,f=!1,g=null,v=new Uint8Array,y=function(e){try{var l=new Uint8Array(e);for(v=function(e,t){if(e.byteLength+t.byteLength>e.byteLength){var n=e;e=null,(e=new Uint8Array(n.length+t.length)).set(n,0),e.set(t,n.length),n=null}return e}(v,l),l=null,p=v.length;p>0;)if(36!==v[0]){var u=String.fromCharCode.apply(null,v),d=null;!0===m?(d=u.lastIndexOf("\r\n"),m=!1):d=u.search("\r\n\r\n");var f=u.search("RTSP");if(-1===f)throw c.error("Invalid rtsp data in the channel: "+i),new umpError({channelId:i,errorCode:fromHex("0x0200"),place:"transport.js:139",message:"Invalid rtsp data in the channel  ["+error.message+"]"});if(-1===d)return void(p=v.length);a=v.subarray(f,d+4),v=v.subarray(d+4);var g=String.fromCharCode.apply(null,a);t(g),p=v.length,a=null,g=null}else{try{c.debug("Magic: 0x"+v[0].toString(16)+", Channel: "+v[1]+", Length: "+256*v[2]+v[3]+", Data: 0x"+v[4].toString(16))}catch(e){}if(!((h=256*v[2]+v[3])+4<=v.length))return void(p=v.length);o=v.subarray(0,4),s=v.subarray(4,16),r=v.subarray(16,h+4),n(o,s,r),v=v.subarray(h+4),p=v.length,o=null,s=null,r=null}}catch(e){throw console.error("unknown error: ",e.stack),new umpError({channelId:i,errorCode:e.errorCode,place:e.place,message:e.message})}},b=function(e){try{y(e.data)}catch(e){void 0!==l&&l({channelId:e.channel,errorCode:e.errorCode,place:e.place,description:e.message})}},w=function(e){c.info("----- open websocket ["+i+"]-----"),g("open",e)},C=function(e){var t;c.info("----- event onclose from  websocket ["+i+"]-----"),!1===e.wasClean?(c.error("error1: websocket closed ["+i+"]",e),t=new WebsocketStatusCode(e.code),void 0!==l&&l({channelId:i,errorCode:fromHex("0x0005"),place:"transport.js:230",description:"Error Code: "+t.getStatusCode()+", Name: "+t.getName()+", Desc: "+t.getDescription()}),g("error",t)):!0===e.wasClean&&null!==d&&d.readyState===WebSocket.CLOSED?(c.debug("error: websocket closed ["+i+"]"),t=new WebsocketStatusCode(e.code),g("close",t)):(c.error("error2: websocket closed ["+i+"]",e),t=new WebsocketStatusCode(e.code),g("error",t)),d=null},S=function(e){c.info("----- event onerror from  websocket ["+i+"]-----"),1==d.readyState&&(console.error(e),c.debug("error: websocket event "+e.type))};return u.setChannel=function(e){i=null===e?0:e,c.debug("set to transport channel number: "+i)},u.getChannel=function(e){return i},u.SetCallback=function(e,i,r,a){t=i,n=r,g=e,l=a},u.Connect=function(){try{(d=new WebSocket(e)).binaryType="arraybuffer",d.onmessage=b,d.onopen=w,d.onclose=C,d.onerror=S}catch(e){throw c.error("Fail to connect websocket with error in: ["+i+"]"),new umpError({channelId:i,errorCode:fromHex("0x0002"),place:"transport.js:310",message:"Fail to disconnect websock with error: "+e.message})}},u.Disconnect=function(){try{null!==d&&d.readyState===WebSocket.OPEN&&(d.close(),c.info("Success to disconnect websock ["+i+"]-----"))}catch(e){throw c.error("Fail to disconnect websock with error in : ["+i+"]"),new umpError({channelId:i,errorCode:fromHex("0x0003"),place:"transport.js:330",message:"error of weboskcet disconnect: "+e.message})}},u.SendRtspCommand=function(e){try{if(null!==d&&d.readyState===WebSocket.OPEN){if(!1===f)-1!==e.search("DESCRIBE")&&(m=!0,f=!0);d.send(function(e){for(var t=e.length,n=new Uint8Array(new ArrayBuffer(t)),i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}(e))}}catch(e){throw c.error("SendRtspCommand - send rtsp data error: ["+i+"]"),new umpError({channelId:i,errorCode:fromHex("0x0004"),place:"transport.js:356",message:"error of rtsp packet transmission: "+e.message})}},u.SendRtpData=function(e){try{if(null===d||d.readyState!==WebSocket.OPEN)throw c.error("SendRtpData - send rtp data error: ["+i+"]"),new umpError({channelId:i,errorCode:fromHex("0x0004"),place:"transport.js:374",message:"error of send rtp packet transmission: "+error.message});d.send(e)}catch(e){}},u.close=function(){try{d.readyState===WebSocket.OPEN&&(d.close(),d=null),c.info("----- close websock ["+i+"]-------")}catch(e){throw c.error("close - Web socket closed error: ["+i+"]"),new umpError({channelId:i,errorCode:fromHex("0x0005"),place:"transport.js:396",message:"error of websocket close: "+e.message})}},u};function WebsocketStatusCode(e){log4javascript.getLogger();var t={Reserved_0_999:{value:999,name:"Reserved",description:"Reserved and not used."},NormalClosure:{value:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},GoingAway:{value:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},ProtocolError:{value:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},UnsupportedData:{value:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},Reserved_1004:{value:1004,name:"Reserved",description:"Reserved. A meaning might be defined in the future."},NoStatusRecvd:{value:1005,name:"No Status Recvd",description:"Reserved.  Indicates that no status code was provided even though one was expected."},AbnormalClosure:{value:1006,name:"Abnormal Closure",description:"Reserved. Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},InvalidFramePayloadData:{value:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},PolicyViolation:{value:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},MessageTooBig:{value:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},MissingExtension:{value:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},InternalError:{value:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},ServiceRestart:{value:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},TryAgainLater:{value:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},BadGateway:{value:1014,name:"Bad Gateway\t",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},TLSHandshake:{value:1015,name:"TLS Handshake",description:"Reserved. Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},Reserved_1016_1999:{value:1016,name:"Reserved",description:"Reserved for future use by the WebSocket standard."},Reserved_2000_2999:{value:2e3,name:"Reserved",description:"Reserved for use by WebSocket extensions."},Reserved_3000_3999:{value:3e3,name:"Reserved",description:"Available for use by libraries and frameworks. May not be used by applications. Available for registration at the IANA via first-come, first-serve."},Reserved_4000_4999:{value:4e3,name:"Reserved",description:"Available for use by applications."},Reserved_12592:{value:12592,name:"Host was closed the websocket",description:"Host was closed the websocket."},Unknown:{value:-1,name:"Unknown",description:"Unknown Status code."}};function n(e){if(this,Number(e)<=999)n.prototype.status=t.Reserved_0_999;else if(Number(e)>=1016&&Number(e)<=1999)n.prototype.status=t.Reserved_1016_1999;else if(Number(e)>=2e3&&Number(e)<=2999)n.prototype.status=t.Reserved_2000_2999;else if(Number(e)>=3e3&&Number(e)<=3999)n.prototype.status=t.Reserved_3000_3999;else if(Number(e)>=4e3&&Number(e)<=4999)n.prototype.status=t.Reserved_4000_4999;else switch(Number(e)){case 1e3:n.prototype.status=t.NormalClosure;break;case 1001:n.prototype.status=t.GoingAway;break;case 1002:n.prototype.status=t.ProtocolError;break;case 1003:n.prototype.status=t.UnsupportedData;break;case 1004:n.prototype.status=t.Reserved1004;break;case 1005:n.prototype.status=t.NoStatusRecvd;break;case 1006:n.prototype.status=t.AbnormalClosure;break;case 1007:n.prototype.status=t.InvalidFramePayloadData;break;case 1008:n.prototype.status=t.PolicyViolation;break;case 1009:n.prototype.status=t.MessageTooBig;break;case 1010:n.prototype.status=t.MissingExtension;break;case 1011:n.prototype.status=t.InternalError;break;case 1012:n.prototype.status=t.ServiceRestart;break;case 1013:n.prototype.status=t.TryAgainLater;break;case 1014:n.prototype.status=t.BadGateway;break;case 1015:n.prototype.status=t.TLSHandshake;break;case 12592:n.prototype.status=t.Reserved_12592;break;default:n.prototype.status=t.Unknown}}return n.prototype={getDescription:function(){return n.prototype.status.description},getStatusCode:function(){return n.prototype.status.value},getName:function(){return n.prototype.status.name},getObject:function(){return n.prototype.status}},new n(e)}function G711AudioEncoder(){var e=48e3,t=132,n=[255,511,1023,2047,4095,8191,16383,32767],i={type:"G.711",samplingRate:8e3},r=null;function a(e){var i,r;return e<0?(e=t-e,i=127):(e+=t,i=255),(r=function(e,t){for(var n=0,i=t.length;n<i;n++)if(e<=t[n])return n;return t.length}(e,n))>=8?127^i:(r<<4|e>>r+3&15)^i}this.setSampleRate=function(t){e=t},this.encode=function(t){var n=null;null!==r?((n=new Float32Array(t.length+r.length)).set(r,0),n.set(t,r.length)):n=t,n=function(t,n){if(n===e)return t;if(n>e)throw"Downsampling rate show be smaller than original sample rate";var i=e/n,a=Math.floor(t.length/i),o=new Float32Array(a),s=0,l=0;for(;s<o.length;){for(var c=Math.round((s+1)*i),u=0,d=0,p=l,h=t.length;p<c&&p<h;p++)u+=t[p],d++;o[s]=u/d,s++,l=c}if(r=null,Math.round(s*i)!==t.length){var m=Math.round(s*i);r=new Float32Array(t.subarray(m,t.length))}return o}(n,i.samplingRate);for(var o=new Int16Array(n.length),s=new Uint8Array(o.length),l=0,c=n.length;l<c;l++)o[l]=n[l]*Math.pow(2,15),s[l]=a(o[l]);return s},this.getCodecInfo=function(){return i}}function Talk(){var e=null,t=null,n=null,i=null,r=!1,a=null,o={audio:!0,video:!1},s=null;function l(){}return l.prototype={init:function(){if(void 0===e||null===e)try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,(e=new AudioContext).onstatechange=function(){console.info("Audio Context State changed :: "+e.state)}}catch(e){return console.error("Web Audio API is not supported in this web browser! : "+e),!1}return!0},initAudioOut:function(){return new Promise(function(l,c){null!==t&&null!==n||(t=e.createGain(),(n=e.createScriptProcessor(4096,1,1)).onaudioprocess=function(e){if(null!==a){var t=e.inputBuffer.getChannelData(0);null!==s&&!0===r&&s(t)}},t.connect(n),n.connect(e.destination),i=e.sampleRate,t.gain.value=1),void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e,t,n){var i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return i?new Promise(function(t,n){i.call(navigator,e,t,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(o).then(function(n){a=n,e.createMediaStreamSource(n).connect(t),r=!0,l(i)}).catch(function(e){console.error(e),c(new Error(e))}):(console.error("Cannot open local media stream! :: navigator.mediaDevices.getUserMedia is not defined!"),c(new Error("Cannot open local media stream! :: navigator.mediaDevices.getUserMedia is not defined!")))})},controlVolumeOut:function(e){var n=e/20*2;t.gain.value=n<=0?0:n>=10?10:n},stopAudioOut:function(){if(null!==a&&r)try{for(var e=a.getAudioTracks(),t=0,n=e.length;t<n;t++)e[t].stop();r=!1,a=null}catch(e){console.log(e)}},terminate:function(){this.stopAudioOut(),e.close(),t=null,n=null},setSendAudioTalkBufferCallback:function(e){s=e}},new l}function CanvasRenderer(){log4javascript.getLogger("player:canvas:renderer");var e,t=null,n=null,i=null,r=null,a=!1,o=null,s=null,l={isUpdate:!1,element:null};function c(){e=this}function u(r){null!==n&&(n.drawCanvas(r),t.updatedCanvas=!0,a&&!0===t.updatedCanvas&&(a=!1,t.toBlob(function(t){if(null!==o&&void 0!==o)saveAs(t,o+".png");else{if(null===e.eventCaptureCallback||void 0===e.eventCaptureCallback)throw new umpError({channelId:e.channelId,errorCode:fromHex("0x0909"),place:"canvasRenderer.js:53",message:"can not return capture blob"});var n={channelId:e.channelId,blob:t};e.eventCaptureCallback(n)}})),null!==i&&l.isUpdate&&(i.drawCanvas(r),l.isUpdate=!1))}var d=function(){function e(e,t,n){this.canvas=e,this.ctx=t,n&&(this.canvas.width=n.w,this.canvas.height=n.h)}return e.prototype={drawCanvas:function(e){this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0)},initCanvas:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},destroy:function(){}},e}();return c.prototype={init:function(n){if(void 0===n)throw new umpError({channelId:e.channelId,errorCode:fromHex("0x0901"),place:"canvasRenderer.js:47",message:"canvas tag element is undefined"});t=n},setCanvas:function(e,i){if(null===n)switch(s=new Size(i.width,i.height),r=e){case"H264":case"H265":n=new YUVWebGLCanvas(t,t.getContext("webgl"),s);break;case"MJPEG":n=new d(t,t.getContext("2d"),s)}},setCaptureName:function(e){a=!0,o=e},draw:function(e,t){if("MJPEG"===r){var n=new Image(t.width,t.height);n.onload=function(){u(n),window.URL.revokeObjectURL(n.src)},n.src=window.URL.createObjectURL(new Blob([e.buffer]))}else u(e)},renewCanvas:function(){null!==n&&n.initCanvas()},digitalZoom:function(e){null!==n&&n.updateVertexArray(e)},destroy:function(){t=null,null!==n&&(n.initCanvas(),n.destroy(),n=null),null!==i&&(i.initCanvas(),i.destroy(),i=null)},updateMinimapInfo:function(e){var t=e.mode;if(null===l.element&&void 0!==e.target&&null!==e.target){l.element=e.target;var n=l.element.getAttribute("width"),a=l.element.getAttribute("height"),o=null;if(null===i)switch(o=new Size(s.w,s.h,n,a),r){case"H264":case"H265":i=new YUVWebGLCanvas(l.element,l.element.getContext("webgl"),o);break;case"MJPEG":i=new d(l.element,l.element.getContext("2d"),o)}}"draw"===t?l.isUpdate=!0:"off"===t&&(i=null,l={isUpdate:!1,element:null})},addEventListener:function(e,t){switch(e){case"capture":this.eventCaptureCallback=t}}},Object.defineProperty(this,"channelId",{get:function(){return channel},set:function(e){channel=e}}),new c}function CanvasTagPlayer(){var e,t,n=log4javascript.getLogger("player:canvas"),i=null,r=null,a=!1,o=null,s=null,l=null,c=0,u=null,d=null,p=!1;function h(){t=this}var m=!1;function f(e,n){!0!==m&&("MJPEG"!==e.codecType&&function(e,n){(l=new Worker("./media/ump/Worker/VideoDecoder/decoderWorker.js")).onmessage=g;var i={channelId:t.channelId,type:"createDecoder",data:e};l.postMessage(i),i={type:"setOutputSize",data:n.width*n.height+n.width*n.height/4+n.width*n.height/4},l.postMessage(i),i={type:"setFrameRate",data:t.getFrameRate()},l.postMessage(i),i={type:"useDropPacket",data:t.isDropPacket()},l.postMessage(i)}(e.codecType,n,e.codecType),i.setCanvas(e.codecType,n),m=!0)}function g(a){var o=a.data;switch(o.type){case"decoded":null!==d&&h.prototype.popNextFrame(!0);var c=[192,368,608,1088,1472,1952,3008];for(var u in c)if(o.data.width===c[u]){o.data.width-=8;break}if(null===r||void 0===r)throw n.warn("TODO: if canvas element is not defined, check tag's width and height attribute"),new umpError({channelId:t.channelId,errorCode:fromHex("0x0904"),place:"canvasTagPlayer.js:113",message:"The canvas size does not matched with image size"});if(o.data.width===r.width&&o.data.height===r.height)i.draw(o.data.frame),y(o.data.width,o.data.height),p&&void 0!==o.data.receiveClock&&null!==o.data.receiveClock&&(e=performance.now()-o.data.receiveClock,n.debug("decoding latency: ",e));else{if(null===r||void 0===r)throw n.warn("TODO: if canvas element is not defined, check tag's width and height attribute"),new umpError({channelId:t.channelId,errorCode:fromHex("0x0904"),place:"canvasTagPlayer.js:113",message:"The canvas size does not matched with image size"});n.warn("Ths canvas element size not matched with image size ("+r.width+r.height+"), changed canvas element size ("+o.data.width+","+o.data.height+")"),r.setAttribute("width",o.data.width),r.setAttribute("height",o.data.height)}null!==o.data.time&&(o.data.time.channelId=t.channelId,s(o.data.time)),o.data.frame=null,o.data=null;break;case"notReady":null!==d&&(d.front(),setTimeout(function(){h.prototype.popNextFrame(!1)},500));break;case"terminated":null!==l&&void 0!==l&&(l.terminate(),l=null,n.info("terminated decoder worker")),null!==d&&void 0!==d&&(d=null,n.info("clear buffer Manager"));break;default:throw n.debug("canvasTagPlayer::decoderWorker unknown data = "+o.data),new umpError({channelId:t.channelId,errorCode:fromHex("0x0905"),place:"canvasTagPlayer.js:168",message:"The decoder worker returned unknown data\t"})}}function v(e){var t=null;return null===(t="forward"===e?u.forward():u.backward())?(i.renewCanvas(),!1):(h.prototype.onVideoData(t.playMode,t.streamData,t.videoInfo),!0)}function y(e,t){if(!1===a)if(a=!0,window.jQuery)n.info("jquery $(window).trigger('resize')"),$(window).trigger("resize");else{n.info("windows.dispatchEvent('resizeEvent')");var i=document.createEvent("HTMLEvents");i.initEvent("resize",!0,!1),window.dispatchEvent(i)}}function b(e){n.debug("WEBGL Context Lost detect!"),void 0!==e&&e.preventDefault(),o({channelId:t.channelId,errorCode:fromHex("0x0902"),place:"canvasTagPlayer.js:178",description:"CanvasTagPlayer: WebGL Context Lost detect"})}return h.prototype=inheritObject(new VideoPlayer,{init:function(e){n.debug("CanvasTagPlayer::init"),r=e.cloneNode(!0),e.parentNode.replaceChild(r,e),(i=new CanvasRenderer).channelId=this.channelId,i.addEventListener("capture",this.eventCaptureCallback),i.init(r),u=new StepBufferList,r.addEventListener("webglcontextlost",b,!1)},popNextFrame:function(e){if(null!==d&&!1!==d.isReadyToPop()){var t;"object"==typeof(t=d.pop(e))&&this.onVideoData(t.playMode,t.streamData,t.videoInfo)}},onVideoData:function(e,r,a){if(f(r,a),!0!=(o=r.codecType,u=a.dropOut,"MJPEG"===o&&(1===u?c=0:c+=1,u>1&&c%u==0))){var o,u;if(null===i)throw n.debug("CanvasTagPlayer::drawer is null"),new umpError({channelId:this.channelId,errorCode:fromHex("0x0903"),place:"canvasTagPlayer.js:290",message:"CanvasTagPlayer: canvas tag renderer is null"});if("MJPEG"===r.codecType)i.draw(r.frameData,a),y(a.width,a.height),"Playback"===e&&(r.timeStamp.channelId=t.channelId,s(r.timeStamp));else{var d={type:"decode",data:{playMode:e,timeStamp:"Playback"===e?r.timeStamp:null,frameData:r.frameData,frameType:a.frameType,width:a.width,height:a.height,receiveClock:r.receiveClock}};l.postMessage(d)}}else s(r.timeStamp)},bufferingVideoData:function(e,t,n,i){return f(t,n),u.push(e,t,n)},sendToBufferManager:function(e,t,n,i){null===d&&((d=new PlaybackBufferManager).init(i),d.channelId=this.channelId),f(t,n);var r={playMode:e,streamData:t,videoInfo:n};!0===d.push(r)&&this.popNextFrame(!1)},capture:function(e){i.setCaptureName(e)},setTimeStampCallback:function(e){s=e},setResizeCallback:function(e){e},setErrorCallback:function(e){o=e},play:function(){n.debug("CanvasTagPlayer::play")},pause:function(){n.debug("CanvasTagPlayer::pause"),null!==d&&d.pause()},resume:function(){(n.debug("CanvasTagPlayer::resume"),null!==d)&&(!0===d.resume()&&this.popNextFrame(!1))},stop:function(){n.debug("CanvasTagPlayer::stop")},controlStepPlay:function(e,t){u.searchTimestamp(e);var n=u.findIFrame(t);this.onVideoData(n.playMode,n.streamData,n.videoInfo)},forward:function(){return v("forward")},backward:function(){return v("backward")},clearBuffer:function(){u.bufferClear()},digitalZoom:function(e){null!==i&&a&&i.digitalZoom(e)},updateMiniMapInfo:function(e){i.updateMinimapInfo(e)},close:function(){if(n.debug("CanvasTagPlayer::close"),null!==r&&void 0!==r&&(r.removeEventListener("webglcontextlost",b,!1),r=null,n.info("clear canvas elementss")),null!==i&&void 0!==i&&(i.renewCanvas(),i.destroy(),n.debug("destory renderer")),null!==l){var e={channelId:t.channelId,type:"terminate"};l.postMessage(e),n.debug("request terminate decoder worker")}else n.debug("decoder worker already terminated")}}),new h}var StepBufferList=function(){var e=240,t=0,n=0,i=[];function r(){}function a(){for(;i.length;)i.pop();n=0,t=0}return r.prototype=inheritObject(new BufferList,{push:function(n,r,a){if(1===i.length&&this.setBufferingLength(4*a.framerate),i.length<e){var o={playMode:n,streamData:r,videoInfo:a};o.streamData.frameData=new Uint8Array(r.frameData),i.push(o),t=i.length}return!(i.length>=e)},forward:function(){return++n<t?i[n]:(a(),null)},backward:function(){for(;--n>=0;){var e=i[n];if("I"===e.videoInfo.frameType||"MJPEG"===e.streamData.codecType)return e}return a(),null},searchTimestamp:function(e){for(var r=0;r<t;r++){var a=i[r];if(a.streamData.timeStamp.timestamp===e.timestamp&&a.streamData.timeStamp.timestamp_usec===e.timestamp_usec){n=r;break}if(a.streamData.timeStamp.timestamp>e.timestamp){n=r;break}}},findIFrame:function(e){for(;n<i.length&&n>=0;)if("forward"===e?n++:n--,n<0&&(n=0),"I"===i[n].videoInfo.frameType)return i[n]},setBufferingLength:function(t){(e=t)>240?e=240:e<6&&(e=6)},bufferClear:function(){a()}}),new r},Script=function(){function e(){}return e.createFromElementId=function(t){var n=document.getElementById(t);assert(n,"Could not find shader with ID: "+t);for(var i="",r=n.firstChild;r;)3===r.nodeType&&(i+=r.textContent),r=r.nextSibling;var a=new e;return a.type=n.type,a.source=i,a},e.createFromSource=function(t,n){var i=new e;return i.type=t,i.source=n,i},e}(),Shader=function(){function e(e,t){if(this.gl=e,"x-shader/x-fragment"===t.type)this.shader=e.createShader(e.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==t.type)return void error("Unknown shader type: "+t.type);this.shader=e.createShader(e.VERTEX_SHADER)}e.shaderSource(this.shader,t.source),e.compileShader(this.shader),e.getShaderParameter(this.shader,e.COMPILE_STATUS)||error("An error occurred compiling the shaders: "+e.getShaderInfoLog(this.shader))}return e.prototype={destroy:function(){this.gl.deleteShader(this.shader)}},e}(),Program=function(){function e(e){this.gl=e,this.program=this.gl.createProgram()}return e.prototype={attach:function(e){this.gl.attachShader(this.program,e.shader)},link:function(){this.gl.linkProgram(this.program),assert(this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS),"Unable to initialize the shader program.")},use:function(){this.gl.useProgram(this.program)},getAttributeLocation:function(e){return this.gl.getAttribLocation(this.program,e)},setMatrixUniform:function(e,t){var n=this.gl.getUniformLocation(this.program,e);this.gl.uniformMatrix4fv(n,!1,t)},destroy:function(){this.gl.deleteProgram(this.program)}},e}(),Texture=function(){var e=null;function t(e,t,n){this.gl=e,this.size=t,this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),this.format=n||e.LUMINANCE,e.texImage2D(e.TEXTURE_2D,0,this.format,t.w,t.h,0,this.format,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}return t.prototype={fill:function(e,t){var n=this.gl;assert(e.length>=this.size.w*this.size.h,"Texture size mismatch, data:"+e.length+", texture: "+this.size.w*this.size.h),n.bindTexture(n.TEXTURE_2D,this.texture),t?n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.size.w,this.size.h,this.format,n.UNSIGNED_BYTE,e):n.texImage2D(n.TEXTURE_2D,0,this.format,this.size.w,this.size.h,0,this.format,n.UNSIGNED_BYTE,e)},bind:function(t,n,i){var r=this.gl;e||(e=[r.TEXTURE0,r.TEXTURE1,r.TEXTURE2]),r.activeTexture(e[t]),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(r.getUniformLocation(n.program,i),t)},destroy:function(){this.gl.deleteTexture(this.texture)}},t}(),ImageTexture=function(){function e(e,t,n){Texture.call(this,e,t,n)}return e.prototype=inherit(Texture,{fill:function(e,t){var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),t?n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.size.w,this.size.h,this.format,n.UNSIGNED_BYTE,e):n.texImage2D(n.TEXTURE_2D,0,this.format,this.format,n.UNSIGNED_BYTE,e)}}),e}(),WebGLCanvas=function(){var e=Script.createFromSource("x-shader/x-vertex",text(["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat4 uMVMatrix;","varying highp vec2 vTextureCoord;","void main(void) {","  gl_Position = uMVMatrix * vec4(aVertexPosition, 1.0);","  vTextureCoord = aTextureCoord;","}"])),t=Script.createFromSource("x-shader/x-fragment",text(["precision highp float;","varying highp vec2 vTextureCoord;","uniform sampler2D texture;","void main(void) {","  gl_FragColor = texture2D(texture, vTextureCoord);","}"])),n=[192,368,608,1088,1472,1952,3008],i=BrowserDetect();function r(e,t,r,a){this.canvas=e,this.size=r,this.gl=t;var o=!0;for(var s in n)r.w===n[s]&&(o=!1);o?this.canvas.width=void 0!==r.viewWidth?r.viewWidth:r.w:192===r.w?this.canvas.width=void 0!==r.viewWidth?r.viewWidth:r.w-12:this.canvas.width=void 0!==r.viewWidth?r.viewWidth:r.w-8,this.canvas.height=void 0!==r.viewHeight?r.viewHeight:r.h,this.onInitWebGL(),this.onInitShaders(),function(){var e,t=this.gl;this.quadVPBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadVPBuffer),e=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),this.quadVPBuffer.itemSize=3,this.quadVPBuffer.numItems=4;var n=1;"edge"===i&&this.canvas.width!==this.size.w&&(n=this.canvas.width/this.size.w);this.quadVTCBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadVTCBuffer),e=[n,0,0,0,n,1,0,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)}.call(this),a&&function(){var e=this.gl;this.framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),this.framebufferTexture=new Texture(this.gl,this.size,e.RGBA),this.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderbuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,void 0!==this.size.viewWidth?this.size.viewWidth:this.size.w,void 0!==this.size.viewHeight?this.size.viewHeight:this.size.h),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.framebufferTexture.texture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.renderbuffer)}.call(this),this.onInitTextures(),function(){var e=this.gl;(function(){this.mvMatrix=Matrix.I(4)}).call(this),e.bindBuffer(e.ARRAY_BUFFER,this.quadVPBuffer),e.vertexAttribPointer(this.vertexPositionAttribute,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.quadVTCBuffer),e.vertexAttribPointer(this.textureCoordAttribute,2,e.FLOAT,!1,0,0),this.onInitSceneTextures(),function(){this.program.setMatrixUniform("uMVMatrix",new Float32Array(this.mvMatrix.flatten()))}.call(this),this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer)}.call(this)}return r.prototype={toString:function(){return"WebGLCanvas Size: "+this.size},checkLastError:function(e){var t=this.gl.getError();if(t!==this.gl.NO_ERROR){var n=this.glNames[t];n=void 0!==n?n+"("+t+")":"Unknown WebGL ENUM (0x"+value.toString(16)+")",e?console.log("WebGL Error: %s, %s",e,n):console.log("WebGL Error: %s",n),console.trace()}},onInitWebGL:function(){if(this.gl||error("Unable to initialize WebGL. Your browser may not support it."),!this.glNames)for(var e in this.glNames={},this.gl)"number"==typeof this.gl[e]&&(this.glNames[this.gl[e]]=e)},onInitShaders:function(){this.program=new Program(this.gl),this.vertexShader=new Shader(this.gl,e),this.fragmentShader=new Shader(this.gl,t),this.program.attach(this.vertexShader),this.program.attach(this.fragmentShader),this.program.link(),this.program.use(),this.vertexPositionAttribute=this.program.getAttributeLocation("aVertexPosition"),this.gl.enableVertexAttribArray(this.vertexPositionAttribute),this.textureCoordAttribute=this.program.getAttributeLocation("aTextureCoord"),this.gl.enableVertexAttribArray(this.textureCoordAttribute)},onInitTextures:function(){var e=this.gl;e.viewport(0,0,this.canvas.width,this.canvas.height),this.texture=new Texture(e,this.size,e.RGBA)},onInitSceneTextures:function(){this.texture.bind(0,this.program,"texture")},drawScene:function(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)},readPixels:function(e){var t=this.gl;t.readPixels(0,0,this.size.w,this.size.h,t.RGBA,t.UNSIGNED_BYTE,e)},destroy:function(){var e=this.gl;e.deleteFramebuffer(this.framebuffer),this.framebuffer=null,e.deleteRenderbuffer(this.renderbuffer),e.deleteBuffer(this.quadVPBuffer),e.deleteBuffer(this.quadVTCBuffer),void 0!==this.vertexShader&&this.vertexShader.destroy(),void 0!==this.fragmentShader&&this.fragmentShader.destroy(),void 0!==this.framebufferTexture&&this.framebufferTexture.destroy(),void 0!==this.YTexture&&this.YTexture.destroy(),void 0!==this.UTexture&&this.UTexture.destroy(),void 0!==this.VTexture&&this.VTexture.destroy(),void 0!==this.texture&&this.texture.destroy(),void 0!==this.program&&this.program.destroy(),e.canvas.width=1,e.canvas.height=1,this.renderbuffer=null,this.quadVPBuffer=null,this.quadVTCBuffer=null,this.vertexShader=null,this.fragmentShader=null,this.texture=null,this.program=null,this.gl=null,this.canvas=null}},r}(),YUVWebGLCanvas=function(){var e=Script.createFromSource("x-shader/x-vertex",text(["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat4 uMVMatrix;","varying highp vec2 vTextureCoord;","void main(void) {","  gl_Position = uMVMatrix * vec4(aVertexPosition, 1.0);","  vTextureCoord = aTextureCoord;","}"])),t=Script.createFromSource("x-shader/x-fragment",text(["precision highp float;","varying highp vec2 vTextureCoord;","uniform sampler2D YTexture;","uniform sampler2D UTexture;","uniform sampler2D VTexture;","const mat4 YUV2RGB = mat4","("," 1.16438, 0.00000, 1.59603, -.87079,"," 1.16438, -.39176, -.81297, .52959,"," 1.16438, 2.01723, 0, -1.08139,"," 0, 0, 0, 1",");","void main(void) {"," gl_FragColor = vec4( texture2D(YTexture,  vTextureCoord).x, texture2D(UTexture, vTextureCoord).x, texture2D(VTexture, vTextureCoord).x, 1) * YUV2RGB;","}"]));function n(e,t,n){WebGLCanvas.call(this,e,t,n)}return n.prototype=inherit(WebGLCanvas,{onInitShaders:function(){this.program=new Program(this.gl),this.vertexShader=new Shader(this.gl,e),this.fragmentShader=new Shader(this.gl,t),this.program.attach(this.vertexShader),this.program.attach(this.fragmentShader),this.program.link(),this.program.use(),this.vertexPositionAttribute=this.program.getAttributeLocation("aVertexPosition"),this.gl.enableVertexAttribArray(this.vertexPositionAttribute),this.textureCoordAttribute=this.program.getAttributeLocation("aTextureCoord"),this.gl.enableVertexAttribArray(this.textureCoordAttribute)},onInitTextures:function(){this.gl.viewport(0,0,void 0!==this.size.viewWidth?this.size.viewWidth:this.size.w,void 0!==this.size.viewHeight?this.size.viewHeight:this.size.h),this.YTexture=new Texture(this.gl,this.size),this.UTexture=new Texture(this.gl,this.size.getHalfSize()),this.VTexture=new Texture(this.gl,this.size.getHalfSize())},onInitSceneTextures:function(){this.YTexture.bind(0,this.program,"YTexture"),this.UTexture.bind(1,this.program,"UTexture"),this.VTexture.bind(2,this.program,"VTexture")},fillYUVTextures:function(e,t,n){this.YTexture.fill(e),this.UTexture.fill(t),this.VTexture.fill(n)},drawCanvas:function(e){var t=this.size.w*this.size.h,n=t>>2;this.YTexture.fill(e.subarray(0,t)),this.UTexture.fill(e.subarray(t,t+n)),this.VTexture.fill(e.subarray(t+n,t+2*n)),this.drawScene()},toString:function(){return"YUVCanvas Size: "+this.size},initCanvas:function(){this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT)}}),n}();function VideoMediaSource(e){var t=log4javascript.getLogger("player"),n=null,i=null,r=null,a={timestamp:0,timestamp_usec:0,timezone:0},o={timestamp:0,timestamp_usec:0,timezone:0},s=e;function l(){}function c(){if(t.info("videoMediaSource::appendInitSegment start"),0===mediaSource.sourceBuffers.length){mediaSource.duration=0;var e='video/mp4;codecs="avc1.'+codecInfo+'"';sourceBuffer=mediaSource.addSourceBuffer(e),AddBufferEventListener(sourceBuffer)}var i=n();null!==i?(sourceBuffer.appendBuffer(i),t.info("videoMediaSource::appendInitSegment end, codecInfo = "+codecInfo)):mediaSource.endOfStream("network")}function u(){videoElement.paused&&(r(),isPlaying||videoElement.play())}function d(){videoElement.paused||isPause||videoElement.pause()}return l.prototype={init:function(e){browserType=BrowserDetect(),t.info("videoMediaSource::init browserType = "+browserType),videoElement=e;var n="./base/images/loading.gif";window.jQuery&&($("channel_player.full-screen").length||$("#channellist-containner").length)&&(n="./base/images/loading_b.gif"),videoElement.controls=!1,videoElement.preload="auto",videoElement.autoplay=!0,videoElement.muted=!1,videoElement.poster="./base/images/video_poster.png",videoElement.style.background="url("+n+") no-repeat center center"+videoElement.style.background,videoElement.style.backgroundSize="48px 48px",videoDigitalPtz.setVideoElement(videoElement),AddVideoEventListener(videoElement),c()},setInitSegmentFunc:function(e){n=e},getVideoElement:function(){return videoElement},setCodecInfo:function(e){codecInfo=e},setMediaSegment:function(e){!function(e){if(null!==sourceBuffer&&"closed"!=mediaSource.readyState&&"ended"!=mediaSource.readyState&&!sourceBuffer.updating)try{sourceBuffer.appendBuffer(e)}catch(e){t.error("videoMediaSource::appendNextMediaSegment error >> initVideo"),s.initVideo(!1)}}(e)},capture:function(e){var t=document.createElement("canvas");t.width=videoElement.videoWidth,t.height=videoElement.videoHeight,t.getContext("2d").drawImage(videoElement,0,0,t.width,t.height),doCapture(t.toDataURL(),e)},setInitSegment:function(){c()},setTimeStamp:function(e,t){i=e,t},setVideoSizeCallback:function(e){r=e},setAudioStartCallback:function(e){startAudioCallback=e},getPlaybackTimeStamp:function(){return i},setSpeedPlay:function(e){e},setvideoTimeStamp:function(e){!0===Math.abs(a.timestamp-e.timestamp)>3&&(0,o=e,startAudioCallback(o.timestamp,"init")),a=e},pause:function(){d()},play:function(){u()},setPlaybackFlag:function(e){e},setTimeStampInit:function(){null,o={timestamp:0,timestamp_usec:0,timezone:0}},setBoxSize:function(e){boxSize=e},close:function(){removeEventListener(),d()}},new l}function VideoTagPlayer(){var e,t,n,i,r=log4javascript.getLogger("player:video"),a=0,o=0,s=.3,l=0,c=!1,u=null,d=4,p=null,h=null,m=null,f=null,g=s,v=0,y={isUpdate:!1,element:null},b=null,w=null,C=null,S=null,_=!1,T=!0,x=1,E={timestamp:0,timestamp_usec:0,timezone:0,channelId:0},I=null,k=null,A=null,R=1e4,L=[],P=1,M=[],D=0,N=0,H=[],U=0,F=10,O=2,B="",j=!1,V=-1;function q(){i=this}function z(e){switch(e.type){case"sourceopen":r.debug("ch: "+i.channelId+"', readyState: "+A.readyState+", mediaSourceEventListener::error = "+JSON.stringify(e,["type","timeStamp"])),A=e.target,function(){if(r.info("videoTagPlayer::appendInitSegment codecInfo = "+f),0===A.sourceBuffers.length){A.duration=0;try{var e='video/mp4;codecs="'+f+'"';k=A.addSourceBuffer(e)}catch(e){throw new umpError({channelId:i.channelId,errorCode:e.code,place:"videoTagPlayer.js:511",message:e.message})}!function(){C=["error","abort","updatestart","update","updateend","updating"];for(var e=0;e<C.length;e++)k.addEventListener(C[e],G)}()}}(),pe();break;case"error":case"abort":r.debug("ch: "+i.channelId+", readyState: "+A.readyState+", mediaSourceEventListener::error,abort = "+JSON.stringify(e,["type","timeStamp"]));break;case"sourceended":case"sourceclose":r.debug("ch: "+i.channelId+", readyState: "+A.readyState+", mediaSourceEventListener::event type = "+JSON.stringify(e,["type","timeStamp"]));break;default:r.debug("ch: "+i.channelId+", readyState: "+A.readyState+", mediaSourceEventListener::event unknown type = "+JSON.stringify(e,["type","timeStamp"]))}}function G(e){switch(e.type){case"error":case"abort":r.debug("ch: "+i.channelId+", readyState: "+A.readyState+", sourceBufferEventListener::error,abort = "+JSON.stringify(e,["type","timeStamp"]));break;case"updatestart":r.debug("ch: "+i.channelId+", readyState: "+A.readyState+", sourceBufferEventListener::updatestart = "+JSON.stringify(e,["type","timeStamp"]));break;case"update":r.debug("ch: "+i.channelId+", readyState: "+A.readyState+", sourceBufferEventListener::update = "+JSON.stringify(e,["type","timeStamp"]));break;case"updateend":pe(),r.debug("ch: "+i.channelId+", readyState: "+A.readyState+", sourceBufferEventListener::event type = "+JSON.stringify(e,["type","timeStamp"]));break;case"updating":r.debug("ch: "+i.channelId+", readyState: "+A.readyState+", sourceBufferEventListener::event type = "+JSON.stringify(e,["type","timeStamp"]));break;default:r.debug("ch: "+i.channelId+", readyState: "+A.readyState+", sourceBufferEventListener::event unknown type = "+JSON.stringify(e,["type","timeStamp"]))}}function W(e){switch(e.type){case"playing":_=!0,T=!1;break;case"pause":r.debug("ch: ",i.channelId,"videoElementEventListener pause event = ",JSON.stringify(e,["type","timeStamp"])),_=!1,T=!0;break;case"error":r.debug("ch: ",i.channelId,"videoElementEventListener error event = ",JSON.stringify(e,["type","timeStamp"]));break;case"waiting":r.debug("ch: ",i.channelId,"videoElementEventListener waiting event = ",JSON.stringify(e,["type","timeStamp"]));break;case"timeupdate":r.debug("ch: ",i.channelId,"videoElementEventListener timeupdate event = ",JSON.stringify(e,["type","timeStamp"])),!0===j&&function(e){var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);try{n.restore(),n.save(),n.drawImage(e,0,0,t.width,t.height)}catch(e){console.log(e)}j=!1,t.toBlob(function(e){if(null!==B&&void 0!==B)saveAs(e,B+".png");else{if(null===i.eventCaptureCallback||void 0===i.eventCaptureCallback)throw new umpError({channelId:i.channelId,errorCode:fromHex("0x0909"),place:"canvasRenderer.js:53",message:"can not return capture blob"});var t={channelId:i.channelId,blob:e};i.eventCaptureCallback(t)}})}(h);break;case"resize":if(r.debug("ch: ",i.channelId,"videoElementEventListener resize event = ",JSON.stringify(e,["type","timeStamp"])),window.jQuery)r.info("jquery $(window).trigger('resize')"),$(window).trigger("resize");else{r.info("windows.dispatchEvent('resizeEvent')");var t=document.createEvent("HTMLEvents");t.initEvent("resize",!0,!1),window.dispatchEvent(t)}break;case"seeked":r.debug("ch: ",i.channelId,"videoElementEventListener seeked event = ",JSON.stringify(e,["type","timeStamp"])),i.instantplayback||he();break;case"progress":case"seeking":case"loadstart":case"abort":case"emptied":case"stalled":case"loadedmetadata":case"loadeddata":case"canplay":case"canplaythrough":case"ended":case"play":case"ratechange":case"volumechange":case"addtrack":case"removetrack":r.debug("ch: ",i.channelId,"videoElementEventListener event = ",JSON.stringify(e,["type","timeStamp"]));break;default:r.debug("ch: "+i.channelId+", videoElementEventListener::event unknown = "+JSON.stringify(e,["type","timeStamp"]))}}function J(){null===A||"ended"===A.readyState?(A=new MediaSource,function(){S=["sourceopen","error","sourceended","sourceclose"];for(var e=0;e<S.length;e++)A.addEventListener(S[e],z)}(),h.src=window.URL.createObjectURL(A),r.info("videoTagPlayer::create MediaSource")):r.warn("videoTagPlayer:: MediaSource is already create. status = "+A.readyState)}function Y(){if(null!==this.activeCues&&void 0!==this.activeCues[0]&&null!==this.activeCues[0])try{var e=this.activeCues[0].text;this.removeCue(this.activeCues[0]);var t=JSON.parse(e);t.channelId=i.channelId,b(t)}catch(e){throw new umpError({channelId:i.channelId,errorCode:e.code,place:"videoTagPlayer.js:296",message:e.message})}}function K(e){var t="./base/images/loading.gif";window.jQuery&&($("channel_player.full-screen").length||$("#channellist-containner").length)&&(t="./base/images/loading_b.gif"),h.controls=!1,h.preload="auto",h.autoplay=!1,h.muted=!0,h.style.background="url("+t+") no-repeat center center"+h.style.background,h.style.backgroundSize="48px 48px",h.onplaying=Z,h.onpause=te,h.onclose=ee,h.oncanplay=Q,h.onwaiting=ne,h.ondurationchange=ie,h.onloadeddata=re,h.onprogress=ae,h.onseeking=oe;var n=h.addTextTrack("captions","English","en");V=h.textTracks.length-1,n.mode="hidden",n.oncuechange=Y,function(){w=["durationchange","playing","error","pause","timeupdate","resize","seeked","progress","seeking","loadstart","abort","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","waiting","ended","play","ratechange","volumechange","addtrack","removetrack"];for(var e=0;e<w.length;e++)h.addEventListener(w[e],W)}(),void 0!==document.webkitHidden&&document.addEventListener("visibilitychange",X)}function X(){c&&"visible"===document.visibilityState&&function(){if(!T){var e=U<=4?2:1;if(e<H.length){var t=H[H.length-1-e];h.currentTime<t&&(h.currentTime=t)}}}()}function Z(){r.info("ch: ",i.channelId,"videoTagPlayer::onPlaying: video element play started"),void 0===t&&(r.info("videoTagPlayer::onPlaying message what start timer"+i.channelId),t=setInterval(function(){!function(){if(n=h.currentTime,a=Math.floor(n*i.getFrameRate()),r.debug("ch: "+i.channelId+", Current Time: "+n+", the Current fps: "+a),void 0!==i.eventStatisticsCallback&&null!==i.eventStatisticsCallback){var e={type:"fps",channelId:i.channelId,fps:a-o,bps:(h.videoWidth*h.videoHeight*(a-o)*.07/1048576).toFixed(2)};i.eventStatisticsCallback(e)}o=a}()},1e3))}function Q(e){r.info("ch: ",i.channelId,"videoTagPlayer::onCanPlay",JSON.stringify(e)),_||(i.instantplayback?r.info("ch: ",i.channelId,"videoTagPlayer::onCanPlay: this is instant playback mode"):he())}function ee(){r.info("ch: ",i.channelId,"videoTagPlayer::onClose: video element closed"),o=a=0,void 0!==t&&null!==t&&clearInterval(t),void 0!==e&&null!==e&&clearInterval(e)}function te(){if(r.info("ch: ",i.channelId,"videoTagPlayer::onPause: video element paused"),i.instantplayback){var e=1*k.buffered.start(k.buffered.length-1),t=1*k.buffered.end(k.buffered.length-1);r.info("ch: ",i.channelId,"available instant playback, start time = ",e,", end time = ",t);var n={channelId:i.channelId,errorCode:fromHex("0x1100"),timeline:{start:e,end:t}};void 0!==i.eventInstantPlaybackCallback&&null!==i.eventInstantPlaybackCallback&&i.eventInstantPlaybackCallback(n)}}function ne(){if(r.info("ch: ",i.channelId,"videoTagPlayer::onWaiting: video element on waiting"),i.instantplayback){r.info("ch: ",i.channelId,"videoTagPlayer::onWaiting: this is instant playback mode");var e=1*k.buffered.start(k.buffered.length-1),t=1*k.buffered.end(k.buffered.length-1);r.info("current time = ",h.currentTime,", start time = ",e,", endtime = ",t),me()}}function ie(){r.debug("ch: ",i.channelId,"videoTagPlayer::onDurationChange: The video duration has changed"),function(){try{if(null===A||void 0===k.buffered)return}catch(e){return}if(k.buffered.length>0){if(function(){k.buffered.start(k.buffered.length-1);var e=1*k.buffered.end(k.buffered.length-1);try{Math.abs(e-v)>i.getBufferClearInterval()&&e-(i.getMaxInstantPlayback()+i.getBufferClearInterval())>0&&(k.updating||(e=Math.min(e,h.currentTime),k.remove(0,Math.abs(e-i.getMaxInstantPlayback())),v=e))}catch(e){r.error("checkBufferSize::invalid remove scope from channel: "+i.channelId+", error message: "+e.message)}}(),c)return;var e=1*k.buffered.start(k.buffered.length-1),t=1*k.buffered.end(k.buffered.length-1),n=0;if(n=0===h.currentTime?t-e:t-(h.currentTime+g),r.debug("diff time = ",n,", current latency = ",g,", current time = ",h.currentTime,", end time = ",t,", offset time = ",h.currentTime+g),n>g){var a=t-g;a>e&&a<t&&(r.debug("target current time: "+a),h.currentTime=a,!1===_&&he())}}}()}function re(){r.debug("ch: ",i.channelId,"videoTagPlayer::onLoadedData: Alert that data for the current frame is available")}function ae(e){r.debug("ch: ",i.channelId,"videoTagPlayer::onLoadedData: Alert that the video is downloading",JSON.stringify(e))}function oe(e){r.debug("ch: ",i.channelId,", seeking event = ",JSON.stringify(e),", current time = ",h.currentTime),i.instantplayback}window.VTTCue=window.VTTCue||window.TextTrackCue;var se=1500;var le=null;function ce(e,t){var n={size:e.frameData.length,frameData:function(e){var t=e.byteLength,n=0,i=0;for(;i+4<t;)0===e[i+0]&&0===e[i+1]&&0===e[i+2]&&1===e[i+3]?(i>0&&ue(n,i-n-d,e),n=i,i+=d):i+=1;return ue(n,t-n-d,e),new Uint8Array(e)}(e.frameData)};M.push(n),r.debug("samples buffered packet count: "+M.length),c?(n.timeStamp=e.timeStamp,n.rtpTimestamp=parseInt(n.timeStamp.rtpTimestamp,10),"I"===t.frameType&&(M.length>1&&de(M.length-1),le=setTimeout(de,se))):(n.frameDuration=function(e,t){var n=0;if(null===p)return p={streamData:e,videoInfo:t},n;var a=parseInt(p.streamData.timeStamp.rtpTimestamp,10),o=parseInt(e.timeStamp.rtpTimestamp,10);r.debug("preFrameTimeStamp : "+a+" Frame Time Stamp : "+o);(n=1===x?Math.abs(o-a)*F:R/Math.abs(x))>15e3&&(n=15e3),p={streamData:e,videoInfo:t};(0==(l=(l+R/n)/O)||isNaN(l)||void 0===l||null===l)&&(l=1);var u=i.getBoxSize()/l*(c?1:F);Math.abs(u-g)>s&&(g=u+s,r.debug("check delay ch: "+i.channelId+", averageFPS = "+l+", delayCheckTime = "+u+", delay = "+g));return D+=n,n}(e,t),M.length>=i.getBoxSize()&&de(i.getBoxSize()))}function ue(e,t,n){n[e+0]=(4278190080&t)>>24,n[e+1]=(16711680&t)>>16,n[e+2]=(65280&t)>>8,n[e+3]=255&t}function de(e){le&&(clearTimeout(le),le=null);var t={id:1,samples:e?M.splice(0,e):M.splice(0),baseMediaDecodeTime:N},n=function(e){if(1===e.length)return e[0].frameData;var t=e.reduce(function(e,t){return e+t.size},0),n=new Uint8Array(t),i=0;return e.forEach(function(e){n.set(e.frameData,i),i+=e.size}),n}(t.samples);H.push(t.baseMediaDecodeTime/R),U=t.samples.length,c?function(e){for(var t=e.length,n=null,i=null,r=null,a=[],o=0;o<t;o+=1){var s=null;o<t-1?s=Math.abs(e[o+1].rtpTimestamp-e[o].rtpTimestamp):M.length>0&&(s=Math.abs(M[0].rtpTimestamp-e[o].rtpTimestamp)),(null===s||s>se)&&(s=Math.floor(500/t)),e[o].frameDuration=s*F,null===i&&(i=N/R),N+=e[o].frameDuration,null===n?n=e[o].timeStamp:n.timestamp!==e[o].timeStamp.timestamp&&(n=e[o].timeStamp,r=N/R,a.push([i,r,JSON.stringify(n)]),i=r)}i<(r=N/R)&&a.push([i,r,JSON.stringify(n)]),a.forEach(function(e){h.textTracks[V].addCue(new VTTCue(e[0],e[1],e[2]))})}(t.samples):(N=t.baseMediaDecodeTime+D,D=0),L.push(mediaSegment(P,[t],n)),P++,pe()}function pe(){if(null!==k&&!k.updating)if(0!==L.length){var e=L.shift();e?k.appendBuffer(e):A.endOfStream("network")}else 0===M.length&&A&&A.willEnd&&A.endOfStream()}function he(){void 0===h||!h.paused&&_||(void 0!==(m=h.play())&&m.then(function(){h.play()}).catch(function(e){h.pause()}),A&&r.info("mediaSource.readyState: "+A.readyState))}function me(){void 0===h||null===h||h.paused&&!_||(h.pause(),i.instantplayback||(h.currentTime=0),r.info("mediaSource.readyState: "+A.readyState))}function fe(e){return e<10?"0"+e:e}function ge(e){E.timestamp!==e.timestamp&&I&&I.endTime&&void 0!==e.timezone&&null!==e.timezone&&(function(e){if(moment)return moment(1e3*e).format("YYYYMMDDHHmmss");var t=new Date(1e3*e);return t.getUTCFullYear()+fe(t.getUTCMonth()+1)+fe(t.getUTCDate())+fe(t.getUTCHours())+fe(t.getUTCMinutes())+fe(t.getUTCSeconds())}(e.timestamp+60*e.timezone)>=I.endTime&&setTimeout(function(){A&&(A.willEnd=!0)},se))}return q.prototype=inheritObject(new VideoPlayer,{init:function(e){r.info("VideoTagPlayer::init"),h=e,K(),J(),this.instantplayback=!1},onVideoData:function(e,t,n){null!==A&&"ended"!==A.readyState&&(r.debug("ch: "+this.channelId+"', readyState: "+A.readyState+", frame: "+n.frameType),"Playback"===e&&(c=!0,"camera"===u&&ge(t.timeStamp)),f!==n.codecInfo&&"I"===n.frameType&&(f=n.codecInfo,function(e,t){var n=[192,368,608,1088,1472,1952,3008];for(var i in n)if(e.width===n[i]){e.width-=8;break}var r={id:1,width:e.width,height:e.height,type:"video",codecType:t,sps:[e.spsPayload],pps:[e.ppsPayload]};"H264"===t?(r.profileIdc=e.profileIdc,r.profileCompatibility=0,r.levelIdc=e.levelIdc):"H265"===t&&(r.profileTierLevel=e.profileTierLevel,r.vps=[e.vpsPayload]),L.push(initSegment([r]))}(n,t.codecType)),E=t.timeStamp,ce(t,n),y.isUpdate&&y.element&&(y.element.getContext("2d").drawImage(h,0,0,y.element.width,y.element.height),y.isUpdate=!1))},capture:function(e){j=!0,B=e},setTimeStampCallback:function(e){b=e},setSpeedPlay:function(e){x=parseInt(e,10)},setResizeCallback:function(e){e},setErrorCallback:function(e){e},setRequestTime:function(e){I=e},setDeviceType:function(e){u=e},updateMiniMapInfo:function(e){var t=e.mode;null===y.element&&void 0!==e.target&&(y.element=e.target),"on"===t?y.element=e.target:"draw"===t?y.isUpdate=!0:y={isUpdate:!1,element:null}},play:function(){r.info("VideoTagPlayer::play"),void 0!==(m=h.play())&&m.then(function(){h.play()}).catch(function(e){h.pause()})},pause:function(){r.info("VideoTagPlayer::pause"),h.paused||(h.pause(),r.info(this.playmode),"live"===this.playmode&&(this.instantplayback=!0,this.toggleControls()))},resume:function(){if(r.info("VideoTagPlayer::resume"),"live"===this.playmode){this.toggleControls(),this.instantplayback=!1;var e={channelId:i.channelId,errorCode:fromHex("0x1101")};void 0!==i.eventInstantPlaybackCallback&&null!==i.eventInstantPlaybackCallback&&i.eventInstantPlaybackCallback(e)}_||he()},stop:function(){r.debug("VideoTagPlayer::stop")},close:function(){r.info("VideoTagPlayer::close"),me();try{null!==A&&void 0!==A&&(A.removeSourceBuffer(A.sourceBuffers[0]),"ended"!==A.readyState&&A.endOfStream()),o=a=0,void 0!==t&&null!==t&&clearInterval(t),void 0!==e&&null!==e&&clearInterval(e)}catch(e){console.error("Video Tag Player, error code: "+e.code+", message: "+e.message)}var n=h.textTracks[V].cues;if(h.textTracks[V].mode="disabled",null!==n)for(var i=0;i<n.length;i++)h.textTracks[V].removeCue(n[i]);h.textTracks[V].oncuechange=null,function(){var e=0;if(null!==k&&null!==C){for(e=0;e<C.length;e++)k.removeEventListener(C[e],G);k=null}if(null!==A&&null!==S){for(e=0;e<S.length;e++)A.removeEventListener(S[e],z);A=null}if(null!==w)for(e=0;e<w.length;e++)h.removeEventListener(w[e],W);void 0!==document.webkitHidden&&document.removeEventListener("visibilitychange",X)}(),void 0!==h&&null!==h&&(h.style.background=""+h.style.background,window.URL.revokeObjectURL(h.src))},forward:function(){r.info("VideoTagPlayer::forward")},backward:function(){r.info("VideoTagPlayer::backward")},toggleControls:function(){h.hasAttribute("controls")?h.removeAttribute("controls"):h.setAttribute("controls","controls")},clearBuffer:function(){r.info("VideoTagPlayer::clearBuffer");var e=1*k.buffered.end(k.buffered.length-1);try{k.updating||(k.remove(0,e),r.info("VideoTagPlayer::clearBuffer buffer length = ",1*k.buffered.end(k.buffered.length-1)))}catch(e){throw r.error("VideoTagPlayer::clearBuffer remove buffer error from channel: "+this.channelId+", error message: "+e.message),new umpError({channelId:this.channelId,errorCode:fromHex("0x0501"),place:"videoTagPlayer.js:1147",message:"error has occured from source buffer of VideoTagPlayer."})}}}),new q}function VideoPlayer(){var e=log4javascript.getLogger("player");function t(){this,t.prototype.frameRate=30,t.prototype.minRemainTime=30,t.prototype.minTimerInterval=1,t.prototype.channelId=0,t.prototype.drop=!1,t.prototype.boxsize=4,t.prototype.maxdelay=.3,t.prototype.currentdelay=t.prototype.maxdelay}return t.prototype={init:function(t){e.info("videoPlayer::init")},onVideoData:function(t,n,i,r){e.info("videoPlayer::onVideoData")},play:function(){e.info("videoPlayer::play")},pause:function(){e.info("videoPlayer::pause")},resume:function(){e.info("videoPlayer::resume")},stop:function(){e.info("videoPlayer::stop")},close:function(){e.info("videoPlayer::close")},clearBuffer:function(){e.info("videoPlayer::clearBuffer")},addEventListener:function(e,t){switch(e){case"statistics":this.eventStatisticsCallback=t;break;case"capture":this.eventCaptureCallback=t;break;case"instantplayback":this.eventInstantPlaybackCallback=t}},setFrameRate:function(e){t.prototype.frameRate=e},getFrameRate:function(){return t.prototype.frameRate},setMaxInstantPlayback:function(e){t.prototype.minRemainTime=e},getMaxInstantPlayback:function(){return t.prototype.minRemainTime},setBufferClearInterval:function(e){t.prototype.minTimerInterval=e},getBufferClearInterval:function(){return t.prototype.minTimerInterval},useDropPacket:function(e){t.prototype.drop=e},isDropPacket:function(){return t.prototype.drop},updateMiniMapInfo:function(t){e.info("videoPlayer::updateMiniMapInfo")},setBoxSize:function(n){e.info("videoPlayer::setBoxSize: "+n),t.prototype.boxsize=n},getBoxSize:function(){return e.debug("videoPlayer::getBoxSize: "+t.prototype.boxsize),t.prototype.boxsize},forward:function(){e.info("videoPlayer::forward")},backward:function(){e.info("videoPlayer::backward")},setDefaultDelay:function(e){t.prototype.maxdelay=e},getDefaultDelay:function(){return t.prototype.maxdelay},setCurrentDelay:function(e){t.prototype.currentdelay=e},getCurrentDelay:function(){return t.prototype.currentdelay}},Object.defineProperty(this,"channelId",{get:function(){return channel},set:function(e){channel=e}}),Object.defineProperty(this,"playmode",{get:function(){return playmode},set:function(e){playmode=e}}),Object.defineProperty(this,"instantplayback",{get:function(){return instantplayback},set:function(e){instantplayback=e}}),new t}
//# sourceMappingURL=ump-player.sourcemap.map